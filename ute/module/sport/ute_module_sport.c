/**
*@file
*@brief        多运动模块
*@details     包含正常走路，跑步，登山等其他运动模式
*@author       zn.zeng
*@date       2021-07-27
*@version      v1.0
*/

#include "ute_module_message.h"
#include "ute_module_log.h"
#include "ute_module_sport.h"
#include "ute_drv_gsensor_common.h"
#include "ute_application_common.h"
#include "ute_module_profile_ble.h"
#include "ute_module_protocol.h"
#include "ute_module_filesystem.h"
#include "ute_module_crc.h"
#include "ute_module_sleep.h"
#include "ute_module_gui_common.h"
#include "ute_drv_battery_common.h"
#include "ute_drv_motor.h"
// #include "ute_drv_heart_vcxx_common.h"
#include "ute_module_notdisturb.h"
#if UTE_MODULE_DRINK_WATER_NOTIFY_SCREEN_SUPPORT
#include "ute_module_drinkwater.h"
#endif
#include "ute_module_heart.h"
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
#include "cwm_lib.h"
#include "ute_module_CyweeMotion.h"
#if (!UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT)
ute_step_sleep_param_t mStepSleepParam;
#endif
#endif
#if UTE_MODULE_WATCH_ROTATE_SUPPORT
#include "ute_rotate.h"
#endif

#include "func_cover.h"

/*! sport的数据 zn.zeng, 2021-10-23  */
ute_module_sport_data_t uteModuleSprotData;
uint8_t uteModuleSportMoreSportSyncDataBuff[SPORTS_SEND_DATA_READ_LENGTH];
/* 运动互斥量 zn.zeng 2022-02-14*/
void *uteModuleSprotMute;
/* 运动倒计时定时器 xjc 2022-05-31*/
void *uteModuleSprotCountdownTimer = NULL;
/*! 记步算法定时器,wang.luo 2023-05-05 */
#if !UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_ELLIPSIS_TIMER_SUPPORT
void *uteModuleSportInputDataBeforeAlgoTimer = NULL;
#else
static bool enableSportAlgorithmsTimer = false;
#endif
/**
*@brief  多运动模块初始化
*@details  在gsensor初始化后执行
*@author        zn.zeng
*@date        2021-07-27
*/
void uteModuleSportInit(void)
{
    uteModuleFilesystemCreateDirectory(UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR);
    uteModuleFilesystemCreateDirectory(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR);
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
    uteModuleFilesystemCreateDirectory(UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA);
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleFilesystemCreateDirectory(UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR);
#endif
#if UTE_MODULE_LOG_SUPPORT
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR, NULL, NULL);
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, NULL, NULL);
#endif
    uteModulePlatformCreateMutex(&uteModuleSprotMute);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,uteModuleSprotMute = 0x%d,", __func__,uteModuleSprotMute);
    memset(&uteModuleSprotData,0,sizeof(ute_module_sport_data_t));
    uteModuleSprotData.lastDayReadHour = -1;
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleSprotData.lastReadHour = 0xFF;
#endif
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
    uteModuleSprotData.sportSort.minSportNum = UTE_MODULE_SPORT_DISPLAY_MIN_SPORT_NUM;
    uteModuleSprotData.sportSort.maxSportNum = UTE_MODULE_SPORT_DISPLAY_MAX_SPORT_NUM;
#endif

    uteModuleSportReadConfig();
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
    uteModuleSportReadTodayTargetNotifyData();
#endif
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
    uteModuleSportReadTodayEveryHourAllSportStepData();
    uteModuleSportReadTodayEveryHourAllSportKcalData();
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleSportReadWeekDayData();
#else
    uteModuleSportReadWeekDayStep();
#endif
#endif

    uteModuleSystemtimeRegisterSecond(uteModuleSportEverySecond);
    uteModuleSportStepTypeSetStep();
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    disableTakingPicturesState();
#if ROLLOVER_HAND_SCREEN_ACC_DIFF_FAST_VALUE
    if(uteModuleLiftWristGetSensitivityLevel() == LIFT_WRIST_FAST)
    {
        initHandRollverScreenParam(ROLLOVER_HAND_SCREEN_FAST_X_MIN,ROLLOVER_HAND_SCREEN_FAST_X_MAX,ROLLOVER_HAND_SCREEN_FAST_Y_MIN,ROLLOVER_HAND_SCREEN_FAST_Y_MAX,ROLLOVER_HAND_SCREEN_FAST_Z_MIN,ROLLOVER_HAND_SCREEN_FAST_Z_MAX,ROLLOVER_HAND_SCREEN_ACC_DIFF_FAST_VALUE);
    }
    else
#endif
    {
        initHandRollverScreenParam(ROLLOVER_HAND_SCREEN_X_MIN,ROLLOVER_HAND_SCREEN_X_MAX,ROLLOVER_HAND_SCREEN_Y_MIN,ROLLOVER_HAND_SCREEN_Y_MAX,ROLLOVER_HAND_SCREEN_Z_MIN,ROLLOVER_HAND_SCREEN_Z_MAX,ROLLOVER_HAND_SCREEN_ACC_DIFF_VALUE);
    }
#endif
    uteModuleSprotResetRovllverScreenMode();

#if UTE_MODULE_SPORTS_HSTORY_RECORD_SUPPORT
    uteModuleSportReadHistoryRecordData();
#endif
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
    uteModuleSportReadStepSyncTimeInfo();
    uteModuleSportReadExerciseTimeSyncTimeInfo();
    uteModuleSportReadMoreSportsSyncTimeInfo();
#endif
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
    uteModuleSportReadMoreSportsOtherInfo();
#endif
}

/*! 支持百种多运动 xjc, 2022-03-29  */
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
const ute_sports_list_param_t uteModuleSportDefaultSort[] =
{
#if APP_MODULE_SCREENS_MORE_SPORT_LIST_SUPPORT
#if UTE_MODULE_SPORT_RUNNING_SUPPORT
    {.sportMode = SPORT_TYPE_RUNNING, .sportOnOff = UTE_MODULE_SPORT_RUNNING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RUNNING_ORDER},
#endif
#if UTE_MODULE_SPORT_OUTDOOR_WALK_SUPPORT
    {.sportMode = SPORT_TYPE_OUTDOOR_WALK, .sportOnOff = UTE_MODULE_SPORT_OUTDOOR_WALK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_OUTDOOR_WALK_ORDER},
#endif
#if UTE_MODULE_SPORT_TREADMILL_SUPPORT
    {.sportMode = SPORT_TYPE_TREADMILL, .sportOnOff = UTE_MODULE_SPORT_TREADMILL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TREADMILL_ORDER},
#endif
#if UTE_MODULE_SPORT_TRAIL_RUNNING_SUPPORT
    {.sportMode = SPORT_TYPE_TRAIL_RUNNING, .sportOnOff = UTE_MODULE_SPORT_TRAIL_RUNNING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TRAIL_RUNNING_ORDER},
#endif
#if UTE_MODULE_SPORT_CLIMBING_SUPPORT
    {.sportMode = SPORT_TYPE_CLIMBING, .sportOnOff = UTE_MODULE_SPORT_CLIMBING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CLIMBING_ORDER},
#endif
#if UTE_MODULE_SPORT_BIKE_SUPPORT
    {.sportMode = SPORT_TYPE_RIDE_BIKE, .sportOnOff = UTE_MODULE_SPORT_BIKE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BIKE_ORDER},
#endif
#if UTE_MODULE_SPORT_SPINNING_SUPPORT
    {.sportMode = SPORT_TYPE_SPINNING, .sportOnOff = UTE_MODULE_SPORT_SPINNING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SPINNING_ORDER},
#endif
#if UTE_MODULE_SPORT_FREE_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_FREE_TRAINING, .sportOnOff = UTE_MODULE_SPORT_FREE_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FREE_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_JUMP_ROPE_SUPPORT
    {.sportMode = SPORT_TYPE_JUMP_ROPE, .sportOnOff = UTE_MODULE_SPORT_JUMP_ROPE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_JUMP_ROPE_ORDER},
#endif
#if UTE_MODULE_SPORT_SWIMMING_SUPPORT
    {.sportMode = SPORT_TYPE_SWIMMING, .sportOnOff = UTE_MODULE_SPORT_SWIMMING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SWIMMING_ORDER},
#endif
#if UTE_MODULE_SPORT_BADMINTION_SUPPORT
    {.sportMode = SPORT_TYPE_BADMINTON, .sportOnOff = UTE_MODULE_SPORT_BADMINTION_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BADMINTION_ORDER},
#endif
#if UTE_MODULE_SPORT_TABLE_TENNIS_SUPPORT
    {.sportMode = SPORT_TYPE_TABLE_TENNIS, .sportOnOff = UTE_MODULE_SPORT_TABLE_TENNIS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TABLE_TENNIS_ORDER},
#endif
#if UTE_MODULE_SPORT_TENNIS_SUPPORT
    {.sportMode = SPORT_TYPE_TENNIS, .sportOnOff = UTE_MODULE_SPORT_TENNIS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TENNIS_ORDER},
#endif
#if UTE_MODULE_SPORT_WALKING_SUPPORT
    {.sportMode = SPORT_TYPE_WALKING, .sportOnOff = UTE_MODULE_SPORT_WALKING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_WALKING_ORDER},
#endif
#if UTE_MODULE_SPORT_BASKETBALL_SUPPORT
    {.sportMode = SPORT_TYPE_BASKETBALL, .sportOnOff = UTE_MODULE_SPORT_BASKETBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BASKETBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_FOOTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_FOOTBALL, .sportOnOff = UTE_MODULE_SPORT_FOOTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FOOTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_BASEBALL_SUPPORT
    {.sportMode = SPORT_TYPE_BASEBALL, .sportOnOff = UTE_MODULE_SPORT_BASEBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BASEBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_VOLLEYBALL_SUPPORT
    {.sportMode = SPORT_TYPE_VOLLEYBALL, .sportOnOff = UTE_MODULE_SPORT_VOLLEYBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_VOLLEYBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_CRICKET_SUPPORT
    {.sportMode = SPORT_TYPE_CRICKET, .sportOnOff = UTE_MODULE_SPORT_CRICKET_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CRICKET_ORDER},
#endif
#if UTE_MODULE_SPORT_RUGBY_SUPPORT
    {.sportMode = SPORT_TYPE_RUGBY, .sportOnOff = UTE_MODULE_SPORT_RUGBY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RUGBY_ORDER},
#endif
#if UTE_MODULE_SPORT_HOCKEY_SUPPORT
    {.sportMode = SPORT_TYPE_HOCKEY, .sportOnOff = UTE_MODULE_SPORT_HOCKEY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HOCKEY_ORDER},
#endif
#if UTE_MODULE_SPORT_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_DANCE, .sportOnOff = UTE_MODULE_SPORT_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_YOGA_SUPPORT
    {.sportMode = SPORT_TYPE_YOGA, .sportOnOff = UTE_MODULE_SPORT_YOGA_ON_OFF, .sportOrder = UTE_MODULE_SPORT_YOGA_ORDER},
#endif
#if UTE_MODULE_SPORT_SIT_UP_SUPPORT
    {.sportMode = SPORT_TYPE_SIT_UP, .sportOnOff = UTE_MODULE_SPORT_SIT_UP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SIT_UP_ORDER},
#endif
#if UTE_MODULE_SPORT_GYMNASTICS_SUPPORT
    {.sportMode = SPORT_TYPE_GYMNASTICS, .sportOnOff = UTE_MODULE_SPORT_GYMNASTICS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_GYMNASTICS_ORDER},
#endif
#if UTE_MODULE_SPORT_BOATING_SUPPORT
    {.sportMode = SPORT_TYPE_BOATING, .sportOnOff = UTE_MODULE_SPORT_BOATING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BOATING_ORDER},
#endif
#if UTE_MODULE_SPORT_JUMPING_JACK_SUPPORT
    {.sportMode = SPORT_TYPE_JUMPING_JACK, .sportOnOff = UTE_MODULE_SPORT_JUMPING_JACK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_JUMPING_JACK_ORDER},
#endif
#if UTE_MODULE_SPORT_INDOOR_WALK_SUPPORT
    {.sportMode = SPORT_TYPE_INDOOR_WALK, .sportOnOff = UTE_MODULE_SPORT_INDOOR_WALK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_INDOOR_WALK_ORDER},
#endif
#if UTE_MODULE_SPORT_INDOOR_RUN_SUPPORT
    {.sportMode = SPORT_TYPE_INDOOR_RUN, .sportOnOff = UTE_MODULE_SPORT_INDOOR_RUN_ON_OFF, .sportOrder = UTE_MODULE_SPORT_INDOOR_RUN_ORDER},
#endif
#if UTE_MODULE_SPORT_STRENGTH_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_STRENGTH_TRAINING, .sportOnOff = UTE_MODULE_SPORT_STRENGTH_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STRENGTH_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_STEP_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_STEP_TRAINING, .sportOnOff = UTE_MODULE_SPORT_STEP_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STEP_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_HORSE_RIDING_SUPPORT
    {.sportMode = SPORT_TYPE_HORSE_RIDING, .sportOnOff = UTE_MODULE_SPORT_HORSE_RIDING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HORSE_RIDING_ORDER},
#endif
#if UTE_MODULE_SPORT_ELLIPTICAL_TRAINER_SUPPORT
    {.sportMode = SPORT_TYPE_ELLIPTICAL_TRAINER, .sportOnOff = UTE_MODULE_SPORT_ELLIPTICAL_TRAINER_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ELLIPTICAL_TRAINER_ORDER},
#endif
#if UTE_MODULE_SPORT_TAI_CHI_SUPPORT
    {.sportMode = SPORT_TYPE_TAI_CHI, .sportOnOff = UTE_MODULE_SPORT_TAI_CHI_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TAI_CHI_ORDER},
#endif
#if UTE_MODULE_SPORT_SHUTTLECOCK_SUPPORT
    {.sportMode = SPORT_TYPE_SHUTTLECOCK, .sportOnOff = UTE_MODULE_SPORT_SHUTTLECOCK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SHUTTLECOCK_ORDER},
#endif
#if UTE_MODULE_SPORT_BOXING_SUPPORT
    {.sportMode = SPORT_TYPE_BOXING, .sportOnOff = UTE_MODULE_SPORT_BOXING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BOXING_ORDER},
#endif
#if UTE_MODULE_SPORT_SKIING_SUPPORT
    {.sportMode = SPORT_TYPE_SKIING, .sportOnOff = UTE_MODULE_SPORT_SKIING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SKIING_ORDER},
#endif
#if UTE_MODULE_SPORT_ICE_HOCKEY_SUPPORT
    {.sportMode = SPORT_TYPE_ICE_HOCKEY, .sportOnOff = UTE_MODULE_SPORT_ICE_HOCKEY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ICE_HOCKEY_ORDER},
#endif
#if UTE_MODULE_SPORT_TAEKWONDO_SUPPORT
    {.sportMode = SPORT_TYPE_TAEKWONDO, .sportOnOff = UTE_MODULE_SPORT_TAEKWONDO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TAEKWONDO_ORDER},
#endif
#if UTE_MODULE_SPORT_VO2MAX_TEST_SUPPORT
    {.sportMode = SPORT_TYPE_VO2MAX_TEST, .sportOnOff = UTE_MODULE_SPORT_VO2MAX_TEST_ON_OFF, .sportOrder = UTE_MODULE_SPORT_VO2MAX_TEST_ORDER},
#endif
#if UTE_MODULE_SPORT_ROWING_MACHING_SUPPORT
    {.sportMode = SPORT_TYPE_ROWING_MACHING, .sportOnOff = UTE_MODULE_SPORT_ROWING_MACHING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROWING_MACHING_ORDER},
#endif
#if UTE_MODULE_SPORT_AIR_WALKER_SUPPORT
    {.sportMode = SPORT_TYPE_AIR_WALKER, .sportOnOff = UTE_MODULE_SPORT_AIR_WALKER_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AIR_WALKER_ORDER},
#endif
#if UTE_MODULE_SPORT_HIKING_SUPPORT
    {.sportMode = SPORT_TYPE_HIKING, .sportOnOff = UTE_MODULE_SPORT_HIKING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HIKING_ORDER},
#endif
#if UTE_MODULE_SPORT_ATHLETICS_SUPPORT
    {.sportMode = SPORT_TYPE_ATHLETICS, .sportOnOff = UTE_MODULE_SPORT_ATHLETICS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ATHLETICS_ORDER},
#endif
#if UTE_MODULE_SPORT_WAIST_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_WAIST_TRAINING, .sportOnOff = UTE_MODULE_SPORT_WAIST_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_WAIST_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_KARATE_SUPPORT
    {.sportMode = SPORT_TYPE_KARATE, .sportOnOff = UTE_MODULE_SPORT_KARATE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_KARATE_ORDER},
#endif
#if UTE_MODULE_SPORT_COOLDOWN_SUPPORT
    {.sportMode = SPORT_TYPE_COOLDOWN, .sportOnOff = UTE_MODULE_SPORT_COOLDOWN_ON_OFF, .sportOrder = UTE_MODULE_SPORT_COOLDOWN_ORDER},
#endif
#if UTE_MODULE_SPORT_CROSS_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_CROSS_TRAINING, .sportOnOff = UTE_MODULE_SPORT_CROSS_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CROSS_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_PILATES_SUPPORT
    {.sportMode = SPORT_TYPE_PILATES, .sportOnOff = UTE_MODULE_SPORT_PILATES_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PILATES_ORDER},
#endif
#if UTE_MODULE_SPORT_CROSS_FIT_SUPPORT
    {.sportMode = SPORT_TYPE_CROSS_FIT, .sportOnOff = UTE_MODULE_SPORT_CROSS_FIT_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CROSS_FIT_ORDER},
#endif
#if UTE_MODULE_SPORT_FUNCTIONAL_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_FUNCTIONAL_TRAINING, .sportOnOff = UTE_MODULE_SPORT_FUNCTIONAL_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FUNCTIONAL_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_PHYSICAL_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_PHYSICAL_TRAINING, .sportOnOff = UTE_MODULE_SPORT_PHYSICAL_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PHYSICAL_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_ARCHERY_SUPPORT
    {.sportMode = SPORT_TYPE_ARCHERY, .sportOnOff = UTE_MODULE_SPORT_ARCHERY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ARCHERY_ORDER},
#endif
#if UTE_MODULE_SPORT_FLEXIBILITY_SUPPORT
    {.sportMode = SPORT_TYPE_FLEXIBILITY, .sportOnOff = UTE_MODULE_SPORT_FLEXIBILITY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FLEXIBILITY_ORDER},
#endif
#if UTE_MODULE_SPORT_MIXED_CARDIO_SUPPORT
    {.sportMode = SPORT_TYPE_MIXED_CARDIO, .sportOnOff = UTE_MODULE_SPORT_MIXED_CARDIO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MIXED_CARDIO_ORDER},
#endif
#if UTE_MODULE_SPORT_LATIN_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_LATIN_DANCE, .sportOnOff = UTE_MODULE_SPORT_LATIN_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_LATIN_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_STREET_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_STREET_DANCE, .sportOnOff = UTE_MODULE_SPORT_STREET_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STREET_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_KICKBOXING_SUPPORT
    {.sportMode = SPORT_TYPE_KICKBOXING, .sportOnOff = UTE_MODULE_SPORT_KICKBOXING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_KICKBOXING_ORDER},
#endif
#if UTE_MODULE_SPORT_BARRE_SUPPORT
    {.sportMode = SPORT_TYPE_BARRE, .sportOnOff = UTE_MODULE_SPORT_BARRE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BARRE_ORDER},
#endif
#if UTE_MODULE_SPORT_AUSTRALIAN_FOOTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_AUSTRALIAN_FOOTBALL, .sportOnOff = UTE_MODULE_SPORT_AUSTRALIAN_FOOTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AUSTRALIAN_FOOTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_MARTIAL_ARTS_SUPPORT
    {.sportMode = SPORT_TYPE_MARTIAL_ARTS, .sportOnOff = UTE_MODULE_SPORT_MARTIAL_ARTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MARTIAL_ARTS_ORDER},
#endif
#if UTE_MODULE_SPORT_STAIRS_SUPPORT
    {.sportMode = SPORT_TYPE_STAIRS, .sportOnOff = UTE_MODULE_SPORT_STAIRS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STAIRS_ORDER},
#endif
#if UTE_MODULE_SPORT_HANDBALL_SUPPORT
    {.sportMode = SPORT_TYPE_HANDBALL, .sportOnOff = UTE_MODULE_SPORT_HANDBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HANDBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_BOWLING_SUPPORT
    {.sportMode = SPORT_TYPE_BOWLING, .sportOnOff = UTE_MODULE_SPORT_BOWLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BOWLING_ORDER},
#endif
#if UTE_MODULE_SPORT_RACQUETBALL_SUPPORT
    {.sportMode = SPORT_TYPE_RACQUETBALL, .sportOnOff = UTE_MODULE_SPORT_RACQUETBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RACQUETBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_CURLING_SUPPORT
    {.sportMode = SPORT_TYPE_CURLING, .sportOnOff = UTE_MODULE_SPORT_CURLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CURLING_ORDER},
#endif
#if UTE_MODULE_SPORT_HUNTING_SUPPORT
    {.sportMode = SPORT_TYPE_HUNTING, .sportOnOff = UTE_MODULE_SPORT_HUNTING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HUNTING_ORDER},
#endif
#if UTE_MODULE_SPORT_SNOWBOARDING_SUPPORT
    {.sportMode = SPORT_TYPE_SNOWBOARDING, .sportOnOff = UTE_MODULE_SPORT_SNOWBOARDING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SNOWBOARDING_ORDER},
#endif
#if UTE_MODULE_SPORT_PLAY_SUPPORT
    {.sportMode = SPORT_TYPE_PLAY, .sportOnOff = UTE_MODULE_SPORT_PLAY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PLAY_ORDER},
#endif
#if UTE_MODULE_SPORT_AMERICAN_FOOTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_AMERICAN_FOOTBALL, .sportOnOff = UTE_MODULE_SPORT_AMERICAN_FOOTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AMERICAN_FOOTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_HAND_CYCLING_SUPPORT
    {.sportMode = SPORT_TYPE_HAND_CYCLING, .sportOnOff = UTE_MODULE_SPORT_HAND_CYCLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HAND_CYCLING_ORDER},
#endif
#if UTE_MODULE_SPORT_FISHING_SUPPORT
    {.sportMode = SPORT_TYPE_FISHING, .sportOnOff = UTE_MODULE_SPORT_FISHING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FISHING_ORDER},
#endif
#if UTE_MODULE_SPORT_DISC_SPORTS_SUPPORT
    {.sportMode = SPORT_TYPE_DISC_SPORTS, .sportOnOff = UTE_MODULE_SPORT_DISC_SPORTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DISC_SPORTS_ORDER},
#endif
#if UTE_MODULE_SPORT_RUGGER_SUPPORT
    {.sportMode = SPORT_TYPE_RUGGER, .sportOnOff = UTE_MODULE_SPORT_RUGGER_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RUGGER_ORDER},
#endif
#if UTE_MODULE_SPORT_GOLF_SUPPORT
    {.sportMode = SPORT_TYPE_GOLF, .sportOnOff = UTE_MODULE_SPORT_GOLF_ON_OFF, .sportOrder = UTE_MODULE_SPORT_GOLF_ORDER},
#endif
#if UTE_MODULE_SPORT_FOLK_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_FOLK_DANCE, .sportOnOff = UTE_MODULE_SPORT_FOLK_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FOLK_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_DOWNHILL_SKIING_SUPPORT
    {.sportMode = SPORT_TYPE_DOWNHILL_SKIING, .sportOnOff = UTE_MODULE_SPORT_DOWNHILL_SKIING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DOWNHILL_SKIING_ORDER},
#endif
#if UTE_MODULE_SPORT_SNOW_SPORTS_SUPPORT
    {.sportMode = SPORT_TYPE_SNOW_SPORTS, .sportOnOff = UTE_MODULE_SPORT_SNOW_SPORTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SNOW_SPORTS_ORDER},
#endif
#if UTE_MODULE_SPORT_MIND_BODY_SUPPORT
    {.sportMode = SPORT_TYPE_MIND_BODY, .sportOnOff = UTE_MODULE_SPORT_MIND_BODY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MIND_BODY_ORDER},
#endif
#if UTE_MODULE_SPORT_CORE_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_CORE_TRAINING, .sportOnOff = UTE_MODULE_SPORT_CORE_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CORE_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_SKATING_SUPPORT
    {.sportMode = SPORT_TYPE_SKATING, .sportOnOff = UTE_MODULE_SPORT_SKATING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SKATING_ORDER},
#endif
#if UTE_MODULE_SPORT_FITNESS_GAMING_SUPPORT
    {.sportMode = SPORT_TYPE_FITNESS_GAMING, .sportOnOff = UTE_MODULE_SPORT_FITNESS_GAMING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FITNESS_GAMING_ORDER},
#endif
#if UTE_MODULE_SPORT_AEROBICS_SUPPORT
    {.sportMode = SPORT_TYPE_AEROBICS, .sportOnOff = UTE_MODULE_SPORT_AEROBICS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AEROBICS_ORDER},
#endif
#if UTE_MODULE_SPORT_GROUP_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_GROUP_TRAINING, .sportOnOff = UTE_MODULE_SPORT_GROUP_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_GROUP_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_KENDO_SUPPORT
    {.sportMode = SPORT_TYPE_KENDO, .sportOnOff = UTE_MODULE_SPORT_KENDO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_KENDO_ORDER},
#endif
#if UTE_MODULE_SPORT_LACROSSE_SUPPORT
    {.sportMode = SPORT_TYPE_LACROSSE, .sportOnOff = UTE_MODULE_SPORT_LACROSSE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_LACROSSE_ORDER},
#endif
#if UTE_MODULE_SPORT_ROLLING_SUPPORT
    {.sportMode = SPORT_TYPE_ROLLING, .sportOnOff = UTE_MODULE_SPORT_ROLLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROLLING_ORDER},
#endif
#if UTE_MODULE_SPORT_WRESTLING_SUPPORT
    {.sportMode = SPORT_TYPE_WRESTLING, .sportOnOff = UTE_MODULE_SPORT_WRESTLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_WRESTLING_ORDER},
#endif
#if UTE_MODULE_SPORT_FENCING_SUPPORT
    {.sportMode = SPORT_TYPE_FENCING, .sportOnOff = UTE_MODULE_SPORT_FENCING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FENCING_ORDER},
#endif
#if UTE_MODULE_SPORT_SOFTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_SOFTBALL, .sportOnOff = UTE_MODULE_SPORT_SOFTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SOFTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_SINGLE_BAR_SUPPORT
    {.sportMode = SPORT_TYPE_SINGLE_BAR, .sportOnOff = UTE_MODULE_SPORT_SINGLE_BAR_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SINGLE_BAR_ORDER},
#endif
#if UTE_MODULE_SPORT_PARALLEL_BARS_SUPPORT
    {.sportMode = SPORT_TYPE_PARALLEL_BARS, .sportOnOff = UTE_MODULE_SPORT_PARALLEL_BARS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PARALLEL_BARS_ORDER},
#endif
#if UTE_MODULE_SPORT_ROLLER_SKATING_SUPPORT
    {.sportMode = SPORT_TYPE_ROLLER_SKATING, .sportOnOff = UTE_MODULE_SPORT_ROLLER_SKATING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROLLER_SKATING_ORDER},
#endif
#if UTE_MODULE_SPORT_HULA_HOOP_SUPPORT
    {.sportMode = SPORT_TYPE_HULA_HOOP, .sportOnOff = UTE_MODULE_SPORT_HULA_HOOP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HULA_HOOP_ORDER},
#endif
#if UTE_MODULE_SPORT_DARTS_SUPPORT
    {.sportMode = SPORT_TYPE_DARTS, .sportOnOff = UTE_MODULE_SPORT_DARTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DARTS_ORDER},
#endif
#if UTE_MODULE_SPORT_PICKLEBALL_SUPPORT
    {.sportMode = SPORT_TYPE_PICKLEBALL, .sportOnOff = UTE_MODULE_SPORT_PICKLEBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PICKLEBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_HIIT_SUPPORT
    {.sportMode = SPORT_TYPE_HIIT, .sportOnOff = UTE_MODULE_SPORT_HIIT_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HIIT_ORDER},
#endif
#if UTE_MODULE_SPORT_SHOOTING_SUPPORT
    {.sportMode = SPORT_TYPE_SHOOTING, .sportOnOff = UTE_MODULE_SPORT_SHOOTING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SHOOTING_ORDER},
#endif
#if UTE_MODULE_SPORT_JUDO_SUPPORT
    {.sportMode = SPORT_TYPE_JUDO, .sportOnOff = UTE_MODULE_SPORT_JUDO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_JUDO_ORDER},
#endif
#if UTE_MODULE_SPORT_TRAMPOLINE_SUPPORT
    {.sportMode = SPORT_TYPE_TRAMPOLINE, .sportOnOff = UTE_MODULE_SPORT_TRAMPOLINE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TRAMPOLINE_ORDER},
#endif
#if UTE_MODULE_SPORT_SKATEBOARDING_SUPPORT
    {.sportMode = SPORT_TYPE_SKATEBOARDING, .sportOnOff = UTE_MODULE_SPORT_SKATEBOARDING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SKATEBOARDING_ORDER},
#endif
#if UTE_MODULE_SPORT_HOVERBOARD_SUPPORT
    {.sportMode = SPORT_TYPE_HOVERBOARD, .sportOnOff = UTE_MODULE_SPORT_HOVERBOARD_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HOVERBOARD_ORDER},
#endif
#if UTE_MODULE_SPORT_BLADING_SUPPORT
    {.sportMode = SPORT_TYPE_BLADING, .sportOnOff = UTE_MODULE_SPORT_BLADING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BLADING_ORDER},
#endif
#if UTE_MODULE_SPORT_PARKOUR_SUPPORT
    {.sportMode = SPORT_TYPE_PARKOUR, .sportOnOff = UTE_MODULE_SPORT_PARKOUR_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PARKOUR_ORDER},
#endif
#if UTE_MODULE_SPORT_DIVING_SUPPORT
    {.sportMode = SPORT_TYPE_DIVING, .sportOnOff = UTE_MODULE_SPORT_DIVING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DIVING_ORDER},
#endif
#if UTE_MODULE_SPORT_SURFING_SUPPORT
    {.sportMode = SPORT_TYPE_SURFING, .sportOnOff = UTE_MODULE_SPORT_SURFING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SURFING_ORDER},
#endif
#if UTE_MODULE_SPORT_SNORKELING_SUPPORT
    {.sportMode = SPORT_TYPE_SNORKELING, .sportOnOff = UTE_MODULE_SPORT_SNORKELING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SNORKELING_ORDER},
#endif
#if UTE_MODULE_SPORT_PULL_UP_SUPPORT
    {.sportMode = SPORT_TYPE_PULL_UP, .sportOnOff = UTE_MODULE_SPORT_PULL_UP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PULL_UP_ORDER},
#endif
#if UTE_MODULE_SPORT_PUSH_UP_SUPPORT
    {.sportMode = SPORT_TYPE_PUSH_UP, .sportOnOff = UTE_MODULE_SPORT_PUSH_UP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PUSH_UP_ORDER},
#endif
#if UTE_MODULE_SPORT_PLANKING_SUPPORT
    {.sportMode = SPORT_TYPE_PLANKING, .sportOnOff = UTE_MODULE_SPORT_PLANKING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PLANKING_ORDER},
#endif
#if UTE_MODULE_SPORT_ROCK_CLIMBING_SUPPORT
    {.sportMode = SPORT_TYPE_ROCK_CLIMBING, .sportOnOff = UTE_MODULE_SPORT_ROCK_CLIMBING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROCK_CLIMBING_ORDER},
#endif
#if UTE_MODULE_SPORT_HIGHTJUMP_SUPPORT
    {.sportMode = SPORT_TYPE_HIGHTJUMP, .sportOnOff = UTE_MODULE_SPORT_HIGHTJUMP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HIGHTJUMP_ORDER},
#endif
#if UTE_MODULE_SPORT_BUNGEE_JUMPING_SUPPORT
    {.sportMode = SPORT_TYPE_BUNGEE_JUMPING, .sportOnOff = UTE_MODULE_SPORT_BUNGEE_JUMPING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BUNGEE_JUMPING_ORDER},
#endif
#if UTE_MODULE_SPORT_LONGJUMP_SUPPORT
    {.sportMode = SPORT_TYPE_LONGJUMP, .sportOnOff = UTE_MODULE_SPORT_LONGJUMP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_LONGJUMP_ORDER},
#endif
#if UTE_MODULE_SPORT_MARATHON_SUPPORT
    {.sportMode = SPORT_TYPE_MARATHON, .sportOnOff = UTE_MODULE_SPORT_MARATHON_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MARATHON_ORDER},
#endif

#else
#if UTE_MODULE_SPORT_RUNNING_SUPPORT
    {.sportMode = SPORT_TYPE_RUNNING, .sportOnOff = UTE_MODULE_SPORT_RUNNING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RUNNING_ORDER},
#endif
#if UTE_MODULE_SPORT_BIKE_SUPPORT
    {.sportMode = SPORT_TYPE_RIDE_BIKE, .sportOnOff = UTE_MODULE_SPORT_BIKE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BIKE_ORDER},
#endif
#if UTE_MODULE_SPORT_JUMP_ROPE_SUPPORT
    {.sportMode = SPORT_TYPE_JUMP_ROPE, .sportOnOff = UTE_MODULE_SPORT_JUMP_ROPE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_JUMP_ROPE_ORDER},
#endif
#if UTE_MODULE_SPORT_SWIMMING_SUPPORT
    {.sportMode = SPORT_TYPE_SWIMMING, .sportOnOff = UTE_MODULE_SPORT_SWIMMING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SWIMMING_ORDER},
#endif
#if UTE_MODULE_SPORT_BADMINTION_SUPPORT
    {.sportMode = SPORT_TYPE_BADMINTON, .sportOnOff = UTE_MODULE_SPORT_BADMINTION_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BADMINTION_ORDER},
#endif
#if UTE_MODULE_SPORT_TABLE_TENNIS_SUPPORT
    {.sportMode = SPORT_TYPE_TABLE_TENNIS, .sportOnOff = UTE_MODULE_SPORT_TABLE_TENNIS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TABLE_TENNIS_ORDER},
#endif
#if UTE_MODULE_SPORT_TENNIS_SUPPORT
    {.sportMode = SPORT_TYPE_TENNIS, .sportOnOff = UTE_MODULE_SPORT_TENNIS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TENNIS_ORDER},
#endif
#if UTE_MODULE_SPORT_CLIMBING_SUPPORT
    {.sportMode = SPORT_TYPE_CLIMBING, .sportOnOff = UTE_MODULE_SPORT_CLIMBING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CLIMBING_ORDER},
#endif
#if UTE_MODULE_SPORT_WALKING_SUPPORT
    {.sportMode = SPORT_TYPE_WALKING, .sportOnOff = UTE_MODULE_SPORT_WALKING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_WALKING_ORDER},
#endif
#if UTE_MODULE_SPORT_BASKETBALL_SUPPORT
    {.sportMode = SPORT_TYPE_BASKETBALL, .sportOnOff = UTE_MODULE_SPORT_BASKETBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BASKETBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_FOOTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_FOOTBALL, .sportOnOff = UTE_MODULE_SPORT_FOOTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FOOTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_BASEBALL_SUPPORT
    {.sportMode = SPORT_TYPE_BASEBALL, .sportOnOff = UTE_MODULE_SPORT_BASEBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BASEBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_VOLLEYBALL_SUPPORT
    {.sportMode = SPORT_TYPE_VOLLEYBALL, .sportOnOff = UTE_MODULE_SPORT_VOLLEYBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_VOLLEYBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_CRICKET_SUPPORT
    {.sportMode = SPORT_TYPE_CRICKET, .sportOnOff = UTE_MODULE_SPORT_CRICKET_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CRICKET_ORDER},
#endif
#if UTE_MODULE_SPORT_RUGBY_SUPPORT
    {.sportMode = SPORT_TYPE_RUGBY, .sportOnOff = UTE_MODULE_SPORT_RUGBY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RUGBY_ORDER},
#endif
#if UTE_MODULE_SPORT_HOCKEY_SUPPORT
    {.sportMode = SPORT_TYPE_HOCKEY, .sportOnOff = UTE_MODULE_SPORT_HOCKEY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HOCKEY_ORDER},
#endif
#if UTE_MODULE_SPORT_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_DANCE, .sportOnOff = UTE_MODULE_SPORT_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_SPINNING_SUPPORT
    {.sportMode = SPORT_TYPE_SPINNING, .sportOnOff = UTE_MODULE_SPORT_SPINNING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SPINNING_ORDER},
#endif
#if UTE_MODULE_SPORT_YOGA_SUPPORT
    {.sportMode = SPORT_TYPE_YOGA, .sportOnOff = UTE_MODULE_SPORT_YOGA_ON_OFF, .sportOrder = UTE_MODULE_SPORT_YOGA_ORDER},
#endif
#if UTE_MODULE_SPORT_SIT_UP_SUPPORT
    {.sportMode = SPORT_TYPE_SIT_UP, .sportOnOff = UTE_MODULE_SPORT_SIT_UP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SIT_UP_ORDER},
#endif
#if UTE_MODULE_SPORT_TREADMILL_SUPPORT
    {.sportMode = SPORT_TYPE_TREADMILL, .sportOnOff = UTE_MODULE_SPORT_TREADMILL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TREADMILL_ORDER},
#endif
#if UTE_MODULE_SPORT_GYMNASTICS_SUPPORT
    {.sportMode = SPORT_TYPE_GYMNASTICS, .sportOnOff = UTE_MODULE_SPORT_GYMNASTICS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_GYMNASTICS_ORDER},
#endif
#if UTE_MODULE_SPORT_BOATING_SUPPORT
    {.sportMode = SPORT_TYPE_BOATING, .sportOnOff = UTE_MODULE_SPORT_BOATING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BOATING_ORDER},
#endif
#if UTE_MODULE_SPORT_JUMPING_JACK_SUPPORT
    {.sportMode = SPORT_TYPE_JUMPING_JACK, .sportOnOff = UTE_MODULE_SPORT_JUMPING_JACK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_JUMPING_JACK_ORDER},
#endif
#if UTE_MODULE_SPORT_FREE_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_FREE_TRAINING, .sportOnOff = UTE_MODULE_SPORT_FREE_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FREE_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_INDOOR_WALK_SUPPORT
    {.sportMode = SPORT_TYPE_INDOOR_WALK, .sportOnOff = UTE_MODULE_SPORT_INDOOR_WALK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_INDOOR_WALK_ORDER},
#endif
#if UTE_MODULE_SPORT_INDOOR_RUN_SUPPORT
    {.sportMode = SPORT_TYPE_INDOOR_RUN, .sportOnOff = UTE_MODULE_SPORT_INDOOR_RUN_ON_OFF, .sportOrder = UTE_MODULE_SPORT_INDOOR_RUN_ORDER},
#endif
#if UTE_MODULE_SPORT_STRENGTH_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_STRENGTH_TRAINING, .sportOnOff = UTE_MODULE_SPORT_STRENGTH_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STRENGTH_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_STEP_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_STEP_TRAINING, .sportOnOff = UTE_MODULE_SPORT_STEP_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STEP_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_HORSE_RIDING_SUPPORT
    {.sportMode = SPORT_TYPE_HORSE_RIDING, .sportOnOff = UTE_MODULE_SPORT_HORSE_RIDING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HORSE_RIDING_ORDER},
#endif
#if UTE_MODULE_SPORT_ELLIPTICAL_TRAINER_SUPPORT
    {.sportMode = SPORT_TYPE_ELLIPTICAL_TRAINER, .sportOnOff = UTE_MODULE_SPORT_ELLIPTICAL_TRAINER_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ELLIPTICAL_TRAINER_ORDER},
#endif
#if UTE_MODULE_SPORT_TAI_CHI_SUPPORT
    {.sportMode = SPORT_TYPE_TAI_CHI, .sportOnOff = UTE_MODULE_SPORT_TAI_CHI_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TAI_CHI_ORDER},
#endif
#if UTE_MODULE_SPORT_SHUTTLECOCK_SUPPORT
    {.sportMode = SPORT_TYPE_SHUTTLECOCK, .sportOnOff = UTE_MODULE_SPORT_SHUTTLECOCK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SHUTTLECOCK_ORDER},
#endif
#if UTE_MODULE_SPORT_BOXING_SUPPORT
    {.sportMode = SPORT_TYPE_BOXING, .sportOnOff = UTE_MODULE_SPORT_BOXING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BOXING_ORDER},
#endif
#if UTE_MODULE_SPORT_OUTDOOR_WALK_SUPPORT
    {.sportMode = SPORT_TYPE_OUTDOOR_WALK, .sportOnOff = UTE_MODULE_SPORT_OUTDOOR_WALK_ON_OFF, .sportOrder = UTE_MODULE_SPORT_OUTDOOR_WALK_ORDER},
#endif
#if UTE_MODULE_SPORT_TRAIL_RUNNING_SUPPORT
    {.sportMode = SPORT_TYPE_TRAIL_RUNNING, .sportOnOff = UTE_MODULE_SPORT_TRAIL_RUNNING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TRAIL_RUNNING_ORDER},
#endif
#if UTE_MODULE_SPORT_SKIING_SUPPORT
    {.sportMode = SPORT_TYPE_SKIING, .sportOnOff = UTE_MODULE_SPORT_SKIING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SKIING_ORDER},
#endif
#if UTE_MODULE_SPORT_ICE_HOCKEY_SUPPORT
    {.sportMode = SPORT_TYPE_ICE_HOCKEY, .sportOnOff = UTE_MODULE_SPORT_ICE_HOCKEY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ICE_HOCKEY_ORDER},
#endif
#if UTE_MODULE_SPORT_TAEKWONDO_SUPPORT
    {.sportMode = SPORT_TYPE_TAEKWONDO, .sportOnOff = UTE_MODULE_SPORT_TAEKWONDO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TAEKWONDO_ORDER},
#endif
#if UTE_MODULE_SPORT_VO2MAX_TEST_SUPPORT
    {.sportMode = SPORT_TYPE_VO2MAX_TEST, .sportOnOff = UTE_MODULE_SPORT_VO2MAX_TEST_ON_OFF, .sportOrder = UTE_MODULE_SPORT_VO2MAX_TEST_ORDER},
#endif
#if UTE_MODULE_SPORT_ROWING_MACHING_SUPPORT
    {.sportMode = SPORT_TYPE_ROWING_MACHING, .sportOnOff = UTE_MODULE_SPORT_ROWING_MACHING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROWING_MACHING_ORDER},
#endif
#if UTE_MODULE_SPORT_AIR_WALKER_SUPPORT
    {.sportMode = SPORT_TYPE_AIR_WALKER, .sportOnOff = UTE_MODULE_SPORT_AIR_WALKER_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AIR_WALKER_ORDER},
#endif
#if UTE_MODULE_SPORT_HIKING_SUPPORT
    {.sportMode = SPORT_TYPE_HIKING, .sportOnOff = UTE_MODULE_SPORT_HIKING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HIKING_ORDER},
#endif
#if UTE_MODULE_SPORT_ATHLETICS_SUPPORT
    {.sportMode = SPORT_TYPE_ATHLETICS, .sportOnOff = UTE_MODULE_SPORT_ATHLETICS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ATHLETICS_ORDER},
#endif
#if UTE_MODULE_SPORT_WAIST_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_WAIST_TRAINING, .sportOnOff = UTE_MODULE_SPORT_WAIST_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_WAIST_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_KARATE_SUPPORT
    {.sportMode = SPORT_TYPE_KARATE, .sportOnOff = UTE_MODULE_SPORT_KARATE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_KARATE_ORDER},
#endif
#if UTE_MODULE_SPORT_COOLDOWN_SUPPORT
    {.sportMode = SPORT_TYPE_COOLDOWN, .sportOnOff = UTE_MODULE_SPORT_COOLDOWN_ON_OFF, .sportOrder = UTE_MODULE_SPORT_COOLDOWN_ORDER},
#endif
#if UTE_MODULE_SPORT_CROSS_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_CROSS_TRAINING, .sportOnOff = UTE_MODULE_SPORT_CROSS_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CROSS_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_PILATES_SUPPORT
    {.sportMode = SPORT_TYPE_PILATES, .sportOnOff = UTE_MODULE_SPORT_PILATES_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PILATES_ORDER},
#endif
#if UTE_MODULE_SPORT_CROSS_FIT_SUPPORT
    {.sportMode = SPORT_TYPE_CROSS_FIT, .sportOnOff = UTE_MODULE_SPORT_CROSS_FIT_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CROSS_FIT_ORDER},
#endif
#if UTE_MODULE_SPORT_FUNCTIONAL_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_FUNCTIONAL_TRAINING, .sportOnOff = UTE_MODULE_SPORT_FUNCTIONAL_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FUNCTIONAL_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_PHYSICAL_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_PHYSICAL_TRAINING, .sportOnOff = UTE_MODULE_SPORT_PHYSICAL_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PHYSICAL_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_ARCHERY_SUPPORT
    {.sportMode = SPORT_TYPE_ARCHERY, .sportOnOff = UTE_MODULE_SPORT_ARCHERY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ARCHERY_ORDER},
#endif
#if UTE_MODULE_SPORT_FLEXIBILITY_SUPPORT
    {.sportMode = SPORT_TYPE_FLEXIBILITY, .sportOnOff = UTE_MODULE_SPORT_FLEXIBILITY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FLEXIBILITY_ORDER},
#endif
#if UTE_MODULE_SPORT_MIXED_CARDIO_SUPPORT
    {.sportMode = SPORT_TYPE_MIXED_CARDIO, .sportOnOff = UTE_MODULE_SPORT_MIXED_CARDIO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MIXED_CARDIO_ORDER},
#endif
#if UTE_MODULE_SPORT_LATIN_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_LATIN_DANCE, .sportOnOff = UTE_MODULE_SPORT_LATIN_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_LATIN_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_STREET_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_STREET_DANCE, .sportOnOff = UTE_MODULE_SPORT_STREET_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STREET_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_KICKBOXING_SUPPORT
    {.sportMode = SPORT_TYPE_KICKBOXING, .sportOnOff = UTE_MODULE_SPORT_KICKBOXING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_KICKBOXING_ORDER},
#endif
#if UTE_MODULE_SPORT_BARRE_SUPPORT
    {.sportMode = SPORT_TYPE_BARRE, .sportOnOff = UTE_MODULE_SPORT_BARRE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BARRE_ORDER},
#endif
#if UTE_MODULE_SPORT_AUSTRALIAN_FOOTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_AUSTRALIAN_FOOTBALL, .sportOnOff = UTE_MODULE_SPORT_AUSTRALIAN_FOOTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AUSTRALIAN_FOOTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_MARTIAL_ARTS_SUPPORT
    {.sportMode = SPORT_TYPE_MARTIAL_ARTS, .sportOnOff = UTE_MODULE_SPORT_MARTIAL_ARTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MARTIAL_ARTS_ORDER},
#endif
#if UTE_MODULE_SPORT_STAIRS_SUPPORT
    {.sportMode = SPORT_TYPE_STAIRS, .sportOnOff = UTE_MODULE_SPORT_STAIRS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_STAIRS_ORDER},
#endif
#if UTE_MODULE_SPORT_HANDBALL_SUPPORT
    {.sportMode = SPORT_TYPE_HANDBALL, .sportOnOff = UTE_MODULE_SPORT_HANDBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HANDBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_BOWLING_SUPPORT
    {.sportMode = SPORT_TYPE_BOWLING, .sportOnOff = UTE_MODULE_SPORT_BOWLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BOWLING_ORDER},
#endif
#if UTE_MODULE_SPORT_RACQUETBALL_SUPPORT
    {.sportMode = SPORT_TYPE_RACQUETBALL, .sportOnOff = UTE_MODULE_SPORT_RACQUETBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RACQUETBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_CURLING_SUPPORT
    {.sportMode = SPORT_TYPE_CURLING, .sportOnOff = UTE_MODULE_SPORT_CURLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CURLING_ORDER},
#endif
#if UTE_MODULE_SPORT_HUNTING_SUPPORT
    {.sportMode = SPORT_TYPE_HUNTING, .sportOnOff = UTE_MODULE_SPORT_HUNTING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HUNTING_ORDER},
#endif
#if UTE_MODULE_SPORT_SNOWBOARDING_SUPPORT
    {.sportMode = SPORT_TYPE_SNOWBOARDING, .sportOnOff = UTE_MODULE_SPORT_SNOWBOARDING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SNOWBOARDING_ORDER},
#endif
#if UTE_MODULE_SPORT_PLAY_SUPPORT
    {.sportMode = SPORT_TYPE_PLAY, .sportOnOff = UTE_MODULE_SPORT_PLAY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PLAY_ORDER},
#endif
#if UTE_MODULE_SPORT_AMERICAN_FOOTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_AMERICAN_FOOTBALL, .sportOnOff = UTE_MODULE_SPORT_AMERICAN_FOOTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AMERICAN_FOOTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_HAND_CYCLING_SUPPORT
    {.sportMode = SPORT_TYPE_HAND_CYCLING, .sportOnOff = UTE_MODULE_SPORT_HAND_CYCLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HAND_CYCLING_ORDER},
#endif
#if UTE_MODULE_SPORT_FISHING_SUPPORT
    {.sportMode = SPORT_TYPE_FISHING, .sportOnOff = UTE_MODULE_SPORT_FISHING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FISHING_ORDER},
#endif
#if UTE_MODULE_SPORT_DISC_SPORTS_SUPPORT
    {.sportMode = SPORT_TYPE_DISC_SPORTS, .sportOnOff = UTE_MODULE_SPORT_DISC_SPORTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DISC_SPORTS_ORDER},
#endif
#if UTE_MODULE_SPORT_RUGGER_SUPPORT
    {.sportMode = SPORT_TYPE_RUGGER, .sportOnOff = UTE_MODULE_SPORT_RUGGER_ON_OFF, .sportOrder = UTE_MODULE_SPORT_RUGGER_ORDER},
#endif
#if UTE_MODULE_SPORT_GOLF_SUPPORT
    {.sportMode = SPORT_TYPE_GOLF, .sportOnOff = UTE_MODULE_SPORT_GOLF_ON_OFF, .sportOrder = UTE_MODULE_SPORT_GOLF_ORDER},
#endif
#if UTE_MODULE_SPORT_FOLK_DANCE_SUPPORT
    {.sportMode = SPORT_TYPE_FOLK_DANCE, .sportOnOff = UTE_MODULE_SPORT_FOLK_DANCE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FOLK_DANCE_ORDER},
#endif
#if UTE_MODULE_SPORT_DOWNHILL_SKIING_SUPPORT
    {.sportMode = SPORT_TYPE_DOWNHILL_SKIING, .sportOnOff = UTE_MODULE_SPORT_DOWNHILL_SKIING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DOWNHILL_SKIING_ORDER},
#endif
#if UTE_MODULE_SPORT_SNOW_SPORTS_SUPPORT
    {.sportMode = SPORT_TYPE_SNOW_SPORTS, .sportOnOff = UTE_MODULE_SPORT_SNOW_SPORTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SNOW_SPORTS_ORDER},
#endif
#if UTE_MODULE_SPORT_MIND_BODY_SUPPORT
    {.sportMode = SPORT_TYPE_MIND_BODY, .sportOnOff = UTE_MODULE_SPORT_MIND_BODY_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MIND_BODY_ORDER},
#endif
#if UTE_MODULE_SPORT_CORE_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_CORE_TRAINING, .sportOnOff = UTE_MODULE_SPORT_CORE_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_CORE_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_SKATING_SUPPORT
    {.sportMode = SPORT_TYPE_SKATING, .sportOnOff = UTE_MODULE_SPORT_SKATING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SKATING_ORDER},
#endif
#if UTE_MODULE_SPORT_FITNESS_GAMING_SUPPORT
    {.sportMode = SPORT_TYPE_FITNESS_GAMING, .sportOnOff = UTE_MODULE_SPORT_FITNESS_GAMING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FITNESS_GAMING_ORDER},
#endif
#if UTE_MODULE_SPORT_AEROBICS_SUPPORT
    {.sportMode = SPORT_TYPE_AEROBICS, .sportOnOff = UTE_MODULE_SPORT_AEROBICS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_AEROBICS_ORDER},
#endif
#if UTE_MODULE_SPORT_GROUP_TRAINING_SUPPORT
    {.sportMode = SPORT_TYPE_GROUP_TRAINING, .sportOnOff = UTE_MODULE_SPORT_GROUP_TRAINING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_GROUP_TRAINING_ORDER},
#endif
#if UTE_MODULE_SPORT_KENDO_SUPPORT
    {.sportMode = SPORT_TYPE_KENDO, .sportOnOff = UTE_MODULE_SPORT_KENDO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_KENDO_ORDER},
#endif
#if UTE_MODULE_SPORT_LACROSSE_SUPPORT
    {.sportMode = SPORT_TYPE_LACROSSE, .sportOnOff = UTE_MODULE_SPORT_LACROSSE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_LACROSSE_ORDER},
#endif
#if UTE_MODULE_SPORT_ROLLING_SUPPORT
    {.sportMode = SPORT_TYPE_ROLLING, .sportOnOff = UTE_MODULE_SPORT_ROLLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROLLING_ORDER},
#endif
#if UTE_MODULE_SPORT_WRESTLING_SUPPORT
    {.sportMode = SPORT_TYPE_WRESTLING, .sportOnOff = UTE_MODULE_SPORT_WRESTLING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_WRESTLING_ORDER},
#endif
#if UTE_MODULE_SPORT_FENCING_SUPPORT
    {.sportMode = SPORT_TYPE_FENCING, .sportOnOff = UTE_MODULE_SPORT_FENCING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_FENCING_ORDER},
#endif
#if UTE_MODULE_SPORT_SOFTBALL_SUPPORT
    {.sportMode = SPORT_TYPE_SOFTBALL, .sportOnOff = UTE_MODULE_SPORT_SOFTBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SOFTBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_SINGLE_BAR_SUPPORT
    {.sportMode = SPORT_TYPE_SINGLE_BAR, .sportOnOff = UTE_MODULE_SPORT_SINGLE_BAR_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SINGLE_BAR_ORDER},
#endif
#if UTE_MODULE_SPORT_PARALLEL_BARS_SUPPORT
    {.sportMode = SPORT_TYPE_PARALLEL_BARS, .sportOnOff = UTE_MODULE_SPORT_PARALLEL_BARS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PARALLEL_BARS_ORDER},
#endif
#if UTE_MODULE_SPORT_ROLLER_SKATING_SUPPORT
    {.sportMode = SPORT_TYPE_ROLLER_SKATING, .sportOnOff = UTE_MODULE_SPORT_ROLLER_SKATING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROLLER_SKATING_ORDER},
#endif
#if UTE_MODULE_SPORT_HULA_HOOP_SUPPORT
    {.sportMode = SPORT_TYPE_HULA_HOOP, .sportOnOff = UTE_MODULE_SPORT_HULA_HOOP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HULA_HOOP_ORDER},
#endif
#if UTE_MODULE_SPORT_DARTS_SUPPORT
    {.sportMode = SPORT_TYPE_DARTS, .sportOnOff = UTE_MODULE_SPORT_DARTS_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DARTS_ORDER},
#endif
#if UTE_MODULE_SPORT_PICKLEBALL_SUPPORT
    {.sportMode = SPORT_TYPE_PICKLEBALL, .sportOnOff = UTE_MODULE_SPORT_PICKLEBALL_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PICKLEBALL_ORDER},
#endif
#if UTE_MODULE_SPORT_HIIT_SUPPORT
    {.sportMode = SPORT_TYPE_HIIT, .sportOnOff = UTE_MODULE_SPORT_HIIT_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HIIT_ORDER},
#endif
#if UTE_MODULE_SPORT_SHOOTING_SUPPORT
    {.sportMode = SPORT_TYPE_SHOOTING, .sportOnOff = UTE_MODULE_SPORT_SHOOTING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SHOOTING_ORDER},
#endif
#if UTE_MODULE_SPORT_JUDO_SUPPORT
    {.sportMode = SPORT_TYPE_JUDO, .sportOnOff = UTE_MODULE_SPORT_JUDO_ON_OFF, .sportOrder = UTE_MODULE_SPORT_JUDO_ORDER},
#endif
#if UTE_MODULE_SPORT_TRAMPOLINE_SUPPORT
    {.sportMode = SPORT_TYPE_TRAMPOLINE, .sportOnOff = UTE_MODULE_SPORT_TRAMPOLINE_ON_OFF, .sportOrder = UTE_MODULE_SPORT_TRAMPOLINE_ORDER},
#endif
#if UTE_MODULE_SPORT_SKATEBOARDING_SUPPORT
    {.sportMode = SPORT_TYPE_SKATEBOARDING, .sportOnOff = UTE_MODULE_SPORT_SKATEBOARDING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SKATEBOARDING_ORDER},
#endif
#if UTE_MODULE_SPORT_HOVERBOARD_SUPPORT
    {.sportMode = SPORT_TYPE_HOVERBOARD, .sportOnOff = UTE_MODULE_SPORT_HOVERBOARD_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HOVERBOARD_ORDER},
#endif
#if UTE_MODULE_SPORT_BLADING_SUPPORT
    {.sportMode = SPORT_TYPE_BLADING, .sportOnOff = UTE_MODULE_SPORT_BLADING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BLADING_ORDER},
#endif
#if UTE_MODULE_SPORT_PARKOUR_SUPPORT
    {.sportMode = SPORT_TYPE_PARKOUR, .sportOnOff = UTE_MODULE_SPORT_PARKOUR_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PARKOUR_ORDER},
#endif
#if UTE_MODULE_SPORT_DIVING_SUPPORT
    {.sportMode = SPORT_TYPE_DIVING, .sportOnOff = UTE_MODULE_SPORT_DIVING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_DIVING_ORDER},
#endif
#if UTE_MODULE_SPORT_SURFING_SUPPORT
    {.sportMode = SPORT_TYPE_SURFING, .sportOnOff = UTE_MODULE_SPORT_SURFING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SURFING_ORDER},
#endif
#if UTE_MODULE_SPORT_SNORKELING_SUPPORT
    {.sportMode = SPORT_TYPE_SNORKELING, .sportOnOff = UTE_MODULE_SPORT_SNORKELING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_SNORKELING_ORDER},
#endif
#if UTE_MODULE_SPORT_PULL_UP_SUPPORT
    {.sportMode = SPORT_TYPE_PULL_UP, .sportOnOff = UTE_MODULE_SPORT_PULL_UP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PULL_UP_ORDER},
#endif
#if UTE_MODULE_SPORT_PUSH_UP_SUPPORT
    {.sportMode = SPORT_TYPE_PUSH_UP, .sportOnOff = UTE_MODULE_SPORT_PUSH_UP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PUSH_UP_ORDER},
#endif
#if UTE_MODULE_SPORT_PLANKING_SUPPORT
    {.sportMode = SPORT_TYPE_PLANKING, .sportOnOff = UTE_MODULE_SPORT_PLANKING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_PLANKING_ORDER},
#endif
#if UTE_MODULE_SPORT_ROCK_CLIMBING_SUPPORT
    {.sportMode = SPORT_TYPE_ROCK_CLIMBING, .sportOnOff = UTE_MODULE_SPORT_ROCK_CLIMBING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_ROCK_CLIMBING_ORDER},
#endif
#if UTE_MODULE_SPORT_HIGHTJUMP_SUPPORT
    {.sportMode = SPORT_TYPE_HIGHTJUMP, .sportOnOff = UTE_MODULE_SPORT_HIGHTJUMP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_HIGHTJUMP_ORDER},
#endif
#if UTE_MODULE_SPORT_BUNGEE_JUMPING_SUPPORT
    {.sportMode = SPORT_TYPE_BUNGEE_JUMPING, .sportOnOff = UTE_MODULE_SPORT_BUNGEE_JUMPING_ON_OFF, .sportOrder = UTE_MODULE_SPORT_BUNGEE_JUMPING_ORDER},
#endif
#if UTE_MODULE_SPORT_LONGJUMP_SUPPORT
    {.sportMode = SPORT_TYPE_LONGJUMP, .sportOnOff = UTE_MODULE_SPORT_LONGJUMP_ON_OFF, .sportOrder = UTE_MODULE_SPORT_LONGJUMP_ORDER},
#endif
#if UTE_MODULE_SPORT_MARATHON_SUPPORT
    {.sportMode = SPORT_TYPE_MARATHON, .sportOnOff = UTE_MODULE_SPORT_MARATHON_ON_OFF, .sportOrder = UTE_MODULE_SPORT_MARATHON_ORDER},
#endif
#endif
};

/**
*@brief  读取config
*@details
*@author        xjc
*@date       2022-03-30
*/
void uteModuleSportReadHundredSportConfig(void)
{
    void *file;
    /*! 运动列表排序数据 xjc, 2022-03-29  */
    uint16_t sportSortSize = sizeof(ute_sports_list_param_t)*UTE_MODULE_SPORT_MAX_SPORT_NUM;
    ute_sports_list_param_t *readBuffSportList = (ute_sports_list_param_t *)uteModulePlatformMemoryAlloc(sportSortSize);
    // init
    memcpy(readBuffSportList,uteModuleSportDefaultSort,sportSortSize);
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_HUNDRED_SPORT_SORT_DATA, &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readBuffSportList[0],sportSortSize);
        uteModuleFilesystemCloseFile(file);
    }
    memcpy(&uteModuleSprotData.sportSort.sportListData[0], readBuffSportList, sportSortSize);
    uint16_t totalSportNumber = uteModuleSportGetHundredSportValidNumber();
    if (!totalSportNumber)
    {
        memcpy(&uteModuleSprotData.sportSort.sportListData[0], uteModuleSportDefaultSort, sportSortSize);
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,%d,error: totalSportNumber=%d", __func__, __LINE__, totalSportNumber);
    }
    uteModulePlatformMemoryFree(readBuffSportList);
#if 0//UTE_MODULE_LOG_SUPPORT
    for (uint8_t i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i++)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,%d,sportMode=%d,sportOnOff=%d,sportOrder=%d", __func__,i,uteModuleSprotData.sportSort.sportListData[i].sportMode,uteModuleSprotData.sportSort.sportListData[i].sportOnOff,uteModuleSprotData.sportSort.sportListData[i].sportOrder);
    }
#endif
}

/**
*@brief  保存config
*@details
*@author        xjc
*@date       2022-03-30
*/
void uteModuleSportSaveHundredSportConfig(void)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
    void *file;
    /*! 保存到文件xjc, 2022-03-30*/
    uint16_t sportSortSize = sizeof(ute_sports_list_param_t)*UTE_MODULE_SPORT_MAX_SPORT_NUM;
    ute_sports_list_param_t *writeBuffSportList = (ute_sports_list_param_t *)uteModulePlatformMemoryAlloc(sportSortSize);
    uint16_t totalSportNumber = uteModuleSportGetHundredSportValidNumber();
    if (totalSportNumber)
    {
        memcpy(writeBuffSportList, &uteModuleSprotData.sportSort.sportListData[0], sportSortSize);
    }
    else
    {
        memcpy(writeBuffSportList, uteModuleSportDefaultSort, sportSortSize);
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,%d,error: totalSportNumber=%d", __func__, __LINE__, totalSportNumber);
    }
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_HUNDRED_SPORT_SORT_DATA, &file, FS_O_WRONLY | FS_O_CREAT | FS_O_TRUNC))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&writeBuffSportList[0],sportSortSize);
        uteModuleFilesystemCloseFile(file);
    }
    uteModulePlatformMemoryFree(writeBuffSportList);
#if APP_MODULE_SCREENS_TARGET_MORE_SUPPORT
    uteModuleSportTargetMoreSaveData(true);
#endif
}

/**
*@brief     根据数组序号获取实际运动
*@details
*@param[in]   uint8_t sportOrder 传入当前要查找第几个运动
*@return     返回运动类型
*@author        xjc
*@date       2022-03-30
*/
sport_mode_type uteModuleSportFindHundredSportIndex(uint8_t sportOrder)
{
    uint8_t tempSportOrder = sportOrder+1; //序号 = 1,2,3...,从1开始
    if (tempSportOrder > UTE_MODULE_SPORT_MAX_SPORT_NUM)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,ERROR, sportOrder out of range!", __func__);
        return 0;
    }
    for (uint8_t i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i++)
    {
        if (uteModuleSprotData.sportSort.sportListData[i].sportOrder == tempSportOrder)
        {
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,success, sportOrder = %d, sportIndex = %d!", __func__,tempSportOrder,i);
            return uteModuleSprotData.sportSort.sportListData[i].sportMode;
        }
    }
    return 0;
}

/**
*@brief     根据实际运动获取数组序号
*@details
*@param[in]   sport_mode_type sportMode 传入当前运动模式
*@param[in]   sport_mode_type *sportList 传入界面运动的数组
*@return     返回在列表中的序号
*@author        xjc
*@date       2022-03-30
*/
uint8_t uteModuleSportGetRealIndex(uint8_t sportMode, const uint8_t *sportList)
{
    for (uint8_t i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i++)
    {
        if (sportList[i] == sportMode)
        {
            UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,success, sportMode = %d", __func__,i);
            return i;
        }
    }
    return 0;
}

/**
 * @brief        根据实际运动获取数组序号
 * @details
 * @param[in]    sportMode 传入当前运动模式
 * @return       返回对应的sportOrder，0为隐藏
 * @author       Wang.Luo
 * @date         2025-03-13
 */
uint8_t uteModuleSportGetSportOrder(uint8_t sportMode)
{
    for (uint8_t i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i++)
    {
        if (uteModuleSprotData.sportSort.sportListData[i].sportMode == sportMode && uteModuleSprotData.sportSort.sportListData[i].sportOnOff)
        {
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,success, sportMode = %d, sportOrder = %d!", __func__, sportMode, uteModuleSprotData.sportSort.sportListData[i].sportOrder);
            return uteModuleSprotData.sportSort.sportListData[i].sportOrder;
        }
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,ERROR, sportMode not found!", __func__);
    return 0; // 如果未找到，返回0或者根据需求处理
}

/**
*@brief     根据实际运动获取数组序号
*@details
*@param[in]   uint8_t sportMode 传入当前运动模式
*@return     返回在列表中的序号
*@author        wuhuowang
*@date       2023-05-09
*/
uint8_t uteModuleSportFindHundredSportIndexByMode(uint8_t sportMode)
{
    uint8_t i = 0;
    uint8_t sportOrder = 0;

    for (i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i ++)
    {
        if (uteModuleSprotData.sportSort.sportListData[i].sportMode == sportMode)
        {
            UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,success, sportMode = %d i =%d order=%d", __func__, sportMode, i, uteModuleSprotData.sportSort.sportListData[i].sportOrder);
            sportOrder = uteModuleSprotData.sportSort.sportListData[i].sportOrder;
            if (sportOrder >= UTE_MODULE_SPORT_DISPLAY_MAX_SPORT_NUM)
                sportOrder = UTE_MODULE_SPORT_DISPLAY_MAX_SPORT_NUM ;
            return sportOrder;
        }
    }
    return UTE_MODULE_SPORT_DISPLAY_MAX_SPORT_NUM;
}

/**
*@brief  获取界面显示运动数量
*@details
*@return     返回一共显示多少运动
*@author        xjc
*@date       2022-03-30
*/
int uteModuleSportGetHundredSportValidNumber(void)
{
    int totalSportNumber = 0;
    for (uint8_t i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i++)
    {
        if (uteModuleSprotData.sportSort.sportListData[i].sportOnOff > 0)
        {
            totalSportNumber++;
        }
#if !APP_MODULE_RECEIVE_SAVE_TO_FILESYS_SUPPORT
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,receiveSportBytes[%d]= %d-%d-%d", __func__, i, uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 0], uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 1], uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 2]);
#endif
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,totalSportNumber = %d", __func__, totalSportNumber);
    return totalSportNumber;
}
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
/**
 * @brief        获取APP修改运动列表标志
 * @details      用于界面更新显示
 * @author       Wang.Luo
 * @date         2023-01-06
 */
bool uteModuleSportGetAppUpdateTrainingListFlag(void)
{
    return uteModuleSprotData.sportSort.appUpdateTrainingListFlag;
}
/**
 * @brief        设置APP修改运动列表标志
 * @details      更新显示后需清除标志
 * @author       Wang.Luo
 * @date         2023-01-06
 */
void uteModuleSportSetAppUpdateTrainingListFlag(bool isUpdate)
{
    uteModuleSprotData.sportSort.appUpdateTrainingListFlag = isUpdate;
}
#endif
/**
*@brief        开始发送百种数据
*@details
*@author       xjc
*@date       2022-03-30
*/
void uteModuleSportSendHundredData(void)
{
    ute_application_sync_data_param_t *sendParam;
    uteApplicationCommonGetSyncDataParam(&sendParam);
    uint8_t sendSize = 0;
    uint16_t sendPerSportNum = ((sendParam->currSendMtuSize - 4) / 3); //每个包发送多少个运动数据
    uint16_t responseBufferSize = 4 + (sendPerSportNum * 3);           //每个包发送的运动数据需要开多大的buffer
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendPerSportNum =%d,responseBufferSize =%d", __func__, sendPerSportNum, responseBufferSize);
    uint8_t *response = uteModulePlatformMemoryAlloc(responseBufferSize);
    memset(response,0,responseBufferSize);
    response[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;
    response[1] = 0x48;//自定义运动列表显示功能
    response[2] = 0xAA;//查询指令
    response[3] = sendParam->currSendMinIndex;//第几个包
    sendSize = 4;
    if((sendParam->currSendFileSize - sendParam->currSendFileIndex) >= sendPerSportNum)
    {
        for (uint8_t i = 0; i < sendPerSportNum; i++)
        {
            response[4+((i*3)+0)] = uteModuleSprotData.sportSort.sportListData[i+sendParam->currSendFileIndex].sportMode;
            response[4+((i*3)+1)] = uteModuleSprotData.sportSort.sportListData[i+sendParam->currSendFileIndex].sportOnOff;
            response[4+((i*3)+2)] = uteModuleSprotData.sportSort.sportListData[i+sendParam->currSendFileIndex].sportOrder;
            sendSize += 3;
            // UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,30 Index=%d,sportMode=%d,sportOnOff=%d,sportOrder=%d,", __func__,sendParam->currSendFileIndex,response[4+((i*3)+0)],response[4+((i*3)+1)],response[4+((i*3)+2)]);
        }
        sendParam->currSendFileIndex += sendPerSportNum;
    }
    else if((sendParam->currSendFileSize - sendParam->currSendFileIndex) > 0)
    {
        for (uint8_t i = 0; i < (sendParam->currSendFileSize - sendParam->currSendFileIndex); i++)
        {
            response[4+((i*3)+0)] = uteModuleSprotData.sportSort.sportListData[i+sendParam->currSendFileIndex].sportMode;
            response[4+((i*3)+1)] = uteModuleSprotData.sportSort.sportListData[i+sendParam->currSendFileIndex].sportOnOff;
            response[4+((i*3)+2)] = uteModuleSprotData.sportSort.sportListData[i+sendParam->currSendFileIndex].sportOrder;
            sendSize += 3;
            // UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,last Index=%d,sportMode=%d,sportOnOff=%d,sportOrder=%d,", __func__,sendParam->currSendFileIndex,response[4+((i*3)+0)],response[4+((i*3)+1)],response[4+((i*3)+2)]);
        }
        sendParam->currSendFileIndex = sendParam->currSendFileSize;
    }
    else
    {
        // end
        response[3] = 0xFD;
        response[4] = sendParam->crc;
        response[5] = (uteModuleSprotData.sportSort.minSportNum>>8)&0xFF;
        response[6] = (uteModuleSprotData.sportSort.minSportNum)&0xFF;
        response[7] = (uteModuleSprotData.sportSort.maxSportNum>>8)&0xFF;
        response[8] = (uteModuleSprotData.sportSort.maxSportNum)&0xFF;
        sendSize = 9;
    }
    if(response[3] == 0xFD)
    {
        uteApplicationCommonSyncDataTimerStop();
    }
    else
    {
        sendParam->currSendMinIndex++;
        uteModuleCrc8Bit(&sendParam->crc, &response[3],sendSize-3);
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currSendFileIndex=%d,currSendFileSize=%d,currSendMinIndex=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendFileSize,sendParam->currSendMinIndex);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendSize=%d,sendParam->crc=%d", __func__,sendSize,sendParam->crc);
    uteModuleProfileBle50SendToPhone(&response[0],sendSize);
    uteModulePlatformMemoryFree(response);
}

/**
*@brief        准备开始发送百种运动数据
*@details
*@author       xjc
*@date       2022-03-30
*/
void uteModuleSportStartSendHundredData(void)
{
    ute_application_sync_data_param_t *param;
    uteApplicationCommonGetSyncDataParam(&param);
    param->crc = 0;
    param->currSendMinIndex = 0; //用作发送的包数量
    param->currSendFileIndex = 0; //已发送的运动数量
    param->currSendFileSize = UTE_MODULE_SPORT_MAX_SPORT_NUM; //总的运动数量
    param-> currSendMtuSize = uteApplicationCommonGetMtuSize();
    uteApplicationCommonRegisterSyncDataTimerFunction(uteModuleSportSendHundredData);
    uteApplicationCommonSyncDataTimerStart();
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,", __func__);
}

/**
*@brief        接收APP设置百种运动数据
*@details
*@author       xjc
*@date       2022-03-30
*/
void uteModuleSportSetHundredData(uint8_t*receive,uint8_t length)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,", __func__);
    uint8_t response[4];
    response[0] = receive[0];
    response[1] = receive[1];
    if(receive[2] == 0xFD)
    {
        if (receive[3] == uteModuleSprotData.sportSort.receiveCrcCheck)
        {
            response[2] = 0xFD;
            response[3] = uteModuleSprotData.sportSort.receiveCrcCheck;
            uteModuleProfileBle50SendToPhone(&response[0], 4);
            /*! 清理旧数据*/
            for (uint8_t i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i++)
            {
                uteModuleSprotData.sportSort.sportListData[i].sportOnOff = 0;
                uteModuleSprotData.sportSort.sportListData[i].sportOrder = 0;
            }
            /*! 处理接收到数据*/
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,.receiveSportBytesLen=%d", __func__, uteModuleSprotData.sportSort.receiveSportBytesLen);
#if APP_MODULE_RECEIVE_SAVE_TO_FILESYS_SUPPORT
            {
                uint8_t path[30];
                uint8_t *readBuff = uteModulePlatformMemoryAlloc(UTE_MODULE_SPORT_MAX_SPORT_NUM * 3);
                void *file;
                int32_t fileSize = 0;

                memset(&path[0], 0, 30);
                sprintf((char *)&path[0], "%s/%02d", UTE_MODULE_FILESYSTEM_PROTOCAL_RECEIVE_DIR, 0x02);
                if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY))
                {
                    uteModuleFilesystemSeek(file, 0, FS_SEEK_END);
                    fileSize = (uint32_t)uteModuleFilesystemGetFileSize(file);
                    UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,fileSize=%d %d", __func__, fileSize, uteModuleSprotData.sportSort.receiveSportBytesLen);
                    uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
                    uteModuleFilesystemReadData(file, &readBuff[0], fileSize);
                    uteModuleFilesystemCloseFile(file);
                    for (uint8_t i = 0; i < (uteModuleSprotData.sportSort.receiveSportBytesLen / 3); i++)
                    {
                        UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "receiveSportBytes[%d]= %d-%d-%d", i,readBuff[(i * 3) + 0],readBuff[(i * 3) + 1],readBuff[(i * 3) + 2]);
                        for (uint8_t j = 0; j < UTE_MODULE_SPORT_MAX_SPORT_NUM; j++)
                        {
                            if (uteModuleSprotData.sportSort.sportListData[j].sportMode == readBuff[(i * 3) + 0])
                            {
                                uteModuleSprotData.sportSort.sportListData[j].sportOnOff = readBuff[(i * 3) + 1];
                                uteModuleSprotData.sportSort.sportListData[j].sportOrder = readBuff[(i * 3) + 2];
                                break;
                            }
                        }
                    }
                }
                uteModulePlatformMemoryFree(readBuff);
            }
#else
            for (uint8_t i = 0; i < (uteModuleSprotData.sportSort.receiveSportBytesLen / 3); i++)
            {
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "receiveSportBytes[%d]= %d-%d-%d", i,uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 0],uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 1],uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 2]);
                for (uint8_t j = 0; j < UTE_MODULE_SPORT_MAX_SPORT_NUM; j++)
                {
                    if (uteModuleSprotData.sportSort.sportListData[j].sportMode == uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 0])
                    {
                        uteModuleSprotData.sportSort.sportListData[j].sportOnOff = uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 1];
                        uteModuleSprotData.sportSort.sportListData[j].sportOrder = uteModuleSprotData.sportSort.receiveSportBytes[(i * 3) + 2];
                        break;
                    }
                }
            }
#endif
            /*! 数据校验通过保存最新数据*/
            uteModuleSportSaveHundredSportConfig();
            /*! 设置app更新运动列表标志，用于界面显示更新,wang.luo 2023-01-06 */
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
            uteModuleSportSetAppUpdateTrainingListFlag(true);
#endif
        }
        else
        {
            response[2] = 0xFF;
            uteModuleProfileBle50SendToPhone(&response[0], 3);
            /*! 数据校验失败恢复之前数据*/
            uteModuleSportReadHundredSportConfig();
        }
    }
    else
    {
#if APP_MODULE_RECEIVE_SAVE_TO_FILESYS_SUPPORT
        /*! 第一条数据*/
        if (receive[2] == 0)
        {
            uteModuleSprotData.sportSort.receiveCrcCheck = 0;
            uteModuleSprotData.sportSort.receiveSportBytesLen = 0;
            //memset(&uteModuleSprotData.sportSort.receiveSportBytes[0], 0, (UTE_MODULE_SPORT_MAX_SPORT_NUM * 3));
        }
        /*! 数据校验*/
        uteModuleCrc8Bit(&uteModuleSprotData.sportSort.receiveCrcCheck, &receive[2], (length - 2));
        /*! 保存接收到数据*/
        if (receive[2] == 0)
            uteModuleSystemTimeSaveReceiveData(&receive[3], length - 3, 0x02, true);
        else
            uteModuleSystemTimeSaveReceiveData(&receive[3], length - 3, 0x02, false);
#else
        /*! 第一条数据*/
        if (receive[2] == 0)
        {
            uteModuleSprotData.sportSort.receiveCrcCheck = 0;
            uteModuleSprotData.sportSort.receiveSportBytesLen = 0;
            memset(&uteModuleSprotData.sportSort.receiveSportBytes[0], 0, (UTE_MODULE_SPORT_MAX_SPORT_NUM * 3));
        }
        /*! 数据校验*/
        uteModuleCrc8Bit(&uteModuleSprotData.sportSort.receiveCrcCheck, &receive[2], (length - 2));
        /*! 保存接收到数据*/
        memcpy(&uteModuleSprotData.sportSort.receiveSportBytes[uteModuleSprotData.sportSort.receiveSportBytesLen], &receive[3], (length - 3));
#endif
        uteModuleSprotData.sportSort.receiveSportBytesLen += (length - 3);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,.receiveSportBytesLen=%d", __func__, uteModuleSprotData.sportSort.receiveSportBytesLen);
        if (uteModuleSprotData.sportSort.receiveSportBytesLen > (UTE_MODULE_SPORT_MAX_SPORT_NUM * 3))
        {
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,ERROR,receive sport num not current!", __func__);
            uteModuleSprotData.sportSort.receiveCrcCheck = 0;
        }
        /*! BLE收到每条指令以后返回指令0xFD48FB+n(序号)*/
        response[2] = 0xFB;
        response[3] = receive[2];
        uteModuleProfileBle50SendToPhone(&response[0], 4);
    }
}

/**
*@brief      处理百种运动支持协议
*@details
*@author       xjc
*@date       2022-03-29
*/
void uteModuleSportHundredSportCmd(uint8_t*receive,uint8_t length)
{
    if(receive[2] == 0xAA)
    {
        /*! 查询指令：手机端查询当前运动列表显示的内容，xjc 2022-03-29*/
        uteModuleSportStartSendHundredData();
    }
    else
    {
        /*! 接收自定义运动列表显示功能，xjc 2022-03-29*/
        uteModuleSportSetHundredData(receive,length);
    }
}

/**
 * @brief        获取百种运动列表显示信息
 * @details      通过运动类型获取运动列表显示信息，方便运动相关界面复用图片
 * @param[in]    mode      运动类型
 * @param[out]   *languageId      语言ID
 * @param[out]   *iconAddr      图片地址
 * @return       void*
 * @author       Wang.Luo
 * @date         2025-03-21
 */
void uteModuleSportHundredSportGetInfo(sport_mode_type mode, uint16_t *languageId, uint32_t *iconAddr)
{
    if (uteModuleSprotData.sportSort.sportListDisplayData == NULL)
    {
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,ERROR,sportListDisplayData is NULL!", __func__);
        return;
    }

    if (mode <= SPORT_TYPE_NONE || mode >= SPORT_TYPE_MAX)
    {
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,ERROR,mode is error!", __func__);
        return;
    }

    uint8_t i = 0;
    for (i = 0; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i++)
    {
        if (uteModuleSprotData.sportSort.sportListDisplayData[i].sportMode == mode)
        {
            *languageId = uteModuleSprotData.sportSort.sportListDisplayData[i].languageId;
            *iconAddr = uteModuleSprotData.sportSort.sportListDisplayData[i].iconAddr;
            return;
        }
    }

    if (i == UTE_MODULE_SPORT_MAX_SPORT_NUM)
    {
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,ERROR,mode is not found!", __func__);
    }
}

/**
 * @brief        注册百种运动列表显示信息
 * @details      注册百种运动列表显示信息，方便运动相关界面复用图片
 * @param[in]    *displayData      运动列表显示信息数组
 * @param[in]    dataSize      运动列表显示信息数组大小
 * @return       void*
 * @author       Wang.Luo
 * @date         2025-03-21
 */
void uteModuleSportRegisterDisplayData(ute_sports_list_display_param_t *displayData, uint16_t dataSize)
{
    if(displayData == NULL || dataSize == 0)
    {
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,ERROR,invalid displayData or dataSize!", __func__);
        return;
    }

    if(sizeof(ute_sports_list_display_param_t) * UTE_MODULE_SPORT_MAX_SPORT_NUM != dataSize)
    {
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,ERROR,displayData size is error!", __func__);
        return;
    }

    uteModuleSprotData.sportSort.sportListDisplayData = (ute_sports_list_display_param_t*)displayData;
}

#endif

#if APP_MODULE_SCREENS_MORE_SPORT_LIST_SUPPORT
/**
*@brief     根据数组序号获取前面8个固定运动
*@details
*@param[in]   uint8_t sportOrder 传入当前要查找第几个运动
*@return     返回在列表中的序号
*@author        wuhuowang
*@date       2022-11-30
*/
int uteModuleSportFindMoreSportIndex(uint8_t sportOrder, bool fix)
{
    uint8_t tempSportOrder = sportOrder + 1; //序号 = 1,2,3...,从1开始
    uint8_t i = 0;
    if (tempSportOrder > 8 && fix == true)
    {
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,ERROR, sportOrder out of range!", __func__);
        return 0;
    }
    if (fix == true)
    {
        for (i = 0; i < 8; i ++)
        {
            if (uteModuleSprotData.sportSort.sportListData[i].sportOrder == tempSportOrder)
            {
                UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,success, sportOrder = %d, sportIndex = %d!", __func__,tempSportOrder,i);
                return i;
            }
        }
        return 0;
    }
    else
    {
        for (i = 8; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i ++)
        {
            if (uteModuleSprotData.sportSort.sportListData[i].sportOrder == tempSportOrder)
            {
                UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,OK, sportOrder = %d, sportIndex = %d!", __func__,tempSportOrder,i);
                return i;
            }
        }
        return 8;
    }
}

/**
*@brief  获取更多运动界面显示运动数量
*@details
*@return     返回一共显示多少运动
*@author        wuhuowang
*@date       2022-11-30
*/
uint8_t uteModuleSportGetMoreSportValidNumber(void)
{
    uint8_t totalSportNumber = 0;
    uint8_t i = 0;

    for (i = 8; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i ++)
    {
        if (uteModuleSprotData.sportSort.sportListData[i].sportOnOff > 0)
        {
            totalSportNumber ++;
        }
    }
    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,totalSportNumber = %d", __func__,totalSportNumber);
    return totalSportNumber;
}

/**
*@brief  判断当前运动是否属于更多运动
*@details
*@return     返回一共显示多少运动
*@author        wuhuowang
*@date       2023-02-10
*/
bool uteModuleSportIsMoreSportRun(uint8_t type)
{
    bool ret = false;
    uint8_t i = 0;

    for (i = 8; i < UTE_MODULE_SPORT_MAX_SPORT_NUM; i ++)
    {
        if (uteModuleSprotData.sportSort.sportListData[i].sportMode == type)
        {
            ret = true;
            break;
        }
    }
    return ret;
}
#endif

/**
*@brief  读取config
*@details
*@author        zn.zeng
*@date        2021-08-26
*/
void uteModuleSportReadConfig(void)
{
    void *file;
    uint8_t readbuff[17];
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    readbuff[0] = DEFAULT_SEDENTARY_NOTIFY_OPNE;
    readbuff[1] = DEFAULT_SEDENTARY_NOTIFY_TIME_INTERVAL;
    readbuff[2] = (DEFAULT_SEDENTARY_NOTIFY_START_TIME>>8)&0xff;
    readbuff[3] = DEFAULT_SEDENTARY_NOTIFY_START_TIME&0xff;;
    readbuff[4] = (DEFAULT_SEDENTARY_NOTIFY_END_TIME>>8)&0xff;
    readbuff[5] = DEFAULT_SEDENTARY_NOTIFY_END_TIME&0xff;
    readbuff[6] = DEFAULT_HAND_SCREEN_ON_OPEN;
    readbuff[7] = (DEFAULT_STEP_TARGET_CNT>>24)&0xff;
    readbuff[8] = (DEFAULT_STEP_TARGET_CNT>>16)&0xff;
    readbuff[9] = (DEFAULT_STEP_TARGET_CNT>>8)&0xff;
    readbuff[10] = DEFAULT_STEP_TARGET_CNT&0xff;
    readbuff[11] = 0;
    readbuff[12] = DEFAULT_NOON_SLEEP_OPNE;
    readbuff[13] = (DEFAULT_NOON_SLEEP_START_TIME>>8)&0xff;
    readbuff[14] = DEFAULT_NOON_SLEEP_START_TIME&0xff;;
    readbuff[15] = (DEFAULT_NOON_SLEEP_END_TIME>>8)&0xff;
    readbuff[16] = DEFAULT_NOON_SLEEP_END_TIME&0xff;
    if( uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_SPORTINFO,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemReadData(file,&readbuff[0],17);
        uteModuleFilesystemCloseFile(file);
    }
    uteModuleSprotData.sedentary.isOpen = readbuff[0];
    uteModuleSprotData.sedentary.setMin= readbuff[1];
    uteModuleSprotData.sedentary.startPeriodHour= readbuff[2];
    uteModuleSprotData.sedentary.startPeriodMin= readbuff[3];
    uteModuleSprotData.sedentary.endPeriodHour= readbuff[4];
    uteModuleSprotData.sedentary.endPeriodMin= readbuff[5];
    uteModuleSprotData.isOpenHandScreenOn= readbuff[6];
    uteModuleSprotData.stepsTargetCnt = readbuff[7]<<24|readbuff[8]<<16|readbuff[9]<<8|readbuff[10];
    uteModuleSprotData.isTargetCompleted = readbuff[11];
    uteModuleSprotData.sedentary.isOpenNoonSleep = readbuff[12];
#if UTE_MODULE_SEDENTARY_NOTIFY_SET_NOONSLEEP_TIME
    uteModuleSprotData.sedentary.noonSleepStartTime = readbuff[13]<<8|readbuff[14];
    uteModuleSprotData.sedentary.noonSleepEndTime = readbuff[15]<<8|readbuff[16];
#endif
    ute_quick_switch_t quick;
    uteApplicationCommonGetQuickSwitchStatus(&quick);
    quick.isTurnTheWrist = uteModuleSprotData.isOpenHandScreenOn;
    //quick.isSedentary = uteModuleSprotData.sedentary.isOpen;
    uteApplicationCommonSetQuickSwitchStatus(&quick);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,.isOpen=%d,setMin=%d,startPeriodHour=%d,startPeriodMin=%d", __func__,uteModuleSprotData.sedentary.isOpen,uteModuleSprotData.sedentary.setMin, uteModuleSprotData.sedentary.startPeriodHour,uteModuleSprotData.sedentary.startPeriodMin);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,endPeriodHour=%d,endPeriodMin=%d", __func__,uteModuleSprotData.sedentary.endPeriodHour,uteModuleSprotData.sedentary.endPeriodMin);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,isOpenHandScreenOn=%d,stepsTargetCnt=%d", __func__,uteModuleSprotData.isOpenHandScreenOn,uteModuleSprotData.stepsTargetCnt);

#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
    /*! 开机读取当天有步数运动的步数，距离跟卡路里 xjc, 2022-01-17*/
    // uteModuleSportReadTodayAllSportDataConfig(time);
    uteModuleSprotData.updateTodayAllSportData = true;
#endif
    /*! 开机恢复当前小时步数 zn.zeng, 2021-10-23  */
    uint8_t path[40];
    uint16_t buffSize = 12*24+4;
    uint8_t *readBuffOneDay = uteModulePlatformMemoryAlloc(buffSize);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,%04d-%02d-%02d,%02d:%02d:%02d", __func__,time.year,time.month,time.day,time.hour,time.min,time.sec);
    memset(&path[0],0,sizeof(path));
    sprintf((char *)&path[0],"%s/%04d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,time.year,time.month,time.day);
    // read
    memset(&readBuffOneDay[0],0,buffSize);
    if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readBuffOneDay[0],buffSize);
        uteModuleFilesystemCloseFile(file);
    }
    uteModuleSprotData.stepSleepData.currentHourStepCnt = (readBuffOneDay[4+time.hour*12]<<8|readBuffOneDay[4+time.hour*12+1]);
    uteModuleSprotData.stepSleepData.current_hour_run_stepCnt = (readBuffOneDay[4+time.hour*12+5]<<8|readBuffOneDay[4+time.hour*12+6]);
    uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = (readBuffOneDay[4+time.hour*12+10]<<8|readBuffOneDay[4+time.hour*12+11]);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currentHourStepCnt=%d,current_hour_run_stepCnt=%d,current_hour_walk_stepCnt=%d", __func__,uteModuleSprotData.stepSleepData.currentHourStepCnt,uteModuleSprotData.stepSleepData.current_hour_run_stepCnt,uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt);
    mStepSleepParam.currentHourStepCnt = uteModuleSprotData.stepSleepData.currentHourStepCnt;
    mStepSleepParam.current_hour_run_stepCnt = uteModuleSprotData.stepSleepData.current_hour_run_stepCnt;
    mStepSleepParam.current_hour_walk_stepCnt = uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt;
    uteModulePlatformMemoryFree(readBuffOneDay);

#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
    /*! 运动列表排序数据 xjc, 2022-03-29  */
    uteModuleSportReadHundredSportConfig();
#endif
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleCwmReadCurrHourStepDataFromFs();
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleSportRestoreCurrHourExerciseTimeData();
#endif
}

/**
*@brief        往算法更新参数
*@details
*@author       xjc
*@date       2022-03-21
*/
void uteModuleSportUpdateStepSleepParam(void)
{
    bool isMoreSporting = false;
    if(uteModuleSprotData.moreSportData.status!=ALL_SPORT_STATUS_CLOSE)
    {
        isMoreSporting = true;
    }
    if(isMoreSporting)
    {
        mStepSleepParam = uteModuleSprotData.stepSleepData;
    }
    else
    {
        memcpy(&uteModuleSprotData.stepSleepData,&mStepSleepParam,sizeof(ute_step_sleep_param_t));
    }
}

/**
*@brief        往算法更新参数
*@details
*@param[in]   传入时间数据
*@author       zn.zeng
*@date       2021-08-05
*/
void uteModuleSportUpdateAlgoParam(ute_module_systemtime_time_t time)
{
    struct prf_date_time oldTime;
    oldTime.year = time.year;
    oldTime.month = time.month;
    oldTime.day = time.day;
    oldTime.hour = time.hour;
    oldTime.min = time.min;
    oldTime.sec = time.sec;
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    uteUpdateStepSleepData(&oldTime);
    uteModuleSportUpdateStepSleepParam();
    uint8_t state = getStepOrSleepStateWhetherSwitch();
    if((state==1)&&(uteModuleSprotData.stepType == STEP_TYPE_SLEEP))
    {
        uteModuleSportStepTypeSetStep();
    }
    if((state==2)&&(uteModuleSprotData.stepType == STEP_TYPE_STEP))
    {
        uteModuleSportStepTypeSetSleep();
        mStepSleepParam.currentHourSleepTurnCnt =0;
    }
#endif
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleSprotData.stepSleepData.currentHourStepCnt = uteModuleCwmGetTodayCurrHourStep();
    UTE_MODULE_LOG(UTE_LOG_CYWEE_MOTION_LVL,"%s, currentHourStepCnt = %d", __func__,uteModuleSprotData.stepSleepData.currentHourStepCnt);
#endif
}
/**
*@brief        检查摇一摇拍照状态
*@details
*@param[in]
*@author       zn.zeng
*@date       2021-08-06
*/
void uteModuleSportCheckTakePicture(void)
{
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
#if DRV_HID_PHOTO
    if (getTakingPicturesResult() && (uteModuleSprotData.isTakingPictures || ((uteApplicationCommonGetAncsConnStatus()) && (uteModuleGuiCommonGetCurrentScreenId()==UTE_MOUDLE_SCREENS_TAKE_PICTURE_ID))))
#else
    if (getTakingPicturesResult()&&uteModuleSprotData.isTakingPictures)
#endif
    {
        disableTakingPicturesState();
        uteDrvGsensorCommonClearFifo();
        uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_TAKE_PICTURE_NOTIFY,0);
    }
#endif
}
/**
*@brief        手环端主动退出拍照状态
*@details
*@author       xjc
*@date       2022-04-25
*/
void uteModuleSportExitTakePicture(void)
{
    uint8_t exitPhoto[2] = {CMD_SEND_KEYCODE, 0x0F};
    uteModuleProfileBleSendToPhone(&exitPhoto[0], 2);
    uteModuleSportSetTakePictureEnable(false);
}
/**
*@brief        查看是否在摇一摇拍照状态
*@details
*@author       xjc
*@date       2022-04-25
*/
bool uteModuleSportIsTakePicture(void)
{
    return uteModuleSprotData.isTakingPictures;

}
/**
*@brief        久坐提醒处理
*@details
*@param[in]
*@author       zn.zeng
*@date       2021-08-06
*/
void uteModuleSportSedentaryHandler(ute_module_systemtime_time_t time)
{
    bool needNotify = false;
    /*! 运动中久坐提醒时间清零, xjc 2022-03-21*/
    if(uteModuleSprotData.moreSportData.status!=ALL_SPORT_STATUS_CLOSE)
    {
        uteModuleSprotData.sedentary.sedentaryRemindSecCnt = 0;
        return;
    }
    if(uteModuleSprotData.sedentary.isOpen)
    {
        uint32_t oneDaySecond = time.hour*3600+time.min*60+time.sec;
        uint32_t startTimeSecond = uteModuleSprotData.sedentary.startPeriodHour*3600+uteModuleSprotData.sedentary.startPeriodMin*60;
        uint32_t endTimeSecond = uteModuleSprotData.sedentary.endPeriodHour*3600+uteModuleSprotData.sedentary.endPeriodMin*60;
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,startTimeSecond=%d,endTimeSecond=%d,sedentaryRemindSecCnt=%d", __func__,startTimeSecond,endTimeSecond,uteModuleSprotData.sedentary.sedentaryRemindSecCnt);
#if UTE_MODULE_SEDENTARY_NOTIFY_SET_NOONSLEEP_TIME
        if(uteModuleSprotData.sedentary.isOpenNoonSleep&&(oneDaySecond>=uteModuleSprotData.sedentary.noonSleepStartTime*60)&&(oneDaySecond<=uteModuleSprotData.sedentary.noonSleepEndTime*60))
#else
        if(uteModuleSprotData.sedentary.isOpenNoonSleep&&(oneDaySecond>=12*3600)&&(oneDaySecond<=14*3600))
#endif
        {
            needNotify = false;
        }
        else
        {
            if(startTimeSecond<endTimeSecond)   // 8:00 - 18 :00
            {
                if( (oneDaySecond>=startTimeSecond) && (oneDaySecond<=endTimeSecond) )
                {
                    needNotify =true;
                }
                else
                {
                    needNotify =false;
                }
            }
            else     // 18:00 -8:00
            {
                if((startTimeSecond<=oneDaySecond)
                   || (endTimeSecond>=oneDaySecond) )
                {
                    needNotify =true;
                }
                else
                {
                    needNotify =false;
                }
            }
        }
    }
    if(uteModuleSprotData.sedentary.isOpen&&needNotify)
    {

#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT

        if(getSedentaryRemindActivityStatus()==SedentaryRemind_NEED_REMIND)
        {
            uteModuleSprotData.sedentary.sedentaryRemindSecCnt++;
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sedentaryRemindSecCnt=%d,needNotify=%d,stepType=%d", __func__,uteModuleSprotData.sedentary.sedentaryRemindSecCnt,needNotify,uteModuleSprotData.stepType);

            if(uteModuleSprotData.sedentary.sedentaryRemindSecCnt>=(uteModuleSprotData.sedentary.setMin*60))
            {
                uteModuleSprotData.sedentary.sedentaryRemindSecCnt = 0;

                /*||getSleepTotalMinute()<30  add by pcm 2022-10-17
                添加判断条件，判断睡眠模式下，睡眠数据总时间小于30分钟时候，还是继续提示久坐，
                解决之前早上测试久坐无提醒和晚上测试久坐大概率无提醒的问题*/
                if(uteModuleSprotData.stepType == STEP_TYPE_STEP||getSleepTotalMinute()<30)
                {
                    uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_SEDENTARY_NOTIFY,0);
                }
                enableSedentaryRemind();
            }
        }
        else
        {
            uteModuleSprotData.sedentary.sedentaryRemindSecCnt = 0;
        }
#endif
    }
    else
    {
        uteModuleSprotData.sedentary.sedentaryRemindSecCnt = 0;
    }
}

/**
*@brief        切换到下一小时
*@details
*@param[in]
*@author       zn.zeng
*@date       2021-08-23
*/
void uteModuleSportBeforeGotoNextHour(ute_module_systemtime_time_t time)
{
    if((time.min==59)&&(time.sec==59))
    {
        uteModuleSportSaveStepData();
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uteModuleSportSaveExerciseTimeData();
        memset(&uteModuleSprotData.exerciseTime[0], 0, 13 * 2);
        uteModuleSprotData.lastHourRecordKcal = uteModuleSportGetCurrDayKcalData();
        uteModuleSprotData.lastHourRecordDistance = uteModuleSportGetCurrDayDistanceDataWithKM();
        uteModuleSprotData.lastHourRecordStep = uteModuleSportGetCurrDayTotalStepCnt();
#endif
        //clear
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
#if !UTE_MODULE_SPORT_CLEAR_STEP_WHEN_HOUR_SUPPORT
        memset(&uteModuleSprotData.stepSleepData,0,sizeof(ute_step_sleep_param_t));
        memset(&mStepSleepParam,0,sizeof(ute_step_sleep_param_t));
#endif
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
        uteModuleCwmGotoNextHourCallback(time.hour);
        if(time.hour == 23)
        {
            void cwmPedometerReSet(void);
            cwmPedometerReSet();    //清除所有数据
        }
#endif
    }
#if UTE_MODULE_SPORT_CLEAR_STEP_WHEN_HOUR_SUPPORT
    if((time.min==0)&&(time.sec==0))
    {
        memset(&uteModuleSprotData.stepSleepData,0,sizeof(ute_step_sleep_param_t));
        memset(&mStepSleepParam,0,sizeof(ute_step_sleep_param_t));
    }
#endif
}
/**
*@brief        步数目标提醒
*@details
*@author       zn.zeng
*@date       2021-11-30
*/
void uteModuleSportStepTargetHandler(void)
{
    uint32_t second = uteApplicationCommonGetSystemPowerOnSecond();
    uint32_t totalStepCnt = 0;
    uteModuleSportGetCurrDayStepCnt(&totalStepCnt,NULL,NULL);
    if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_CLOSE)
    {
#if !APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
        uint8_t sportType = 0;
        uint32_t tempDistance = 0;
        float distance = 0;
        distance = (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceInteger + (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals * 0.01));
        distance = distance*1000.0f; //放大1000倍,m
        tempDistance = (uint32_t)distance;
        sportType = uteModuleSportGetCurrSportShowDataType(uteModuleSportMoreSportGetType());
        if (sportType && tempDistance >= 100)
#endif
        {
            totalStepCnt += uteModuleSprotData.moreSportData.saveData.sportStep;
        }
    }
    if ((!uteModuleSprotData.isTargetCompleted) &&
        (totalStepCnt >= uteModuleSprotData.stepsTargetCnt) &&
        (second > 9) && (uteDrvBatteryCommonGetChargerStatus() == BAT_STATUS_NO_CHARGE))
    {
        uteModuleSprotData.isTargetCompleted = true;
        /*! 保存到文件xjc, 2022-01-05*/
        void *file;
        uint8_t buff[12];
        if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_SPORTINFO, &file, FS_O_RDONLY|FS_O_WRONLY))
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemReadData(file, &buff[0], 12);
            buff[11] = uteModuleSprotData.isTargetCompleted;
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemWriteData(file,&buff[0],12);
            uteModuleFilesystemCloseFile(file);
        }
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
        memset(&uteModuleSprotData.todayTargetNotify.todayTargetNotifyType,0,sizeof(ute_module_today_target_notify_type_t));
        uteModuleSprotData.todayTargetNotify.todayTargetNotifyType.isTodayStepTargetNotify = true;
#endif
#if QUICK_SWITCH_GOAL_REACH_SUPPORT
        ute_quick_switch_t quick;
        uteApplicationCommonGetQuickSwitchStatus(&quick);
        if(quick.isGoalReach)
#endif
        {
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
            if(uteModuleSprotData.todayTargetNotify.isTodayStepTargetNotifyOpen)
#endif
            {
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TARGET_COMPLETED_ID);       //日常步数目标完成弹窗
                sys_cb.cover_index = REMIND_COVER_GOAL;
                sys_cb.remind_tag = true;
                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
            }
        }
    }
}
/**
*@brief        换天清除目标提醒标志
*@details
*@param[in]
*@author      xjc
*@date       2022-01-05
*/
void uteModuleSportDayStartClearStepTarget(ute_module_systemtime_time_t time)
{
    if(time.hour == 0 && time.min == 0 && time.sec == 0)
    {
        uteModuleSprotData.isTargetCompleted = false;
        /*! 保存到文件xjc, 2022-01-05*/
        void *file;
        uint8_t buff[12];
        if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_SPORTINFO, &file, FS_O_RDONLY|FS_O_WRONLY))
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemReadData(file, &buff[0], 12);
            buff[11] = uteModuleSprotData.isTargetCompleted;
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemWriteData(file,&buff[0],12);
            uteModuleFilesystemCloseFile(file);
        }
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uteModuleSportReadWeekDayData();
#else
        uteModuleSportReadWeekDayStep();
#endif
#endif
    }
}
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
/**
*@brief  清除当天运动步数缓存
*@detailss
*@author        xjc
*@date       2022-03-30
*/
void uteModuleSportClearTodayAllSportData(void)
{
    memset(&uteModuleSprotData.todaySportWithStepsData, 0, sizeof(ute_sports_today_with_step_data_t));
#if UTE_MODULE_SPORT_TIME_TARGET_NOTIFY_SUPPORT
    uteModuleSprotData.todayTargetNotify.currentDayAllSportTimeSec = 0;
#endif
}

/**
*@brief  读取当天运动步数config
*@details
*@param[in] ute_module_systemtime_time_t time, 输入读取的日期
*@param[out] ute_sports_today_with_step_data_t *stepData, 计步数据输出数据指针
*@param[out] ute_module_target_notify_data_t *targetNotifyData，目标提醒数据输出指针
*@author        xjc
*@date       2022-03-30
*/
void uteModuleSportReadTodayAllSportDataConfig(ute_module_systemtime_time_t time,ute_sports_today_with_step_data_t *stepData,ute_module_target_notify_data_t *targetNotifyData)
{
    void *file;
    uint8_t path[40];
    memset(&path[0],0,sizeof(path));
    uint8_t datePath[12];
    memset(&datePath[0],0,sizeof(datePath));
    uint8_t readBuff[33];
    memset(&readBuff[0],0,sizeof(readBuff));
    uint8_t headBuff[33];
    memset(&headBuff[0],0,sizeof(headBuff));
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    sprintf((char *)&datePath[0],"%04d%02d%02d",time.year,time.month,time.day);
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, dirInfo, NULL);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt=%d", __func__,dirInfo->filesCnt);
    uteModuleSportClearTodayAllSportData();
    for (uint8_t i = 0; i < dirInfo->filesCnt; i++)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,datePath=%s", __func__,&datePath[0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesName[%d]=%s", __func__,i,&dirInfo->filesName[i][0]);
        if(memcmp(&datePath[0],&dirInfo->filesName[i][0],8)==0)
        {
            sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&dirInfo->filesName[i][0]);
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,read file=%s", __func__,&path[0]);
            if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
            {
                uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
                uteModuleFilesystemReadData(file,&headBuff[0],33);
                uteModuleFilesystemCloseFile(file);
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,readData.sportsType=%d", __func__,headBuff[1]);
                if ((headBuff[1] == SPORT_TYPE_RUNNING) /*跑步 */
                    || (headBuff[1] == SPORT_TYPE_CLIMBING) /*登山 */
                    || (headBuff[1] == SPORT_TYPE_WALKING) /*健走 */
                    || (headBuff[1] == SPORT_TYPE_TREADMILL) /*跑步机 */
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
#if APP_TRAIL_RUNNING_WITH_STEP
                    || (headBuff[1] == SPORT_TYPE_INDOOR_WALK) /*室内走路 */
                    || (headBuff[1] == SPORT_TYPE_TRAIL_RUNNING) /*越野跑 */
                    || (headBuff[1] == SPORT_TYPE_OUTDOOR_WALK) /*户外健走 */
                    || (headBuff[1] == SPORT_TYPE_HIKING) /*徒步 */
                    || (headBuff[1] == SPORT_TYPE_MARATHON) /*马拉松 */
#else
                    || (headBuff[1] == SPORT_TYPE_INDOOR_WALK) /*室内走路 */
                    || (headBuff[1] == SPORT_TYPE_STEP_TRAINING) /*踏步 */
                    || (headBuff[1] == SPORT_TYPE_OUTDOOR_WALK) /*户外健走 */
                    || (headBuff[1] == SPORT_TYPE_HIKING) /*徒步 */
                    || (headBuff[1] == SPORT_TYPE_INDOOR_RUN) /*室内跑步 */
                    || (headBuff[1] == SPORT_TYPE_PARKOUR) /*跑酷 */
                    || (headBuff[1] == SPORT_TYPE_MARATHON) /*马拉松 */
#endif
#endif
                   )
                {
                    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,readData-sport.step=%d,caloire=%d,distance=%d.%d", __func__,headBuff[16]<<24|headBuff[17]<<16|headBuff[18]<<8|headBuff[19],headBuff[22]<<8|headBuff[23],headBuff[24],headBuff[25]);
                    stepData->step += headBuff[16]<<24|headBuff[17]<<16|headBuff[18]<<8|headBuff[19];
                    stepData->caloire += headBuff[22]<<8|headBuff[23];
                    stepData->distance += (headBuff[24]*100 + headBuff[25]);//整数部分先放大100倍
                }
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
                else if (headBuff[1] == SPORT_TYPE_RIDE_BIKE
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
                         || headBuff[1] == SPORT_TYPE_ROLLER_SKATING
                         || headBuff[1] == SPORT_TYPE_SKATEBOARDING
                         || headBuff[1] == SPORT_TYPE_HUNTING
                         || headBuff[1] == SPORT_TYPE_SKATING
#endif
                        )
                {
                    stepData->caloire += headBuff[22] << 8 | headBuff[23];
                    stepData->distance += (headBuff[24] * 100 + headBuff[25]);//整数部分先放大100倍
                }
#endif
#if UTE_MODULE_SPORT_TODAY_ADD_KCAL_SPORT_DATA_SUPPORT
                else
                {
                    stepData->caloire += headBuff[22]<<8|headBuff[23];
                }
#endif
#if UTE_MODULE_SPORT_TIME_TARGET_NOTIFY_SUPPORT
                if (targetNotifyData != NULL)
                {
                    targetNotifyData->currentDayAllSportTimeSec += (headBuff[13] << 16 | headBuff[14] << 8 | headBuff[15]);
                }
#endif
            }
        }
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sport.step=%d,caloire=%d,distance=%d", __func__,stepData->step,stepData->caloire,stepData->distance);

    uteModulePlatformMemoryFree(dirInfo);
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
#endif

/*! 设备方向切换阈值,wang.luo 2025-05-20 */
#ifndef UTE_MODULE_SPORT_DIRECTION_SWITCH_THRESHOLD
#define UTE_MODULE_SPORT_DIRECTION_SWITCH_THRESHOLD 90
#endif

/**
 * @brief        计算设备方向
 * @details
 * @param[in]    int x, int y, int z 设备三轴数据
 * @return       设备方向
 * @author       Wang.Luo
 * @date         2025-05-20
 */
AT(.com_text.gsensor)
uint8_t uteModuleSportCountDeviceOrientation(int x, int y, int z)
{
    int absX = ABS(x);
    int absY = ABS(y);
    int absZ = ABS(z);

    if (absX > UTE_MODULE_SPORT_DIRECTION_SWITCH_THRESHOLD && absX > absY && absX > absZ)
    {
        return (x > 0) ? 1 : 2;
    }
    else if (absY > UTE_MODULE_SPORT_DIRECTION_SWITCH_THRESHOLD && absY > absX && absY > absZ)
    {
        return (y > 0) ? 3 : 4;
    }
    else if (absZ > UTE_MODULE_SPORT_DIRECTION_SWITCH_THRESHOLD && absZ > absX && absZ > absY)
    {
        return (z > 0) ? 5 : 6;
    }
    else
    {
        return 0;
    }
}

/**
 * @brief        获取当前设备方向
 * @details
 * @return       设备方向值
 * @author       Wang.Luo
 * @date         2025-05-20
 */
AT(.com_text.gsensor)
uint8_t uteModuleSportGetDeviceOrientation(void)
{
    return uteModuleSprotData.deviceOrientation;
}

/**
*@brief        sport每秒函数
*@details       需要注册到主时间，每秒执行一次
*@author       zn.zeng
*@date       2021-07-27
*/
void uteModuleSportEverySecond(void)
{
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleSportDailyExerciseEverySecond(&time);
#endif
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"uteModuleSprotData.stepType=%d,updateTodayAllSportData=%d",uteModuleSprotData.stepType,uteModuleSprotData.updateTodayAllSportData);
    if(time.hour == 0 && time.min == 0 && (time.sec == 0 || time.sec == 1))
    {
        uteModuleSportClearTodayAllSportData();
        uteModuleSprotData.lastHourRecordKcal = 0;
        uteModuleSprotData.lastHourRecordDistance = 0;
        uteModuleSprotData.lastHourRecordStep = 0;
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
        uteModuleSprotData.todaySportOtherData.step = 0;
        uteModuleSprotData.todaySportOtherData.distance = 0;
        uteModuleSprotData.todaySportOtherData.caloire = 0;
#endif
    }
    else if(uteModuleSprotData.updateTodayAllSportData == true)
    {
        uteModuleSprotData.updateTodayAllSportData = false;
        /*! 读取当天有步数运动的步数，距离跟卡路里 xjc, 2022-01-17*/
        uteModuleSportReadTodayAllSportDataConfig(time,&uteModuleSprotData.todaySportWithStepsData,&uteModuleSprotData.todayTargetNotify);
#if UTE_GUI_SCREEN_GET_SPORT_DATA_NEW_FUNC_SUPPORT
        uteModuleSportCalculatorEveryHourSportDataHandler(true);
#endif
    }
#endif
    if(!uteApplicationCommonIsPowerOn())
    {
        return;
    }
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
    uteModuleSportTodayTargetHandler();
#endif
    uteModuleSportBeforeGotoNextHour(time);
    uteModuleSportMoreSportsEverySecond(&time);
    uteModuleSportDayStartClearStepTarget(time);
#if UTE_GUI_SCREEN_GET_SPORT_DATA_NEW_FUNC_SUPPORT
    uteModuleSportCalculatorEveryHourSportDataHandler(false);
#endif
    bool isStepping=false;
    if(uteModuleSprotData.stepType == STEP_TYPE_STEP)
    {
        isStepping = true;
    }
    uteModuleSleepDataInputSecond(&mStepSleepParam,time,isStepping);

#if (UTE_DRV_HEART_VCXX_NIGHT_OPTIMIZE_SLEEP_SUPPORT && !UTE_DRV_HEART_VCXX_REMAIN_POWER_SUPPORT)
    if (isStepping)
    {
        if(bsp_sensor_hr_work_status() && uteModuleHeartGetWorkMode() == WORK_MODE_WEAR)
        {
            uteModuleHeartStopSingleTesting(TYPE_WEAR);
        }
    }
    else
    {
        if(uteModuleSystemtimeIsNight() && !bsp_sensor_hr_work_status())
        {
            uteModuleHeartStartSingleTesting(TYPE_WEAR);
        }
    }
#endif

    uteModuleSportReadCurrDayStepCnt(time);
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    //uteModuleSportReadCurrDayExerciseTimeData(time);
    if (time.hour != uteModuleSprotData.lastReadHour)
    {
        uteModuleSportGetCurrDayEveryHourExerciseTime();
    }
#endif
    if(uteModuleSprotData.stepType == STEP_TYPE_NONE)
    {
        return;
    }
    ute_ble_connect_state_t state;
    uteApplicationCommonGetBleConnectionState(&state);
    uteModuleSportUpdateAlgoParam(time);


    uteModuleSportStepTargetHandler();
    if(uteModuleSprotData.stepType == STEP_TYPE_STEP)
    {
        /*! 发送实时计步数据给应用端zn.zeng, 2021-08-05  */
        if((uteModuleSprotData.lastHourStepCnt!=uteModuleSprotData.stepSleepData.currentHourStepCnt)&&
           (state.connectedSecond>5))
        {
#if UTE_MODULE_SPORT_CLEAR_STEP_WHEN_HOUR_SUPPORT
            if(!((time.min==59)&&(time.sec==59)))
            {
                uteModuleSportSendRealTimeStepInfo();
                uteModuleSprotData.lastHourStepCnt = uteModuleSprotData.stepSleepData.currentHourStepCnt;
            }
#else
            uteModuleSportSendRealTimeStepInfo();
            uteModuleSprotData.lastHourStepCnt = uteModuleSprotData.stepSleepData.currentHourStepCnt;
#endif
            UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL,"%s,lastHourStepCnt=%d",__func__,uteModuleSprotData.lastHourStepCnt);
        }
    }
#if UTE_MODULE_SPROT_ALGO_AUTO_SWITCH_SYSCLK_SUPPORT && UTE_LOG_STEP_LVL
    uint8_t cur_sys_clk = sys_clk_get();
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,cur_sys_clk=%d", __func__, cur_sys_clk);
#endif
    uteModuleSportCheckTakePicture();
    uteModuleSportSedentaryHandler(time);
#if UTE_MODULE_DRINK_WATER_NOTIFY_SCREEN_SUPPORT
    uteModuleDrinkWaterHandler(time);
#endif
#if UTE_MODULE_HAND_WASHING_REMIND_SCREEN_SUPPORT
    uteModuleHandWashingHandler(time);
#endif
}
/**
*@brief        gsensor 数据输入算法库
*@details
*@author       zn.zeng
*@date       2021-07-27
*/
AT(.com_text.gsensor)
void uteModuleSportInputDataBeforeAlgo(void)
{
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    int16_t x[UTE_DRV_GSENSOR_AXIS_DATA_MAX] = {0};
    int16_t y[UTE_DRV_GSENSOR_AXIS_DATA_MAX] = {0};
    int16_t z[UTE_DRV_GSENSOR_AXIS_DATA_MAX] = {0};
    uint8_t frameCnt = 0;
    if(uteModuleSprotData.stepType == STEP_TYPE_NONE)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,STEP_TYPE_NONE", __func__);
#if UTE_MODULE_SPROT_ALGO_AUTO_SWITCH_SYSCLK_SUPPORT
        uteModuleSprotData.switchSysclkCountdown = 0;
#endif
        return;
    }
    ute_drv_gsensor_common_axis_data_t *data = NULL;
    uteDrvGsensorCommonReadFifo(&data);
    uteDrvGsensorCommonClearFifo();
    frameCnt = data->frameCnt;
    ute_drv_gsensor_common_axis_bit_change_t axisBitChange;
    axisBitChange.inputXaxis = &data->accXaxis[0];
    axisBitChange.inputYaxis = &data->accYaxis[0];
    axisBitChange.inputZaxis = &data->accZaxis[0];
    axisBitChange.outputXaxis = &x[0];
    axisBitChange.outputYaxis = &y[0];
    axisBitChange.outputZaxis = &z[0];
    uteDrvGsensorCommonXYZaxisDataBitChange(&axisBitChange,frameCnt,GSENSOR_DATA_BIT_STEP);
#if UTE_MODULE_SPROT_ALGO_AUTO_SWITCH_SYSCLK_SUPPORT
    uint32_t accValueSum = 0;
    uint8_t accValueCount = 0;
    uint8_t accValueAvg = 0;
#endif
    for(int i=0; i<frameCnt; i++)
    {
        if(uteDrvMotorGetRunningStatus())
        {
            /* ellison add ,2022-Jun-07 16:8 马达振动产生的步数不要，振动时摇一摇拍照的干扰结果也不要*/
            break;
        }
        if(!((x[i]==0)&&(y[i]==0)&&(z[i]==0)))
        {
            uint16_t accValue =0;
            if(i==0)
            {
                uteModuleSprotData.deviceOrientation = uteModuleSportCountDeviceOrientation(x[i],y[i],z[i]);
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,i=%02d,frameCnt=%02d,x=%d,y=%d,z=%d", __func__, i, frameCnt, x[i], y[i], z[i]);
            }
            if(uteModuleSprotData.moreSportData.status==ALL_SPORT_STATUS_PAUSE)
            {
                /*! 运动暂停不走算法，不出运动值 ,xjc 2022-03-09*/
            }
            else
            {
                if((uteModuleSprotData.moreSportData.saveData.sportsType==SPORT_TYPE_JUMP_ROPE)&&(uteModuleSprotData.moreSportData.status!=ALL_SPORT_STATUS_CLOSE))
                {
                    app_jump_rope_algorithms_input_data(uteModuleSprotData.accRange,&x[i],&y[i],&z[i],&accValue);
                }
                else
                {
                    uint8_t accRateValue = 40;
                    uint8_t accRate = uteDrvGsensorCommonGetAccRate();
                    if(accRate==GSENSOR_RATE_20HZ)
                    {
                        accRateValue = 20;
                    }
                    else if(accRate==GSENSOR_RATE_40HZ)
                    {
                        accRateValue = 40;
                    }
                    else if(accRate==GSENSOR_RATE_100HZ)
                    {
                        accRateValue = 100;
                    }
#if UTE_MODULE_NEW_T02_SPORT_STEP_ALGORITHMS_SUPPORT
                    uteStepSleepAlgorithmsInputData(uteModuleSprotData.gsensorId,uteModuleSprotData.accRange,&x[i],&y[i],&z[i],frameCnt,i,&accValue,uteModuleSystemtimeIsSleepTime());
#else
                    uteStepSleepAlgorithmsInputData(uteModuleSprotData.gsensorId,uteModuleSprotData.accRange,&x[i],&y[i],&z[i],frameCnt,i,&accValue,uteModuleSystemtimeIsSleepTime(),accRateValue);
#endif
#if APP_DBG_GSENSOR_DATA
                    uteModuleSportSendGsensorDataToPhone(x[i],y[i],z[i]);
#endif
                }
            }
            uteHandScreenAlgorithmsInputData(&x[i],&y[i],&z[i],accValue);
#if UTE_MODULE_WATCH_ROTATE_SUPPORT
            if(uteModuleSprotData.isGsensorRotateTesting && (!uteDrvHeartVcxxIsWear()))//手表旋转中且未佩戴，传入三轴数据
            {
                uteRotateInputData(&x[i],&y[i],&z[i]);
            }
#endif
#if UTE_MODULE_SPROT_ALGO_AUTO_SWITCH_SYSCLK_SUPPORT
            accValueSum += accValue;
            accValueCount ++;
#endif
        }
    }
#if UTE_MODULE_SPROT_ALGO_AUTO_SWITCH_SYSCLK_SUPPORT
    accValueAvg = accValueCount > 0 ? accValueSum / accValueCount : 0;
    if(accValueAvg > 127 ? (accValueAvg - 127) : (127 - accValueAvg) > 10)
    {
        uteModuleSprotData.switchSysclkCountdown = 10;
    }
    else
    {
        if (uteModuleSprotData.switchSysclkCountdown > 0)
        {
            uteModuleSprotData.switchSysclkCountdown--;
        }
    }
#endif
    if(uteModuleSprotData.isOpenHandScreenOn)
    {
        uint8_t rolloverHandScreenStatus = getHandRollVerScreenDisplayParam();
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,rolloverHandScreenStatus=%d",__func__,rolloverHandScreenStatus);
        switch (rolloverHandScreenStatus)
        {
            case ROLLOVER_HAND_SCREEN_ON_STATUS:
            {
#if UTE_MODULE_SCREENS_SCREEN_SAVER_SUPPORT
                if((!uteModuleGuiCommonIsDisplayOn())||(uteModuleGuiCommonIsInScreenSaver()))
#else
                if(!uteModuleGuiCommonIsDisplayOn())
#endif
                {
                    // if(uteModuleNotDisturbIsAllowHandScreenOn()&&(uteModuleGuiCommonGetCurrentScreenId()!=UTE_MOUDLE_SCREENS_FACTORY_TEST_ID))
                    if(uteModuleNotDisturbIsAllowHandScreenOn())
                    {
#if UTE_MODULE_LOCAL_SET_LIFT_WRIST_SUPPORT
                        if(uteModuleLiftWristIsOpen()||uteModuleLiftWristIsTimeBucket())
#endif
                        {
                            uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_HNAD_SCREEN_ON_NOTIFY,0);
                        }
                    }
                }
            }
            break;
            case ROLLOVER_HAND_SCREEN_OFF_STATUS:
            {
#if UTE_MODULE_HAND_SCREEN_OFF_ONLY_WATCHMAIN_ID_SUPPORT//仅主界面允许落腕息屏，其他不允许，默认开启
                if(uteModuleGuiCommonIsDisplayOn()&&(uteModuleGuiCommonGetCurrentScreenId() == FUNC_CLOCK))
#else
                if(uteModuleGuiCommonIsDisplayOn()&&uteModuleGuiCommonIsAllowHandGestureDisplayOff())
#endif
                {
                    uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_HNAD_SCREEN_OFF_NOTIFY,0);
                }
            }
            break;
            default:
                break;
        }
#if 1//UTE_MODULE_LIFT_WRIST_EXCEPTION_HANDLING_SUPPORT
        // clear handup on screen status/*灭屏的时候，如果还是灭屏姿态说明有抬腕亮屏算法需要重新初始化*/
        if(!uteModuleGuiCommonIsDisplayOn() && rolloverHandScreenStatus == ROLLOVER_HAND_SCREEN_OFF_STATUS)
        {
            /*ellison add 防止灭屏的时候没有重新初始化抬手亮屏，这个和勿扰模式无关或者是否开启抬腕亮屏也没有直接关系，
            其他的逻辑不要控制算法逻辑，否则会导致算法异常。现在发现因为队列消息丢失导致抬腕亮屏算法没有重新初始化，抬腕失灵。*/
            uteModuleSprotResetRovllverScreenMode();
        }
#endif
    }
#endif
}
/**
*@brief        更新传入算法库参数标识
*@details
*@author       zn.zeng
*@date       2021-07-27
*/
void uteModuleSportUpdateGsensorIdAccRange(void)
{
    uteModuleSprotData.gsensorId = GSENSOR_BMA250E_ID;
    uteModuleSprotData.accRange = GSENSOR_4G_MODE;
    switch (uteDrvGsensorCommonGetId())
    {
        case UTE_DRV_GSENSOR_ID_STK8321:
        case UTE_DRV_GSENSOR_ID_STK8325:
        {
            uteModuleSprotData.gsensorId = GSENSOR_STK8321_ID;
        }
        break;
        case UTE_DRV_GSENSOR_ID_BMI160:
        {
            uteModuleSprotData.gsensorId = GSENSOR_BMI160_ID;
        }
        break;
        case UTE_DRV_GSENSOR_ID_ICM40607:
        {

        }
        break;
        case UTE_DRV_GSENSOR_ID_SC7A20:
        case UTE_DRV_GSENSOR_ID_SC7A20E:
        case UTE_DRV_GSENSOR_ID_SC7A20H:
        {
            uteModuleSprotData.gsensorId = GSENSOR_SC7A20_ID;
        }
        break;
        case UTE_DRV_GSENSOR_ID_BMI270:
        {
            uteModuleSprotData.gsensorId = GSENSOR_BMI160_ID ;
        }
        break;
    }
    if(uteDrvGsensorCommonGetAccRange()==8)
    {
        uteModuleSprotData.accRange =GSENSOR_8G_MODE;
    }
    else
    {
        uteModuleSprotData.accRange =GSENSOR_4G_MODE;
    }
}
/**
*@brief        设置step type
*@details
*@author       zn.zeng
*@date       2021-08-05
*/

void uteModuleSportStepTypeSetStep(void)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,uteModuleSprotData.stepType=%d", __func__,uteModuleSprotData.stepType);
    if(uteModuleSprotData.stepType!=STEP_TYPE_STEP)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
        uteModuleSprotData.stepType = STEP_TYPE_STEP;
        uteModuleSprotData.lastStepType = STEP_TYPE_STEP;
        uteDrvGsensorCommonInit(UTE_DRV_GSENSOR_DEFAULT_ACC_RATE_VALUE,UTE_DRV_GSENSOR_DEFAULT_ACC_RANGE_VALUE);
        uteModuleSportUpdateGsensorIdAccRange();
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
        uteModuleSprotResetRovllverScreenMode();
        setCurrentStepSleepState(true,false);
#endif
    }

}
/**
*@brief        设置sleep type
*@details
*@author       zn.zeng
*@date       2021-08-05
*/
void uteModuleSportStepTypeSetSleep(void)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,uteModuleSprotData.stepType=%d", __func__,uteModuleSprotData.stepType);
    if(uteModuleSprotData.stepType!=STEP_TYPE_SLEEP)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
        uteModuleSprotData.stepType = STEP_TYPE_SLEEP;
        uteModuleSprotData.lastStepType = STEP_TYPE_SLEEP;
        uteDrvGsensorCommonInit(UTE_DRV_GSENSOR_DEFAULT_ACC_RATE_VALUE,UTE_DRV_GSENSOR_DEFAULT_ACC_RANGE_VALUE);
        uteModuleSportUpdateGsensorIdAccRange();
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
        uteModuleSprotResetRovllverScreenMode();
        setCurrentStepSleepState(false,true);
#endif
        uteModuleSportSaveStepData();
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uteModuleSportSaveExerciseTimeData();
#endif
    }

}
/**
*@brief        设置none type
*@details     不计步不睡眠，不跑算法
*@author       zn.zeng
*@date       2021-08-05
*/
void uteModuleSportStepTypeSetNone(void)
{
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT  //赛维算法不设置NONE状态
//    UTE_MODULE_LOG(1, "%s,uteModuleSprotData.stepType=%d", __func__,uteModuleSprotData.stepType);
    if(uteModuleSprotData.stepType!=STEP_TYPE_NONE)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
        if(uteModuleSprotData.sedentary.isOpen)
        {
            uteModuleSprotData.sedentary.sedentaryRemindSecCnt = 0;
        }
        uteModuleSprotData.stepType = STEP_TYPE_NONE;
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
        resetUteStepsParameter();
#endif
        uteDrvGsensorCommonClearFifo();
        uteDrvGsensorCommonSleep();
        // 保存现有数据
        uteModuleSportSaveStepData();
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uteModuleSportSaveExerciseTimeData();
#endif
    }
#endif
}

/**
 * @brief        获取当前计步状态
 * @details
 * @return       计步状态
 * @author       Wang.Luo
 * @date         2025-01-10
 */
ute_module_sport_step_type uteModuleSportGetStepType(void)
{
    return uteModuleSprotData.stepType;
}

/**
*@brief        清空抬手亮屏参数
*@details     以下几种情况必须重新使能：1）屏幕off的时候；2）（手点击/滑动屏幕）手动操作屏幕的时候
*@author       zn.zeng
*@date       2021-08-05
*/
void uteModuleSprotResetRovllverScreenMode(void)
{
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    if(uteModuleSprotData.isOpenHandScreenOn)
    {
        enableHandRollverScreenMode();
    }
#endif
#if UTE_CUSTOM_HAND_SCREEN_ON_DISPLAY_OFF_TIME
    uteResetHandScreenOnFlag();
#endif
}
/**
*@brief        发送实时步数
*@details
*@author       zn.zeng
*@date       2021-08-23
*/
void uteModuleSportSendRealTimeStepInfo(void)
{
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uint8_t response[20];
    memset(response,0x00,20);
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    response[0] = CMD_CYWEE_READ_STEP_DATA;
    response[1] = 0x01;
    response[2] = time.year>>8&0xff;
    response[3] = time.year&0xff;
    response[4] = time.month;
    response[5] = time.day;
    response[6] = time.hour;
    response[7] = uteModuleSprotData.stepSleepData.currentHourStepCnt>>8&0xff;
    response[8] = uteModuleSprotData.stepSleepData.currentHourStepCnt>>0&0xff;
    uint16_t distance = (uint16_t)uteModuleCwmGetTodayCurrHourDistance();
    response[9] = distance>>8&0xff;
    response[10] = distance&0xff;
    uint32_t calories =(uint32_t) uteModuleCwmGetTodayCurrHourCalories();
    response[11] = calories>>16&0xff;
    response[12] = calories>>8&0xff;
    response[13] = calories&0xff;
    uteModuleProfileBleSendToPhone(&response[0],14);
#else
    uint8_t response[20];
    memset(response,0x00,20);
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    response[0] = CMD_READ_HOUR_STEP_DATA;
    response[1] = time.year>>8&0xff;
    response[2] = time.year&0xff;
    response[3] = time.month;
    response[4] = time.day;
    response[5] = time.hour;
    response[6] = uteModuleSprotData.stepSleepData.currentHourStepCnt>>8&0xff;
    response[7] = uteModuleSprotData.stepSleepData.currentHourStepCnt&0xff;
    response[8] = uteModuleSprotData.stepSleepData.current_hour_start_running_min;
    if (uteModuleSprotData.stepSleepData.current_hour_start_running_min >= uteModuleSprotData.stepSleepData.current_hour_end_running_min)
    {
        response[8] = 0;
    }
    response[9] = uteModuleSprotData.stepSleepData.current_hour_end_running_min;
    response[10] = uteModuleSprotData.stepSleepData.current_hour_run_step_secondCnt/60; //one hour, seconds change to minutes
    response[11] = uteModuleSprotData.stepSleepData.current_hour_run_stepCnt >> 8 & 0xff;
    response[12] = uteModuleSprotData.stepSleepData.current_hour_run_stepCnt & 0xff;
    response[13] = uteModuleSprotData.stepSleepData.current_hour_start_walking_min;
    if (uteModuleSprotData.stepSleepData.current_hour_start_walking_min >= uteModuleSprotData.stepSleepData.current_hour_end_walking_min)
    {
        response[13] = 0;
    }
    response[14] = uteModuleSprotData.stepSleepData.current_hour_end_walking_min;
    response[15] = uteModuleSprotData.stepSleepData.current_hour_walk_secondCnt/60; //one hour ,seconds change to minutes
    uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = uteModuleSprotData.stepSleepData.currentHourStepCnt -uteModuleSprotData.stepSleepData.current_hour_run_stepCnt;
    response[16] = uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt >> 8 & 0xff;
    response[17] = uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt & 0xff;
#if APP_DBG_GSENSOR_DATA
    // do nothings
    if(uteModuleSprotData.appDebugGsensorDataSwitch == false)
#endif
    {
        if(bsp_system_is_sleep() || uteModuleGuiCommonIsDisplayOn()) //熄屏后进入睡眠前不发送数据，防止无法进入睡眠
        {
            uteModuleProfileBleSendToPhone(&response[0],18);
        }
    }
#endif
}
/**
*@brief        保存当前计步数据
*@details      每天保存一个文件，前面4个byte为年月日，后面每12个byte为一个小时的数据（参考协议的数据格式）
*@author       zn.zeng
*@date       2021-08-23
*/
void uteModuleSportSaveStepData(void)
{
    /*! 没有连接过APP不保存数据 xjc, 2022-05-06  */
    if(!uteApplicationCommonIsHasConnectOurApp())
    {
        return;
    }
    uint16_t buffSize = 12*24+4;
    uint8_t *readBuff = uteModulePlatformMemoryAlloc(buffSize);
    uint8_t path[40];
    memset(&readBuff[0],0,buffSize);
    memset(&path[0],0,sizeof(path));
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    sprintf((char *)&path[0],"%04d%02d%02d",time.year,time.month,time.day);
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR, dirInfo, NULL);
    if((dirInfo->filesCnt>=UTE_MODULE_SPORT_SAVE_STEP_DATA_MAX_DAYS)&&(memcmp(&path[0],&dirInfo->filesName[0][0],8)!=0))
    {
        /*! 删除最旧一天的数据zn.zeng, 2021-08-23  */
        memset(&path[0],0,sizeof(path));
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,&dirInfo->filesName[0][0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__,&path[0]);
        uteModuleFilesystemDelFile((char *)&path[0]);
    }
    memset(&path[0],0,sizeof(path));
    sprintf((char *)&path[0],"%s/%04d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,time.year,time.month,time.day);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt=%d", __func__,dirInfo->filesCnt);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,save file=%s", __func__,&path[0]);
    /*! 保存当前数据zn.zeng, 2021-08-23  */
    void *file;
    // read
    if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readBuff[0],buffSize);
        uteModuleFilesystemCloseFile(file);
    }
    else
    {
        readBuff[0] = time.year>>8&0xff;
        readBuff[1] = time.year&0xff;
        readBuff[2] = time.month;
        readBuff[3] = time.day;
    }
    if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_WRONLY|FS_O_CREAT))
    {
        uint16_t cacheOffset = 0;
        cacheOffset = 4+12*time.hour;
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,cacheOffset=%d , currentHourStepCnt = %d", __func__,cacheOffset,uteModuleSprotData.stepSleepData.currentHourStepCnt);
        uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = uteModuleSprotData.stepSleepData.currentHourStepCnt -uteModuleSprotData.stepSleepData.current_hour_run_stepCnt;
        readBuff[cacheOffset] = (uteModuleSprotData.stepSleepData.currentHourStepCnt>>8)&0xff;
        readBuff[cacheOffset+1] = (uteModuleSprotData.stepSleepData.currentHourStepCnt)&0xff;
        readBuff[cacheOffset+2] = uteModuleSprotData.stepSleepData.current_hour_start_running_min;
        if (uteModuleSprotData.stepSleepData.current_hour_start_running_min >= uteModuleSprotData.stepSleepData.current_hour_end_running_min)
        {
            readBuff[cacheOffset+2] = 0;
        }
        readBuff[cacheOffset+3] = uteModuleSprotData.stepSleepData.current_hour_end_running_min;
        readBuff[cacheOffset+4] = uteModuleSprotData.stepSleepData.current_hour_run_step_secondCnt/60;
        readBuff[cacheOffset+5] = (uteModuleSprotData.stepSleepData.current_hour_run_stepCnt>>8)&0xff;
        readBuff[cacheOffset+6] = (uteModuleSprotData.stepSleepData.current_hour_run_stepCnt)&0xff;
        readBuff[cacheOffset + 7] = uteModuleSprotData.stepSleepData.current_hour_start_walking_min;
        if (uteModuleSprotData.stepSleepData.current_hour_start_walking_min >= uteModuleSprotData.stepSleepData.current_hour_end_walking_min)
        {
            readBuff[cacheOffset + 7] = 0;
        }
        readBuff[cacheOffset+8] = uteModuleSprotData.stepSleepData.current_hour_end_walking_min;
        readBuff[cacheOffset+9] = uteModuleSprotData.stepSleepData.current_hour_walk_secondCnt/60;
        readBuff[cacheOffset+10] = (uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt>>8)&0xff;
        readBuff[cacheOffset+11] = (uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt)&0xff;
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&readBuff[0],buffSize);
        uteModuleFilesystemCloseFile(file);
    }
    uteModulePlatformMemoryFree(readBuff);
    uteModulePlatformMemoryFree(dirInfo);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleCwmSaveStepData();     //保存当天运动数据
#endif
}
#if  UTE_MODULE_CYWEE_MOTION_SUPPORT
/**
*@brief        赛维开始发送计步数据
*@details
*@author     casen
*@date       2022-11-03
*/
void uteModuleSportSendStepHistoryData(void)
{
    ute_application_sync_data_param_t *sendParam;
    uteApplicationCommonGetSyncDataParam(&sendParam);
    uint8_t path[32];
    uint8_t response[20];
    uint8_t sendSize = 0;
    response[0] = CMD_CYWEE_READ_STEP_DATA;
    response[1] = 0x02;
    uint8_t *dataBuff = (uint8_t *)uteModulePlatformMemoryAlloc(sendParam->dataBuffSize);
    memset(&dataBuff[0],0,sendParam->dataBuffSize);
    memset(&path[0],0,32);

    if(sendParam->dirInfo.filesCnt>0)
    {
    SEND_NEXT_DATA:
        sendSize = 14;
        bool isHasData = false;
        void *file;
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_CWM_STEP_DATA_DIR,&sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,read file=%s", __func__,&path[0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currSendFileIndex=%d,currSendHourIndex=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendHourIndex);
        if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
        {
            uteModuleFilesystemReadData(file,&dataBuff[0],sendParam->dataBuffSize);
            uteModuleFilesystemCloseFile(file);
        }
        uint8_t invalidHour = 0;
        for(uint8_t i=sendParam->currSendHourIndex; i<24; i++)
        {
            uint16_t stetCnt = dataBuff[4+CWMSTEPDATA_ONCE_DATA_LEN*i]<<8|dataBuff[4+CWMSTEPDATA_ONCE_DATA_LEN*i+1];
            if(stetCnt==0)
            {
                invalidHour++;
            }
            else
            {
                memcpy(&response[2],&dataBuff[0],4);//year month day
                response[6] = i;
                memcpy(&response[7],&dataBuff[4+CWMSTEPDATA_ONCE_DATA_LEN*i],CWMSTEPDATA_ONCE_DATA_LEN);
                invalidHour++;
                isHasData = true;
                break;
            }
        }
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,invalidHour=%d", __func__,invalidHour);
        sendParam->currSendHourIndex+=invalidHour;
        if(sendParam->currSendHourIndex>=24)
        {
            sendParam->currSendFileIndex++;
            if(sendParam->currSendFileIndex<sendParam->dirInfo.filesCnt)
            {
                sendParam->currSendHourIndex = 0;
            }
            else
            {
                sendParam->currSendHourIndex=24;
            }
        }
        if((!isHasData)&&(sendParam->currSendFileIndex<sendParam->dirInfo.filesCnt))
        {
            goto SEND_NEXT_DATA;
        }
    }
    else
    {
        sendParam->currSendHourIndex=24;
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currSendFileIndex=%d,currSendHourIndex=%d,dirInfo.filesCnt=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendHourIndex,sendParam->dirInfo.filesCnt);
    if((sendParam->currSendFileIndex==sendParam->dirInfo.filesCnt)
       &&(sendParam->currSendHourIndex==24))
    {
        sendSize = 4;
        response[1] = 0x02;
        response[2] = 0xfd;
        response[3] = sendParam->crc;
        uteApplicationCommonSyncDataTimerStop();
    }
    if(sendSize==14)
    {
        uteModuleCrc8Bit(&sendParam->crc, &response[2],12);
    }
    uteModuleProfileBleSendToPhone(&response[0],sendSize);
    uteModulePlatformMemoryFree(dataBuff);
}
#else
/**
*@brief        开始发送计步数据
*@details
*@author       zn.zeng
*@date       2021-08-23
*/
void uteModuleSportSendStepHistoryData(void)
{
    ute_application_sync_data_param_t *sendParam;
    uteApplicationCommonGetSyncDataParam(&sendParam);
    uint8_t path[40];
    uint8_t response[sizeof(path)];
    uint8_t sendSize = 0;
    response[0] = CMD_START_SYN_SETP_DATA;
    uint8_t *dataBuff = (uint8_t *)uteModulePlatformMemoryAlloc(sendParam->dataBuffSize);
    memset(&path[0],0,sizeof(path));
    bool isHasData = false;
    if(sendParam->dirInfo.filesCnt>0)
    {
    SEND_NEXT_DATA:
        sendSize = 18;
        isHasData = false;
        void *file;
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,&sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,read file=%s", __func__,&path[0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currSendFileIndex=%d,currSendHourIndex=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendHourIndex);
        memset(&dataBuff[0],0,sendParam->dataBuffSize);
        if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemReadData(file,&dataBuff[0],sendParam->dataBuffSize);
            uteModuleFilesystemCloseFile(file);
        }
        uint8_t invalidHour = 0;
        for(uint8_t i=sendParam->currSendHourIndex; i<24; i++)
        {
            uint16_t stetCnt = dataBuff[4+12*i]<<8|dataBuff[4+12*i+1];
            if(stetCnt==0)
            {
                invalidHour++;
            }
            else
            {
                memcpy(&response[1],&dataBuff[0],4);//year month day
                response[5] = i;
                memcpy(&response[6],&dataBuff[4+12*i],12);
                invalidHour++;
                isHasData = true;
                break;
            }
        }
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,invalidHour=%d", __func__,invalidHour);
        sendParam->currSendHourIndex+=invalidHour;
        if(sendParam->currSendHourIndex>=24)
        {
            sendParam->currSendFileIndex++;
            if(sendParam->currSendFileIndex<sendParam->dirInfo.filesCnt)
            {
                sendParam->currSendHourIndex = 0;
            }
            else
            {
                sendParam->currSendHourIndex=24;
            }
        }
        if((!isHasData)&&(sendParam->currSendFileIndex<sendParam->dirInfo.filesCnt))
        {
            goto SEND_NEXT_DATA;
        }
    }
    else
    {
        sendParam->currSendHourIndex=24;
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currSendFileIndex=%d,currSendHourIndex=%d,dirInfo.filesCnt=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendHourIndex,sendParam->dirInfo.filesCnt);
    if((sendParam->currSendFileIndex>=sendParam->dirInfo.filesCnt)
       &&(sendParam->currSendHourIndex==24)&&(!isHasData))
    {
        sendSize = 3;
        response[1] = 0xfd;
        response[2] = sendParam->crc;
        uteApplicationCommonSyncDataTimerStop();
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
        ute_module_systemtime_time_t time;
        uteModuleSystemtimeGetTime(&time);
        ute_module_systemtime_measure_time_t setTime;
        memset(&setTime,0,sizeof(ute_module_systemtime_measure_time_t));
        setTime.year = time.year;
        setTime.month = time.month;
        setTime.day = time.day;
        setTime.hour = time.hour;
        setTime.min = time.min;
        setTime.sec = time.sec;
        uteModuleSportSetStepSyncTime(setTime);
#endif
    }
    if(sendSize==18)
    {
        uteModuleCrc8Bit(&sendParam->crc, &response[1],17);
    }
    uteModuleProfileBleSendToPhone(&response[0],sendSize);
    uteModulePlatformMemoryFree(dataBuff);
}
#endif
/**
*@brief        准备开始发送计步数据
*@details
*@param[in]  需要同步的数据时间戳
*@author       zn.zeng
*@date       2021-08-23
*/
void uteModuleSportStartSendStepHistoryData(ute_module_systemtime_time_t time)
{
    uteModuleSportSaveStepData();
    ute_application_sync_data_param_t *param;
    uteApplicationCommonGetSyncDataParam(&param);
    param->crc = 0;
    param->time = time;
    if(param->time.year==0)
    {
        param->isAllData = true;
    }
    param->currSendFileIndex = 0;
    param->currSendHourIndex = 0;
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    param->dataBuffSize = CWMSTEPDATA_ONCE_DATA_LEN*24+4;
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_CWM_STEP_DATA_DIR, &param->dirInfo, NULL);
    uteApplicationCommonRegisterSyncDataTimerFunction(uteModuleSportSendStepHistoryData);
#else
    param->dataBuffSize = 12*24+4;
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR, &param->dirInfo, NULL);
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
    int diffday = 0;
    ute_module_systemtime_time_t curryTime;
    uteModuleSystemtimeGetTime(&curryTime);
    if(uteModuleSprotData.stepSyncTime.year == 0)
    {
        diffday = 0;
    }
    else
    {
        diffday = uteModuleSystemtimeGetDiffDay(uteModuleSprotData.stepSyncTime.year,uteModuleSprotData.stepSyncTime.month,uteModuleSprotData.stepSyncTime.day,curryTime.year,curryTime.month,curryTime.day);
    }
    if((diffday >= 0)&&(diffday <= UTE_MODULE_SPORT_SAVE_STEP_DATA_MAX_DAYS))
    {
        if((param->dirInfo.filesCnt - diffday) > 0)
        {
            param->currSendFileIndex = param->dirInfo.filesCnt - diffday - 1;
        }
    }
    UTE_MODULE_LOG(1, "%s,diffday = %d,syncSime=%d/%d/%d %d:%d:%d", __func__, diffday,uteModuleSprotData.stepSyncTime.year, uteModuleSprotData.stepSyncTime.month,uteModuleSprotData.stepSyncTime.day,\
                   uteModuleSprotData.stepSyncTime.hour,uteModuleSprotData.stepSyncTime.min,uteModuleSprotData.stepSyncTime.sec);
#endif
    uteApplicationCommonRegisterSyncDataTimerFunction(uteModuleSportSendStepHistoryData);
#endif
    uteApplicationCommonSyncDataTimerStart();
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,", __func__);
}
/**
*@brief          打开关闭摇一摇拍照
*@details
*@author       zn.zeng
*@date       2021-08-24
*/
void uteModuleSportSetTakePictureEnable(bool isEnable)
{
    uteModuleSprotData.isTakingPictures = isEnable;
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    if(uteModuleSprotData.isTakingPictures)
    {
        enableTakingPicturesState();
    }
    else
    {
        disableTakingPicturesState();
    }
#endif
}
/**
*@brief          摇一摇拍照消息处理
*@details
*@author       zn.zeng
*@date       2021-08-24
*/
void uteModuleSportTakePictureHandlerMsg(void)
{
    uint8_t response[2] = {CMD_TAKE_PICTURE_MODE,0x02};
    response[0] = CMD_TAKE_PICTURE_MODE;
    uteModuleProfileBleSendToPhone(&response[0],2);
#if UTE_MODULE_SPORT_TAKE_PICTURE_MOTOR_SUPPORT
    if(uteModuleSportIsTakePicture())
    {
        uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);
        uteModuleSportDelaySetTakePictureEnableTimerStart(2000);
    }
#else
    enableTakingPicturesState();
#endif
#if DRV_HID_PHOTO
    if (uteModuleTakePictureGetMmKeyBoardStatus()) // key down
    {
        if (hidPhtotoFlag == false)
        {
            hidPhotoMultiMediaKey[0] = 0x80;
            hidPhtotoFlag = true;
        }
        else
        {
            hidPhotoMultiMediaKey[0] = 0x40;
            hidPhtotoFlag = false;
        }
        hids_send_notify(GATT_SRV_HID_MM_KB_INPUT_INDEX, hidPhotoMultiMediaKey, sizeof(hidPhotoMultiMediaKey));
    }
    if (uteModuleTakePictureGetMmKeyBoardStatus()) // key up
    {
        hidPhotoMultiMediaKey[0] = 0x00;
        hids_send_notify(GATT_SRV_HID_MM_KB_INPUT_INDEX, hidPhotoMultiMediaKey, sizeof(hidPhotoMultiMediaKey));
    }
#endif
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
}
/**
*@brief          摇一摇拍照打开app相机界面消息处理
*@details
*@author       dengli.lu
*@date       2022-08-23
*/
#if UTE_MODULE_SPORT_TAKE_PICTURE_OPEN_APP_SCREEN
void uteModuleSportOpenAppTakePictureScreenHandler(void)
{
    uint8_t response[2];
    memset(&response[0],0,2);
    response[0] = CMD_SEND_KEYCODE;
    response[1] = 0x11;
    uteModuleProfileBleSendToPhone(&response[0],2);
}
#endif
/**
*@brief         保存久坐提醒参数
*@details
*@author       zn.zeng
*@date       2021-08-24
*/
void uteModuleSportSaveSedentaryParam(ute_module_sport_sedentary_param_t *param)
{
    if(param) memcpy(&uteModuleSprotData.sedentary,param,sizeof(ute_module_sport_sedentary_param_t));
    uteModuleSprotData.sedentary.sedentaryRemindSecCnt=0;
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    if(uteModuleSprotData.sedentary.isOpen)
    {
        enableSedentaryRemind();
    }
    else
    {
        disableSedentaryRemind();
    }
#endif
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,.isOpen=%d,setMin=%d,startPeriodHour=%d,startPeriodMin=%d", __func__,uteModuleSprotData.sedentary.isOpen,uteModuleSprotData.sedentary.setMin, uteModuleSprotData.sedentary.startPeriodHour,uteModuleSprotData.sedentary.startPeriodMin);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,endPeriodHour=%d,endPeriodMin=%d", __func__,uteModuleSprotData.sedentary.endPeriodHour,uteModuleSprotData.sedentary.endPeriodMin);
    /*! 保存到文件zn.zeng, 2021-08-26*/
    void *file;
    uint8_t writebuff[17];
    writebuff[0] = uteModuleSprotData.sedentary.isOpen;
    writebuff[1] = uteModuleSprotData.sedentary.setMin;
    writebuff[2] = uteModuleSprotData.sedentary.startPeriodHour;
    writebuff[3] = uteModuleSprotData.sedentary.startPeriodMin;
    writebuff[4] = uteModuleSprotData.sedentary.endPeriodHour;
    writebuff[5] = uteModuleSprotData.sedentary.endPeriodMin;
    writebuff[6] = uteModuleSprotData.isOpenHandScreenOn;
    writebuff[7] = (uteModuleSprotData.stepsTargetCnt>>24)&0xff;
    writebuff[8] = (uteModuleSprotData.stepsTargetCnt>>16)&0xff;
    writebuff[9] = (uteModuleSprotData.stepsTargetCnt>>8)&0xff;
    writebuff[10] = uteModuleSprotData.stepsTargetCnt&0xff;
    writebuff[11] = uteModuleSprotData.isTargetCompleted;
    writebuff[12] = uteModuleSprotData.sedentary.isOpenNoonSleep;
#if UTE_MODULE_SEDENTARY_NOTIFY_SET_NOONSLEEP_TIME
    writebuff[13] = (uteModuleSprotData.sedentary.noonSleepStartTime>>8)&0xff;
    writebuff[14] = uteModuleSprotData.sedentary.noonSleepStartTime&0xff;
    writebuff[15] = (uteModuleSprotData.sedentary.noonSleepEndTime>>8)&0xff;
    writebuff[16] = uteModuleSprotData.sedentary.noonSleepEndTime&0xff;
#endif
    if( uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_SPORTINFO,&file,FS_O_WRONLY|FS_O_CREAT|FS_O_TRUNC))
    {
        uteModuleFilesystemWriteData(file,&writebuff[0],17);
        uteModuleFilesystemCloseFile(file);
    }
    //ute_quick_switch_t quick;
    //uteApplicationCommonGetQuickSwitchStatus(&quick);
    //quick.isSedentary = uteModuleSprotData.sedentary.isOpen;
    //uteApplicationCommonSetQuickSwitchStatus(&quick);
}

/**
*@brief         读取久坐提醒参数
*@details
*@author       bang.zhou
*@date       2022-10-11
*/
void uteModuleSportReadSedentaryParam(ute_module_sport_sedentary_param_t *param)
{
    memcpy(param,&uteModuleSprotData.sedentary,sizeof(ute_module_sport_sedentary_param_t));
}

/**
*@brief         保存抬手亮屏、目标步数
*@details
*@author       zn.zeng
*@date       2021-08-26
*/
void uteModuleSportSaveHandScreenOnStepsTargetCnt(bool isHandOpen,uint32_t targetCnt)
{
    /*! 只有修改的目标步数大于当前设置的目标步数，才重置已提醒状态 xjc, 2022-01-05*/
    if(targetCnt > uteModuleSprotData.stepsTargetCnt)
    {
        uteModuleSprotData.isTargetCompleted = false;
    }
    uteModuleSprotData.isOpenHandScreenOn = isHandOpen;
    uteModuleSprotData.stepsTargetCnt = targetCnt;
    /*! 保存到文件zn.zeng, 2021-08-26*/
    void *file;
    uint8_t writebuff[12];
    writebuff[0] = uteModuleSprotData.sedentary.isOpen;
    writebuff[1] = uteModuleSprotData.sedentary.setMin;
    writebuff[2] = uteModuleSprotData.sedentary.startPeriodHour;
    writebuff[3] = uteModuleSprotData.sedentary.startPeriodMin;
    writebuff[4] = uteModuleSprotData.sedentary.endPeriodHour;
    writebuff[5] = uteModuleSprotData.sedentary.endPeriodMin;
    writebuff[6] = uteModuleSprotData.isOpenHandScreenOn;
    writebuff[7] = (uteModuleSprotData.stepsTargetCnt>>24)&0xff;
    writebuff[8] = (uteModuleSprotData.stepsTargetCnt>>16)&0xff;
    writebuff[9] = (uteModuleSprotData.stepsTargetCnt>>8)&0xff;
    writebuff[10] = uteModuleSprotData.stepsTargetCnt&0xff;
    writebuff[11] = uteModuleSprotData.isTargetCompleted;
    if( uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_SPORTINFO,&file,FS_O_WRONLY|FS_O_CREAT|FS_O_TRUNC))
    {
        uteModuleFilesystemWriteData(file,&writebuff[0],12);
        uteModuleFilesystemCloseFile(file);
    }
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    if(uteModuleSprotData.sedentary.isOpen)
    {
        enableSedentaryRemind();
    }
    else
    {
        disableSedentaryRemind();
    }
#endif
    ute_quick_switch_t quick;
    uteModuleSprotResetRovllverScreenMode();
    uteApplicationCommonGetQuickSwitchStatus(&quick);
    quick.isTurnTheWrist = uteModuleSprotData.isOpenHandScreenOn;
    uteApplicationCommonSetQuickSwitchStatus(&quick);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,isOpenHandScreenOn=%d,stepsTargetCnt=%d", __func__,uteModuleSprotData.isOpenHandScreenOn,uteModuleSprotData.stepsTargetCnt);
}

bool uteModuleSportSedentaryOpenCtrl(bool isSet,bool isOpen)
{
    if(isSet)
    {
        uteModuleSprotData.sedentary.isOpen=isOpen;
        uteModuleSportSaveSedentaryParam(NULL);
    }

    return uteModuleSprotData.sedentary.isOpen;
}
void uteModuleSportSedentaryOpenSwitch(void)
{
    uteModuleSprotData.sedentary.isOpen=!uteModuleSprotData.sedentary.isOpen;
    uteModuleSportSaveSedentaryParam(NULL);
}



/**
*@brief         从flash读取当天步数信息
*@details
*@param[out] uint32_t *total 总步数
*@param[out] uint32_t *walk 总走路步数
*@param[out] uint32_t *run 总跑步步数
*@author       zn.zeng
*@date       2021-11-03
*/
void uteModuleSportReadCurrDayStepCnt(ute_module_systemtime_time_t time)
{
    uint32_t readTotal=0;
    uint32_t readWalk=0;
    uint32_t readRun=0;
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    //Casen add 22-07-13
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
    uteModuleSprotData.dailyActivity.everyHourRunStep[time.hour] = (uteModuleSprotData.stepSleepData.current_hour_run_stepCnt);
    uteModuleSprotData.dailyActivity.everyHourWalkStep[time.hour] = (uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleSprotData.dailyActivity.everyHourWalkStep[time.hour] = uteModuleSprotData.stepSleepData.currentHourStepCnt;
#endif
#endif
    if(time.hour!=uteModuleSprotData.lastDayReadHour)
    {
        void *file;
        uint8_t path[40];
        uint16_t buffSize = 12*24+4;
        uint8_t *readBuff = uteModulePlatformMemoryAlloc(buffSize);
        memset(&path[0],0,sizeof(path));
        sprintf((char *)&path[0],"%s/%04d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,time.year,time.month,time.day);
        // read
        if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemReadData(file,&readBuff[0],buffSize);
            uteModuleFilesystemCloseFile(file);
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
            memset(&uteModuleSprotData.dailyActivity.everyHourRunStep[0], 0, 24 * 4);
            memset(&uteModuleSprotData.dailyActivity.everyHourWalkStep[0], 0, 24 * 4);
#endif
            for(uint8_t i=0; i<24; i++)
            {
                uint32_t tmpTotal = (readBuff[4+i*12]<<8|readBuff[4+i*12+1]);
                uint32_t tmpRun = (readBuff[4+i*12+5]<<8|readBuff[4+i*12+6]);
                uint32_t tmpWalk = (readBuff[4+i*12+10]<<8|readBuff[4+i*12+11]);
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
                uteModuleSprotData.dailyActivity.everyHourRunStep[i] = tmpRun;
                uteModuleSprotData.dailyActivity.everyHourWalkStep[i] = tmpWalk;
#endif
                if(time.hour==i)
                {
                    break;
                }
                // UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,i=%d,tmpTotal=%d,tmpRun=%d,tmpWalk=%d,everyHourWalkStep[i]=%d", __func__,i,tmpTotal,tmpRun,tmpWalk,uteModuleSprotData.dailyActivity.everyHourWalkStep[i]);
                readTotal = readTotal+tmpTotal;
                readRun = readRun+tmpRun;
                readWalk = readWalk+tmpWalk;
            }
        }
        uteModulePlatformMemoryFree(readBuff);
        uteModuleSprotData.currDayReadTotalStep = readTotal;
        uteModuleSprotData.currDayReadWalkStep = readWalk;
        uteModuleSprotData.currDayReadRunStep = readRun;
        uteModuleSprotData.lastDayReadHour = time.hour;
        //  UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,readTotal=%d,readRun=%d,readWalk=%d", __func__,readTotal,readRun,readWalk);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
        uteModuleCwmReadCurrDayStepFromFs();
#endif
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currentHourStepCnt=%d,current_hour_run_stepCnt=%d,current_hour_walk_stepCnt=%d", __func__,uteModuleSprotData.stepSleepData.currentHourStepCnt,uteModuleSprotData.stepSleepData.current_hour_run_stepCnt,uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    cwmStepData_t currentDayStepData;
    uteModuleCwmGetCurrStepData(&currentDayStepData);
    uteModuleSprotData.currDayTotalStep = (uint32_t)(currentDayStepData.step*1.0f) + uteModuleSprotData.stepSleepData.currentHourStepCnt;
//    UTE_MODULE_LOG(UTE_LOG_CYWEE_MOTION_LVL, "%s,currDayTotalStep=%d, step = %f", __func__,uteModuleSprotData.currDayTotalStep,currentDayStepData.step);
#else
    uteModuleSprotData.currDayTotalStep = uteModuleSprotData.currDayReadTotalStep +uteModuleSprotData.stepSleepData.currentHourStepCnt;
#endif
    uteModuleSprotData.currDayWalkStep = uteModuleSprotData.currDayReadWalkStep+uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt;
    uteModuleSprotData.currDayRunStep = uteModuleSprotData.currDayReadRunStep+uteModuleSprotData.stepSleepData.current_hour_run_stepCnt;
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currDayTotalStep=%d,currDayWalkStep=%d,currDayRunStep=%d", __func__,uteModuleSprotData.currDayTotalStep,uteModuleSprotData.currDayWalkStep,uteModuleSprotData.currDayRunStep);

    uteModulePlatformGiveMutex(uteModuleSprotMute);
}

/**
*@brief         获取当天步数信息
*@details
*@param[out] uint32_t *total 总步数
*@param[out] uint32_t *walk 总走路步数
*@param[out] uint32_t *run 总跑步步数
*@author       zn.zeng
*@date       2021-10-23
*/
void uteModuleSportGetCurrDayStepCnt(uint32_t *total,uint32_t *walk,uint32_t *run)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    if (total != NULL)
    {
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
        *total = uteModuleSprotData.currDayTotalStep + uteModuleSprotData.todaySportWithStepsData.step + uteModuleSprotData.todaySportOtherData.step;
#else
        *total = uteModuleSprotData.currDayTotalStep + uteModuleSprotData.todaySportWithStepsData.step;
#endif
#else
        *total = uteModuleSprotData.currDayTotalStep;
#endif
#if UTE_LOG_GUI_LVL // test
        ute_module_systemtime_time_t time;
        uteModuleSystemtimeGetTime(&time);
        if(time.sec%3==0)
        {
            *total=3210;
        }
        if(time.sec%5==0)
        {
            *total=654;
        }
        if(time.sec%7==0)
        {
            *total=87;
        }
        if(time.sec%11==0)
        {
            *total=9;
        }
#endif
#if APP_CUSTOM_NOT_DISPLAY_STEP_SUPPORT
        if (!uteApplicationCommonIsHasConnectOurApp())
        {
            if (*total < 50)
            {
                *total = 0;
            }
        }
#endif
    }
    if (walk != NULL)
    {
        *walk = uteModuleSprotData.currDayWalkStep;
    }
    if (run != NULL)
    {
        *run = uteModuleSprotData.currDayRunStep;
    }
    if(*total > 99999)
    {
        *total = 99999;
    }
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
/**
*@brief  读取目标步数
*@details
*@author        dengli.lu
*@date        2021-10-26
*/
uint32_t uteModuleSportGetStepsTargetCnt(void)
{
    return uteModuleSprotData.stepsTargetCnt;
}
/**
*@brief  设置目标提醒是否完成
*@details
*@author        dengli.lu
*@date        2021-10-26
*/
void uteModuleSportSetIsTargetCompleted(bool isTargetCompleted)
{
    uteModuleSprotData.isTargetCompleted = isTargetCompleted;
}
/**
*@brief  获取目标提醒是否完成
*@details
*@author        dengli.lu
*@date        2021-10-26
*/
bool uteModuleSportGetIsTargetCompleted(void)
{
    return uteModuleSprotData.isTargetCompleted;
}
/**
*@brief  读取抬手亮屏开关
*@details
*@author        dengli.lu
*@date        2021-10-26
*/
bool uteModuleSportGetIsOpenHandScreenOn(void)
{
    return uteModuleSprotData.isOpenHandScreenOn;
}
/**
*@brief         获取当天距离
*@details
*@author       dengli.lu
*@date       2021-10-26
*/
uint16_t uteModuleSportGetCurrDayDistanceData(void)
{
    float distance;
    float distance_Step,distance_Run;
    ute_personal_info_t personal;
    uteApplicationCommonGetPersonalInfo(&personal);
    uint16_t tempDistance=0;
    uteModulePlatformTakeMutex(uteModuleSprotMute);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    cwmStepData_t currentDayStepData;
    uteModuleCwmGetCurrStepData(&currentDayStepData);
    float currHourdistance = uteModuleCwmGetTodayCurrHourDistance();
    distance = ExactDecimalPoint(currentDayStepData.distance*0.001f, 2) + ExactDecimalPoint(currHourdistance*0.001f, 2);
#else
    {
        if(personal.isMan)
        {
            distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.currDayWalkStep))*0.00001f*0.4102670f);
            distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.currDayRunStep))*0.00001f*0.5461055f);
        }
        else
        {
            distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.currDayWalkStep))*0.00001f*0.4151582f);
            distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.currDayRunStep))*0.00001f*0.5047813f);
        }
    }
    distance_Step = ExactDecimalPoint(distance_Step,2);
    distance_Run = ExactDecimalPoint(distance_Run,2);
    distance = ExactDecimalPoint((distance_Step+distance_Run),2);
#endif
    if(uteModuleSystemtimeGetDistanceMiType())
    {
        distance = (float)distance * 0.6213712f;
    }
    distance = ExactDecimalPoint(distance,2);
#if UTE_LOG_GUI_LVL
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    if(time.sec%3==0)
    {
        distance=12.34;
    }
    if(time.sec%5==0)
    {
        distance=45.67;
    }
    if(time.sec%7==0)
    {
        distance=78.90;
    }
    if(time.sec%11==0)
    {
        distance=70;
    }
#endif
    tempDistance = (uint16_t)(distance*100.f) ; //放大浮点取小数点后两位
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
    uint16_t moreSportDistance = (uint16_t)((uteModuleSystemtimeGetDistanceMiType()) ? (uteModuleSprotData.todaySportWithStepsData.distance * 0.6213712f) : uteModuleSprotData.todaySportWithStepsData.distance);
    tempDistance = tempDistance + moreSportDistance;
#endif
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
    tempDistance += uteModuleSprotData.todaySportOtherData.distance;
#endif
    uteModulePlatformGiveMutex(uteModuleSprotMute);
    if(tempDistance>9999)
    {
        tempDistance = 9999;
    }
    return tempDistance;
}
/**
*@brief         获取当天卡路里
*@details
*@author       dengli.lu
*@date       2021-10-26
*/
uint16_t uteModuleSportGetCurrDayKcalData(void)
{
    uint16_t kcal=0;
    float distance_Step,distance_Run;
    float kcli_Step,kcli_Run,kcli;
    ute_personal_info_t personal;
    uteApplicationCommonGetPersonalInfo(&personal);
    uteModulePlatformTakeMutex(uteModuleSprotMute);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    cwmStepData_t currentDayStepData;
    uteModuleCwmGetCurrStepData(&currentDayStepData);
    float calories = uteModuleCwmGetTodayCurrHourCalories();
    kcli_Step = ExactDecimalPoint(currentDayStepData.calories*0.001f,1) + ExactDecimalPoint(calories*0.001f,1);
    kcli_Run = 0.0f;
#else
    if(personal.isMan)
    {
        distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.currDayWalkStep))*0.00001f*0.4102670f);
        distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.currDayRunStep))*0.00001f*0.5461055f);

        kcli_Step = (float)(distance_Step*personal.weight/1000.0f*0.5907296f);
        kcli_Run =  (float)(distance_Run*personal.weight/1000.0f*0.9288487f);
    }
    else
    {
        distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.currDayWalkStep))*0.00001f*0.4151582f);
        distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.currDayRunStep))*0.00001f*0.5047813f);

        kcli_Step = (float)(distance_Step*personal.weight/1000.0f*0.7918928f);
        kcli_Run = (float)(distance_Run*personal.weight/1000.0f*1.234930f);
    }
    kcli_Step = ExactDecimalPoint(kcli_Step,1);
    kcli_Run = ExactDecimalPoint(kcli_Run,1);
#endif
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
    float kcalAllSport;
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
    float kcalotherSport;
    kcalotherSport = uteModuleSprotData.todaySportOtherData.caloire;
    kcalotherSport = ExactDecimalPoint(kcalotherSport, 1);
#endif
    kcalAllSport = uteModuleSprotData.todaySportWithStepsData.caloire;
    kcalAllSport = ExactDecimalPoint(kcalAllSport,1);
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
    kcli = ExactDecimalPoint((kcli_Step + kcli_Run + kcalAllSport + kcalotherSport), 2);
#else
    kcli = ExactDecimalPoint((kcli_Step+kcli_Run+kcalAllSport),2);
#endif
#else
    kcli = ExactDecimalPoint((kcli_Step+kcli_Run),2);
#endif
    uteModulePlatformGiveMutex(uteModuleSprotMute);
    kcal = (uint16_t)(kcli*1.0f);
#if UTE_LOG_GUI_LVL
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    if(time.sec%3==0)
    {
        kcal=3210;
    }
    if(time.sec%5==0)
    {
        kcal=654;
    }
    if(time.sec%7==0)
    {
        kcal=87;
    }
    if(time.sec%11==0)
    {
        kcal=9;
    }
#endif
    if(kcal>9999)
    {
        kcal = 9999;
    }
    return kcal;
}

/**
*@brief     开始多运动
*@details
*@param[in]  sportsType     运动模式标志
*@param[in]  startInterval  每隔N个10秒
*@param[in]  isAppStart     是否为APP开启运动
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportStartMoreSports(uint8_t sportsType,uint8_t startInterval,bool isAppStart)
{
    uint32_t param = sportsType<<24|startInterval<<16|isAppStart<<8;
    uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_MODULE_SPORT_START_MORE_SPORTS,param);
}
/**
*@brief     发送运动状态给app
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportSendMoreSportsStatus(void)
{
    uint8_t resp[4];
    resp[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;
    resp[1] = uteModuleSprotData.moreSportData.status;
    resp[2] = uteModuleSprotData.moreSportData.saveData.sportsType;
    resp[3] = uteModuleSprotData.moreSportData.saveData.startInterval;
    uteModuleProfileBleSendToPhone(&resp[0],4);
}

/**
*@brief     用于与APP同步运动状态
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportSyncAppSportStatus(all_sport_status_type sportStatus)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sportStatus=0x%x,uteModuleSprotData.moreSportData.status=0x%x,isAppStart=%d ", __func__,sportStatus,uteModuleSprotData.moreSportData.status,uteModuleSprotData.moreSportData.isAppStart);
    if(sportStatus ==uteModuleSprotData.moreSportData.status)
    {
        return;//相同的状态就不用重复更新给手机
    }
    if (sportStatus ==ALL_SPORT_STATUS_CONTINUE)
    {
        /*!APP启动运动，断开连接回连时,不发送继续指令，在回连同步数据的时候可能会导致手环端数据不更新 xjc 2022-03-07*/
        if((uteModuleSportMoreSportIsAppStart())&&(!uteModuleSportMoreSportIsAppStartReconnection()))
        {
            return;
        }
    }
    uint8_t length =13;
    if (sportStatus ==ALL_SPORT_STATUS_CLOSE)
    {
        length = 4;
    }

    uteModuleSprotData.moreSportData.status = (sportStatus==ALL_SPORT_STATUS_CONTINUE)?ALL_SPORT_STATUS_OPEN:sportStatus ;

    if(uteModuleSprotData.moreSportData.isAppStart)
    {
        static uint8_t tmpSendData[14];

        tmpSendData[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;   //指令头标志
        tmpSendData[1] = sportStatus;
        tmpSendData[2] = uteModuleSprotData.moreSportData.saveData.sportsType;
        tmpSendData[3] = uteModuleSprotData.moreSportData.saveData.startInterval;
        //get sport time
        tmpSendData[4] = (uteModuleSprotData.moreSportData.totalSportTime>>16&0xff);
        tmpSendData[5] = (uteModuleSprotData.moreSportData.totalSportTime>>8)&0xff;
        tmpSendData[6] = uteModuleSprotData.moreSportData.totalSportTime&0xff;
        // kcal
        tmpSendData[7] = (uteModuleSprotData.moreSportData.saveData.sportCaloire>>8)&0xff;
        tmpSendData[8] = uteModuleSprotData.moreSportData.saveData.sportCaloire & 0xff;
        //distance
        tmpSendData[9] = uteModuleSprotData.moreSportData.saveData.sportDistanceInteger;
        tmpSendData[10] = uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals;
        //avg time
        tmpSendData[11] = uteModuleSprotData.moreSportData.saveData.avgTimeMinute;
        tmpSendData[12] = uteModuleSprotData.moreSportData.saveData.avgTimeSecond;

        uteModuleProfileBleSendToPhone(&tmpSendData[0],length);
    }
}

/**
*@brief     app端启动运动是否的带gps的运动类型
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
bool uteModuleSportIsPhoneAppStartGpsSportsType(void)
{
    bool result =false;
    if((uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_RUNNING)
       ||(uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_WALKING)
#if (!UTE_MODULE_SPORT_BIKE_KCAL_USE_LOCAL_DATA_SUPPORT)
       ||(uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_RIDE_BIKE)
#endif
      )
    {
        result =true;
    }
    return result;
}
/**
*@brief     多运动每秒从算法获取数据
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportMoreSportsGetDataFormAlgo(ute_module_systemtime_time_t *time)
{
    uint8_t sportDistanceInteger,sportDistanceDecimals;
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    cwmSportModeData_t cwmSportModeData = {0};
    uint16_t sportPace=0;
    uteModuleCwmGetCurrSportData(&cwmSportModeData);
#endif
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
    uint16_t tmpDistance = 0;
#endif
    struct prf_date_time currentTime;
    currentTime.year = time->year;
    currentTime.month = time->month;
    currentTime.day = time->day;
    currentTime.hour = time->hour;
    currentTime.min = time->min;
    currentTime.sec = time->sec;
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    if(uteModuleSprotData.moreSportData.isAppStart)
    {
        //如果是APP开启的GPS运动，那么卡路里、距离、配速、运动时长，这四个数据由APP推送下来，不在从算法中获取
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
        getUTESportData(currentTime);//这个只是更新开始和结束时间，为了统一性，总的时长还是由APP下发，卡路里由算法提供
#endif
        if (!uteModuleSportIsPhoneAppStartGpsSportsType())
        {
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
            uteModuleSprotData.moreSportData.saveData.sportCaloire = (uint16_t)cwmSportModeData.sportCalories;
            //距离:保留2位小数
            sportDistanceInteger  = (uint8_t)(cwmSportModeData.sportDistance/1000);
            sportDistanceDecimals = (uint8_t)((cwmSportModeData.sportDistance - sportDistanceInteger*1000)/10);
            uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = sportDistanceInteger;
            uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals = sportDistanceDecimals;
            //配速
            sportPace = (uint16_t)(cwmSportModeData.sportPace*60);
            uteModuleSprotData.moreSportData.saveData.avgTimeMinute = sportPace/60;
            uteModuleSprotData.moreSportData.saveData.avgTimeSecond = sportPace%60;;

#else
            uteModuleSprotData.moreSportData.saveData.sportCaloire = mUTESportDatas.sportKcal;
            //距离:保留2位小数
            sportDistanceInteger  = (uint8_t)(mUTESportDatas.sportDistance);
            sportDistanceDecimals = (uint8_t)((mUTESportDatas.sportDistance-(float)sportDistanceInteger)*100);
            uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = sportDistanceInteger;
            uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals = sportDistanceDecimals;
            //配速
            uteModuleSprotData.moreSportData.saveData.avgTimeMinute = (mUTESportDatas.sportSpeed>>8)&0xFF;
            uteModuleSprotData.moreSportData.saveData.avgTimeSecond = mUTESportDatas.sportSpeed&0xFF;
#endif
        }
    }
    else
    {
#if UTE_MODULE_HEART_SUPPORT
#if !APP_MODULE_SPORT_NOT_WARE_DETECT_SUPPORT
        if(uteModuleHeartIsWear())
#endif
#endif
        {
            uteModuleSprotData.moreSportData.totalSportTime++;
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
            getUTESportData(currentTime);
#endif
        }
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
        //卡路里
        uteModuleSprotData.moreSportData.saveData.sportCaloire = (uint16_t)cwmSportModeData.sportCalories;
        //距离:保留2位小数
        sportDistanceInteger  = (uint8_t)(cwmSportModeData.sportDistance/1000);
        sportDistanceDecimals = (uint8_t)((cwmSportModeData.sportDistance - sportDistanceInteger*1000)/10);
        uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = sportDistanceInteger;
        uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals = sportDistanceDecimals;
        //配速
        sportPace = (uint16_t)(cwmSportModeData.sportPace*60);
        uteModuleSprotData.moreSportData.saveData.avgTimeMinute = sportPace/60;
        uteModuleSprotData.moreSportData.saveData.avgTimeSecond = sportPace%60;;
#else
        //卡路里
        uteModuleSprotData.moreSportData.saveData.sportCaloire = mUTESportDatas.sportKcal;
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
        if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01)
        {
            tmpDistance = uteModuleSprotData.gpsData.gpsTotalDistance / 100;//单位由分米转换为10米
            uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = tmpDistance / 100;
            uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals = tmpDistance % 100;
        }
        else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03 || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x04)
        {
            tmpDistance = uteModuleSprotData.gpsData.gpsTotalDistance / 100;//单位由分米转换为10米
            uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = tmpDistance / 100;
            uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals = tmpDistance % 100;
        }
        else
        {
            //距离:保留2位小数
            sportDistanceInteger  = (uint8_t)(mUTESportDatas.sportDistance);
            sportDistanceDecimals = (uint8_t)((mUTESportDatas.sportDistance - (float)sportDistanceInteger) * 100);
            uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = sportDistanceInteger;
            uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals = sportDistanceDecimals;
            //配速
            uteModuleSprotData.moreSportData.saveData.avgTimeMinute = (mUTESportDatas.sportSpeed>>8)&0xFF;
            uteModuleSprotData.moreSportData.saveData.avgTimeSecond = mUTESportDatas.sportSpeed&0xFF;
        }
#else
        //距离:保留2位小数
        sportDistanceInteger  = (uint8_t)(mUTESportDatas.sportDistance);
        sportDistanceDecimals = (uint8_t)((mUTESportDatas.sportDistance-(float)sportDistanceInteger)*100);
        uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = sportDistanceInteger;
        uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals = sportDistanceDecimals;
        //配速
        uteModuleSprotData.moreSportData.saveData.avgTimeMinute = (mUTESportDatas.sportSpeed>>8)&0xFF;
        uteModuleSprotData.moreSportData.saveData.avgTimeSecond = mUTESportDatas.sportSpeed&0xFF;
#endif
#endif
    }
    //UTE_LOG(UTE_LOG_SAVE_LVL,"sportDistanceInteger = %d \t sportDistanceDecimals = %d \n\r",sportDistanceInteger,sportDistanceDecimals);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    //步数
    uteModuleSprotData.moreSportData.saveData.sportStep = (uint32_t)cwmSportModeData.sportStep;
    //赛维提供的库跳绳和游泳时不输出运动次数
//    //次数
//    if(mUTESportDatas.sportType == SPORT_TYPE_JUMP_ROPE)
//    {
//        uteModuleSprotData.moreSportData.saveData.sportTimes = mUTESportDatas.jumpRopeCurrentCnt;
//    }
//    else if(mUTESportDatas.sportType == SPORT_TYPE_SWIMMING)
//    {
//        uteModuleSprotData.moreSportData.saveData.sportTimes = mUTESportDatas.swimmingCurrentCnt;
//    }
    //开始时间&结束时间
    memcpy(&uteModuleSprotData.moreSportData.saveData.startSportTime,&cwmSportModeData.startSportTime,7);
    memcpy(&uteModuleSprotData.moreSportData.saveData.stopSportTime,&cwmSportModeData.stopSportTime,7);

#else
    //步数
    uteModuleSprotData.moreSportData.saveData.sportStep = mUTESportDatas.sportSteps;
    //次数
    if(mUTESportDatas.sportType == SPORT_TYPE_JUMP_ROPE)
    {
        uteModuleSprotData.moreSportData.saveData.sportTimes = mUTESportDatas.jumpRopeCurrentCnt;
    }
    else if(mUTESportDatas.sportType == SPORT_TYPE_SWIMMING)
    {
        uteModuleSprotData.moreSportData.saveData.sportTimes = mUTESportDatas.swimmingCurrentCnt;
    }
    //开始时间&结束时间
    memcpy(&uteModuleSprotData.moreSportData.saveData.startSportTime,&mUTESportDatas.startSportTime,7);
    memcpy(&uteModuleSprotData.moreSportData.saveData.stopSportTime,&mUTESportDatas.stopSportTime,7);
#endif

    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
/**
*@brief     多运动每秒处理心率数据
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportMoreSportsHeartDataHandler(void)
{
#if UTE_MODULE_HEART_SUPPORT
    if(!bsp_sensor_hr_work_status() || uteModuleHeartGetWorkMode() != HR_WORK_MODE_HR)
    {
        uteModuleHeartStartSingleTesting(TYPE_HEART);
    }
    uint8_t heart = (uint8_t)uteModuleHeartGetHeartValue();
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
    bool needSave = false;
    if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01
        || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03)
    {
        //支持轨迹每隔APP_SPORT_SAVE_DATA_INTERVAL秒存一组值
        if (uteModuleSprotData.moreSportData.totalSportTime % APP_SPORT_SAVE_DATA_INTERVAL == 0)
            needSave = true;
    }
    else
    {
        //其他运动每隔10秒存一组值
        if (uteModuleSprotData.moreSportData.totalSportTime % 10 == 0)
            needSave = true;
    }
    //every 10 seconds will save data
    if (needSave == true
        && uteModuleSprotData.moreSportData.totalSportTime > 0
        && (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE))
    {
        uteModulePlatformTakeMutex(uteModuleSprotMute);
        if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01)
        {
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = heart;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeSecond;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeStepfrequency;
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.latitudeSport >> 24) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.latitudeSport >> 16) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.latitudeSport >> 8) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.gpsData.latitudeSport & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.longitudeSport >> 24) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.longitudeSport >> 16) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.longitudeSport >> 8) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.gpsData.longitudeSport & 0xFF;
#endif
        }
        else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02)
        {
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = heart;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeSecond;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeStepfrequency;
        }
        else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03)
        {
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = heart;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeSpeedInteger;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeSpeedDecimals;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = 0x00;//reserve
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.latitudeSport >> 24) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.latitudeSport >> 16) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.latitudeSport >> 8) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.gpsData.latitudeSport & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.longitudeSport >> 24) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.longitudeSport >> 16) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = (uteModuleSprotData.gpsData.longitudeSport >> 8) & 0xFF;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.gpsData.longitudeSport & 0xFF;
#endif
        }
        else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x04)
        {
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = heart;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeSpeedInteger;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = uteModuleSprotData.moreSportData.realTimeSpeedDecimals;
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = 0x00;//reserve
        }
        else
        {
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportsCalc.saveIndex ++] = heart;
        }

        if (uteModuleSprotData.moreSportsCalc.saveIndex == SPORTS_HEART_DATAS_CACHE_LENGTH)
        {
            /*! 保存数据 */
            uteModuleSportMoreSportsSaveData(false);
            uteModuleSprotData.moreSportsCalc.saveIndex = 0;
            //判断空间是否足够
            if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01
                || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03)
            {
                //空间不够自动停止运动
                if (uteModuleSprotData.moreSportData.heartTotalCnt * 12 > (uteModuleSprotData.leftSpaceSize - 1024))//todo
                {
                    uteModuleSportStopMoreSportsMsgHandler();
                    uteModuleSportSetMemoryFullType(FULL_TYPE_NOT_ENOUGH_ING);
//                    uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TIP_SCREEN_ID);
                }
            }
            else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02
                     || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x04)
            {
                UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL,"heartTotalCnt =%d %d", uteModuleSprotData.moreSportData.heartTotalCnt * 4, uteModuleSprotData.leftSpaceSize - 1024);
                if (uteModuleSprotData.moreSportData.heartTotalCnt * 4 > (uteModuleSprotData.leftSpaceSize - 1024))//todo
                {
                    uteModuleSportStopMoreSportsMsgHandler();
                    uteModuleSportSetMemoryFullType(FULL_TYPE_NOT_ENOUGH_ING);
//                    uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TIP_SCREEN_ID);
                }
            }
            else
            {
                if (uteModuleSprotData.moreSportData.heartTotalCnt > (uteModuleSprotData.leftSpaceSize - 1024))//todo
                {
                    uteModuleSportStopMoreSportsMsgHandler();
                    uteModuleSportSetMemoryFullType(FULL_TYPE_NOT_ENOUGH_ING);
//                    uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TIP_SCREEN_ID);
                }
            }
        }

        //心率 MAX MIN AVG
        if (heart > uteModuleSprotData.moreSportData.saveData.maxHeartRate)
        {
            uteModuleSprotData.moreSportData.saveData.maxHeartRate = heart;
        }
        if (heart < uteModuleSprotData.moreSportData.saveData.minHeartRate && heart > 0)
        {
            uteModuleSprotData.moreSportData.saveData.minHeartRate = heart;
        }
        if (heart > 0)
        {
            uteModuleSprotData.moreSportData.heartTotalSum += heart;
            uteModuleSprotData.moreSportData.heartTotalCnt ++;
            uteModuleSprotData.moreSportData.saveData.avgHeartRate = uteModuleSprotData.moreSportData.heartTotalSum / uteModuleSprotData.moreSportData.heartTotalCnt;
        }
        uteModulePlatformGiveMutex(uteModuleSprotMute);
    }
    if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE)
    {
        if (heart >= uteModuleSprotData.moreSportsCalc.hrWarmup
            && heart < uteModuleSprotData.moreSportsCalc.hrWeightReduction)
            uteModuleSprotData.moreSportData.saveData.hrWarmupCnt ++;
        else if (heart >= uteModuleSprotData.moreSportsCalc.hrWeightReduction
                 && heart < uteModuleSprotData.moreSportsCalc.hrEndurance)
            uteModuleSprotData.moreSportData.saveData.hrWeightReductionCnt ++;
        else if (heart >= uteModuleSprotData.moreSportsCalc.hrEndurance
                 && heart < uteModuleSprotData.moreSportsCalc.hrAnaerobic)
            uteModuleSprotData.moreSportData.saveData.hrEnduranceCnt ++;
        else if (heart >= uteModuleSprotData.moreSportsCalc.hrAnaerobic
                 && heart < uteModuleSprotData.moreSportsCalc.hrExtreme)
            uteModuleSprotData.moreSportData.saveData.hrAnaerobicCnt ++;
        else if (heart >= uteModuleSprotData.moreSportsCalc.hrExtreme)
            uteModuleSprotData.moreSportData.saveData.hrExtremeCnt ++;
    }
#else
    uint16_t saveTimeInterval = uteModuleSprotData.moreSportData.saveData.startInterval*10;
    //uint8_t heart = (uint8_t)uteModuleHeartGetHeartValue();
    if((uteModuleSprotData.moreSportData.totalSportTime%saveTimeInterval==0 )&&
       (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE))
    {
        //Casen add 20-11-09
        uteModulePlatformTakeMutex(uteModuleSprotMute);
        if(heart != 0 && heart != 0xFF)
        {
            uteModuleSprotData.moreSportData.heartCache[uteModuleSprotData.moreSportData.heartTotalCnt%SPORTS_HEART_DATAS_CACHE_LENGTH] = heart;
            if((uteModuleSprotData.moreSportData.heartTotalCnt%SPORTS_HEART_DATAS_CACHE_LENGTH)==0 && uteModuleSprotData.moreSportData.heartTotalCnt!=0)
            {
                /*! 保存数据 zn.zeng, 2021-11-11  */
                uteModuleSportMoreSportsSaveData(false);
            }
            //心率 MAX MIN AVG
            if(heart>uteModuleSprotData.moreSportData.saveData.maxHeartRate)
            {
                uteModuleSprotData.moreSportData.saveData.maxHeartRate = heart;
            }
            if(heart<uteModuleSprotData.moreSportData.saveData.minHeartRate)
            {
                uteModuleSprotData.moreSportData.saveData.minHeartRate = heart;
            }
            uteModuleSprotData.moreSportData.heartTotalSum += heart;
            uteModuleSprotData.moreSportData.heartTotalCnt++;
            uteModuleSprotData.moreSportData.saveData.avgHeartRate = uteModuleSprotData.moreSportData.heartTotalSum/uteModuleSprotData.moreSportData.heartTotalCnt;
        }
        uteModulePlatformGiveMutex(uteModuleSprotMute);
    }
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE)
    {
        if (uteModuleSprotData.exerciseType == 0x01 || uteModuleSprotData.exerciseType == 0x03)
        {
            //以步数来判断
        }
        else
        {
            if (heart > uteModuleSprotData.exerCiseHeartValue)
                uteModuleSprotData.exerciseTime[uteModuleSprotData.exerciseType] += 1;//以秒为单位保存
        }
    }
#endif
#endif
}
/**
*@brief     多运动每秒发送数据给app
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportMoreSportsSendRealTimeData(void)
{
    if(uteModuleSprotData.moreSportData.isAppStart)
    {
        static uint8_t tmpSendData[14];
        bool   updateRealTimeData = false;
        uint8_t heart = (uint8_t)uteModuleHeartGetHeartValue();
        if(heart != tmpSendData[2])
        {
            updateRealTimeData = true;
        }
        else if(uteModuleSprotData.moreSportData.saveData.sportCaloire != ((tmpSendData[3]<<8)+tmpSendData[4]))
        {
            updateRealTimeData = true;
        }
        else if((uteModuleSprotData.moreSportData.saveData.avgTimeMinute!=tmpSendData[5]) || (uteModuleSprotData.moreSportData.saveData.avgTimeSecond!=tmpSendData[6]))
        {
            updateRealTimeData = true;
        }
        else if(uteModuleSprotData.moreSportData.saveData.sportStep != ((tmpSendData[7]<<16)+(tmpSendData[8]<<8)+tmpSendData[9]))
        {
            updateRealTimeData = true;
        }
        else if(uteModuleSprotData.moreSportData.saveData.sportTimes != ((tmpSendData[10]<<8)+tmpSendData[11]))
        {
            updateRealTimeData = true;
        }
        else if((uteModuleSprotData.moreSportData.saveData.sportDistanceInteger!=tmpSendData[12]) || (uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals!=tmpSendData[13]))
        {
            updateRealTimeData = true;
        }
        if(updateRealTimeData)
        {
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"RealTimeData heart =%d",heart);
            tmpSendData[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;   //指令头标志
            tmpSendData[1] = uteModuleSprotData.moreSportData.saveData.sportsType;
            tmpSendData[2] = heart;
            tmpSendData[3] = uteModuleSprotData.moreSportData.saveData.sportCaloire>>8;
            tmpSendData[4] = uteModuleSprotData.moreSportData.saveData.sportCaloire;
            tmpSendData[5] = uteModuleSprotData.moreSportData.saveData.avgTimeMinute;
            tmpSendData[6] = uteModuleSprotData.moreSportData.saveData.avgTimeSecond;
            tmpSendData[7] = uteModuleSprotData.moreSportData.saveData.sportStep>>16;
            tmpSendData[8] = uteModuleSprotData.moreSportData.saveData.sportStep>>8;
            tmpSendData[9] = uteModuleSprotData.moreSportData.saveData.sportStep;
#if (UTE_MODULE_SPORT_WITH_TIMES_SUPPORT)
            tmpSendData[10] = uteModuleSprotData.moreSportData.saveData.sportTimes>>8;
            tmpSendData[11] = uteModuleSprotData.moreSportData.saveData.sportTimes;
#else
            tmpSendData[10] = 0;
            tmpSendData[11] = 0;
#endif
            tmpSendData[12] = uteModuleSprotData.moreSportData.saveData.sportDistanceInteger;
            tmpSendData[13] = uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals;
            uteModuleProfileBleSendToPhone(&tmpSendData[0],14);
        }
    }
}
/**
*@brief     多运动每秒处理
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportMoreSportsEverySecond(ute_module_systemtime_time_t *time)
{
    /*! 低电量自动停止运动 zn.zeng, 2021-11-11  */
    if ((uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_OPEN) &&
        (uteModuleSprotData.moreSportData.countZeroIndex == -1) &&
        uteDrvBatteryCommonGetLvl() < UTE_DRV_BATTERY_LOW_POWER_PERECNT)
    {
        uteModuleSportStopMoreSportsMsgHandler();
#if UTE_MODULE_SCREENS_LOW_BATTERY_NOTIFY_SUPPORT
        uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);
        sys_cb.cover_index = REMIND_COVER_LOW_BATTERY;
        sys_cb.remind_tag = true;
//        msgbox((char*)i18n[STR_LOW_BATTERY], NULL, NULL, MSGBOX_MODE_BTN_NONE, MSGBOX_MSG_TYPE_LOW_BATTERY);
#else
        // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_WATCHMAIN_ID);              //低电停止运动返回表盘
        func_switch_to(FUNC_CLOCK, FUNC_SWITCH_LR_ZOOM_RIGHT | FUNC_SWITCH_AUTO);
#endif
    }
    if(uteModuleSprotData.moreSportData.status!=ALL_SPORT_STATUS_CLOSE)
    {
        if(uteModuleSprotData.moreSportData.countZeroIndex==0)
        {
            struct prf_date_time sportTime;
            sportTime.year = time->year;
            sportTime.month = time->month;
            sportTime.day = time->day;
            sportTime.hour = time->hour;
            sportTime.min = time->min;
            sportTime.sec = time->sec;
            ute_personal_info_t info;
            uteApplicationCommonGetPersonalInfo(&info);
            //Casen add 22-06-15
            info.weight = (info.weight/1000.0f);
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
            if(0)
            {}
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
            else if(uteModuleSprotData.moreSportData.saveData.sportsType>SPORT_TYPE_FREE_TRAINING)
            {
#if APP_TRAIL_RUNNING_WITH_STEP
                if ((uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_INDOOR_WALK) ||
                    (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_OUTDOOR_WALK) ||
                    (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_HIKING)) //室内走路/户外健走/徒步
                {
                    enableUTESport(SPORT_TYPE_WALKING, sportTime, info.isMan, info.weight, info.height);
                }
                else if ((uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_TRAIL_RUNNING) ||//越野跑
                         (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_MARATHON)) //马拉松
                {
                    enableUTESport(SPORT_TYPE_RUNNING, sportTime, info.isMan, info.weight, info.height);
                }
                else
                {
                    enableUTESport(SPORT_TYPE_FREE_TRAINING, sportTime, info.isMan, info.weight, info.height);
                }
#else
                if ((uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_INDOOR_WALK) ||
                    (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_STEP_TRAINING) ||
                    (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_OUTDOOR_WALK) ||
                    (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_HIKING)) //室内走路/踏步/户外健走/徒步
                {
                    enableUTESport(SPORT_TYPE_WALKING,sportTime,info.isMan,info.weight,info.height);
                }
                else if ((uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_INDOOR_RUN) ||
                         (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_PARKOUR) ||
//#if APP_TRAIL_RUNNING_WITH_STEP
//                         (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_TRAIL_RUNNING) ||//越野跑
//#endif
                         (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_MARATHON)) //室内跑步/跑酷/马拉松
                {
                    enableUTESport(SPORT_TYPE_RUNNING,sportTime,info.isMan,info.weight,info.height);
                }
                else
                {
                    enableUTESport(SPORT_TYPE_FREE_TRAINING,sportTime,info.isMan,info.weight,info.height);
                }
#endif
            }
#endif
            else
            {
                enableUTESport((sport_mode_type)uteModuleSprotData.moreSportData.saveData.sportsType,sportTime,info.isMan,info.weight,info.height);
            }
#endif
#if APP_SPORT_VIB_AFTER_COUNT
            if (!uteModuleSprotData.moreSportData.isAppStart)
            {
//                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);
            }
#endif
            uteModuleSprotData.moreSportData.countZeroIndex = -1;
        }
        else if(uteModuleSprotData.moreSportData.countZeroIndex==-1)
        {
            if(uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE)
            {
                //每秒获取一次运动数据
                uteModuleSportMoreSportsGetDataFormAlgo(time);
#if UTE_SPORTS_HEART_MAX_MIN_WARNING_NOTIFY_SUPPORT
                uteModuleSportMoreSportsHeartWarningProcess();
#endif
#if UTE_MODULE_SCREENS_SPORT_TARGET_NOTIFY_SUPPORT
#if APP_MODULE_SPORT_SLIDE_NOT_PAUSE_SUPPORT
                if (uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_OPEN || uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_CONTINUE)
#else
                if(uteModuleGuiCommonGetCurrentScreenId() == UTE_MOUDLE_SCREENS_SPORTS_DETAIL_ID)
#endif
                {
                    uteModuleSportMoreSportsTargetsProcess();
                }
#endif
            }
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
            //计算每10秒的步频等数据
            uteModuleSportMoreSportsOtherDataHandler();
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
            uteModuleSportMoreSportsExerciseDataHandler();
#endif
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
            uteModuleSportGPSDataEverySecond();
#endif
            //心率数据
            uteModuleSportMoreSportsHeartDataHandler();
            /*运动跨越天数的时候：
             *1，将前一天的数据保存
             *2，关闭运动算法
             *3，sportHeartRateCnt,sportHeartRateSum,heartRateDataLength清零
             *4，开启运动算法
             */
            if((time->hour==23)&&(time->min==59)&&(time->sec==59))
            {
                uteModuleSportStopMoreSportsMsgHandler();
                // 下一秒开始的参数
                // uteModuleSprotData.moreSportData.status = ALL_SPORT_STATUS_OPEN;
                // uteModuleSprotData.moreSportData.countZeroIndex = 0;
                // uteModuleSprotData.moreSportData.saveData.avgHeartRate = 0;
                // uteModuleSprotData.moreSportData.saveData.maxHeartRate = 0;
                // uteModuleSprotData.moreSportData.saveData.minHeartRate = 0xff;
                // uteModuleSprotData.moreSportData.heartTotalSum = 0;
                // uteModuleSprotData.moreSportData.heartTotalCnt = 0;
                // uteModuleSprotData.moreSportData.totalSportTime = 0;
            }
            /*! 发送实时数据到app zn.zeng, 2021-11-11  */
            uteModuleSportMoreSportsSendRealTimeData();
            /*! 断开超时 zn.zeng, 2021-11-11  */
            if((uteModuleSprotData.moreSportData.isAppStart)&& /*App开启的运动*/
               (!uteModuleSprotData.moreSportData.isAppStartSportReConnection)&&           /*断开没有收到APP运动继续的时候*/
               (uteModuleSprotData.moreSportData.status==ALL_SPORT_STATUS_PAUSE) /*进入到暂停界面*/
              )
            {
                uteModuleSprotData.moreSportData.appStartSportDisconnectTimeOutCnt++;
                if(uteModuleSprotData.moreSportData.appStartSportDisconnectTimeOutCnt>=300)
                {
                    uteModuleSportStopMoreSportsMsgHandler();
                    /*! 跳转界面zn.zeng, 2021-11-11  */
                    if(uteModuleSportMoreSportsIsLessData())
                    {
                        // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TRAINING_LIST_ID); //退回运动列表
                        void func_switch_to(u8 sta, u16 switch_mode);
//                        func_switch_to(FUNC_SPORT, FUNC_SWITCH_LR_ZOOM_RIGHT | FUNC_SWITCH_AUTO);
#if UTE_MODULE_SCREENS_SPORT_SUPPORT
                        printf("czh line %d,func %s\n",__LINE__,__func__);
                        uteTaskGuiStartScreen(FUNC_SPORT, 0, __func__);
#endif // UTE_MODULE_SCREENS_SPORT_SUPPORT
                    }
                    else
                    {
#if UTE_MODULE_SPORTS_HSTORY_RECORD_SUPPORT
                        uteModuleSprotData.sportsHistoryRecord.displayIndex = 0;
#endif
                        /*! 没有连接过APP不保存数据 xjc, 2022-05-06  */
                        if(!uteApplicationCommonIsHasConnectOurApp())
                        {
                            // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TRAINING_LIST_ID);  //退回运动列表
//                            extern u8 task_stack_pop(void);
//                            task_stack_pop();
#if UTE_MODULE_SCREENS_SPORT_SUPPORT
                            printf("czh line %d,func %s\n",__LINE__,__func__);
                            uteTaskGuiStartScreen(FUNC_SPORT, 0, __func__);
#endif // UTE_MODULE_SCREENS_SPORT_SUPPORT
                        }
                        else
                        {
                            printf("czh line %d,func %s\n",__LINE__,__func__);
                            // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORTS_REPORTS_ID);     //运动完成数据弹窗
                            uteTaskGuiStartScreen(FUNC_SPORT_FINISH, 0, __func__);
//                            sys_cb.cover_index = REMIND_COVER_GOAL;
//                            sys_cb.remind_tag = true;

                        }
                    }
                    printf("czh line %d,func %s\n",__LINE__,__func__);
                    uteTaskGuiStackRemoveScreenId(FUNC_SPORT_SUB_RUN);
                }
            }
            else
            {
                uteModuleSprotData.moreSportData.appStartSportDisconnectTimeOutCnt = 0;
            }
        }
    }
}

#if UTE_GUI_SCREEN_GET_SPORT_DATA_NEW_FUNC_SUPPORT
/**
*@brief     重新计算每小时运动数据
*@details
*@author      xjc
*@date       2023-05-31
*/
void uteModuleSportCalculatorEveryHourSportDataHandler(bool isFinish)
{
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    if (((uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_CLOSE) && (uteModuleSprotData.moreSportData.countZeroIndex == (-1))) ||
        (isFinish))
    {
        /*! 有步数的运动*/
        if ((uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_RUNNING)      /*跑步 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_CLIMBING)  /*登山*/
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_WALKING)   /*健走|徒步 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_TREADMILL) /*跑步机 */
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_INDOOR_WALK)   /*室内走路 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_STEP_TRAINING) /*踏步 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_OUTDOOR_WALK)  /*户外健走 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_HIKING)        /*徒步 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_INDOOR_RUN)    /*室内跑步 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_PARKOUR)       /*跑酷 */
            || (uteModuleSprotData.moreSportData.saveData.sportsType == SPORT_TYPE_MARATHON)      /*马拉松 */
#endif
           )
        {
            /*! 跨小时保存数据*/
            if (((time.min == 59) && (time.sec == 59)) || (isFinish))
            {
                uint32_t tempStep, tempKcal;
                tempStep = uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[time.hour];
                tempKcal = uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[time.hour];
                if (time.hour == uteModuleSprotData.moreSportData.saveData.startSportTime.hour)
                {
                    /*保存第一个小时数据*/
                    tempStep += uteModuleSprotData.moreSportData.saveData.sportStep;
                    tempKcal += uteModuleSprotData.moreSportData.saveData.sportCaloire;
                }
                else
                {
                    /*保存其它小时数据*/
                    tempStep += (uteModuleSprotData.moreSportData.saveData.sportStep - uteModuleSprotData.dailyActivity.lastHourSportStep);
                    tempKcal += (uteModuleSprotData.moreSportData.saveData.sportCaloire - uteModuleSprotData.dailyActivity.lastHourSportKcal);
                }
                uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[time.hour] = tempStep;
                uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[time.hour] = tempKcal;

                uteModuleSprotData.dailyActivity.lastHourSportStep = uteModuleSprotData.moreSportData.saveData.sportStep;
                uteModuleSprotData.dailyActivity.lastHourSportKcal = uteModuleSprotData.moreSportData.saveData.sportCaloire;

                uteModuleSprotData.dailyActivity.needSaveCurrentDayEveryHourSportData = true;
            }
        }
    }

    if (isFinish && uteModuleSprotData.dailyActivity.needSaveCurrentDayEveryHourSportData)
    {
        uteModuleSportSaveEveryHourData();
    }
}

/**
 *@brief     保存多运动每小时数据
 *@details
 *@author       xjc
 *@date       2023-05-31
 */
void uteModuleSportSaveEveryHourData(void)
{
    if (!uteModuleSprotData.dailyActivity.needSaveCurrentDayEveryHourSportData)
    {
        return;
    }
    void *file;
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_SPORT_STEP_DATA, &file, FS_O_WRONLY | FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemWriteData(file, &uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[0], 24 * sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[0]));
        uteModuleFilesystemCloseFile(file);
    }
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_SPORT_KCAL_DATA, &file, FS_O_WRONLY | FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemWriteData(file, &uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[0], 24 * sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[0]));
        uteModuleFilesystemCloseFile(file);
    }
    memset(&uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[0], 0, sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep));
    memset(&uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[0], 0, sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal));
    uteModuleSprotData.dailyActivity.needSaveCurrentDayEveryHourSportData = false;
}

/**
 *@brief     读取多运动每小时数据
 *@details
 *@author       xjc
 *@date       2023-05-31
 */
void uteModuleSportReadEveryHourData(void)
{
    void *file;
    memset(&uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[0], 0, sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep));
    memset(&uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[0], 0, sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal));
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_SPORT_STEP_DATA, &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[0], 24 * sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[0]));
        uteModuleFilesystemCloseFile(file);
    }
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_SPORT_KCAL_DATA, &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[0], 24 * sizeof(uteModuleSprotData.dailyActivity.currentDayEveryHourSportKcal[0]));
        uteModuleFilesystemCloseFile(file);
    }
}
#endif

/**
*@brief     开始多运动消息处理
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportStartMoreSportsMsgHandler(uint32_t param)
{
    uint8_t sportsType = (param>>24)&0xff;
    uint8_t startInterval = (param>>16)&0xff;
    bool isAppStart = (param>>8)&0xff;
    bool isAppRestart = false;
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sportsType=%d,startInterval=%d,isAppStart=%d,isAppRestart=%d", __func__,sportsType,startInterval,isAppStart,isAppRestart);
    if((uteModuleSprotData.moreSportData.status==ALL_SPORT_STATUS_OPEN)&&isAppStart)
    {
        isAppRestart = true;
        uteModuleSprotCountdownTimerStop();
        uteModuleSprotCountdownTimerStart(1000);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sportsType1=%d,startInterval1=%d,isAppStart1=%d,isAppRestart1=%d", __func__,sportsType,startInterval,isAppStart,isAppRestart);
    }
    if(isAppRestart)
    {
//        uteModuleSportStopMoreSportsMsgHandler();
        //关闭运动算法
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
        uteModuleCwmStopSportMode();
#else
        disableUTESport();
#endif
        if(!uteModuleSportMoreSportsIsLessData())
        {
            /*! 保存数据 zn.zeng, 2021-11-11  */
            uteModuleSportMoreSportsSaveData(true);
#if UTE_MODULE_SPORTS_HSTORY_RECORD_SUPPORT
            uteModuleSportReadHistoryRecordData();
#endif
#if  UTE_MODULE_SPORTS_HISTORY_HEART_ZONE_SUPPORT
            ute_module_systemtime_time_t time;
            memset(&time,0,sizeof(ute_module_systemtime_time_t));
            time.year = uteModuleSprotData.moreSportData.saveData.startSportTime.year;
            time.month = uteModuleSprotData.moreSportData.saveData.startSportTime.month;
            time.day = uteModuleSprotData.moreSportData.saveData.startSportTime.day;
            time.hour = uteModuleSprotData.moreSportData.saveData.startSportTime.hour;
            time.min = uteModuleSprotData.moreSportData.saveData.startSportTime.min;
            time.sec = uteModuleSprotData.moreSportData.saveData.startSportTime.sec;
            uteModuleSportReadHistoryHeartZoneData(&time);
#endif
        }
        uteModuleSprotData.moreSportData.status = ALL_SPORT_STATUS_CLOSE;
        uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);
    }
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleCwmStartSportMode(sportsType);   //开始运动
#endif
    memset(&uteModuleSprotData.moreSportData,0,sizeof(ute_module_more_sports_data_t));
    uteModuleSprotData.moreSportData.isAppStart = isAppStart;
    uteModuleSprotData.moreSportData.status = ALL_SPORT_STATUS_OPEN;
    uteModuleSprotData.moreSportData.saveData.sportsType = sportsType;
    uteModuleSprotData.moreSportData.saveData.startInterval = startInterval;
    uteModuleSprotData.moreSportData.saveData.avgHeartRate = 0;
    uteModuleSprotData.moreSportData.saveData.maxHeartRate = 0;
    uteModuleSprotData.moreSportData.saveData.minHeartRate = 0xff;
    uteModuleSprotData.moreSportData.countZeroIndex = UTE_MODULE_SPROT_MORE_SPORT_COUNT_ZORE;
    uteModuleSprotData.dailyActivity.sportChangeHourSteps = 0;
    uteModuleSprotData.dailyActivity.sportChangeHourKcal = 0;
    uteModuleSprotData.moreSportData.heartTotalSum = 0;
    uteModuleSprotData.moreSportData.heartTotalCnt = 0;
    uteModuleSprotData.moreSportData.saveData.avgHeartRate = 0;
#if UTE_SPORTS_HEART_MAX_MIN_WARNING_NOTIFY_SUPPORT
    uteModuleHeartSetSportHeartWaringSecond(0);
    uteModuleHeartSetSportHeartWaringIsFristHasNotify(false);
#endif
    uteModuleHeartStartSingleTesting(TYPE_HEART);
    if(uteModuleSprotData.moreSportData.countZeroIndex > 0)
    {
        uteModuleSprotCountdownTimerStart(1000);
    }
    if(isAppRestart)
    {
        uteModuleSprotData.moreSportData.isAppStartSportReConnection = true;
    }
    uteModuleSprotData.moreSportData.appStartSportDisconnectTimeOutCnt = 0;
    uteModuleSportSendMoreSportsStatus();
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
    uteModuleSportSendMoreSportsStatusToAPPWhenChange(ALL_SPORT_STATUS_OPEN);
#endif
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
    uteModuleSprotData.moreSportData.saveData.saveInfoType = uteModuleSportGetCurrSportDataSaveType();
    if (uteModuleSportGetGPSStatus() != GPS_LACATION_OK && uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01)
        uteModuleSportSetCurrSportDataSaveType(0x02);//no need save GPS
    uteModuleSportInitSportsHRRangeData();
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleSprotData.lastMinuteSportStepCnt = 0;
#if APP_MODULE_HEART_MAX_HEARTRATE_SET_SUPPORT
    uteModuleSprotData.exerCiseHeartValue = uteModuleHeartGetSaveMaxHeartValue() * 6 / 10;
#else
    uteModuleSprotData.exerCiseHeartValue = (220 - DEFAULT_PERSONALINFO_AGE) * 6 / 10;
#endif
    uteModuleSprotData.exerciseType = uteModuleSportGetCurrSportDataExerciseType();
#endif
#if !APP_SPORT_VIB_AFTER_COUNT
    if(!isAppRestart)
    {
        uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);
    }
#endif
    /*! 跳转界面zn.zeng, 2021-11-11  */
    // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORTS_DETAIL_ID);      //运动RUNING界面
    //func_switch_to(FUNC_SPORT_SUB_RUN, FUNC_SWITCH_LR_ZOOM_RIGHT | FUNC_SWITCH_AUTO);

    uteTaskGuiStartScreen(FUNC_SPORT_SWITCH, 0, __func__);

    sys_cb.sport_app_disconnect = false;
    if(sportsType==SPORT_TYPE_JUMP_ROPE)
    {
        // uteDrvHeartVcxxStopSample();
        // uteDrvHeartVcxxStartSample();
        uteDrvGsensorCommonInit(GSENSOR_RATE_100HZ,UTE_DRV_GSENSOR_DEFAULT_ACC_RANGE_VALUE);
        uteModuleSprotResetRovllverScreenMode();
    }

#if UTE_GUI_SCREEN_GET_SPORT_DATA_NEW_FUNC_SUPPORT
    uteModuleSportReadEveryHourData();
#endif
}
/**
*@brief     结束多运动
*@details
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportStopMoreSports(void)
{
    uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_MODULE_SPORT_STOP_MORE_SPORTS,0);
}
/**
*@brief     判断运动量是否过少
*@details
*@return ture 为运动量过少
*@author       zn.zeng
*@date       2021-11-11
*/

bool uteModuleSportMoreSportsIsLessData(void)
{
    bool ret = false;
//  return ret;
    uteModulePlatformTakeMutex(uteModuleSprotMute);
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uint8_t sportType = 0;
    uint32_t tempDistance = 0;
    float distance = 0;
    distance = (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceInteger + (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals*0.01));
    distance = distance*1000.0f; //放大1000倍,m
    tempDistance = (uint32_t)distance;
    sportType = uteModuleSportGetCurrSportShowDataType(uteModuleSportMoreSportGetType());
    if (sportType)
    {
        // 1 距离等于零
        if (tempDistance == 0)
        {
            ret =  true;  // 不需要保存数据
        }
        // 2 距离小于100m
        if ((tempDistance != 0) && (tempDistance < 100))
        {
            ret = true;  // 不需要保存数据
        }
    }
    else
    {
        if (uteModuleSprotData.moreSportData.totalSportTime<UTE_MODULE_SPORT_MORE_SPORT_MIN_SAVE_TIME)
        {
            ret = true;
        }
    }
#else
    if(uteModuleSprotData.moreSportData.totalSportTime<UTE_MODULE_SPORT_MORE_SPORT_MIN_SAVE_TIME)
    {
        ret = true;
    }
    uint32_t tempDistance = 0;
    float distance = 0;
    distance = (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceInteger + (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals*0.01));
    distance = distance*1000.0f; //放大1000倍,m
    tempDistance = (uint32_t)distance;
    // 1 距离等于零，卡路里等于零
    if((tempDistance==0)&&(uteModuleSprotData.moreSportData.saveData.sportCaloire==0))
    {
        ret =  true;  // 不需要保存数据
    }
    // 2 距离小于100m
    if((tempDistance!=0)&&(tempDistance<100))
    {
        ret = true;  // 不需要保存数据
    }
    // 3 卡路里不等于零，时间小于1分钟
    if((uteModuleSprotData.moreSportData.saveData.sportCaloire!=0)&&(uteModuleSprotData.moreSportData.totalSportTime<UTE_MODULE_SPORT_MORE_SPORT_MIN_SAVE_TIME))
    {
        ret = true;  // 不需要保存数据
    }
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uint16_t stopType = uteModuleSprotData.moreSportData.saveData.sportsType;
    if ((stopType == SPORT_TYPE_RUNNING)          /*跑步 */
        || (stopType == SPORT_TYPE_CLIMBING)      /*登山*/
        || (stopType == SPORT_TYPE_WALKING)       /*健走|徒步 */
        || (stopType == SPORT_TYPE_TREADMILL)     /*跑步机 */
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
        || (stopType == SPORT_TYPE_INDOOR_WALK)   /*室内走路 */
        || (stopType == SPORT_TYPE_STEP_TRAINING) /*踏步 */
        || (stopType == SPORT_TYPE_OUTDOOR_WALK)  /*户外健走 */
        || (stopType == SPORT_TYPE_HIKING)        /*徒步 */
        || (stopType == SPORT_TYPE_INDOOR_RUN)    /*室内跑步 */
        || (stopType == SPORT_TYPE_PARKOUR)       /*跑酷 */
        || (stopType == SPORT_TYPE_MARATHON)      /*马拉松 */
#endif
       )
    {
        if(tempDistance<100)
        {
            ret = true;
        }
    }
#endif
#endif
    uteModulePlatformGiveMutex(uteModuleSprotMute);

#if UTE_MODULE_LOG_SUPPORT&&UTE_LOG_GUI_LVL
    ret = false;
#endif
    return ret;
}
/**
*@brief     填充保存多运动数据
*@details
*@param[out] uint8_t *buff
*@author       zn.zeng
*@date       2021-11-12
*/
void uteModuleSportFillMoreSportsSaveData(uint8_t *buff)
{
    ute_module_systemtime_time_t globalTime;
    uteModuleSystemtimeGetTime(&globalTime);
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
    if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01 || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03)
        buff[0] = 0xDC + APP_SPORT_SAVE_DATA_INTERVAL;//5秒 0xE1 - 0xDC(220) = 5
    else
        buff[0] = 0x01;//固定为10秒
#else
    buff[0] = uteModuleSprotData.moreSportData.saveData.startInterval;
#endif
    buff[1] = uteModuleSprotData.moreSportData.saveData.sportsType;
    buff[2] = uteModuleSprotData.moreSportData.saveData.startSportTime.year>>8&0xff;
    buff[3] = uteModuleSprotData.moreSportData.saveData.startSportTime.year&0xff;
    buff[4] = uteModuleSprotData.moreSportData.saveData.startSportTime.month;
    buff[5] = uteModuleSprotData.moreSportData.saveData.startSportTime.day;
    buff[6] = uteModuleSprotData.moreSportData.saveData.startSportTime.hour;
    buff[7] = uteModuleSprotData.moreSportData.saveData.startSportTime.min;
    buff[8] = uteModuleSprotData.moreSportData.saveData.startSportTime.sec;
    tm_t timeptr;
    timeptr.year = uteModuleSprotData.moreSportData.saveData.stopSportTime.year-1900;
    timeptr.mon = uteModuleSprotData.moreSportData.saveData.stopSportTime.month-1;
    timeptr.day = uteModuleSprotData.moreSportData.saveData.stopSportTime.day;
    timeptr.hour = uteModuleSprotData.moreSportData.saveData.stopSportTime.hour;
    timeptr.min = uteModuleSprotData.moreSportData.saveData.stopSportTime.min;
    timeptr.sec = uteModuleSprotData.moreSportData.saveData.stopSportTime.sec;
    time_t tmp = tm_to_time(timeptr);
    //Casen 在原时间基础上强制转换时间到GMT+8 存储
    tmp = tmp - globalTime.zone*3600 + (globalTime.zone-8)*3600;
    buff[9] = (tmp>>24&0x000000FF);
    buff[10] = (tmp>>16&0x000000FF);
    buff[11] = (tmp>>8&0x000000FF);
    buff[12] = (tmp&0x000000FF);
    buff[13] = (uteModuleSprotData.moreSportData.totalSportTime>>16&0xFF);
    buff[14] = (uteModuleSprotData.moreSportData.totalSportTime>>8);
    buff[15] = uteModuleSprotData.moreSportData.totalSportTime&0xFF;
    buff[16] = uteModuleSprotData.moreSportData.saveData.sportStep>>24&0xff;
    buff[17] = uteModuleSprotData.moreSportData.saveData.sportStep>>16&0xff;
    buff[18] = uteModuleSprotData.moreSportData.saveData.sportStep>>8&0xff;
    buff[19] = uteModuleSprotData.moreSportData.saveData.sportStep&0xff;
#if (UTE_MODULE_SPORT_WITH_TIMES_SUPPORT)
    buff[20] = uteModuleSprotData.moreSportData.saveData.sportTimes>>8&0xff;
    buff[21] = uteModuleSprotData.moreSportData.saveData.sportTimes&0xff;
#else
    buff[20] = 0;
    buff[21] = 0;
#endif
    buff[22] = uteModuleSprotData.moreSportData.saveData.sportCaloire>>8&0xff;
    buff[23] = uteModuleSprotData.moreSportData.saveData.sportCaloire;
    buff[24] = uteModuleSprotData.moreSportData.saveData.sportDistanceInteger;
    buff[25] = uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals;
    buff[26] = uteModuleSprotData.moreSportData.saveData.avgHeartRate;
    buff[27] = uteModuleSprotData.moreSportData.saveData.maxHeartRate;
    buff[28] = uteModuleSprotData.moreSportData.saveData.minHeartRate;
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
    uint16_t tmpPace = 0;
    if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01
        || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02
        || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03
        || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x04)
    {
        if (((uteModuleSprotData.moreSportData.saveData.sportDistanceInteger * 1000) + (uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals * 10)) > 0)
        {
            tmpPace = (uint16_t)((1000 * uteModuleSprotData.moreSportData.totalSportTime) / ((uteModuleSprotData.moreSportData.saveData.sportDistanceInteger * 1000) + (uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals * 10)));
            uteModuleSprotData.moreSportData.saveData.avgTimeMinute = tmpPace / 60;
            uteModuleSprotData.moreSportData.saveData.avgTimeSecond = tmpPace % 60;
        }
    }
    buff[29] = uteModuleSprotData.moreSportData.saveData.avgTimeMinute;
    buff[30] = uteModuleSprotData.moreSportData.saveData.avgTimeSecond;
    if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01
        || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03)
    {
        buff[31] = (uteModuleSprotData.moreSportData.heartTotalCnt * 12 >> 8) & 0xff;
        buff[32] = (uteModuleSprotData.moreSportData.heartTotalCnt * 12) & 0xff;
    }
    else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02
             || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x04)
    {
        buff[31] = (uteModuleSprotData.moreSportData.heartTotalCnt * 4 >> 8) & 0xff;
        buff[32] = uteModuleSprotData.moreSportData.heartTotalCnt * 4 & 0xff;
    }
    else
    {
        buff[31] = (uteModuleSprotData.moreSportData.heartTotalCnt >> 8) & 0xff;
        buff[32] = uteModuleSprotData.moreSportData.heartTotalCnt & 0xff;
    }
    buff[33] = (uteModuleSprotData.moreSportData.saveData.hrWarmupCnt >> 16) & 0xFF;
    buff[34] = (uteModuleSprotData.moreSportData.saveData.hrWarmupCnt >> 8) & 0xFF;
    buff[35] = uteModuleSprotData.moreSportData.saveData.hrWarmupCnt & 0xFF;
    buff[36] = (uteModuleSprotData.moreSportData.saveData.hrWeightReductionCnt >> 16) & 0xFF;
    buff[37] = (uteModuleSprotData.moreSportData.saveData.hrWeightReductionCnt >> 8) & 0xFF;
    buff[38] = uteModuleSprotData.moreSportData.saveData.hrWeightReductionCnt & 0xFF;
    buff[39] = (uteModuleSprotData.moreSportData.saveData.hrEnduranceCnt >> 16) & 0xFF;
    buff[40] = (uteModuleSprotData.moreSportData.saveData.hrEnduranceCnt >> 8) & 0xFF;
    buff[41] = uteModuleSprotData.moreSportData.saveData.hrEnduranceCnt & 0xFF;
    buff[42] = (uteModuleSprotData.moreSportData.saveData.hrAnaerobicCnt >> 16) & 0xFF;
    buff[43] = (uteModuleSprotData.moreSportData.saveData.hrAnaerobicCnt >> 8) & 0xFF;
    buff[44] = uteModuleSprotData.moreSportData.saveData.hrAnaerobicCnt & 0xFF;
    buff[45] = (uteModuleSprotData.moreSportData.saveData.hrExtremeCnt >> 16) & 0xFF;
    buff[46] = (uteModuleSprotData.moreSportData.saveData.hrExtremeCnt >> 8) & 0xFF;
    buff[47] = uteModuleSprotData.moreSportData.saveData.hrExtremeCnt & 0xFF;
    buff[48] = uteModuleSprotData.moreSportData.saveData.avgStepfrequency;
    buff[49] = uteModuleSprotData.moreSportData.saveData.maxStepfrequency;
    buff[50] = uteModuleSprotData.moreSportData.saveData.minStepfrequency;
    if (uteModuleSprotData.moreSportData.saveData.avgTimeMinute > uteModuleSprotData.moreSportData.saveData.minTimeMinute && uteModuleSprotData.moreSportData.saveData.minTimeMinute < 250)
        uteModuleSprotData.moreSportData.saveData.minTimeMinute += 5;
    else if (uteModuleSprotData.moreSportData.saveData.avgTimeMinute > uteModuleSprotData.moreSportData.saveData.minTimeMinute && uteModuleSprotData.moreSportData.saveData.minTimeMinute >= 250)
        uteModuleSprotData.moreSportData.saveData.minTimeMinute = 255;
    buff[51] = uteModuleSprotData.moreSportData.saveData.maxTimeMinute;
    buff[52] = uteModuleSprotData.moreSportData.saveData.maxTimeSecond;
    buff[53] = uteModuleSprotData.moreSportData.saveData.minTimeMinute;
    buff[54] = uteModuleSprotData.moreSportData.saveData.minTimeSecond;
    buff[55] = uteModuleSprotData.moreSportData.saveData.saveInfoType;
#else
    buff[29] = uteModuleSprotData.moreSportData.saveData.avgTimeMinute;
    buff[30] = uteModuleSprotData.moreSportData.saveData.avgTimeSecond;
    buff[31] = uteModuleSprotData.moreSportData.heartTotalCnt>>8&0xff;
    buff[32] = uteModuleSprotData.moreSportData.heartTotalCnt&0xff;
#endif
}
/**
*@brief     保存多运动数据
*@details
*@param[in] bool isStopSport
*@author       zn.zeng
*@date       2021-11-11
*/
void uteModuleSportMoreSportsSaveData(bool isStopSport)
{
    /*! 没有连接过APP不保存数据 xjc, 2022-05-06  */
    // if(!uteApplicationCommonIsHasConnectOurApp())
    // {
    //     return;
    // }
    uint8_t path[40];
    memset(&path[0],0,sizeof(path));
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    ute_module_systemtime_time_t time;

    time.year = uteModuleSprotData.moreSportData.saveData.startSportTime.year;
    time.month = uteModuleSprotData.moreSportData.saveData.startSportTime.month;
    time.day = uteModuleSprotData.moreSportData.saveData.startSportTime.day;
    time.hour = uteModuleSprotData.moreSportData.saveData.startSportTime.hour;
    time.min = uteModuleSprotData.moreSportData.saveData.startSportTime.min;

    sprintf((char *)&path[0],"%04d%02d%02d%02d%02d",time.year,time.month,time.day,time.hour,time.min);
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, dirInfo, NULL);
    if((dirInfo->filesCnt>=UTE_MODULE_SPORT_MORE_SPORTS_DATA_MAX_CNT)&&(memcmp(&path[0],&dirInfo->filesName[0][0],12)!=0))
    {
        /*! 删除最旧一天的数据zn.zeng, 2021-11-12   */
        memset(&path[0],0,sizeof(path));
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&dirInfo->filesName[0][0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__,&path[0]);
        uteModuleFilesystemDelFile((char *)&path[0]);
    }
    memset(&path[0],0,sizeof(path));
    sprintf((char *)&path[0],"%s/%04d%02d%02d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,time.year,time.month,time.day,time.hour,time.min);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt=%d", __func__,dirInfo->filesCnt);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,save file=%s", __func__,&path[0]);
    /*! 保存当前数据zn.zeng, 2021-11-12  */
    void *file;
    int32_t fileSize = 0;
    uint8_t headBuff[SPORTS_HEAD_DATAS_LENGTH];
    if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_WRONLY|FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_END);
        fileSize = uteModuleFilesystemGetFileSize(file);
        if(isStopSport)
        {
            // 其他数据
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleSportFillMoreSportsSaveData(&headBuff[0]);
            uteModuleFilesystemWriteData(file,&headBuff[0],SPORTS_HEAD_DATAS_LENGTH);
            // 心率数据
            uteModuleFilesystemSeek(file,0,FS_SEEK_END);
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
            uteModuleFilesystemWriteData(file, &uteModuleSprotData.moreSportData.heartCache[0], uteModuleSprotData.moreSportsCalc.saveIndex);
            uteModuleSprotData.moreSportsCalc.saveIndex = 0;
#else
            uint16_t heartCacheCnt = uteModuleSprotData.moreSportData.heartTotalCnt%SPORTS_HEART_DATAS_CACHE_LENGTH;
            uteModuleFilesystemWriteData(file,&uteModuleSprotData.moreSportData.heartCache[0],heartCacheCnt);
#endif
        }
        else
        {
            if(fileSize==0)
            {
                // 其他数据
                uteModuleSportFillMoreSportsSaveData(&headBuff[0]);
                uteModuleFilesystemWriteData(file,&headBuff[0],SPORTS_HEAD_DATAS_LENGTH);
            }
            uteModuleFilesystemSeek(file,0,FS_SEEK_END);
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
            uteModuleFilesystemWriteData(file, &uteModuleSprotData.moreSportData.heartCache[0], uteModuleSprotData.moreSportsCalc.saveIndex);
            uteModuleSprotData.moreSportsCalc.saveIndex = 0;
#else
            uteModuleFilesystemWriteData(file,&uteModuleSprotData.moreSportData.heartCache[0],SPORTS_HEART_DATAS_CACHE_LENGTH);
#endif
        }
        uteModuleFilesystemCloseFile(file);
    }
    uteModulePlatformMemoryFree(dirInfo);

#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
    if(isStopSport)
    {
        // ute_module_systemtime_time_t currTime;
        // uteModuleSystemtimeGetTime(&currTime);
        // uteModuleSportReadTodayAllSportDataConfig(currTime);
        uteModuleSprotData.updateTodayAllSportData = true;
    }
#endif
}

/**
*@brief     结束多运动消息处理
*@details   改方法仅作为结束运动动作，请不要在其中实现UI跳转
*@author       zn.zeng
*@date      casen modify 2021-12-30
*/
void uteModuleSportStopMoreSportsMsgHandler(void)
{
    //关闭运动算法
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleCwmStopSportMode();
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uteModuleSportMoreSportsGetDataFormAlgo(&time);
#else
    disableUTESport();
#endif
#if UTE_MODULE_HEART_SUPPORT
    if (bsp_sensor_hr_work_status() && uteModuleHeartGetWorkMode() == HR_WORK_MODE_HR)
    {
        uteModuleHeartStopSingleTesting(TYPE_HEART);
    }
#endif
    if(!uteModuleSportMoreSportsIsLessData())
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s ", __func__);
        /*! 保存数据 zn.zeng, 2021-11-11  */
        uteModuleSportMoreSportsSaveData(true);
#if UTE_MODULE_SPORTS_HSTORY_RECORD_SUPPORT
        uteModuleSportReadHistoryRecordData();
#endif
#if !APP_GUI_SCREEN_SHOW_ACTIVITY_HOURS_SUPPORT
        ute_module_systemtime_time_t systemTime;
        uteModuleSystemtimeGetTime(&systemTime);
        if((uteModuleSprotData.dailyActivity.everyHourAllSportStep[systemTime.hour] + uteModuleSprotData.moreSportData.saveData.sportStep) > uteModuleSprotData.dailyActivity.sportChangeHourSteps)
        {
            uteModuleSprotData.dailyActivity.everyHourAllSportStep[systemTime.hour] = uteModuleSprotData.dailyActivity.everyHourAllSportStep[systemTime.hour] + uteModuleSprotData.moreSportData.saveData.sportStep - uteModuleSprotData.dailyActivity.sportChangeHourSteps;
        }
        if((uteModuleSprotData.dailyActivity.everyHourAllSportKcal[systemTime.hour] + uteModuleSprotData.moreSportData.saveData.sportCaloire) > uteModuleSprotData.dailyActivity.sportChangeHourKcal)
        {
            uteModuleSprotData.dailyActivity.everyHourAllSportKcal[systemTime.hour] = uteModuleSprotData.dailyActivity.everyHourAllSportKcal[systemTime.hour] + uteModuleSprotData.moreSportData.saveData.sportCaloire - uteModuleSprotData.dailyActivity.sportChangeHourKcal;
        }
#endif
#if  UTE_MODULE_SPORTS_HISTORY_HEART_ZONE_SUPPORT
        ute_module_systemtime_time_t time;
        memset(&time,0,sizeof(ute_module_systemtime_time_t));
        time.year = uteModuleSprotData.moreSportData.saveData.startSportTime.year;
        time.month = uteModuleSprotData.moreSportData.saveData.startSportTime.month;
        time.day = uteModuleSprotData.moreSportData.saveData.startSportTime.day;
        time.hour = uteModuleSprotData.moreSportData.saveData.startSportTime.hour;
        time.min = uteModuleSprotData.moreSportData.saveData.startSportTime.min;
        time.sec = uteModuleSprotData.moreSportData.saveData.startSportTime.sec;
        uteModuleSportReadHistoryHeartZoneData(&time);
#endif
    }
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
    else
    {
        ute_module_systemtime_time_t time;

        time.year = uteModuleSprotData.moreSportData.saveData.startSportTime.year;
        time.month = uteModuleSprotData.moreSportData.saveData.startSportTime.month;
        time.day = uteModuleSprotData.moreSportData.saveData.startSportTime.day;
        time.hour = uteModuleSprotData.moreSportData.saveData.startSportTime.hour;
        time.min = uteModuleSprotData.moreSportData.saveData.startSportTime.min;
        uteModuleSportMoreSportsDeleteInvalidData(time);
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
        {
            ute_module_systemtime_time_t systime;
            uteModuleSystemtimeGetTime(&systime);
            uteModuleSportReadMoreSportsOtherInfo();
            uteModuleSprotData.todaySportOtherData.step += uteModuleSprotData.moreSportData.saveData.sportStep;
            uteModuleSprotData.todaySportOtherData.distance += uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals;//整数肯定为0
            uteModuleSprotData.todaySportOtherData.caloire += uteModuleSprotData.moreSportData.saveData.sportCaloire;
            UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "SaveOtherInfo:%d:%d:%d", uteModuleSprotData.todaySportOtherData.step, uteModuleSprotData.todaySportOtherData.distance, uteModuleSprotData.todaySportOtherData.caloire);
            uteModuleSportSaveMoreSportsOtherInfo(systime);
        }
#endif
    }
#endif
    uteModuleSprotData.moreSportData.status = ALL_SPORT_STATUS_CLOSE;
    uteModuleSprotData.moreSportData.isAppStart = false;
    uteModuleSprotData.dailyActivity.sportChangeHourSteps = 0;
    uteModuleSprotData.dailyActivity.sportChangeHourKcal = 0;
    uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);
    uteModuleSportSendMoreSportsStatus();
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
    uteModuleSportSendMoreSportsStatusToAPPWhenChange(ALL_SPORT_STATUS_CLOSE);
    uteModuleSportSetGPSStatus(GPS_LACATION_IDLE);
#endif

    if(uteModuleSprotData.moreSportData.saveData.sportsType==SPORT_TYPE_JUMP_ROPE)
    {
        // uteDrvHeartVcxxStopSample();
        // uteDrvHeartVcxxStartSample();
        uteDrvGsensorCommonInit(UTE_DRV_GSENSOR_DEFAULT_ACC_RATE_VALUE,UTE_DRV_GSENSOR_DEFAULT_ACC_RANGE_VALUE);
#if UTE_MODULE_SPORT_APP_STOP_SPORT_STOP_HEART_TEST_SUPPORT
        if(!uteModuleHeartIsAutoTesting())
        {
            uteDrvHeartVcxxStopSample();
        }
#endif
    }

    /*! 界面跳转, xjc Mark 20220111 */
    if(uteModuleSportMoreSportsIsLessData())
    {
#if APP_MODULE_SCREENS_MORE_SPORT_LIST_SUPPORT
        if (uteModuleSportIsMoreSportRun(uteModuleSprotData.moreSportData.saveData.sportsType))
            uteTaskGuiStartScreen(FUNC_SPORT, 0, __func__);
        else
#endif
#if UTE_MODULE_SCREENS_SPORT_SUPPORT
            printf("czh line %d,func %s\n",__LINE__,__func__);
        uteTaskGuiStartScreen(FUNC_SPORT, 0, __func__);
#endif
    }
    else if (!uteApplicationCommonIsHasConnectOurApp())
    {
#if APP_MODULE_SCREENS_MORE_SPORT_LIST_SUPPORT
        if (uteModuleSportIsMoreSportRun(uteModuleSprotData.moreSportData.saveData.sportsType))
            uteTaskGuiStartScreen(FUNC_SPORT, 0, __func__);
        else
#endif
            uteTaskGuiStartScreen(FUNC_SPORT, 0, __func__);
    }
    else
    {
#if UTE_MODULE_SCREENS_SPORTS_REPORT_LIST_SUPPORT
        uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORTS_REPORT_LIST_ID);
#else
#if UTE_MODULE_SPORTS_HSTORY_RECORD_SUPPORT
        uteModuleSprotData.sportsHistoryRecord.displayIndex = 0;
#endif
        // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORTS_REPORTS_ID);     //运动完成数据界面
        printf("czh line %d,func %s\n",__LINE__,__func__);
        uteTaskGuiStartScreen(FUNC_SPORT_FINISH, 0, __func__);//FUNC_SPORT;       //todo 结束报告界面，暂时没有做，直接返回运动列表
//        sys_cb.cover_index = REMIND_COVER_GOAL;
//        sys_cb.remind_tag = true;
#endif
    }
    uteModuleSportMoreSportsTargetInit();
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleSprotData.lastMinuteStepCnt = uteModuleSprotData.currDayTotalStep;
#endif
#if UTE_SPORTS_HEART_MAX_MIN_WARNING_NOTIFY_SUPPORT
    uteModuleHeartSetSportHeartWaringSecond(0);
    uteModuleHeartSetSportHeartWaringIsFristHasNotify(false);
#endif
    uteModuleSprotData.moreSportData.increaseKcal = 0;
    uteModuleSprotData.moreSportData.lastKcal = 0;
    uteModuleSprotData.moreSportData.lastKMPaceMinute = 0;
    uteModuleSprotData.moreSportData.lastKMPaceSecond = 0;
    uteTaskGuiStackRemoveScreenId(FUNC_SPORT_SUB_RUN);
    printf("czh line %d,func %s\n",__LINE__,__func__);
}
/**
*@brief     app 同步运动数据到ble
*@details
*@author       zn.zeng
*@date       2021-11-13
*/
void uteModuleSportSyncAppMoreSportData(const uint8_t *receive)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);

    //set intervel
    uteModuleSprotData.moreSportData.saveData.startInterval = receive[3];
    //set sport time
    uteModuleSprotData.moreSportData.totalSportTime = (receive[4]*3600)+(receive[5]*60) + receive[6]; // hour/min/sec
    if (uteModuleSportIsPhoneAppStartGpsSportsType())
    {
        // kcal
        uteModuleSprotData.moreSportData.saveData.sportCaloire = (receive[7]<<8&0xff00) | receive[8];
        //distance
        uteModuleSprotData.moreSportData.saveData.sportDistanceInteger = receive[9];
        uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals =receive[10];
        //avgTime
        uteModuleSprotData.moreSportData.saveData.avgTimeMinute = receive[11];
        uteModuleSprotData.moreSportData.saveData.avgTimeSecond = receive[12];
    }
    uteModuleSprotData.moreSportData.isAppStartSportReConnection = true;
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
/**
*@brief        开始发送多运动数据
*@details
*@author       wuhuowang
*@date       2022-11-19
*/
void uteModuleSportSendMoreSportHistoryData(void)
{
    ute_application_sync_data_param_t *sendParam;
    uteApplicationCommonGetSyncDataParam(&sendParam);
    uint8_t response[SPORTS_SEND_DATA_READ_LENGTH / 2 + 4];
    uint8_t sendSize = 0;
    uint8_t path[40];
    bool isSendFinish = false;
    memset(&path[0], 0, 40);
    memset(&response[0], 0, sizeof(response));
    response[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currSendFileIndex=%d,currSendMinIndex=%d,dirInfo.filesCnt=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendMinIndex,sendParam->dirInfo.filesCnt);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendParam->currSendFileSize=%d,currSendFileDataOffset=%d", __func__,sendParam->currSendFileSize,sendParam->currSendFileDataOffset);
    if(((sendParam->currSendFileSize==sendParam->currSendFileDataOffset)&&(sendParam->currSendFileSize!=0))
       ||(sendParam->dirInfo.filesCnt==0)
       ||(sendParam->currSendFileIndex==sendParam->dirInfo.filesCnt))
    {
        sendSize = 3;
        response[1] = 0xfd;
        response[2] = sendParam->crc;
        sendParam->crc = 0;
        sendParam->currSendMinIndex = 0;
        sendParam->currSendFileDataOffset = 0;
        sendParam->currSendFileIndex++;
        if(sendParam->currSendFileIndex>=sendParam->dirInfo.filesCnt)
        {
            uteApplicationCommonSyncDataTimerStop();
        }
        isSendFinish = true;
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
        if(uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_CLOSE)
        {
            ute_module_systemtime_time_t time;
            uteModuleSystemtimeGetTime(&time);
            ute_module_systemtime_measure_time_t setTime;
            memset(&setTime,0,sizeof(ute_module_systemtime_measure_time_t));
            setTime.year = time.year;
            setTime.month = time.month;
            setTime.day = time.day;
            setTime.hour = time.hour;
            setTime.min = time.min;
            setTime.sec = time.sec;
            uteModuleSportSetMoreSportsSyncTime(setTime);
        }
#endif
    }
    if(!isSendFinish)
    {
        void *file;
        if(sendParam->dirInfo.filesCnt>0)
        {
            if(sendParam->currSendMinIndex == 0)
            {
                snprintf((char *)&path[0],30,"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
                if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
                {
                    uteModuleFilesystemSeek(file,0,FS_SEEK_END);
                    sendParam->currSendFileSize = (uint32_t)uteModuleFilesystemGetFileSize(file);
                    uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
                    memset(&uteModuleSportMoreSportSyncDataBuff[0],0,sendParam->dataBuffSize);
                    uteModuleFilesystemReadData(file,&uteModuleSportMoreSportSyncDataBuff[0], SPORTS_HEAD_DATAS_LENGTH);
                    uteModuleFilesystemCloseFile(file);
                    sendParam->currSendFileDataOffset = 17;
                    sendSize = 20;
                    response[1] = 0;
                    response[2] = sendParam->currSendMinIndex;
                    response[3] = uteModuleSportMoreSportSyncDataBuff[1];
                    response[4] = uteModuleSportMoreSportSyncDataBuff[31];
                    response[5] = uteModuleSportMoreSportSyncDataBuff[32];
                    response[6] = uteModuleSportMoreSportSyncDataBuff[2];
                    response[7] = uteModuleSportMoreSportSyncDataBuff[3];
                    response[8] = uteModuleSportMoreSportSyncDataBuff[4];
                    response[9] = uteModuleSportMoreSportSyncDataBuff[5];
                    response[10] = uteModuleSportMoreSportSyncDataBuff[6];
                    response[11] = uteModuleSportMoreSportSyncDataBuff[7];
                    response[12] = uteModuleSportMoreSportSyncDataBuff[8];
                    response[13] = uteModuleSportMoreSportSyncDataBuff[9];
                    response[14] = uteModuleSportMoreSportSyncDataBuff[10];
                    response[15] = uteModuleSportMoreSportSyncDataBuff[11];
                    response[16] = uteModuleSportMoreSportSyncDataBuff[12];
                    response[17] = uteModuleSportMoreSportSyncDataBuff[13];
                    response[18] = uteModuleSportMoreSportSyncDataBuff[14];
                    response[19] = uteModuleSportMoreSportSyncDataBuff[15];
                    uteModuleCrc8Bit(&sendParam->crc, &response[1],19);
                    sendParam->currSendMinIndex++;
                }
                else
                {
                    sendParam->currSendFileIndex++;
                }
            }
            else if(sendParam->currSendMinIndex == 1)
            {
                sendParam->currSendFileDataOffset = 33;
                sendSize = 18;
                response[1] = 0;
                response[2] = sendParam->currSendMinIndex;
                response[3] = uteModuleSportMoreSportSyncDataBuff[17];
                response[4] = uteModuleSportMoreSportSyncDataBuff[18];
                response[5] = uteModuleSportMoreSportSyncDataBuff[19];
                response[6] = uteModuleSportMoreSportSyncDataBuff[20];
                response[7] = uteModuleSportMoreSportSyncDataBuff[21];
                response[8] = uteModuleSportMoreSportSyncDataBuff[22];
                response[9] = uteModuleSportMoreSportSyncDataBuff[23];
                response[10] = uteModuleSportMoreSportSyncDataBuff[24];
                response[11] = uteModuleSportMoreSportSyncDataBuff[25];
                response[12] = uteModuleSportMoreSportSyncDataBuff[26];
                response[13] = uteModuleSportMoreSportSyncDataBuff[27];
                response[14] = uteModuleSportMoreSportSyncDataBuff[28];
                response[15] = uteModuleSportMoreSportSyncDataBuff[29];
                response[16] = uteModuleSportMoreSportSyncDataBuff[30];
                response[17] = uteModuleSportMoreSportSyncDataBuff[0];
                uteModuleCrc8Bit(&sendParam->crc, &response[1],17);
                sendParam->currSendMinIndex++;
            }
            else if (sendParam->currSendMinIndex == 2)
            {
                sendParam->currSendFileDataOffset = 50;
                sendSize = 20;
                response[1] = 0;
                response[2] = sendParam->currSendMinIndex;
                response[3] = uteModuleSportMoreSportSyncDataBuff[33];
                response[4] = uteModuleSportMoreSportSyncDataBuff[34];
                response[5] = uteModuleSportMoreSportSyncDataBuff[35];
                response[6] = uteModuleSportMoreSportSyncDataBuff[36];
                response[7] = uteModuleSportMoreSportSyncDataBuff[37];
                response[8] = uteModuleSportMoreSportSyncDataBuff[38];
                response[9] = uteModuleSportMoreSportSyncDataBuff[39];
                response[10] = uteModuleSportMoreSportSyncDataBuff[40];
                response[11] = uteModuleSportMoreSportSyncDataBuff[41];
                response[12] = uteModuleSportMoreSportSyncDataBuff[42];
                response[13] = uteModuleSportMoreSportSyncDataBuff[43];
                response[14] = uteModuleSportMoreSportSyncDataBuff[44];
                response[15] = uteModuleSportMoreSportSyncDataBuff[45];
                response[16] = uteModuleSportMoreSportSyncDataBuff[46];
                response[17] = uteModuleSportMoreSportSyncDataBuff[47];
                response[18] = uteModuleSportMoreSportSyncDataBuff[48];
                response[19] = uteModuleSportMoreSportSyncDataBuff[49];
                uteModuleCrc8Bit(&sendParam->crc, &response[1], 19);
                sendParam->currSendMinIndex ++;
            }
            else if (sendParam->currSendMinIndex == 3)
            {
                sendParam->currSendFileDataOffset = SPORTS_HEAD_DATAS_LENGTH;
                sendSize = 9;
                response[1] = 0;
                response[2] = sendParam->currSendMinIndex;
                response[3] = uteModuleSportMoreSportSyncDataBuff[50];
                response[4] = uteModuleSportMoreSportSyncDataBuff[51];
                response[5] = uteModuleSportMoreSportSyncDataBuff[52];
                response[6] = uteModuleSportMoreSportSyncDataBuff[53];
                response[7] = uteModuleSportMoreSportSyncDataBuff[54];
                response[8] = uteModuleSportMoreSportSyncDataBuff[55];
                uteModuleCrc8Bit(&sendParam->crc, &response[1], 8);
                sendParam->currSendMinIndex ++;
            }
            else
            {
                uint8_t sendindexMod = ((sendParam->currSendMinIndex - 4) % 2);
                UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,sendindexMod=%d,currSendFileSize=%d,currSendFileDataOffset=%d", __func__,sendindexMod,sendParam->currSendFileSize,sendParam->currSendFileDataOffset);
                if (sendindexMod == 0)
                {
                    //read
                    sprintf((char *)&path[0], "%s/%s", UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, &sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
                    if (uteModuleFilesystemOpenFile(&path[0], &file, FS_O_RDONLY))
                    {
                        uint32_t readSize = 0;
                        if ((sendParam->currSendFileDataOffset + sendParam->dataBuffSize) > sendParam->currSendFileSize)
                        {
                            readSize = sendParam->currSendFileSize - sendParam->currSendFileDataOffset;
                        }
                        else
                        {
                            readSize = sendParam->dataBuffSize;
                        }
                        UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,readSize=%d", __func__,readSize);
                        uteModuleFilesystemSeek(file, sendParam->currSendFileDataOffset, FS_SEEK_SET);
                        memset(&uteModuleSportMoreSportSyncDataBuff[0], 0, sendParam->dataBuffSize);
                        uteModuleFilesystemReadData(file, &uteModuleSportMoreSportSyncDataBuff[0], readSize);
                        uteModuleFilesystemCloseFile(file);
                    }
                }
                response[1] = (sendParam->currSendMinIndex >> 8) & 0xff;
                response[2] = sendParam->currSendMinIndex & 0xff;
                if ((sendParam->currSendFileDataOffset + (SPORTS_SEND_DATA_READ_LENGTH / 2) > sendParam->currSendFileSize))
                {
                    sendSize = sendParam->currSendFileSize - sendParam->currSendFileDataOffset;
                }
                else
                {
                    sendSize = SPORTS_SEND_DATA_READ_LENGTH / 2;
                }
                sendParam->currSendFileDataOffset += sendSize;
                memcpy(&response[3], &uteModuleSportMoreSportSyncDataBuff[sendindexMod * (SPORTS_SEND_DATA_READ_LENGTH / 2)], sendSize);
                sendSize = sendSize + 3;
                uteModuleCrc8Bit(&sendParam->crc, &response[1], sendSize - 1);
                sendParam->currSendMinIndex ++;
            }
        }
    }
    UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,sendSize=%d", __func__,sendSize);
    if (sendSize > 0)
    {
        uteModuleProfileBle50SendToPhone(&response[0], sendSize);
    }
}
#else
/**
*@brief        开始发送多运动数据
*@details
*@author       zn.zeng
*@date       2021-08-23
*/
void uteModuleSportSendMoreSportHistoryData(void)
{
    ute_application_sync_data_param_t *sendParam;
    uteApplicationCommonGetSyncDataParam(&sendParam);
    uint8_t response[20];
    uint8_t sendSize = 0;
    uint8_t path[40];
    bool isSendFinish = false;
    memset(&path[0],0,sizeof(path));
    response[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currSendFileIndex=%d,currSendMinIndex=%d,dirInfo.filesCnt=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendMinIndex,sendParam->dirInfo.filesCnt);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendParam->currSendFileSize=%d,currSendFileDataOffset=%d", __func__,sendParam->currSendFileSize,sendParam->currSendFileDataOffset);
    if(((sendParam->currSendFileSize==sendParam->currSendFileDataOffset)&&(sendParam->currSendFileSize!=0))
       ||(sendParam->dirInfo.filesCnt==0)
       ||(sendParam->currSendFileIndex==sendParam->dirInfo.filesCnt))
    {
        sendSize = 3;
        response[1] = 0xfd;
        response[2] = sendParam->crc;
        sendParam->crc = 0;
        sendParam->currSendMinIndex = 0;
        sendParam->currSendFileDataOffset = 0;
        sendParam->currSendFileIndex++;
        if(sendParam->currSendFileIndex>=sendParam->dirInfo.filesCnt)
        {
            uteApplicationCommonSyncDataTimerStop();
        }
        isSendFinish = true;
    }
    if(!isSendFinish)
    {
        void *file;
        if(sendParam->dirInfo.filesCnt>0)
        {
            if(sendParam->currSendMinIndex == 0)
            {
                snprintf((char *)&path[0],30,"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
                if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
                {
                    uteModuleFilesystemSeek(file,0,FS_SEEK_END);
                    sendParam->currSendFileSize = (uint32_t)uteModuleFilesystemGetFileSize(file);
                    uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
                    memset(&uteModuleSportMoreSportSyncDataBuff[0],0,sendParam->dataBuffSize);
                    uteModuleFilesystemReadData(file,&uteModuleSportMoreSportSyncDataBuff[0],SPORTS_HEAD_DATAS_LENGTH);
                    uteModuleFilesystemCloseFile(file);
                    sendParam->currSendFileDataOffset = 17;
                    sendSize = 20;
                    response[1] = 0;
                    response[2] = sendParam->currSendMinIndex;
                    response[3] = uteModuleSportMoreSportSyncDataBuff[1];
                    response[4] = uteModuleSportMoreSportSyncDataBuff[31];
                    response[5] = uteModuleSportMoreSportSyncDataBuff[32];
                    response[6] = uteModuleSportMoreSportSyncDataBuff[2];
                    response[7] = uteModuleSportMoreSportSyncDataBuff[3];
                    response[8] = uteModuleSportMoreSportSyncDataBuff[4];
                    response[9] = uteModuleSportMoreSportSyncDataBuff[5];
                    response[10] = uteModuleSportMoreSportSyncDataBuff[6];
                    response[11] = uteModuleSportMoreSportSyncDataBuff[7];
                    response[12] = uteModuleSportMoreSportSyncDataBuff[8];
                    response[13] = uteModuleSportMoreSportSyncDataBuff[9];
                    response[14] = uteModuleSportMoreSportSyncDataBuff[10];
                    response[15] = uteModuleSportMoreSportSyncDataBuff[11];
                    response[16] = uteModuleSportMoreSportSyncDataBuff[12];
                    response[17] = uteModuleSportMoreSportSyncDataBuff[13];
                    response[18] = uteModuleSportMoreSportSyncDataBuff[14];
                    response[19] = uteModuleSportMoreSportSyncDataBuff[15];
                    uteModuleCrc8Bit(&sendParam->crc, &response[1],19);
                    sendParam->currSendMinIndex++;
                }
                else
                {
                    sendParam->currSendFileIndex++;
                }
            }
            else if(sendParam->currSendMinIndex == 1)
            {
                sendParam->currSendFileDataOffset = SPORTS_HEAD_DATAS_LENGTH;
                sendSize = 18;
                response[1] = 0;
                response[2] = sendParam->currSendMinIndex;
                response[3] = uteModuleSportMoreSportSyncDataBuff[17];
                response[4] = uteModuleSportMoreSportSyncDataBuff[18];
                response[5] = uteModuleSportMoreSportSyncDataBuff[19];
                response[6] = uteModuleSportMoreSportSyncDataBuff[20];
                response[7] = uteModuleSportMoreSportSyncDataBuff[21];
                response[8] = uteModuleSportMoreSportSyncDataBuff[22];
                response[9] = uteModuleSportMoreSportSyncDataBuff[23];
                response[10] = uteModuleSportMoreSportSyncDataBuff[24];
                response[11] = uteModuleSportMoreSportSyncDataBuff[25];
                response[12] = uteModuleSportMoreSportSyncDataBuff[26];
                response[13] = uteModuleSportMoreSportSyncDataBuff[27];
                response[14] = uteModuleSportMoreSportSyncDataBuff[28];
                response[15] = uteModuleSportMoreSportSyncDataBuff[29];
                response[16] = uteModuleSportMoreSportSyncDataBuff[30];
                response[17] = uteModuleSportMoreSportSyncDataBuff[0];
                uteModuleCrc8Bit(&sendParam->crc, &response[1],17);
                sendParam->currSendMinIndex++;
            }
            else
            {
                uint8_t sendindexMod = ((sendParam->currSendMinIndex-2)%10);
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendindexMod=%d,currSendFileSize=%d,currSendFileDataOffset=%d", __func__,sendindexMod,sendParam->currSendFileSize,sendParam->currSendFileDataOffset);
                if(sendindexMod==0)
                {
                    //read
                    sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
                    if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
                    {
                        uint32_t readSize = 0;
                        if((sendParam->currSendFileDataOffset+sendParam->dataBuffSize)>sendParam->currSendFileSize)
                        {
                            readSize = sendParam->currSendFileSize-sendParam->currSendFileDataOffset;
                        }
                        else
                        {
                            readSize = sendParam->dataBuffSize;
                        }
                        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,readSize=%d", __func__,readSize);
                        uteModuleFilesystemSeek(file,sendParam->currSendFileDataOffset,FS_SEEK_SET);
                        memset(&uteModuleSportMoreSportSyncDataBuff[0],0,sendParam->dataBuffSize);
                        uteModuleFilesystemReadData(file,&uteModuleSportMoreSportSyncDataBuff[0],readSize);
                        uteModuleFilesystemCloseFile(file);
                    }
                }
                response[1] = (sendParam->currSendMinIndex>>8)&0xff;
                response[2] = sendParam->currSendMinIndex&0xff;
                if((sendParam->currSendFileDataOffset+17)>sendParam->currSendFileSize)
                {
                    sendSize = sendParam->currSendFileSize - sendParam->currSendFileDataOffset;
                }
                else
                {
                    sendSize = 17;
                }
                sendParam->currSendFileDataOffset += sendSize;
                memcpy(&response[3],&uteModuleSportMoreSportSyncDataBuff[sendindexMod*17],sendSize);
                sendSize = sendSize+3;
                uteModuleCrc8Bit(&sendParam->crc,&response[1],sendSize-1);
                sendParam->currSendMinIndex++;
            }
        }
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendSize=%d", __func__,sendSize);
    if(sendSize>0)
    {
        uteModuleProfileBleSendToPhone(&response[0],sendSize);
    }
}
#endif
/**
*@brief        准备开始发送多运动数据
*@details
*@param[in]  需要同步的数据时间戳
*@author       zn.zeng
*@date       2021-11-13
*/
void uteModuleSportStartSendMoreSportHistoryData(ute_module_systemtime_time_t time)
{
    ute_application_sync_data_param_t *param;
    uteApplicationCommonGetSyncDataParam(&param);
    param->crc = 0;
    param->time = time;
    if(param->time.year==0)
    {
        param->isAllData = true;
    }
    else
    {
        param->isAllData = false;
    }
    param->currSendFileIndex = 0;
    param->currSendFileDataOffset = 0;
    param->currSendMinIndex =0;
    param->dataBuffSize = SPORTS_SEND_DATA_READ_LENGTH;
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, &param->dirInfo, NULL);
    uint16_t  hasFiles = 0;
#if !APP_SYNC_RECORD_TIME_FLAG_SUPPORT
    /*Casen add start 23-02-09 新增判断,如果处于运动中并且心率保存数大于90则当条数据不发给APP*/
    uint8_t sportStatus = uteModuleSportMoreSportGetStatus();
    if(sportStatus != ALL_SPORT_STATUS_CLOSE)
    {
        if(uteModuleSprotData.moreSportData.heartTotalCnt>=SPORTS_HEART_DATAS_CACHE_LENGTH)
        {
            if(param->dirInfo.filesCnt>0)
            {
                param->dirInfo.filesCnt = param->dirInfo.filesCnt -1 ;
            }
        }
    }
    /*Casen add end 23-02-09 */
    if(!param->isAllData)
    {
        uint64_t readTime,fileTime;
        uint8_t timeBuff[18];
        memset(timeBuff,0,18);
        sprintf((char *)&timeBuff[0],"%04d%02d%02d%02d%02d",time.year,time.month,time.day,time.hour,time.min);
        UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,%s", __func__,timeBuff);
        readTime = atoll((const char *)&timeBuff[0]);
        for(uint8_t i = 0; i<param->dirInfo.filesCnt; i++)
        {
            fileTime = atoll((const char *)&param->dirInfo.filesName[i][0]);
            UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,fileTime=%lld,readTime=%lld", __func__,fileTime,readTime);
            if(fileTime>=readTime)
            {
                hasFiles = param->dirInfo.filesCnt -i;
                param->currSendFileIndex = i;
                break;
            }
        }
        if(hasFiles==0)
        {
            param->currSendFileIndex = param->dirInfo.filesCnt;
        }
    }
    else
#endif
    {
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
        if(uteModuleSprotData.moreSportsSyncTime.year == 0)
        {
            hasFiles = param->dirInfo.filesCnt;
        }
        else
        {
            uint64_t lastSyncTime,fileTime;
            uint8_t lastSyncTimeBuff[15];
            memset(lastSyncTimeBuff,0,15);
            sprintf((char *)&lastSyncTimeBuff[0],"%04d%02d%02d%02d%02d",uteModuleSprotData.moreSportsSyncTime.year,uteModuleSprotData.moreSportsSyncTime.month,\
                    uteModuleSprotData.moreSportsSyncTime.day,uteModuleSprotData.moreSportsSyncTime.hour,uteModuleSprotData.moreSportsSyncTime.min);
            UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,%s", __func__,lastSyncTimeBuff);
            lastSyncTime = atoll((const char *)&lastSyncTimeBuff[0]);
            for(uint8_t i = 0; i<param->dirInfo.filesCnt; i++)
            {
                fileTime = atoll((const char *)&param->dirInfo.filesName[i][0]);
                UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,fileTime=%lld,lastSyncTimeBuff=%lld", __func__,fileTime,lastSyncTime);
                if(fileTime >= lastSyncTime)
                {
                    hasFiles = param->dirInfo.filesCnt -i;
                    param->currSendFileIndex = i;
                    break;
                }
            }
            if(hasFiles==0)
            {
                param->currSendFileIndex = param->dirInfo.filesCnt;
            }
        }
        //add by wuhuowang 2023-05-12 运动中不上传多运动数据
        if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_CLOSE)
        {
            if (hasFiles > 0)
                hasFiles = 0;
        }
#else
        hasFiles = param->dirInfo.filesCnt;
#endif
    }
    uint8_t response[10];
    memset(&response[0],0,10);
    response[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;
    response[1] = 0xfa;
    response[2] = time.year>>8&0xff;
    response[3] = time.year&0xff;
    response[4] = time.month;
    response[5] = time.day;
    response[6] = time.hour;
    response[7] = time.min;
    response[8] = hasFiles>>8&0xff;
    response[9] = hasFiles&0xff;

    uteModuleProfileBleSendToPhone(&response[0],10);
    if(hasFiles>0)
    {
        uteApplicationCommonRegisterSyncDataTimerFunction(uteModuleSportSendMoreSportHistoryData);
        uteApplicationCommonSyncDataTimerStart();
    }
    UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,", __func__);
}
/**
*@brief        设置运动开始的倒计时
*@details
*@author       dengli.lu
*@date       2021-11-17
*/
void uteModuleSportSetCountZeroIndex(uint8_t countZeroIndex)
{
    uteModuleSprotData.moreSportData.countZeroIndex = countZeroIndex;
}
/**
*@brief        断开连接处理
*@details
*@author       zn.zeng
*@date       2021-11-30
*/
void uteModuleSportDisconnectHandler(void)
{
    if (
        (uteModuleSprotData.moreSportData.isAppStart) &&
        ((uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_OPEN) || (uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_UPDATE_DATA))
    )
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
        uteModuleSprotData.moreSportData.isAppStartSportReConnection = false;
        uteModuleSprotData.moreSportData.status = ALL_SPORT_STATUS_PAUSE;
        // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORTS_PAUSED_ID);          //跳到暂停界面，自动暂停运动，蓝牙连接才可继续跑
        //func_switch_to(FUNC_SPORT_SUB_RUN, FUNC_SWITCH_LR_ZOOM_RIGHT | FUNC_SWITCH_AUTO);
        // func_cb.sta = FUNC_SPORT_SUB_RUN;
        printf("czh line %d,func %s\n",__LINE__,__func__);
        uteTaskGuiStartScreen(FUNC_SPORT_SUB_RUN,0,__func__);
        sys_cb.sport_app_disconnect = true;
    }
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
    if ((uteModuleSprotData.moreSportData.isAppStart == false)
        && (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_CLOSE)
        && (uteModuleSportGetGPSStatus() == GPS_LACATION_OK)
       )
    {
        uteModuleSportSetGPSStatus(GPS_LACATION_DISCONNECT);
        uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger = (uint8_t)(mUTESportDatas.sportDistance);
        uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals = (uint8_t)((mUTESportDatas.sportDistance - (float)uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger) * 100);
        uteDrvMotorStart(UTE_MOTOR_DURATION_TIME, UTE_MOTOR_INTERVAL_TIME, 1);
//        uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_GPS_DISCONNECT_SCREEN_ID);
    }
#endif
}
/**
*@brief    久坐提醒msg处理函数
*@details
*@author        zn.zeng
*@date        2021-08-06
*/
void uteModuleSportSedentaryMsg(void)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s", __func__);
#if UTE_MODULE_GUI_CHARGERING_NOT_GOTO_NOTIFICATION_SCREEN_SUPPORT
    if(uteDrvBatteryCommonGetChargerStatus() != BAT_STATUS_NO_CHARGE)
    {
        return;
    }
#endif
    if (!uteModuleHeartIsWear() || uteDrvBatteryCommonGetChargerStatus() != BAT_STATUS_NO_CHARGE)
    {
        return;
    }
    // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SEDENTARY_REMIND_ID);           //久坐提醒界面
    sys_cb.cover_index = REMIND_COVER_HEALTH_SEDENTARY;
    sys_cb.remind_tag = true;
    //uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);  //振动放到弹窗界面中，以防某些原因导致不振动
}
/**
*@brief    从未佩戴到佩戴切换
*@details
*@author        zn.zeng
*@date        2021-12-27
*/
void uteModuleSportUnWearToWearSwitch(void)
{
    if(uteModuleSprotData.lastStepType == STEP_TYPE_SLEEP)
    {
        uteModuleSportStepTypeSetSleep();
    }
    else
    {
        uteModuleSportStepTypeSetStep();
    }
}

#if UTE_MODULE_SPORT_TAKE_PICTURE_MOTOR_SUPPORT
void *uteModuleSportDelaySetTakePictureEnableTimerPointer = NULL;
/**
*@brief        延时使能拍照处理函数
*@details
*@author       xjc
*@date       2022-01-07
*/
void uteModuleSportDelaySetTakePictureEnableHandlerMsg(void)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,", __func__);
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_SUPPORT
    if(uteModuleSprotData.isTakingPictures)
    {
        enableTakingPicturesState();
    }
    else
    {
        disableTakingPicturesState();
    }
#endif
}
/**
*@brief   停止使能拍照定时器创建函数
*@details
*@author       xjc
*@date       2022-01-07
*/
void uteModuleSportDelaySetTakePictureEnableTimerStop(void)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,", __func__);
    uteModulePlatformStopTimer(&uteModuleSportDelaySetTakePictureEnableTimerPointer);
    //delete timer
    uteModulePlatformDeleteTimer(&uteModuleSportDelaySetTakePictureEnableTimerPointer);
    uteModuleSportDelaySetTakePictureEnableTimerPointer = NULL;
}
/**
*@brief        延时使能拍照回调函数
*@details
*@author       xjc
*@date       2022-01-07
*/
void uteModuleSportDelaySetTakePictureEnableTimerCallback(void *pxTimer)
{
    uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_MODULE_SPORT_DELAY_ENABLE_TAKEPICTURE_TIMER,0);
    uteModuleSportDelaySetTakePictureEnableTimerStop();
}
/**
*@brief        延时使能拍照定时器创建函数
*@details
*@author       xjc
*@date       2022-01-07
*/
void uteModuleSportDelaySetTakePictureEnableTimerCreate(void)
{
    if(uteModuleSportDelaySetTakePictureEnableTimerPointer == NULL)
    {
        uteModulePlatformCreateTimer(&uteModuleSportDelaySetTakePictureEnableTimerPointer, "delaySetTakePictureEnableTimer",1, 1000, false, uteModuleSportDelaySetTakePictureEnableTimerCallback);
    }
}
/**
*@brief     启动使能拍照定时器创建函数
*@details
*@author       xjc
*@date       2022-01-07
*/
void uteModuleSportDelaySetTakePictureEnableTimerStart(uint16_t ms)
{
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,", __func__);
    uteModuleSportDelaySetTakePictureEnableTimerCreate();
    uteModulePlatformRestartTimer(&uteModuleSportDelaySetTakePictureEnableTimerPointer, ms);
}
#endif
/**
*@brief       多运动正在运行
*@details
*@author       zn.zeng
*@date       2022-01-11
*/
AT(.com_text.ute_sport)
bool uteModuleSportMoreSportIsRuning(void)
{
    // UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,.moreSportData.status=%d", __func__,uteModuleSprotData.moreSportData.status);
    if(uteModuleSprotData.moreSportData.status!=ALL_SPORT_STATUS_CLOSE)
    {
        return true;
    }
    else
    {
        return false;
    }

}
/**
*@brief       获取多运动的运动类型
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
AT(.com_text.ute_sport)
uint8_t uteModuleSportMoreSportGetType(void)
{
    return uteModuleSprotData.moreSportData.saveData.sportsType;
}

/**
*@brief       获取多运动的运动类型
*@details
*@author       wuhuowang
*@date       2022-12-09
*/
void uteModuleSportMoreSportSetType(uint8_t type)
{
    uteModuleSprotData.moreSportData.saveData.sportsType = type;
}

/**
*@brief       获取多运动的运动状态
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
uint8_t uteModuleSportMoreSportGetStatus(void)
{
    return uteModuleSprotData.moreSportData.status;
}
/**
*@brief       设置多运动的运动状态
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
void uteModuleSportMoreSportSetStatus(all_sport_status_type sportStatus)
{
    uteModuleSprotData.moreSportData.status = sportStatus;
}
/**
*@brief       获取多运动的运动是否是手机端开启的
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
bool uteModuleSportMoreSportIsAppStart(void)
{
    return uteModuleSprotData.moreSportData.isAppStart;
}
/**
*@brief       设置多运动的运动是否是手机端开启的回连状态
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
void uteModuleSportMoreSportSetIsAppStartReconnection(bool isAppStartSportReConnection)
{
    uteModuleSprotData.moreSportData.isAppStartSportReConnection = isAppStartSportReConnection;
}
/**
*@brief       获取多运动的运动是否是手机端开启的回连状态
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
bool uteModuleSportMoreSportIsAppStartReconnection(void)
{
    return uteModuleSprotData.moreSportData.isAppStartSportReConnection;
}
/**
*@brief     获取多运动数据
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
void uteModuleSportGetMoreSportsDatas(ute_module_more_sports_data_t *data)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    memcpy(data,&uteModuleSprotData.moreSportData,sizeof(ute_module_more_sports_data_t));
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
/**
*@brief       获取多运动的倒计时计数
*@details
*@author       zn.zeng
*@date       2022-02-14
*/
int8_t uteModuleSportMoreSportGetCountZeroIndex(void)
{
    return uteModuleSprotData.moreSportData.countZeroIndex;
}

/**
*@brief        运动倒计时处理函数
*@details
*@author       xjc
*@date       2022-05-31
*/
void uteModuleSprotCountdownTimerHandlerMsg(void)
{
    if(uteModuleSprotData.moreSportData.countZeroIndex > 0)
    {
        uteModuleSprotData.moreSportData.countZeroIndex--;
#if APP_SPORT_VIB_AFTER_COUNT
        if (!uteModuleSprotData.moreSportData.isAppStart && uteModuleSprotData.moreSportData.countZeroIndex == 1)
        {
            uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,1);
        }
#endif
        uteModuleSprotCountdownTimerStart(1000);
    }
    else
    {
        uteModuleSprotCountdownTimerStop();
    }
}
/**
*@brief      运动倒计时定时器回调
*@details
*@author     xjc
*@date       2022-05-31
*/
void uteModuleSprotCountdownTimerCallback(void *pxTimer)
{
    uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_DRV_SPORT_COUNTDOWN_TIMER,0);
}
/**
*@brief      开始运动倒计时定时器
*@details
*@author     xjc
*@date       2022-05-31
*/
void uteModuleSprotCountdownTimerStart(uint16_t ms)
{
    if(uteModuleSprotCountdownTimer == NULL)
    {
        uteModulePlatformCreateTimer(&uteModuleSprotCountdownTimer, "sports countdown timer", 1, 1000, false, uteModuleSprotCountdownTimerCallback);
    }
    uteModulePlatformRestartTimer(&uteModuleSprotCountdownTimer, ms);
}
/**
*@brief      停止运动倒计时定时器
*@details
*@author     xjc
*@date       2022-05-31
*/
void uteModuleSprotCountdownTimerStop(void)
{
    uteModulePlatformStopTimer(&uteModuleSprotCountdownTimer);
    uteModulePlatformDeleteTimer(&uteModuleSprotCountdownTimer);
    uteModuleSprotCountdownTimer = NULL;
}

/**
 *@brief        时间变化
 *@details   跨天数时要处理清零
 *@param[in] ute_module_systemtime_time_t curr,当前时间
 *@param[in] ute_module_systemtime_time_t newSet,将要设置的时间
 *@author       xjc
 *@date       2022-04-28
 */
void uteModuleSportSystemtimeChange(ute_module_systemtime_time_t curr,ute_module_systemtime_time_t newSet)
{
    if (!uteApplicationCommonIsPowerOn())
    {
        return;
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,curr %04d-%02d-%02d %02d:%02d:%02d", __func__,curr.year,curr.month,curr.day,curr.hour,curr.min,curr.sec);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,newSet %04d-%02d-%02d %02d:%02d:%02d", __func__,newSet.year,newSet.month,newSet.day,newSet.hour,newSet.min,newSet.sec);
    uint32_t newDay = newSet.year<<16|newSet.month<<8|newSet.day;
    uint32_t currDay = curr.year<<16|curr.month<<8|curr.day;
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    void *file;
    uint16_t buffSize = 12*24+4;
    uint8_t path[40];
    memset(&path[0],0,sizeof(path));
    uint8_t *readBuffOneDay = uteModulePlatformMemoryAlloc(buffSize);
    uteModuleSprotData.lastDayReadHour = -1;
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    uteModuleSprotData.lastReadHour = 0xFF;
#endif
    if(newDay<currDay)
    {
        /*! 时间往回设置,删除大于新设置日期的数据*/
        uint32_t newSetDay = 0;
        uint32_t fileDay = 0;
        ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,before del file", __func__);
        uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR, dirInfo, NULL);
        for (int i = (dirInfo->filesCnt-1); i >= 0; i--)
        {
            sprintf((char *)&path[0],"%04d%02d%02d",newSet.year,newSet.month,newSet.day);
            newSetDay = atoi((const char *)&path[0]);
            fileDay = atoi((const char *)&dirInfo->filesName[i][0]);
            if(fileDay > newSetDay)
            {
                memset(&path[0],0,20);
                sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,&dirInfo->filesName[i][0]);
                uteModuleFilesystemDelFile((char *)&path[0]);
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__,&path[0]);
            }
            else
            {
                break;
            }
        }
#if UTE_MODULE_LOG_SUPPORT
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,after del file", __func__);
        uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR, NULL, NULL);
#endif
        /*! 清除当天步数数据*/
        uteModuleSprotData.stepSleepData.currentHourStepCnt = 0;
        uteModuleSprotData.stepSleepData.current_hour_run_stepCnt = 0;
        uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = 0;
        mStepSleepParam.currentHourStepCnt = 0;
        mStepSleepParam.current_hour_run_stepCnt = 0;
        mStepSleepParam.current_hour_walk_stepCnt = 0;
        uteModuleSprotData.currDayTotalStep = 0;
        uteModuleSprotData.currDayWalkStep = 0;
        uteModuleSprotData.currDayRunStep = 0;
        /*! 恢复当前步数*/
        memset(&path[0],0,sizeof(path));
        sprintf((char *)&path[0],"%s/%04d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,newSet.year,newSet.month,newSet.day);
        memset(&readBuffOneDay[0],0,buffSize);
        if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY|FS_O_WRONLY))
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemReadData(file,&readBuffOneDay[0],buffSize);
            /*! 清除当前时间下一个小时之后的数据*/
            memset(&readBuffOneDay[4+(newSet.hour+1)*12],0,buffSize-(4+(newSet.hour+1)*12));
            uteModuleFilesystemWriteData(file,&readBuffOneDay[0],buffSize);
            uteModuleFilesystemCloseFile(file);
        }
        /*! 恢复当前小时步数*/
        uteModuleSprotData.stepSleepData.currentHourStepCnt = (readBuffOneDay[4+newSet.hour*12]<<8|readBuffOneDay[4+newSet.hour*12+1]);
        uteModuleSprotData.stepSleepData.current_hour_run_stepCnt = (readBuffOneDay[4+newSet.hour*12+5]<<8|readBuffOneDay[4+newSet.hour*12+6]);
        uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = (readBuffOneDay[4+newSet.hour*12+10]<<8|readBuffOneDay[4+newSet.hour*12+11]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currentHourStepCnt=%d,current_hour_run_stepCnt=%d,current_hour_walk_stepCnt=%d", __func__,uteModuleSprotData.stepSleepData.currentHourStepCnt,uteModuleSprotData.stepSleepData.current_hour_run_stepCnt,uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt);
        mStepSleepParam.currentHourStepCnt = uteModuleSprotData.stepSleepData.currentHourStepCnt;
        mStepSleepParam.current_hour_run_stepCnt = uteModuleSprotData.stepSleepData.current_hour_run_stepCnt;
        mStepSleepParam.current_hour_walk_stepCnt = uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt;
        /*! 恢复当天步数信息*/
        uteModuleSportReadCurrDayStepCnt(newSet);
        uteModulePlatformMemoryFree(dirInfo);
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
        uteModuleSprotData.todayTargetNotify.currStandMin = 0;
        uteModuleSprotData.todayTargetNotify.lastMinStepCnt = uteModuleSprotData.todayTargetNotify.allMinStepCnt = 0;
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
        memset(uteModuleSprotData.dailyActivity.everyHourAllSportStep,0x00,24*4);
        memset(uteModuleSprotData.dailyActivity.everyHourAllSportKcal,0x00,24*2);
#endif
        uteModuleSportSaveTodayTargetNotifyData();
#endif
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
        /*! 重新读取当天有步数运动的步数，距离跟卡路里 xjc, 2022-08-03*/
        // uteModuleSportReadTodayAllSportDataConfig(newSet);
        uteModuleSprotData.updateTodayAllSportData = true;
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uteModuleSportDeleteExerciseTimeDataByDay(newSet);
        uteModuleSportDeleteExerciseTimeDataByHour(newSet);
        uteModuleSportReadCurrDayExerciseTimeData(newSet);
#endif
    }
    else if(newDay == currDay)
    {
        if(newSet.hour < curr.hour)
        {
            /*! 清除当天步数数据*/
            uteModuleSprotData.stepSleepData.currentHourStepCnt = 0;
            uteModuleSprotData.stepSleepData.current_hour_run_stepCnt = 0;
            uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = 0;
            mStepSleepParam.currentHourStepCnt = 0;
            mStepSleepParam.current_hour_run_stepCnt = 0;
            mStepSleepParam.current_hour_walk_stepCnt = 0;
            uteModuleSprotData.currDayTotalStep = 0;
            uteModuleSprotData.currDayWalkStep = 0;
            uteModuleSprotData.currDayRunStep = 0;
            memset(&path[0],0,sizeof(path));
            sprintf((char *)&path[0],"%s/%04d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,newSet.year,newSet.month,newSet.day);
            memset(&readBuffOneDay[0],0,buffSize);
            if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY|FS_O_WRONLY))
            {
                uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
                uteModuleFilesystemReadData(file,&readBuffOneDay[0],buffSize);
                /*! 清除当前时间下一个小时之后的数据*/
                memset(&readBuffOneDay[4+(newSet.hour+1)*12],0,buffSize-(4+(newSet.hour+1)*12));
                uteModuleFilesystemWriteData(file,&readBuffOneDay[0],buffSize);
                uteModuleFilesystemCloseFile(file);
            }
            /*! 恢复当前小时步数*/
            uteModuleSprotData.stepSleepData.currentHourStepCnt = (readBuffOneDay[4+newSet.hour*12]<<8|readBuffOneDay[4+newSet.hour*12+1]);
            uteModuleSprotData.stepSleepData.current_hour_run_stepCnt = (readBuffOneDay[4+newSet.hour*12+5]<<8|readBuffOneDay[4+newSet.hour*12+6]);
            uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = (readBuffOneDay[4+newSet.hour*12+10]<<8|readBuffOneDay[4+newSet.hour*12+11]);
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currentHourStepCnt=%d,current_hour_run_stepCnt=%d,current_hour_walk_stepCnt=%d", __func__,uteModuleSprotData.stepSleepData.currentHourStepCnt,uteModuleSprotData.stepSleepData.current_hour_run_stepCnt,uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt);
            mStepSleepParam.currentHourStepCnt = uteModuleSprotData.stepSleepData.currentHourStepCnt;
            mStepSleepParam.current_hour_run_stepCnt = uteModuleSprotData.stepSleepData.current_hour_run_stepCnt;
            mStepSleepParam.current_hour_walk_stepCnt = uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt;
            /*! 恢复当天步数信息*/
            uteModuleSportReadCurrDayStepCnt(newSet);
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
            uteModuleSportDeleteExerciseTimeDataByHour(newSet);
            uteModuleSportReadCurrDayExerciseTimeData(newSet);
#endif
        }
#if (UTE_MODULE_CYWEE_MOTION_SUPPORT == false)
        else if(newSet.hour > curr.hour)
        {
#if UTE_MODULE_SPORT_CLEAR_STEP_WHEN_HOUR_SUPPORT
            if(!((curr.min==59)&&(curr.sec==59)))
            {
                uteModuleSportSaveStepData();
                //clear
                memset(&uteModuleSprotData.stepSleepData,0,sizeof(ute_step_sleep_param_t));
                memset(&mStepSleepParam,0,sizeof(ute_step_sleep_param_t));
                uteModuleSportReadCurrDayStepCnt(newSet);
            }
#else
            uteModuleSportSaveStepData();
            //clear
            memset(&uteModuleSprotData.stepSleepData,0,sizeof(ute_step_sleep_param_t));
            memset(&mStepSleepParam,0,sizeof(ute_step_sleep_param_t));
            uteModuleSportReadCurrDayStepCnt(newSet);
#endif
        }
#endif
    }
    else
    {
        /*! 清除当天步数数据*/
        memset(&path[0],0,sizeof(path));
        sprintf((char *)&path[0],"%s/%04d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR,newSet.year,newSet.month,newSet.day);
        uteModuleFilesystemDelFile((char *)&path[0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__,&path[0]);
        uteModuleSprotData.stepSleepData.currentHourStepCnt = 0;
        uteModuleSprotData.stepSleepData.current_hour_run_stepCnt = 0;
        uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt = 0;
        mStepSleepParam.currentHourStepCnt = 0;
        mStepSleepParam.current_hour_run_stepCnt = 0;
        mStepSleepParam.current_hour_walk_stepCnt = 0;
        uteModuleSprotData.currDayTotalStep = 0;
        uteModuleSprotData.currDayWalkStep = 0;
        uteModuleSprotData.currDayRunStep = 0;
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
        uteModuleSprotData.todayTargetNotify.currStandMin = 0;
        uteModuleSprotData.todayTargetNotify.lastMinStepCnt = uteModuleSprotData.todayTargetNotify.allMinStepCnt = 0;
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
        memset(uteModuleSprotData.dailyActivity.everyHourAllSportStep,0x00,24*4);
        memset(uteModuleSprotData.dailyActivity.everyHourAllSportKcal,0x00,24*2);
#endif
        uteModuleSportSaveTodayTargetNotifyData();
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uint8_t path1[40];
        memset(&path1[0], 0, 40);
        sprintf((char *)&path1[0],"%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, newSet.year, newSet.month, newSet.day);
        uteModuleFilesystemDelFile((char *)&path1[0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__,&path1[0]);
        uteModuleSprotData.lastMinuteStepCnt = 0;
        memset(&uteModuleSprotData.exerciseTime[0], 0, 13 * 2);
#endif
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
        /*! 重新读取当天有步数运动的步数，距离跟卡路里 xjc, 2022-08-03*/
        // uteModuleSportReadTodayAllSportDataConfig(newSet);
        uteModuleSprotData.updateTodayAllSportData = true;
#endif
    }
    uteModulePlatformMemoryFree(readBuffOneDay);
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}

#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
/**
*@brief     读取目标数据
*@details
*@author        dengli.lu
*@date        2022-03-18
*/
void uteModuleSportReadTodayTargetNotifyData(void)
{
    /*! 读取目标数据*/
    void *file;
    uint8_t readbuff[36];
    memset(&readbuff[0],0,sizeof(readbuff));
    readbuff[0] = (DEFAULT_KCAL_TARGET_CNT>>8)&0xff;
    readbuff[1] = DEFAULT_KCAL_TARGET_CNT&0xff;
    readbuff[2] = DEFAULT_KCAL_TARGET_OPEN;
    readbuff[3] = 0;
    readbuff[4] = DEFAULT_STEP_TARGET_OPEN;
    readbuff[5] = (DEFAULT_DISTANCE_TARGET_CNT>>24)&0xff;
    readbuff[6] = (DEFAULT_DISTANCE_TARGET_CNT>>16)&0xff;
    readbuff[7] = (DEFAULT_DISTANCE_TARGET_CNT>>8)&0xff;
    readbuff[8] = DEFAULT_DISTANCE_TARGET_CNT&0xff;
    readbuff[9] = DEFAULT_DISTANCE_TARGET_OPEN;
    readbuff[10] = 0;
    readbuff[11] = DEFAULT_STAND_TIME_TARGET_OPEN;
    readbuff[12] = 0;
    readbuff[13] = (DEFAULT_STAND_TIME_TARGET_CNT>>8)&0xff;
    readbuff[14] = DEFAULT_STAND_TIME_TARGET_CNT&0xff;
    readbuff[27] = DEFAULT_SPORE_TIME_TARGET_OPEN;
    readbuff[28] = 0;
    readbuff[29] = (DEFAULT_SPORT_TIME_TARGET_CNT>>8)&0xff;
    readbuff[30] = DEFAULT_SPORT_TIME_TARGET_CNT&0xff;
    readbuff[31] = 0;
    readbuff[32] = DEFAULT_EXERCISE_TIME_TARGET_OPEN;
    readbuff[33] = 0;
    readbuff[34] = (DEFAULT_EXERCISE_TIME_TARGET_CNT >> 8) & 0xff;
    readbuff[35] = DEFAULT_EXERCISE_TIME_TARGET_CNT & 0xff;
    if(uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_TARGET_NOTIFY_DATA,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readbuff[0],36);
        uteModuleFilesystemCloseFile(file);
    }
    //kcal step distance
    uteModuleSprotData.todayTargetNotify.todayKcalTarget = readbuff[0]<<8|readbuff[1];
    uteModuleSprotData.todayTargetNotify.isTodayKcalTargetNotifyOpen = readbuff[2];
    uteModuleSprotData.todayTargetNotify.isTodayKcalTargetHasNotify = readbuff[3];
    uteModuleSprotData.todayTargetNotify.isTodayStepTargetNotifyOpen = readbuff[4];
    uteModuleSprotData.todayTargetNotify.todayDistanceTarget = readbuff[5]<<24|readbuff[6]<<16|readbuff[7]<<8|readbuff[8];
    uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetNotifyOpen = readbuff[9];
    uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetHasNotify = readbuff[10];
    //stand time
    uteModuleSprotData.todayTargetNotify.isStandTimeTargetNotifyOpen = readbuff[11];
    uteModuleSprotData.todayTargetNotify.isStandTimeTargetHasNotify = readbuff[12];
    uteModuleSprotData.todayTargetNotify.standTimeTargetSetMin = readbuff[13]<<8|readbuff[14];
    uteModuleSprotData.todayTargetNotify.currStandMin = readbuff[15]<<8|readbuff[16];
    uteModuleSprotData.todayTargetNotify.allMinStepCnt = readbuff[17]<<24|readbuff[18]<<16|readbuff[19]<<8|readbuff[20];
    uteModuleSprotData.todayTargetNotify.lastMinStepCnt = readbuff[21]<<24|readbuff[22]<<16|readbuff[23]<<8|readbuff[24];
    uteModuleSprotData.todayTargetNotify.standStartHour = readbuff[25];
    uteModuleSprotData.todayTargetNotify.standStartMin = readbuff[26];
    //sport time
    uteModuleSprotData.todayTargetNotify.isSportTimeTargetNotifyOpen = readbuff[27];
    uteModuleSprotData.todayTargetNotify.isSportTimeTargetHasNotify = readbuff[28];
    uteModuleSprotData.todayTargetNotify.sportTimeTargetSetMin = readbuff[29]<<8|readbuff[30];
    //all target
    uteModuleSprotData.todayTargetNotify.isTodayAllTargetHasNotify = readbuff[31];
    //exercise time
    uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetNotifyOpen = readbuff[32];
    uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetHasNotify = readbuff[33];
    uteModuleSprotData.todayTargetNotify.exerciseTimeTargetSetMin = readbuff[34] << 8 | readbuff[35];
}

/**
*@brief     保存目标数据
*@details
*@author        dengli.lu
*@date        2022-03-18
*/
void uteModuleSportSaveTodayTargetNotifyData(void)
{
    /*! 保存目标数据*/
    void *file;
    uint8_t writeBuff[36];
    memset(&writeBuff[0],0,sizeof(writeBuff));
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_TARGET_NOTIFY_DATA, &file, FS_O_RDONLY|FS_O_WRONLY|FS_O_CREAT))
    {
        //kcal step distance
        writeBuff[0] = (uteModuleSprotData.todayTargetNotify.todayKcalTarget>>8)&0xff;
        writeBuff[1] = (uteModuleSprotData.todayTargetNotify.todayKcalTarget)&0xff;
        writeBuff[2] = uteModuleSprotData.todayTargetNotify.isTodayKcalTargetNotifyOpen;
        writeBuff[3] = uteModuleSprotData.todayTargetNotify.isTodayKcalTargetHasNotify;
        writeBuff[4] = uteModuleSprotData.todayTargetNotify.isTodayStepTargetNotifyOpen;
        writeBuff[5] = (uteModuleSprotData.todayTargetNotify.todayDistanceTarget>>24)&0xff;
        writeBuff[6] = (uteModuleSprotData.todayTargetNotify.todayDistanceTarget>>16)&0xff;
        writeBuff[7] = (uteModuleSprotData.todayTargetNotify.todayDistanceTarget>>8)&0xff;
        writeBuff[8] = (uteModuleSprotData.todayTargetNotify.todayDistanceTarget)&0xff;
        writeBuff[9] = uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetNotifyOpen;
        writeBuff[10] = uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetHasNotify;
        //stand time
        writeBuff[11] = uteModuleSprotData.todayTargetNotify.isStandTimeTargetNotifyOpen;
        writeBuff[12] = uteModuleSprotData.todayTargetNotify.isStandTimeTargetHasNotify;
        writeBuff[13] = (uteModuleSprotData.todayTargetNotify.standTimeTargetSetMin>>8)&0xff;
        writeBuff[14] = (uteModuleSprotData.todayTargetNotify.standTimeTargetSetMin)&0xff;
        writeBuff[15] = (uteModuleSprotData.todayTargetNotify.currStandMin>>8)&0xff;
        writeBuff[16] = (uteModuleSprotData.todayTargetNotify.currStandMin)&0xff;
        writeBuff[17] = (uteModuleSprotData.todayTargetNotify.allMinStepCnt>>24)&0xff;
        writeBuff[18] = (uteModuleSprotData.todayTargetNotify.allMinStepCnt>>16)&0xff;
        writeBuff[19] = (uteModuleSprotData.todayTargetNotify.allMinStepCnt>>8)&0xff;
        writeBuff[20] = (uteModuleSprotData.todayTargetNotify.allMinStepCnt)&0xff;
        writeBuff[21] = (uteModuleSprotData.todayTargetNotify.lastMinStepCnt>>24)&0xff;
        writeBuff[22] = (uteModuleSprotData.todayTargetNotify.lastMinStepCnt>>16)&0xff;
        writeBuff[23] = (uteModuleSprotData.todayTargetNotify.lastMinStepCnt>>8)&0xff;
        writeBuff[24] = (uteModuleSprotData.todayTargetNotify.lastMinStepCnt)&0xff;
        writeBuff[25] = uteModuleSprotData.todayTargetNotify.standStartHour;
        writeBuff[26] = uteModuleSprotData.todayTargetNotify.standStartMin;
        //sport time
        writeBuff[27] = uteModuleSprotData.todayTargetNotify.isSportTimeTargetNotifyOpen;
        writeBuff[28] = uteModuleSprotData.todayTargetNotify.isSportTimeTargetHasNotify;
        writeBuff[29] = (uteModuleSprotData.todayTargetNotify.sportTimeTargetSetMin>>8)&0xff;
        writeBuff[30] = (uteModuleSprotData.todayTargetNotify.sportTimeTargetSetMin)&0xff;
        //all target
        writeBuff[31] = uteModuleSprotData.todayTargetNotify.isTodayAllTargetHasNotify;
        //exercise time
        writeBuff[32] = uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetNotifyOpen;
        writeBuff[33] = uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetHasNotify;
        writeBuff[34] = (uteModuleSprotData.todayTargetNotify.exerciseTimeTargetSetMin >> 8) & 0xff;
        writeBuff[35] = (uteModuleSprotData.todayTargetNotify.exerciseTimeTargetSetMin) & 0xff;
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&writeBuff[0],36);
        uteModuleFilesystemCloseFile(file);
    }
}
/**
*@brief  设置今日活动目标
*@details
*@param[in] ute_module_target_notify_data_t setTodayTarget  传入要设置今日活动参数的指针
*@author      dengli.lu
*@date       2022-03-08
*/
void uteModuleSportSetTodayTargetNotifyData(ute_module_target_notify_data_t setTodayTarget)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    if(setTodayTarget.todayDistanceTarget > 9999)
    {
        setTodayTarget.todayDistanceTarget = 9999;
    }
    if(setTodayTarget.todayKcalTarget > 9999)
    {
        setTodayTarget.todayKcalTarget = 9999;
    }
    memcpy(&uteModuleSprotData.todayTargetNotify, &setTodayTarget, sizeof(ute_module_target_notify_data_t));
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
/**
*@brief  获取今日活动目标
*@details
*@param[in] ute_module_target_notify_data_t *set  传入获取今日活动参数的指针
*@author      dengli.lu
*@date       2022-03-08
*/
void uteModuleSportGetTodayTargetNotifyData(ute_module_target_notify_data_t *todayTarget)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    memcpy(todayTarget,&uteModuleSprotData.todayTargetNotify, sizeof(ute_module_target_notify_data_t));
    if(uteModuleSystemtimeGetDistanceMiType())
    {
        todayTarget->todayDistanceTarget = todayTarget->todayDistanceTarget * 0.6213712f;
    }
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
/**
*@brief  获取今日活动目标
*@details
*@param[in] ute_module_target_notify_data_t *set  传入获取今日活动参数的指针
*@author      dengli.lu
*@date       2022-03-08
*/
void uteModuleSportProtocolGetTodayTargetNotifyData(ute_module_target_notify_data_t *todayTarget)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    memcpy(todayTarget,&uteModuleSprotData.todayTargetNotify, sizeof(ute_module_target_notify_data_t));
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
/**
*@brief     目标数据每秒处理函数
*@details
*@author        dengli.lu
*@date        2022-03-18
*/
void uteModuleSportTodayTargetHandler(void)
{
    if(!uteApplicationCommonIsPowerOn())
    {
        return;
    }
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    if (uteDrvBatteryCommonGetChargerStatus() == BAT_STATUS_NO_CHARGE)
    {
        uint16_t tempDistance = uteModuleSportGetCurrDayDistanceData();
        uint16_t curryDayKcal = uteModuleSportGetCurrDayKcalData();
        uint32_t currentDayTotleStepsCnt =0;
        uteModuleSportGetCurrDayStepCnt(&currentDayTotleStepsCnt,NULL,NULL);
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
        if(uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_CLOSE)
        {
            if(!uteModuleSportMoreSportsIsLessData())
            {
                if((time.sec == 59) && (time.min == 59))
                {
                    if((uteModuleSprotData.dailyActivity.everyHourAllSportStep[time.hour] + uteModuleSprotData.moreSportData.saveData.sportStep) > uteModuleSprotData.dailyActivity.sportChangeHourSteps)
                    {
                        uteModuleSprotData.dailyActivity.everyHourAllSportStep[time.hour] = uteModuleSprotData.dailyActivity.everyHourAllSportStep[time.hour] + uteModuleSprotData.moreSportData.saveData.sportStep - uteModuleSprotData.dailyActivity.sportChangeHourSteps;
                    }
                    if((uteModuleSprotData.dailyActivity.everyHourAllSportKcal[time.hour] + uteModuleSprotData.moreSportData.saveData.sportCaloire) > uteModuleSprotData.dailyActivity.sportChangeHourKcal)
                    {
                        uteModuleSprotData.dailyActivity.everyHourAllSportKcal[time.hour] = uteModuleSprotData.dailyActivity.everyHourAllSportKcal[time.hour] + uteModuleSprotData.moreSportData.saveData.sportCaloire - uteModuleSprotData.dailyActivity.sportChangeHourKcal;
                    }
                    uteModuleSprotData.dailyActivity.sportChangeHourSteps = uteModuleSprotData.moreSportData.saveData.sportStep;
                    uteModuleSprotData.dailyActivity.sportChangeHourKcal = uteModuleSprotData.moreSportData.saveData.sportCaloire;
                }
            }
        }
#endif
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"curryDayKcal=%d,tempDistance=%d,isStandTimeOpen =%d,currStandMin=%d.moreSportData.status=%d",curryDayKcal,tempDistance,
                       (uteModuleSprotData.todayTargetNotify.isStandTimeTargetNotifyOpen),uteModuleSprotData.todayTargetNotify.currStandMin,uteModuleSprotData.moreSportData.status);
        if(uteModuleSystemtimeGetDistanceMiType())
        {
            tempDistance = (float)tempDistance / 0.6213712f;//先转换为KM，在转换为米
        }
        //kcal notify
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
        if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_CLOSE)
        {
            curryDayKcal += uteModuleSprotData.moreSportData.saveData.sportCaloire;
        }
#endif
        if((curryDayKcal >= uteModuleSprotData.todayTargetNotify.todayKcalTarget)&&\
           (!uteModuleSprotData.todayTargetNotify.isTodayKcalTargetHasNotify)&&\
           (uteModuleSprotData.todayTargetNotify.isTodayKcalTargetNotifyOpen))
        {
            memset(&uteModuleSprotData.todayTargetNotify.todayTargetNotifyType,0,sizeof(ute_module_today_target_notify_type_t));
            uteModuleSprotData.todayTargetNotify.todayTargetNotifyType.isTodayKcalTargetNotify = true;
            uteModuleSprotData.todayTargetNotify.isTodayKcalTargetHasNotify = true;
#if UTE_MODULE_KCAL_TARGET_NOTIFY_SUPPORT
#if QUICK_SWITCH_GOAL_REACH_SUPPORT
            ute_quick_switch_t quick;
            uteApplicationCommonGetQuickSwitchStatus(&quick);
            if(quick.isGoalReach)
#endif
            {
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TARGET_COMPLETED_ID, 0, __func__); //目标达成
                sys_cb.cover_index = REMIND_COVER_GOAL;
                sys_cb.remind_tag = true;
                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
            }
#endif
        }
#if !APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uint32_t curryDayDistance = tempDistance;
        //distance notify
        if((curryDayDistance >= uteModuleSprotData.todayTargetNotify.todayDistanceTarget)&&\
           (!uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetHasNotify)&&\
           (uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetNotifyOpen))
        {
            memset(&uteModuleSprotData.todayTargetNotify.todayTargetNotifyType,0,sizeof(ute_module_today_target_notify_type_t));
            uteModuleSprotData.todayTargetNotify.todayTargetNotifyType.isTodayDistanceTargetNotify = true;
            uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetHasNotify = true;
#if UTE_MODULE_DISTANCE_TARGET_NOTIFY_SUPPORT
#if QUICK_SWITCH_GOAL_REACH_SUPPORT
            ute_quick_switch_t quick;
            uteApplicationCommonGetQuickSwitchStatus(&quick);
            if(quick.isGoalReach)
#endif
            {
                //uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TARGET_COMPLETED_ID, 0, __func__);
                sys_cb.cover_index = REMIND_COVER_GOAL;
                sys_cb.remind_tag = true;
                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
            }
#endif
        }
#endif
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        if ((!uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetHasNotify) && \
            (uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetNotifyOpen))
        {
            uint16_t curryDayExerciseTime = uteModuleSportGetCurrDayExerciseData() / 60;

            if (curryDayExerciseTime >= uteModuleSprotData.todayTargetNotify.exerciseTimeTargetSetMin)
            {
                memset(&uteModuleSprotData.todayTargetNotify.todayTargetNotifyType, 0, sizeof(ute_module_today_target_notify_type_t));
                uteModuleSprotData.todayTargetNotify.todayTargetNotifyType.isTodayExerciseTimeTargetNotify = true;
                uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetHasNotify = true;
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TARGET_COMPLETED_ID, 0, __func__); //目标达成
                sys_cb.cover_index = REMIND_COVER_GOAL;
                sys_cb.remind_tag = true;
                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME, UTE_MOTOR_INTERVAL_TIME, 2);
            }
        }
#endif
#if !APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        //stand time
        if(time.sec==59)
        {
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT&(!UTE_GUI_SCREEN_GET_SPORT_DATA_NEW_FUNC_SUPPORT)
            uint32_t currentDayTotleStepsCnt =0;
            uteModuleSportGetCurrDayStepCnt(&currentDayTotleStepsCnt,NULL,NULL);
            if(uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_CLOSE)
            {
                uteModuleSprotData.dailyActivity.everyHourAllSportStep[time.hour] = currentDayTotleStepsCnt;
                uteModuleSprotData.dailyActivity.everyHourAllSportKcal[time.hour] = curryDayKcal;
            }
            else
            {
                if(!uteModuleSportMoreSportsIsLessData())
                {
                    uteModuleSprotData.dailyActivity.everyHourAllSportStep[time.hour] = currentDayTotleStepsCnt + uteModuleSprotData.moreSportData.saveData.sportStep;
                    uteModuleSprotData.dailyActivity.everyHourAllSportKcal[time.hour] = curryDayKcal + uteModuleSprotData.moreSportData.saveData.sportCaloire;
                }
                else
                {
                    uteModuleSprotData.dailyActivity.everyHourAllSportStep[time.hour] = currentDayTotleStepsCnt;
                    uteModuleSprotData.dailyActivity.everyHourAllSportKcal[time.hour] = curryDayKcal;
                }
            }
#endif
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
            uint32_t totalStepCnt = 0;
            uteModuleSportGetCurrDayStepCnt(&totalStepCnt,NULL,NULL);
            uteModuleSprotData.todayTargetNotify.allMinStepCnt = totalStepCnt;
            if((uteModuleSprotData.moreSportData.status) && (!uteModuleSportMoreSportsIsLessData()))
            {
                uteModuleSprotData.todayTargetNotify.allMinStepCnt += uteModuleSprotData.moreSportData.saveData.sportStep;
            }
#endif
            if(uteModuleSprotData.todayTargetNotify.isStandTimeTargetNotifyOpen)
            {
                uteModuleSprotData.todayTargetNotify.currStandMin++;
                if(uteModuleSprotData.todayTargetNotify.allMinStepCnt < (uteModuleSprotData.todayTargetNotify.lastMinStepCnt + 15))
                {
                    if(uteModuleSprotData.todayTargetNotify.currStandMin==60)
                    {
                        if(uteModuleSprotData.todayTargetNotify.allMinStepCnt > (uteModuleSprotData.todayTargetNotify.lastMinStepCnt + 10))
                        {
                            uteModuleSprotData.dailyActivity.sedentarinessFlag = false;
                        }
                    }
                }
                else
                {
                    uteModuleSprotData.dailyActivity.sedentarinessFlag = false;
                }
                if(time.min == 59)  //整小时xx:59:59
                {
                    if(uteModuleSprotData.dailyActivity.sedentarinessFlag == false && uteModuleSprotData.todayTargetNotify.currStandMin == 60)
                    {
                        uteModuleSprotData.todayTargetNotify.standStartHour = time.hour;
                        uteModuleSprotData.todayTargetNotify.standStartMin = time.min;
                        uteModuleSprotData.todayTargetNotify.currStandMin = 60;
                        uteModuleSportSaveStandTimeData(uteModuleSprotData.todayTargetNotify.standStartHour,uteModuleSprotData.todayTargetNotify.standStartMin,uteModuleSprotData.todayTargetNotify.currStandMin);
                        //保存一次数据
                    }
                    uteModuleSprotData.todayTargetNotify.currStandMin = 0;
                    uteModuleSprotData.todayTargetNotify.standStartHour = time.hour;
                    uteModuleSprotData.todayTargetNotify.standStartMin = time.min;
                    uteModuleSprotData.dailyActivity.sedentarinessFlag = true;
                }
                if(!uteModuleSprotData.todayTargetNotify.isStandTimeTargetHasNotify)
                {
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT  //add pcm 2022+09-23 添加宏控制，防止其他项目编译不过
                    if(uteModuleSportGetCurrDayEveryHourStandTime()>=uteModuleSprotData.todayTargetNotify.standTimeTargetSetMin)
#endif
                    {
                        //提醒
#if !UTE_MODULE_RH281LX_DEBUG_SUPPORT
                        memset(&uteModuleSprotData.todayTargetNotify.todayTargetNotifyType,0,sizeof(ute_module_today_target_notify_type_t));
#endif
                        uteModuleSprotData.todayTargetNotify.todayTargetNotifyType.isTodayStandTimeTargetNotify = true;
                        uteModuleSprotData.todayTargetNotify.isStandTimeTargetHasNotify = true;
#if UTE_MODULE_STAND_TIME_TARGET_NOTIFY_SUPPORT
#if QUICK_SWITCH_GOAL_REACH_SUPPORT
                        ute_quick_switch_t quick;
                        uteApplicationCommonGetQuickSwitchStatus(&quick);
                        if(quick.isGoalReach)
#endif
                        {
                            uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TARGET_COMPLETED_ID, 0, __func__);
                            uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
                        }
#endif
                    }
                }
            }
            uteModuleSprotData.todayTargetNotify.lastMinStepCnt = uteModuleSprotData.todayTargetNotify.allMinStepCnt;
        }
        // sport time
        if((uteModuleSprotData.todayTargetNotify.isSportTimeTargetNotifyOpen)&&(!uteModuleSprotData.todayTargetNotify.isSportTimeTargetHasNotify))
        {
            if((uteModuleSprotData.todayTargetNotify.currentDayAllSportTimeSec/60)>=uteModuleSprotData.todayTargetNotify.sportTimeTargetSetMin)
            {
#if !UTE_MODULE_RH281LX_DEBUG_SUPPORT
                memset(&uteModuleSprotData.todayTargetNotify.todayTargetNotifyType,0,sizeof(ute_module_today_target_notify_type_t));
#endif
                uteModuleSprotData.todayTargetNotify.todayTargetNotifyType.isTodaySportTimeTargetNotify = true;
                uteModuleSprotData.todayTargetNotify.isSportTimeTargetHasNotify = true;
#if UTE_MODULE_STAND_TIME_TARGET_NOTIFY_SUPPORT
#if QUICK_SWITCH_GOAL_REACH_SUPPORT
                ute_quick_switch_t quick;
                uteApplicationCommonGetQuickSwitchStatus(&quick);
                if(quick.isGoalReach)
#endif
                {
                    uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TARGET_COMPLETED_ID, 0, __func__);
                    uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
                }
#endif
            }
        }
        //all target
        if((!uteModuleSprotData.todayTargetNotify.isTodayAllTargetHasNotify)&&\
           uteModuleSprotData.todayTargetNotify.isTodayKcalTargetHasNotify &&\
           uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetHasNotify &&\
           uteModuleSprotData.todayTargetNotify.isStandTimeTargetHasNotify &&\
           uteModuleSprotData.todayTargetNotify.isSportTimeTargetHasNotify &&\
           uteModuleSprotData.isTargetCompleted)
        {
#if !UTE_MODULE_RH281LX_DEBUG_SUPPORT
            memset(&uteModuleSprotData.todayTargetNotify.todayTargetNotifyType,0,sizeof(ute_module_today_target_notify_type_t));
#endif
            uteModuleSprotData.todayTargetNotify.todayTargetNotifyType.isTodayAllTargetNotify = true;
            uteModuleSprotData.todayTargetNotify.isTodayAllTargetHasNotify = true;
#if UTE_MODULE_ALL_TARGET_NOTIFY_SUPPORT
#if QUICK_SWITCH_GOAL_REACH_SUPPORT
            ute_quick_switch_t quick;
            uteApplicationCommonGetQuickSwitchStatus(&quick);
            if(quick.isGoalReach)
#endif
            {
                uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_TARGET_COMPLETED_ID, 0, __func__);
                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
            }
#endif
        }
#endif
#if 0
        if(uteModuleSportMoreSportGetStatus() == ALL_SPORT_STATUS_CONTINUE || uteModuleSportMoreSportGetStatus() == ALL_SPORT_STATUS_OPEN)
        {
            if((((uteModuleSprotData.moreSportData.totalSportTime % 3600) / 60 >= uteModuleSportTargetGetTimeGoal() /60) &&uteModuleSportTargetGetTimeGoal() != 0) && (uteModuleSportTargetGetIsNoTarget() == SPORT_TARGET_TIME_SET))
            {
                if(!uteModuleSportTargetGetTimeGoalNotify())
                {
                    uteModuleSportTargetSetTimeGoalNotify(true);
                    sys_cb.cover_index = REMIND_SPORT_TIME_TARGET;
                    sys_cb.remind_tag = true;
                    uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);

                }
            }
            else if(((uteModuleSprotData.moreSportData.saveData.sportCaloire >= uteModuleSportTargetGetKcalGoal() ) &&uteModuleSportTargetGetKcalGoal() != 0) && (uteModuleSportTargetGetIsNoTarget() == SPORT_TARGET_KCAL_SET))
            {
                if(!uteModuleSportTargetGetKcalGoalNotify())
                {
                    uteModuleSportTargetSetKcalGoalNotify(true);
                    sys_cb.cover_index = REMIND_SPORT_KCAL_TARGET;
                    sys_cb.remind_tag = true;
                }
            }
            else if((uteModuleSprotData.moreSportData.saveData.sportDistanceInteger * 1000 + uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals *10) >= uteModuleSportTargetGetDistanceGoal() &&uteModuleSportTargetGetDistanceGoal() > 4)
            {
                if(!uteModuleSportTargetGetDistanceGoalNotify())
                {
                    uteModuleSportTargetSetDistanceGoalNotify(true);
                    sys_cb.cover_index = REMIND_SPORT_DANST_TARGET;
                    sys_cb.remind_tag = true;
                }
            }
            else if(uteModuleSprotData.moreSportData.saveData.sportDistanceInteger / 1000 > 0 && (uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals % 1000 / 10 == 0) \
                    && (uteModuleSprotData.moreSportData.totalSportTime / 60 == 0))
            {
                uteModuleSportTargetSetOneHourNotify(true);
            }

            else if(uteModuleSprotData.moreSportData.totalSportTime > 0 && (uteModuleSprotData.moreSportData.saveData.sportDistanceInteger > 0) \
                    && (uteModuleSprotData.moreSportData.lastKM != uteModuleSprotData.moreSportData.saveData.sportDistanceInteger))
            {
                uteModuleSportTargetSetOneKmNotify(true);
                uteModuleSprotData.moreSportData.lastKM = uteModuleSprotData.moreSportData.saveData.sportDistanceInteger;

            }


            if(uteModuleSportTargetGetOneHourNotify())
            {
                uteModuleSportTargetSetOneHourNotify(false);
                uteModuleSprotData.moreSportData.increaseKcal = uteModuleSprotData.moreSportData.saveData.sportCaloire - uteModuleSprotData.moreSportData.lastKcal;
                uteModuleSprotData.moreSportData.lastKcal = uteModuleSprotData.moreSportData.saveData.sportCaloire;

                sys_cb.cover_index = REMIND_SPORT_LAST_KCAL;
                sys_cb.remind_tag = true;
                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);

            }
            else if(uteModuleSportTargetGetOneKmNotify())
            {
                uteModuleSportTargetSetOneKmNotify(false);
                uint32_t pastTime = uteModuleSprotData.moreSportData.totalSportTime - uteModuleSprotData.moreSportData.lasttotalSportTime;
                uteModuleSprotData.moreSportData.lastKMPaceMinute = pastTime / 60;
                uteModuleSprotData.moreSportData.lastKMPaceSecond = pastTime % 60;
                uteModuleSprotData.moreSportData.lasttotalSportTime = uteModuleSprotData.moreSportData.totalSportTime;

                sys_cb.cover_index = REMIND_SPORT_LAST_SPEED;
                sys_cb.remind_tag = true;
                uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
            }
        }
#endif
    }
    if((time.hour==0)&&(time.min==0)&&(time.sec==0))
    {
        uteModuleSprotData.todayTargetNotify.isTodayKcalTargetHasNotify = false;
        uteModuleSprotData.todayTargetNotify.isTodayDistanceTargetHasNotify = false;
        uteModuleSprotData.todayTargetNotify.isTodayAllTargetHasNotify = false;
        uteModuleSprotData.todayTargetNotify.isStandTimeTargetHasNotify = false;
        uteModuleSprotData.todayTargetNotify.isSportTimeTargetHasNotify = false;
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        uteModuleSprotData.todayTargetNotify.isExerciseTimeTargetHasNotify = false;
#endif
        uteModuleSprotData.todayTargetNotify.currStandMin = 0;
        uteModuleSprotData.todayTargetNotify.standStartHour = time.hour;
        uteModuleSprotData.todayTargetNotify.standStartMin = time.min;
        uteModuleSprotData.dailyActivity.sedentarinessFlag = true;
        memset(uteModuleSprotData.dailyActivity.everyHourAllSportStep,0x00,24*4);
        memset(uteModuleSprotData.dailyActivity.everyHourAllSportKcal,0x00,24*2);
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
        memset(&uteModuleSprotData.dailyActivity.everyHourExerciseTime[0], 0, 24);
#endif
        uteModuleSprotData.todayTargetNotify.lastMinStepCnt = uteModuleSprotData.todayTargetNotify.allMinStepCnt = 0;
    }
}

/**
*@brief      保存当前站立时长数据
*@details    每天保存一个文件，前面4个byte为年月日，后面每4个byte为一个小时的数据（参考协议的数据格式）
*@author     casen
*@date       2022-07-14
*/
void uteModuleSportSaveStandTimeData(uint8_t standStartHour,uint8_t standStartMin,uint8_t currStandMin)
{
    /*! 没有连接过APP不保存数据 xjc, 2022-05-06  */
    if(!uteApplicationCommonIsHasConnectOurApp())
    {
        return;
    }
    uint16_t buffSize = 4;
    uint8_t *writeBuff = uteModulePlatformMemoryAlloc(buffSize);
    uint8_t path[40];
    memset(&writeBuff[0],0,buffSize);
    memset(&path[0],0,40);
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    sprintf((char *)&path[0],"%04d%02d%02d",time.year,time.month,time.day);
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA, dirInfo, NULL);
    if((dirInfo->filesCnt>=UTE_MODULE_SPORT_STANDTIME_SAVE_DATA_MAX_DAYS)&&(memcmp(&path[0],&dirInfo->filesName[0][0],8)!=0))
    {
        /*! 删除最旧一天的数据zn.zeng, 2021-08-23  */
        memset(&path[0],0,40);
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA,&dirInfo->filesName[0][0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__,&path[0]);
        uteModuleFilesystemDelFile((char *)&path[0]);
    }
    memset(&path[0],0,40);
    sprintf((char *)&path[0],"%s/%04d%02d%02d",UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA,time.year,time.month,time.day);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt=%d", __func__,dirInfo->filesCnt);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,save file=%s", __func__,&path[0]);
    /*! 保存当前数据zn.zeng, 2021-08-23  */
    void *file;

    writeBuff[0] = standStartHour;
    writeBuff[1] = standStartMin;
    writeBuff[2] = currStandMin>>8&0xff;
    writeBuff[3] = currStandMin&0xff;

    if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_WRONLY|FS_O_CREAT))
    {
        int32_t size = uteModuleFilesystemGetFileSize(file);
        UTE_MODULE_LOG(UTE_LOG_SLEEP_LVL, "%s,size=%d", __func__, size);
        if((size+buffSize)<=(4*24)) //防止跳转日期反复存储
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_END);  //在文件末尾添加数据
            uteModuleFilesystemWriteData(file,&writeBuff[0],buffSize);
            uteModuleFilesystemCloseFile(file);
        }
    }
    uteModulePlatformMemoryFree(writeBuff);
    uteModulePlatformMemoryFree(dirInfo);
}
/**
*@brief      开始发送站立时长数据
*@details
*@author     casen
*@date       2022-07-14
*/
void uteModuleSportSendStandTimeHistoryData(void)
{
    ute_application_sync_data_param_t *sendParam;
    uteApplicationCommonGetSyncDataParam(&sendParam);
    uint8_t sendBuff[247];
    memset(&sendBuff[0], 0, 247);
    sendBuff[0] = CMD_TODAY_TARGET_CTRL;
    sendBuff[1] = 0x01;
    sendBuff[2] = 0x02;
    uint16_t mtu = uteApplicationCommonGetMtuSize();
    void *file;
    uint8_t path[40];
    memset(&path[0],0,40);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendParam->currSendFileIndex=%d , sendParam->dirInfo.filesCnt = %d", __func__,sendParam->currSendFileIndex,sendParam->dirInfo.filesCnt);
    if(sendParam->currSendFileIndex<sendParam->dirInfo.filesCnt)
    {
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA,&sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,path file=%s", __func__,&path[0]);
        if( uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_END);
            sendParam->currSendFileSize = uteModuleFilesystemGetFileSize(file);
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,sendParam->currSendFileSize =%d", __func__,sendParam->currSendFileSize );
            uint32_t numDate; //yyyymmnn
            numDate = atoi((const char *)&sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
            //year
            sendBuff[3] = (numDate/10000)>>8&0xff;
            sendBuff[4] = (numDate/10000)&0xff;
            //month
            sendBuff[5] = ((numDate%10000)/100)&0xff;
            //day
            sendBuff[6] = (numDate%100)&0xff;
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemReadData(file,&sendBuff[7],sendParam->currSendFileSize);
            uteModuleFilesystemCloseFile(file);
            uteModuleProfileBle50SendToPhone(&sendBuff[0], 7+sendParam->currSendFileSize);
            for(uint8_t j=0; j<(7+sendParam->currSendFileSize); j++)
            {
                sendParam->crc ^=sendBuff[j];
            }
        }
        sendParam->currSendFileIndex ++;
    }
    else
    {
        uteApplicationCommonSyncDataTimerStop();
        sendBuff[3] = 0xfa;
        sendBuff[4] = sendParam->crc;
        uteModuleProfileBleSendToPhone(&sendBuff[0], 5);
    }
}
/**
*@brief        准备开始发送计步数据
*@details
*@param[in]  需要同步的数据时间戳
*@author     casen
*@date       2022-07-14
*/
void uteModuleSportStartSendStandTimeHistoryData(void)
{
    ute_application_sync_data_param_t *param;
    uteApplicationCommonGetSyncDataParam(&param);
    param->crc = 0;
    param->currSendFileIndex = 0;
    param->currSendFileSize = 0;
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA, &param->dirInfo, NULL);
    uteApplicationCommonRegisterSyncDataTimerFunction(uteModuleSportSendStandTimeHistoryData);
    uteApplicationCommonSyncDataTimerStart();
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,", __func__);
}

#endif

#if UTE_MODULE_SPORTS_HSTORY_RECORD_SUPPORT
/**
*@brief  读取运动历史记录
*@details
*@author      dengli.lu
*@date       2022-06-25
*/
void uteModuleSportReadHistoryRecordData(void)
{
    void *file=NULL;
    uint8_t readbuff[SPORTS_HEAD_DATAS_LENGTH];
    memset(&readbuff[0],0,sizeof(readbuff));
    uint8_t path[30];
    memset(&path[0],0,sizeof(path));
    memset(&uteModuleSprotData.sportsHistoryRecord,0,sizeof(uteModuleSprotData.sportsHistoryRecord));
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, dirInfo, NULL);
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    uint8_t vailCnt = 0;
    int diffday = 0;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uteModuleSprotData.recentTotalTime = 0;
    uteModuleSprotData.recentTotalKcal = 0;
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt = %d,", __func__,dirInfo->filesCnt);
    for(uint8_t i = dirInfo->filesCnt; i > 0; i--)
    {
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&dirInfo->filesName[i-1][0]);
        if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
        {
            uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
            uteModuleFilesystemReadData(file,&readbuff[0],SPORTS_HEAD_DATAS_LENGTH);
            uteModuleFilesystemCloseFile(file);
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startInterval = readbuff[0];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].sportsType = readbuff[1];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.year = (readbuff[2]<<8|readbuff[3]);
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.month = readbuff[4];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.day = readbuff[5];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.hour = readbuff[6];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.min = readbuff[7];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.sec = readbuff[8];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].stopSportTime.hour = (readbuff[13]<<16|readbuff[14]<<8|readbuff[15])/3600;//用于表示运动时长的小时
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].stopSportTime.min = (readbuff[13]<<16|readbuff[14]<<8|readbuff[15])%3600/60;//用于表示运动时长的分钟
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].stopSportTime.sec = (readbuff[13]<<16|readbuff[14]<<8|readbuff[15])%60;//用于表示运动时长的秒
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].sportStep = (readbuff[16]<<24|readbuff[17]<<16|readbuff[18]<<8|readbuff[19]);
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].sportTimes = (readbuff[20]<<8|readbuff[21]);
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].sportCaloire = (readbuff[22]<<8|readbuff[23]);
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].sportDistanceInteger = readbuff[24];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].sportDistanceDecimals = readbuff[25];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].avgHeartRate = readbuff[26];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].maxHeartRate = readbuff[27];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].minHeartRate = readbuff[28];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].avgTimeMinute = readbuff[29];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].avgTimeSecond = readbuff[30];
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].hrWarmupCnt = (readbuff[33] << 16) | (readbuff[34] << 8) | readbuff[35];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].hrWeightReductionCnt = (readbuff[36] << 16) | (readbuff[37] << 8) | readbuff[38];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].hrEnduranceCnt = (readbuff[39] << 16) | (readbuff[40] << 8) | readbuff[41];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].hrAnaerobicCnt = (readbuff[42] << 16) | (readbuff[43] << 8) | readbuff[44];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].hrExtremeCnt = (readbuff[45] << 16) | (readbuff[46] << 8) | readbuff[47];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].avgStepfrequency = readbuff[48];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].maxStepfrequency = readbuff[49];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].minStepfrequency = readbuff[50];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].maxTimeMinute = readbuff[51];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].maxTimeSecond = readbuff[52];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].minTimeMinute = readbuff[53];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].minTimeSecond = readbuff[54];
            uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].totalTime = (readbuff[13] << 16) | (readbuff[14] << 8) | readbuff[15];
#endif
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT

            diffday = uteModuleSystemtimeGetDiffDay(uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.year,\
                                                    uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.month,\
                                                    uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].startSportTime.day,\
                                                    time.year, time.month, time.day);
            if (diffday >= 0 && diffday <= 6)
            {
                uteModuleSprotData.recentTotalTime += ((readbuff[13] << 16) | (readbuff[14] << 8) | readbuff[15]);
                uteModuleSprotData.recentTotalKcal += uteModuleSprotData.sportsHistoryRecord.oneHistoryRecordData[vailCnt].sportCaloire;
            }
#endif
            vailCnt ++;
        }
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,vailCnt = %d,", __func__,vailCnt);
    uteModuleSprotData.sportsHistoryRecord.sportsHistoryRecordTotalCnt = vailCnt;
    uteModulePlatformGiveMutex(uteModuleSprotMute);
    uteModulePlatformMemoryFree(dirInfo);
}
/**
*@brief     获取运动历史数据
*@details
*@author      dengli.lu
*@date       2022-06-25
*/
void uteModuleSportsHistoryRecordGetData(ute_module_sports_record_data_t *data)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    memcpy(data,&uteModuleSprotData.sportsHistoryRecord,sizeof(ute_module_sports_record_data_t));
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}

/**
*@brief     设置运动历史数据标志（在历史记录界面进入设置）
*@details
*@author      pcm
*@date       2022-010-15
*/
void uteModuleSportsHistoryRecordSetIsHistoryRecordData(bool IsHistoryRecordData)
{

    uteModuleSprotData.sportsHistoryRecord.IsHistoryRecordData=IsHistoryRecordData;

}
/**
*@brief     获取运动历史数据标志（在历史记录界面进入设置）
*@details
*@author      pcm
*@date       2022-010-15
*/
bool uteModuleSportsHistoryRecordGetIsHistoryRecordData(void)
{

    return uteModuleSprotData.sportsHistoryRecord.IsHistoryRecordData;

}

/**
*@brief        获取存在记录的总条数
*@details
*@return uint8_t
*@author      dengli.lu
*@date       2022-06-25
*/
uint8_t uteModuleSportsHistoryGetRecordTotalCnt(void)
{
    return uteModuleSprotData.sportsHistoryRecord.sportsHistoryRecordTotalCnt;
}
/**
*@brief     设置运动历史记录显示索引
*@details
*@author      dengli.lu
*@date       2022-06-25
*/
void uteModuleSportsSetHistoryRecordDisplayIndex(uint8_t displayIndex)
{
    uteModuleSprotData.sportsHistoryRecord.displayIndex = displayIndex;
}
/**
*@brief        获取存在记录的总时长
*@details
*@return uint8_t
*@author      wuhuowang
*@date       2022-12-05
*/
uint32_t uteModuleSportsHistoryGetRecordTotalTime(void)
{
    return uteModuleSprotData.recentTotalTime;
}
/**
*@brief        获取存在记录的总消耗
*@details
*@return uint8_t
*@author      wuhuowang
*@date       2022-12-05
*/
uint32_t uteModuleSportsHistoryGetRecordTotalKcal(void)
{
    return uteModuleSprotData.recentTotalKcal;
}
#endif

#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
/**
*@brief  读取运动当天每小时的运动时长
*@details  totalSportMinSec:当天总的运动时长
*@author   casen
*@date     2022-07-13
*/
uint32_t uteModuleSportGetCurrDayEveryHourSportTime(void)
{
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    return 0;
#else
    void *file=NULL;
    uint32_t totalSportMinSec = 0;
    uint8_t readbuff[33];
    memset(&readbuff[0],0,sizeof(readbuff));
    uint8_t path[30];
    memset(&path[0],0,sizeof(path));
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, dirInfo, NULL);
    //清空数据
    memset(uteModuleSprotData.dailyActivity.everyHourSportTime,0x00,sizeof(uteModuleSprotData.dailyActivity.everyHourSportTime[0])*24);

    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uint8_t currDayPath[12];
    memset(&currDayPath[0],0,12);
    sprintf((char *)&currDayPath[0],"%04d%02d%02d",time.year,time.month,time.day);

    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt = %d,", __func__,dirInfo->filesCnt);
    for(uint8_t i = dirInfo->filesCnt; i > 0; i--)
    {
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&dirInfo->filesName[i-1][0]);
        if(memcmp(&currDayPath[0],&path[11],8) == 0)  //currDay
        {
            if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
            {
                uint32_t sportTime = 0;
                uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
                uteModuleFilesystemReadData(file,&readbuff[0],33);
                uteModuleFilesystemCloseFile(file);
                sportTime = (uint32_t)readbuff[13]<<16|readbuff[14]<<8|readbuff[15];
                (totalSportMinSec) += sportTime;
                uint8_t startSportHour = readbuff[6],startSportMin = readbuff[7];
                if(startSportHour<24)
                {
                    uint16_t sportTimeMin = (sportTime/60);
                    if((startSportMin + sportTimeMin)>60)
                    {
                        uint16_t tempMin = 60 - startSportMin ;
                        uteModuleSprotData.dailyActivity.everyHourSportTime[startSportHour] += tempMin;
                        sportTimeMin = sportTimeMin - tempMin;
                        uint8_t i = 1;
                        while(sportTimeMin  > 60)
                        {
                            //跨天的数据不处理
                            if((startSportHour+i)<24)
                            {
                                uteModuleSprotData.dailyActivity.everyHourSportTime[startSportHour+i] += 60;
                            }
                            sportTimeMin -= 60;
                            i++;
                        }
                        //跨天的数据不处理
                        if((startSportHour+i)<24)
                        {
                            uteModuleSprotData.dailyActivity.everyHourSportTime[startSportHour+i] += sportTimeMin;
                        }
                    }
                    else
                    {
                        uteModuleSprotData.dailyActivity.everyHourSportTime[startSportHour] += sportTimeMin;
                    }
                }
            }
        }
    }
    uteModulePlatformMemoryFree(dirInfo);
    return totalSportMinSec;
#endif
}

/**
*@brief      获取当天每个小时的卡路里
*@details
*@author     casen
*@date       2022-07-13
*/
uint16_t uteModuleSportGetCurrDayEveryHourKcal(void)
{
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    return 0;
#else
    uint16_t kcal=0;
    float distance_Step,distance_Run;
    float kcli_Step,kcli_Run,kcli;
    ute_personal_info_t personal;
    uteApplicationCommonGetPersonalInfo(&personal);
    memset(uteModuleSprotData.dailyActivity.everyHourKcal,0x00,sizeof(uteModuleSprotData.dailyActivity.everyHourKcal[0])*24);
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleCwmGetCurrEveryHourKcalData(&uteModuleSprotData.dailyActivity.everyHourKcal[0]);
#else
    for(uint8_t i=0; i<24; i++)
    {
        if(personal.isMan)
        {
            distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.dailyActivity.everyHourWalkStep[i]))*0.00001f*0.4102670f);
            distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.dailyActivity.everyHourRunStep[i]))*0.00001f*0.5461055f);

            kcli_Step = (float)(distance_Step*personal.weight/1000.0f*0.5907296f);
            kcli_Run =  (float)(distance_Run*personal.weight/1000.0f*0.9288487f);
        }
        else
        {
            distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.dailyActivity.everyHourWalkStep[i]))*0.00001f*0.4151582f);
            distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.dailyActivity.everyHourRunStep[i]))*0.00001f*0.5047813f);

            kcli_Step = (float)(distance_Step*personal.weight/1000.0f*0.7918928f);
            kcli_Run = (float)(distance_Run*personal.weight/1000.0f*1.234930f);
        }
        kcli_Step = ExactDecimalPoint(kcli_Step,1);
        kcli_Run = ExactDecimalPoint(kcli_Run,1);
        kcli = ExactDecimalPoint((kcli_Step+kcli_Run),2);
        kcal = (uint16_t)(kcli*1.0f);
        uteModuleSprotData.dailyActivity.everyHourKcal[i] = kcal;
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,everyHourKcal[%d] = %d,", __func__,uteModuleSprotData.dailyActivity.everyHourKcal[i],i);
    }
#endif
    if(kcal>9999)
    {
        kcal = 9999;
    }
    return kcal;
#endif
}
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
/**
*@brief      获取当天每个小时的站立时长数据
*@details   1）读取当天每个小时的数据，并缓存到全局变量值中；
            2）返回值是当天的站立时长，每次是60分钟，如果要显示次数，需要除以60即可得到次数
*@return    当天站立时长，单位分钟
*@author     casen
*@date       2022-07-13
*/
uint16_t uteModuleSportGetCurrDayEveryHourStandTime(void)
{
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    return 0;
#else
    uint16_t totalStandTimeMin= 0;
    void *file=NULL;
    uint8_t readbuff[4*24];
    memset(&readbuff[0],0,sizeof(readbuff));
    uint8_t path[30];
    memset(&path[0],0,sizeof(path));
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uint8_t currDayPath[8];
    memset(&currDayPath[0],0,8);
    sprintf((char *)&currDayPath[0],"%04d%02d%02d",time.year,time.month,time.day);
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA, dirInfo, NULL);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,uteModuleSprotMute = 0x%d,", __func__,uteModuleSprotMute);
    //清空数据
    memset(uteModuleSprotData.dailyActivity.everyHourStandTime,0x00,sizeof(uteModuleSprotData.dailyActivity.everyHourStandTime[0])*24);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt = %d,", __func__,dirInfo->filesCnt);
    for(uint8_t i = dirInfo->filesCnt; i > 0; i--)
    {
        uint32_t fileSize = 0;
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_STAND_TIME_DATA,&dirInfo->filesName[i-1][0]);
        if(memcmp(&currDayPath[0],&dirInfo->filesName[i-1][0],8) == 0)  //currDay
        {
            if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
            {
                uteModuleFilesystemSeek(file,0,FS_SEEK_END);
                fileSize = uteModuleFilesystemGetFileSize(file);

                uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
                uteModuleFilesystemReadData(file,&readbuff[0],fileSize);
                uteModuleFilesystemCloseFile(file);
            }
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,fileSize = %d,", __func__,fileSize);
            for(uint8_t j=0; j<(fileSize/4); j++)
            {
                if(readbuff[0+j*4]<24)
                {
                    uteModuleSprotData.dailyActivity.everyHourStandTime[readbuff[0+j*4]] += (readbuff[2+j*4]<<8|readbuff[3+j*4]);
                    if((uteModuleSprotData.dailyActivity.everyHourStandTime[readbuff[0+j*4]]!=0) &&(uteModuleSprotData.dailyActivity.everyHourStandTime[readbuff[0+j*4]] !=0xffff))
                    {
                        totalStandTimeMin +=60;
                    }
                }
            }
        }
    }
    uteModulePlatformMemoryFree(dirInfo);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,totalStandTimeMin=%d", __func__,totalStandTimeMin);
    return totalStandTimeMin;
#endif
}
#endif
/**
*@brief     读取每小时所有运动的步数数据
*@details   开机的时候读取flash里面的保存数据
*@author    casen
*@date      2022-07-14
*/
void uteModuleSportReadTodayEveryHourAllSportStepData(void)
{
#if !APP_GUI_SCREEN_SHOW_ACTIVITY_HOURS_SUPPORT
    void *file;
    if(uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_ALLSPORT_STEP_DATA,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&uteModuleSprotData.dailyActivity.everyHourAllSportStep[0],24*4);
        uteModuleFilesystemCloseFile(file);
    }
#if UTE_LOG_STEP_LVL
    for(uint8_t i=0; i<6; i++)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,read everyHourAllSportStep =%d,%d,%d,%d",__func__, uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4],uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+1], \
                       uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+2],uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+3]);
    }
#endif
#endif
}

/**
*@brief     保存每小时所有运动步数数据
*@details   关机的时候，保存数据到flash
*@author     casen
*@date        2022-07-14
*/
void uteModuleSportSaveTodayEveryHourAllSportStepData(void)
{
#if !APP_GUI_SCREEN_SHOW_ACTIVITY_HOURS_SUPPORT
    /*! 保存目标数据*/
    void *file;
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_ALLSPORT_STEP_DATA, &file, FS_O_RDONLY|FS_O_WRONLY|FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&uteModuleSprotData.dailyActivity.everyHourAllSportStep[0],24*4);
        uteModuleFilesystemCloseFile(file);
    }
#if UTE_LOG_STEP_LVL
    for(uint8_t i=0; i<6; i++)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,read everyHourAllSportStep =%d,%d,%d,%d",__func__, uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4],uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+1], \
                       uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+2],uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+3]);
    }
#endif
#endif
}

/**
*@brief     读取每小时所有运动的卡路里数据
*@details
*@author    casen
*@date      2022-07-14
*/
void uteModuleSportReadTodayEveryHourAllSportKcalData(void)
{
#if !APP_GUI_SCREEN_SHOW_ACTIVITY_HOURS_SUPPORT
    void *file;
    if(uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_ALLSPORT_KCAL_DATA,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&uteModuleSprotData.dailyActivity.everyHourAllSportKcal[0],24*2);
        uteModuleFilesystemCloseFile(file);
    }
#endif
}

/**
*@brief     读取一天的所有步数，包括多运动的
*@details
*@param[in] ute_module_systemtime_time_t time, 读取的时间
*@return uint32_t 返回总步数
*@author        zn.zeng
*@date        2022-09-02
*/
uint32_t uteModuleSportReadAllStepWithTime(ute_module_systemtime_time_t time)
{
    uint32_t totalStep = 0;
    void *file;
    uint8_t path[30];
    uint16_t buffSize = 12 * 24 + 4;
    uint8_t *readBuff = uteModulePlatformMemoryAlloc(buffSize);
    memset(&path[0], 0, 30);
    sprintf((char *)&path[0], "%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_STEP_DIR, time.year, time.month, time.day);
    // read
    if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &readBuff[0], buffSize);
        uteModuleFilesystemCloseFile(file);
        for (uint8_t i = 0; i < 24; i++)
        {
            uint32_t tmpTotal = (readBuff[4 + i * 12] << 8 | readBuff[4 + i * 12 + 1]);
            totalStep += tmpTotal;
        }
    }
    uteModulePlatformMemoryFree(readBuff);
    ute_sports_today_with_step_data_t moreStep;
    moreStep.step = 0;
    uteModuleSportReadTodayAllSportDataConfig(time,&moreStep,NULL);
    totalStep = totalStep + moreStep.step;
    return totalStep;
}
/**
*@brief     读取一周内每天的总计步数据
*@details
*@author        zn.zeng
*@date        2022-08-19
*/
void uteModuleSportReadWeekDayStep(void)
{
#if !APP_GUI_SCREEN_SHOW_RECENT_DAYS_SUPPORT
    ute_module_systemtime_time_t time;
    ute_module_systemtime_time_t readTime;
    uteModuleSystemtimeGetTime(&time);
    memset(&uteModuleSprotData.dailyActivity.weekDayTotalStep[0],0,28);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,%04d%02d%02d,week=%d",__func__,time.year,time.month,time.day,time.week);
    for (uint8_t i = 0; i <= time.week; i++)
    {
        memcpy(&readTime,&time,sizeof(ute_module_systemtime_time_t));
        uteModuleSystemtimeInputDateIncreaseDecreaseDay(&readTime,i-time.week);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,readTime,%04d%02d%02d,week=%d",__func__,readTime.year,readTime.month,readTime.day,readTime.week);
        uteModuleSprotData.dailyActivity.weekDayTotalStep[i] = uteModuleSportReadAllStepWithTime(readTime);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,weekDayTotalStep[%d]=%d",__func__,i,uteModuleSprotData.dailyActivity.weekDayTotalStep[i]);
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,finish",__func__);
#endif
}
/**
*@brief     保存每小时所有卡路里步数数据
*@details
*@author        dengli.lu
*@date        2022-03-18
*/
void uteModuleSportSaveTodayEveryHourAllSportKcalData(void)
{
#if !APP_GUI_SCREEN_SHOW_ACTIVITY_HOURS_SUPPORT
    /*! 保存目标数据*/
    void *file;
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SPORT_TODAY_EVERYHOUR_ALLSPORT_KCAL_DATA, &file, FS_O_RDONLY|FS_O_WRONLY|FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&uteModuleSprotData.dailyActivity.everyHourAllSportKcal[0],24 * 2);
        uteModuleFilesystemCloseFile(file);
    }
#endif
}
/**
*@brief     加载今日活动每个小时的步数柱状图
*@details
*@param[out] uint32_t everyHourStep[24] 当天每小时步数
*@return  uint32_t  当天最大数据的整1000倍数据，如2300，返回3000，最小返回1000
*@author      dengli.lu
*@date       2022-07-14
*/
uint32_t uteModuleSportLoadTodayEveryHourStepHistoryData(uint32_t *everyHourStep)
{
    //step graph
    uint32_t maxStep = 0,everySportStep = 0;
    uint32_t intStep1000 = 0;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    memset(&everyHourStep[0], 0, 24 * sizeof(uint32_t));
    for(uint8_t i = 0; i < 24; i++)
    {
        everySportStep = 0;
        if(i > time.hour)
        {
            break;
        }
#if UTE_GUI_SCREEN_GET_SPORT_DATA_NEW_FUNC_SUPPORT
        everySportStep = uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[i];
        if ((uteModuleSprotData.dailyActivity.everyHourRunStep[i] + uteModuleSprotData.dailyActivity.everyHourWalkStep[i] + everySportStep) > maxStep)
        {
            maxStep = uteModuleSprotData.dailyActivity.everyHourRunStep[i] + uteModuleSprotData.dailyActivity.everyHourWalkStep[i] + everySportStep;
        }
#else
        if(i == 0)
        {
            everySportStep = uteModuleSprotData.dailyActivity.everyHourAllSportStep[0];
        }
        else
        {
            if(uteModuleSprotData.dailyActivity.everyHourAllSportStep[i] > uteModuleSprotData.dailyActivity.everyHourAllSportStep[i-1])
            {
                everySportStep = uteModuleSprotData.dailyActivity.everyHourAllSportStep[i] - uteModuleSprotData.dailyActivity.everyHourAllSportStep[i-1];
            }
        }
        if((everySportStep + uteModuleSprotData.dailyActivity.everyHourRunStep[i] + uteModuleSprotData.dailyActivity.everyHourWalkStep[i]) > maxStep)
        {
            maxStep = everySportStep + uteModuleSprotData.dailyActivity.everyHourRunStep[i] + uteModuleSprotData.dailyActivity.everyHourWalkStep[i];
        }
#endif
        if(maxStep > 99999)
        {
            maxStep = 99999;
        }
        // UTE_MODULE_LOG(1, "%s,everySportStep[%d] = %d,.everyHourRunStep = %d,.everyHourWalkStep = %d", __func__, i, everySportStep, uteModuleSprotData.dailyActivity.everyHourRunStep[i], uteModuleSprotData.dailyActivity.everyHourWalkStep[i]);
    }
    // UTE_MODULE_LOG(1,"%s,maxStep = %d",__func__,maxStep);
    if(maxStep/1000)
    {
        u8 temp = (maxStep % 100) ? 1 : 0;
        intStep1000 = (maxStep / 100 + temp) * 100;
    }
    else
    {
        intStep1000 = 1000;
    }
    // UTE_MODULE_LOG(1,"%s,maxStep = %d,intStep1000 = %d",__func__,maxStep,intStep1000);
    for(uint8_t i=0; i<24; i++)
    {
        everySportStep = 0;
        if(i>time.hour)
        {
            break;
        }
#if UTE_GUI_SCREEN_GET_SPORT_DATA_NEW_FUNC_SUPPORT
        everySportStep = uteModuleSprotData.dailyActivity.currentDayEveryHourSportStep[i];
#else
        if(i == 0)
        {
            everySportStep = uteModuleSprotData.dailyActivity.everyHourAllSportStep[0];
        }
        else
        {
            if(uteModuleSprotData.dailyActivity.everyHourAllSportStep[i] > uteModuleSprotData.dailyActivity.everyHourAllSportStep[i-1])
            {
                everySportStep = uteModuleSprotData.dailyActivity.everyHourAllSportStep[i] - uteModuleSprotData.dailyActivity.everyHourAllSportStep[i-1];
            }
        }
#endif
        uint32_t step = everySportStep + uteModuleSprotData.dailyActivity.everyHourRunStep[i] + uteModuleSprotData.dailyActivity.everyHourWalkStep[i];
        if(step > 99999)
        {
            step = 99999;
        }
        // UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL,"%s,step[%d] = %d",__func__,i,step);
        everyHourStep[i] = step;
    }
#if UTE_LOG_STEP_LVL
    for(uint8_t i=0; i<6; i++)
    {
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "everyHourAllSportStep =%d,%d,%d,%d", uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4],uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+1], \
                       uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+2],uteModuleSprotData.dailyActivity.everyHourAllSportStep[i*4+3]);
    }
#endif
    return intStep1000;
}
/**
*@brief     加载今日活动每个小时的Kcal柱状图
*@details
*@param[in] uint16_t everyHourKcal[24] 当天每小时卡路里
*@param[in] color 颜色
*@param[in] x开始坐标
*@param[in] y开始坐标
*@param[in] drawWidth 宽度
*@param[in] intervalWidth 之间的间隔
*@param[in] hightRange 对应的像素高度
*@return    当天有数据返回true,没有则返回false
*@author      dengli.lu
*@date       2022-07-14
*/
uint16_t uteModuleSportLoadTodayEveryHourKcalHistoryData(uint16_t *everyHourKcal)
{
    uint16_t maxKcal = 0,everySportKcal = 0;
    uint16_t intKcal100 = 0;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uteModuleSportGetCurrDayEveryHourKcal();
    memset(&everyHourKcal[0], 0, sizeof(uint16_t) * 24);
    for(uint8_t i = 0; i < 24; i++)
    {
        everySportKcal = 0;
        if(i > time.hour)
        {
            break;
        }
        if(i == 0)
        {
            everySportKcal = uteModuleSprotData.dailyActivity.everyHourAllSportKcal[0];
        }
        else
        {
            if(uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i] > uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i-1])
            {
                everySportKcal = uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i] - uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i-1];
            }
        }
        if((everySportKcal + uteModuleSprotData.dailyActivity.everyHourKcal[i]) > maxKcal)
        {
            maxKcal = everySportKcal + uteModuleSprotData.dailyActivity.everyHourKcal[i];
        }
        if(maxKcal > 9999)
        {
            maxKcal = 9999;
        }
    }
    if(maxKcal < 100)
    {
        intKcal100 = 100;
    }
    else
    {
        u8 temp = (maxKcal % 10) ? 1 : 0;
        intKcal100 = (maxKcal / 10 + temp) * 10;
    }
    for(uint8_t i = 0; i < 24; i++)
    {
        everySportKcal = 0;
        if(i > time.hour)
        {
            break;
        }
        if(i == 0)
        {
            everySportKcal = uteModuleSprotData.dailyActivity.everyHourAllSportKcal[0];
        }
        else
        {
            if(uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i] > uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i-1])
            {
                everySportKcal = uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i] - uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i-1];
            }
        }
        uint16_t kcal = everySportKcal + uteModuleSprotData.dailyActivity.everyHourKcal[i];
        if(kcal > 9999)
        {
            kcal = 9999;
        }
        everyHourKcal[i] = kcal;
    }
    return intKcal100;
}
/**
*@brief     加载今日活动每个小时的运动时长柱状图
*@details
*@param[in] uint16_t everyHourSportTime[24] 当天每小时运动时长
*@return    当天有数据返回true,没有则返回false
*@author      dengli.lu
*@date       2022-07-14
*/
uint16_t uteModuleSportLoadTodayEveryHourSportTimeHistoryData(uint16_t *everyHourSportTime)
{
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    return false;
#else
    uint16_t maxSportTime = 0;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uteModuleSportGetCurrDayEveryHourSportTime();
    memset(&everyHourSportTime[0], 0, sizeof(uint16_t) * 24);
    for(uint8_t i = 0; i < 24; i++)
    {
        if(i > time.hour)
        {
            break;
        }
        if(uteModuleSprotData.dailyActivity.everyHourSportTime[i] > maxSportTime)
        {
            maxSportTime = uteModuleSprotData.dailyActivity.everyHourSportTime[i];
        }
        if(maxSportTime > 60)
        {
            maxSportTime = 60;
        }
    }
    if(maxSportTime == 0)
    {
        return false;
    }
    for(uint8_t i = 0; i < 24; i++)
    {
        if(i > time.hour)
        {
            break;
        }
        uint16_t sportTime = uteModuleSprotData.dailyActivity.everyHourSportTime[i];
        if(sportTime > 60)
        {
            sportTime = 60;
        }
        everyHourSportTime[i] = sportTime;
    }
    return true;
#endif
}
#if APP_STAND_SPORT_STEP_KCAL_DISTANCE_NOTIFY_SUPPORT
/**
*@brief     加载今日活动每个小时的站立时长柱状图
*@details
*@param[in] uint16_t everyHourStandTime[24] 当天每小时站立时长
*@return    当天总站立时长
*@author      dengli.lu
*@date       2022-07-14
*/
uint16_t uteModuleSportLoadTodayEveryHourStandTimeHistoryData(uint16_t *everyHourStandTime)
{
#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
    return 0;
#else
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uint16_t totalStandTimeMin = uteModuleSportGetCurrDayEveryHourStandTime();
    for(uint8_t i = 0; i < 24; i++)
    {
        uint16_t standTime = uteModuleSprotData.dailyActivity.everyHourStandTime[i];
        if((standTime != 0) && (standTime != 0xffff))
        {
            standTime = 60;
        }
        everyHourStandTime[i] = standTime;
    }
    return totalStandTimeMin;
#endif
}
#endif
/**
*@brief     加载今日活动周每天的步数柱状图
*@details
*@param[out] uint32_t weekDayStep[7] 7天每天的步数
*@param[out] *totalStep 周步数总步数
*@return  uint32_t  当周最大数据的整1000倍数据，如2300，返回3000，最小返回1000
*@author      zn.zeng
*@date       2022-09-02
*/
uint32_t uteModuleSportLoadWeekDayStepHistoryData(uint32_t *weekDayStep, uint32_t *totalStep)
{
    //step graph
    uint32_t maxStep = 0;
    uint32_t intStep1000 = 0;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uint32_t currTotal = 0;
    uteModuleSportGetCurrDayStepCnt(&currTotal,NULL,NULL);
    uteModuleSprotData.dailyActivity.weekDayTotalStep[time.week] = currTotal;
    memset(&weekDayStep[0], 0, sizeof(uint32_t) * 7);
    *totalStep = 0;
    for(uint8_t i = 0; i < 7; i++)
    {
#if UTE_LOG_GUI_LVL
        uteModuleSprotData.dailyActivity.weekDayTotalStep[i] = 1300*(i+1);
#endif
        *totalStep = *totalStep + uteModuleSprotData.dailyActivity.weekDayTotalStep[i];
        if(uteModuleSprotData.dailyActivity.weekDayTotalStep[i]>maxStep)
        {
            maxStep = uteModuleSprotData.dailyActivity.weekDayTotalStep[i];
        }
        if(maxStep > 99999)
        {
            maxStep = 99999;
        }
    }
    if (maxStep % 1000)
    {
        intStep1000 = (maxStep / 1000 + 1) * 1000;
    }
    else
    {
        intStep1000 = maxStep;
        if (intStep1000 == 0)
        {
            intStep1000 = 1000;
        }
    }
    if (maxStep != 0)
    {
        for (uint8_t i = 0; i < 7; i++)
        {
            uint32_t step = uteModuleSprotData.dailyActivity.weekDayTotalStep[i];
            if (step > 99999)
            {
                step = 99999;
            }
            weekDayStep[i] = step;
        }
    }
    return intStep1000;
}
#endif

#if UTE_MODULE_SCREENS_SPORT_TARGET_NOTIFY_SUPPORT
/**
*@brief  多运动目标提醒初始化函数
*@details
*@author        dengli.lu
*@date        2022-03-08
*/
void uteModuleSportMoreSportsTargetInit(void)
{
#if UTE_MODULE_SCREENS_TARGET_SELECT_SUPPORT
    uteModuleSportTargetInit();
#else
    memset(&uteModuleSprotData.moreSportsTarget,0,sizeof(ute_module_sports_target_data_t));
#if UTE_MORE_SPORTS_TARGET_SAVE_SUPPORT
    uteModuleSportMoreSportsTargetReadConfig();
#endif
#endif
}

#if UTE_MODULE_SCREENS_TARGET_SELECT_SUPPORT
/**
*@brief        获取上一公里配速
*@details
*@author      wuhuowang
*@date       2022-12-08
*/
uint16_t uteModuleSportMoreSportsGetLastKMPace(void)
{
    return uteModuleSprotData.moreSportData.lastKMPaceMinute * 60 + uteModuleSprotData.moreSportData.lastKMPaceSecond;
}

/**
*@brief        获取上一小时消耗
*@details
*@author      wuhuowang
*@date       2022-12-08
*/
uint16_t uteModuleSportMoreSportsGetLastHourKcal(void)
{
    return uteModuleSprotData.moreSportData.increaseKcal;
}
#else
#if UTE_MORE_SPORTS_TARGET_SAVE_SUPPORT
/**
*@brief     多运动目标提醒读取数据
*@details
*@author        dengli.lu
*@date        2022-04-24
*/
void uteModuleSportMoreSportsTargetReadConfig(void)
{
    /*! 保存到文件dengli.lu, 2022-04-24*/
    void *file;
    uint8_t readbuff[11];
    memset(readbuff,0,11);
    readbuff[0] = (UTE_MORE_SPORTS_DEFAULT_DISTANCE_TARGET>>24)&0xff;
    readbuff[1] = (UTE_MORE_SPORTS_DEFAULT_DISTANCE_TARGET>>16)&0xff;
    readbuff[2] = (UTE_MORE_SPORTS_DEFAULT_DISTANCE_TARGET>>8)&0xff;
    readbuff[3] = UTE_MORE_SPORTS_DEFAULT_DISTANCE_TARGET&0xff;
    uint32_t timeTargetSec = UTE_MORE_SPORTS_DEFAULT_TIME_TARGET_MIN*60;
    readbuff[4] = (timeTargetSec>>24)&0xff;
    readbuff[5] = (timeTargetSec>>16)&0xff;
    readbuff[6] = (timeTargetSec>>8)&0xff;
    readbuff[7] = timeTargetSec&0xff;
    readbuff[8] = (UTE_MORE_SPORTS_DEFAULT_KCAL_TARGET>>8)&0xff;
    readbuff[9] = UTE_MORE_SPORTS_DEFAULT_KCAL_TARGET&0xff;
    readbuff[10] = UTE_MORE_SPORTS_DEFAULT_NO_TARGET_MODE;
    if( uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_MORE_SPORTS_TARGET_DATA,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readbuff[0],11);
        uteModuleFilesystemCloseFile(file);
    }
    uteModuleSprotData.moreSportsTarget.sportDistanceTargeCnt = readbuff[0]<<24|readbuff[1]<<16|readbuff[2]<<8|readbuff[3];
    uteModuleSprotData.moreSportsTarget.sportTimeTargetSec = readbuff[4]<<24|readbuff[5]<<16|readbuff[6]<<8|readbuff[7];
    uteModuleSprotData.moreSportsTarget.sportKcalTarget = readbuff[8]<<8|readbuff[9];
    uteModuleSprotData.moreSportsTarget.isNoTarget = readbuff[10];
}
/**
*@brief     多运动目标提醒保存数据到内存
*@details
*@author        dengli.lu
*@date        2022-04-24
*/
void uteModuleSportMoreSportsTargetSaveData(void)
{
    /*! 保存到文件，dengli.lu, 2022-04-24*/
    void *file;
    uint8_t writebuff[11];
    writebuff[0] = (uteModuleSprotData.moreSportsTarget.sportDistanceTargeCnt>>24)&0xff;
    writebuff[1] = (uteModuleSprotData.moreSportsTarget.sportDistanceTargeCnt>>16)&0xff;
    writebuff[2] = (uteModuleSprotData.moreSportsTarget.sportDistanceTargeCnt>>8)&0xff;
    writebuff[3] = (uteModuleSprotData.moreSportsTarget.sportDistanceTargeCnt)&0xff;
    writebuff[4] = (uteModuleSprotData.moreSportsTarget.sportTimeTargetSec>>24)&0xff;
    writebuff[5] = (uteModuleSprotData.moreSportsTarget.sportTimeTargetSec>>16)&0xff;
    writebuff[6] = (uteModuleSprotData.moreSportsTarget.sportTimeTargetSec>>8)&0xff;
    writebuff[7] = (uteModuleSprotData.moreSportsTarget.sportTimeTargetSec)&0xff;
    writebuff[8] = (uteModuleSprotData.moreSportsTarget.sportKcalTarget>>8)&0xff;
    writebuff[9] = (uteModuleSprotData.moreSportsTarget.sportKcalTarget)&0xff;
    writebuff[10] = uteModuleSprotData.moreSportsTarget.isNoTarget;
    if(uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_MORE_SPORTS_TARGET_DATA,&file,FS_O_WRONLY|FS_O_CREAT|FS_O_TRUNC))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&writebuff[0],11);
        uteModuleFilesystemCloseFile(file);
    }
}
#endif
/**
*@brief  设置多运动目标
*@details
*@param[in] ute_module_sports_target_data_t setMoreSportsTarget  传入要设置多运动目标参数的指针
*@author      dengli.lu
*@date       2022-03-08
*/
void uteModuleSportSetMoreSportsTargetData(ute_module_sports_target_data_t setMoreSportsTarget)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    memcpy(&uteModuleSprotData.moreSportsTarget, &setMoreSportsTarget, sizeof(ute_module_sports_target_data_t));
#if UTE_MORE_SPORTS_TARGET_SAVE_SUPPORT
    uteModuleSportMoreSportsTargetSaveData();
#endif
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
/**
*@brief  获取多运动目标
*@details
*@param[in] ute_module_sports_target_data_t *sportsTarget  传入获取多运动目标参数的指针
*@author      dengli.lu
*@date       2022-03-08
*/
void uteModuleSportGetMoreSportsTargetData(ute_module_sports_target_data_t *sportsTarget)
{
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    memcpy(sportsTarget,&uteModuleSprotData.moreSportsTarget, sizeof(ute_module_sports_target_data_t));
    if(uteModuleSystemtimeGetDistanceMiType())
    {
        sportsTarget->sportDistanceTargeCnt = sportsTarget->sportDistanceTargeCnt * 0.6213712f;
    }
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}
#endif
/**
*@brief        多运动目标处理
*@details
*@author      dengli.lu
*@date       2022-03-08
*/
void uteModuleSportMoreSportsTargetsProcess(void)
{
#if UTE_MODULE_SCREENS_TARGET_SELECT_SUPPORT
    uint32_t sportDistancemi = 0;
    uint32_t pastTime = 0;
    float distance = 0;
    distance = (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceInteger + (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals*0.01f));
    distance = distance * 1000.0f; //放大1000倍,m
    sportDistancemi = (uint32_t)distance;
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,status=%d,Target=%d", __func__,uteModuleSprotData.moreSportData.status,uteModuleSportTargetGetIsNoTarget());
#if APP_MODULE_SCREENS_TARGET_MORE_SUPPORT
    if ((uteModuleSprotData.moreSportData.totalSportTime > 0) && (uteModuleSportTargetGetIsNoTarget()))//启动运动目标提醒
#else
    if ((uteModuleSprotData.moreSportData.totalSportTime > 0) && (!uteModuleSportTargetGetIsNoTarget()))//启动运动目标提醒
#endif
    {
        if(0)
        {}
        else if ((uteModuleSprotData.moreSportData.totalSportTime >= uteModuleSportTargetGetTimeGoal()) && (uteModuleSportTargetGetTimeGoal() > 0) && uteModuleSportTargetGetTimeGoalHasNotify() == false)
        {
#if APP_MODULE_SCREENS_TARGET_MORE_REMIND_ONLY_ONE_TARGET
            if (uteModuleSportTargetGetIsNoTarget() == SPORT_TARGET_TIME_SET)
#endif
            {
                uteModuleSportTargetSetOneKmNotify(false);
                uteModuleSportTargetSetTimeGoalNotify(true);
                uteModuleSportTargetSetOneHourNotify(false);
                uteModuleSportTargetSetKcalGoalNotify(false);
                uteModuleSportTargetSetDistanceGoalNotify(false);
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_TIME_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSportTargetSetTimeGoalHasNotify(true);
            }
        }
        else if ((uteModuleSprotData.moreSportData.saveData.sportCaloire >= uteModuleSportTargetGetKcalGoal()) && (uteModuleSportTargetGetKcalGoal() > 0) && uteModuleSportTargetGetKcalGoalHasNotify() == false)
        {
#if APP_MODULE_SCREENS_TARGET_MORE_REMIND_ONLY_ONE_TARGET
            if (uteModuleSportTargetGetIsNoTarget() == SPORT_TARGET_KCAL_SET)
#endif
            {
                uteModuleSportTargetSetOneKmNotify(false);
                uteModuleSportTargetSetTimeGoalNotify(false);
                uteModuleSportTargetSetOneHourNotify(false);
                uteModuleSportTargetSetKcalGoalNotify(true);
                uteModuleSportTargetSetDistanceGoalNotify(false);
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_KCAL_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSportTargetSetKcalGoalHasNotify(true);
            }
        }
        else if ((sportDistancemi >= uteModuleSportTargetGetDistanceGoal()) && (uteModuleSportTargetGetDistanceGoal() > 0) && uteModuleSportTargetGetDistanceGoalHasNotify() == false)
        {
#if APP_MODULE_SCREENS_TARGET_MORE_REMIND_ONLY_ONE_TARGET
            if (uteModuleSportTargetGetIsNoTarget() == SPORT_TARGET_DISTANCE_SET)
#endif
            {
                uteModuleSportTargetSetOneKmNotify(false);
                uteModuleSportTargetSetTimeGoalNotify(false);
                uteModuleSportTargetSetOneHourNotify(false);
                uteModuleSportTargetSetKcalGoalNotify(false);
                uteModuleSportTargetSetDistanceGoalNotify(true);
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_DANST_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSportTargetSetDistanceGoalHasNotify(true);
            }
        }
#if UTE_SPORTS_ONE_KM_TARGET_NOTIFY_SUPPORT
        //else if (sportDistancemi >= 1000)
        else if (uteModuleSprotData.moreSportData.saveData.sportDistanceInteger != uteModuleSprotData.moreSportData.lastKM)
        {
            pastTime = uteModuleSprotData.moreSportData.totalSportTime - uteModuleSprotData.moreSportData.lasttotalSportTime;
            uteModuleSprotData.moreSportData.lastKMPaceMinute = pastTime / 60;
            uteModuleSprotData.moreSportData.lastKMPaceSecond = pastTime % 60;
            uteModuleSprotData.moreSportData.lasttotalSportTime = uteModuleSprotData.moreSportData.totalSportTime;
            //if (uteModuleSportTargetGetOneKmHasNotify() == false)
            {
                uteModuleSportTargetSetOneKmNotify(true);
                uteModuleSportTargetSetTimeGoalNotify(false);
                uteModuleSportTargetSetOneHourNotify(false);
                uteModuleSportTargetSetKcalGoalNotify(false);
                uteModuleSportTargetSetDistanceGoalNotify(false);
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_LAST_SPEED;
                sys_cb.remind_tag = true;

                //uteModuleSportTargetSetOneKmHasNotify(true);
                uteModuleSprotData.moreSportData.lastKM = uteModuleSprotData.moreSportData.saveData.sportDistanceInteger;
            }
        }
#endif
#if UTE_SPORTS_ONE_HOUR_TARGET_NOTIFY_SUPPORT
        else if (uteModuleSprotData.moreSportData.totalSportTime % 3600 == 0 && uteModuleSportGetCurrSportShowDataType(uteModuleSportMoreSportGetType()) == 0x00)
        {
            uteModuleSprotData.moreSportData.increaseKcal = uteModuleSprotData.moreSportData.saveData.sportCaloire - uteModuleSprotData.moreSportData.lastKcal;
            uteModuleSprotData.moreSportData.lastKcal = uteModuleSprotData.moreSportData.saveData.sportCaloire;
            //if (uteModuleSportTargetGetOneHourHasNotify() == false)
            {
                uteModuleSportTargetSetOneKmNotify(false);
                uteModuleSportTargetSetTimeGoalNotify(false);
                uteModuleSportTargetSetOneHourNotify(true);
                uteModuleSportTargetSetKcalGoalNotify(false);
                uteModuleSportTargetSetDistanceGoalNotify(false);
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_LAST_KCAL;
                sys_cb.remind_tag = true;

                //uteModuleSportTargetSetOneHourHasNotify(true);
            }
        }
#endif
    }
#else
    uint32_t sportDistancemi = 0;
    float distance = 0;
    distance = (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceInteger + (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals*0.01f));
    distance = distance*1000.0f; //放大1000倍,m
    sportDistancemi = (uint32_t)distance;
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,status =%d", __func__,uteModuleSprotData.moreSportData.status);
    if((uteModuleSprotData.moreSportData.totalSportTime > 0) && (!uteModuleSprotData.moreSportsTarget.isNoTarget))//启动运动目标提醒
    {
        if(0)
        {}
#if UTE_SPORTS_ITTEGER_KM_DISTANCE_TARGET//整公里提醒
        else if(sportDistancemi >= (UTE_SPORTS_ITTEGER_KM_DISTANCE_TARGET*1000))
        {
            if(uteModuleSprotData.moreSportsTarget.isSportIntegerKmHasNotify == false)
            {
                uteModuleSprotData.moreSportsTarget.isSportIntegerKmNotify = true;
                uteModuleSprotData.moreSportsTarget.isSportTimeTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportIntegerHourNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportKcalTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportDistanceTargetNotify = false;
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSprotData.moreSportsTarget.isSportIntegerKmHasNotify = true;
            }
        }
#endif
        else if((uteModuleSprotData.moreSportData.totalSportTime >= uteModuleSprotData.moreSportsTarget.sportTimeTargetSec) && (uteModuleSprotData.moreSportsTarget.sportTimeTargetSec > 0))
        {
            if(uteModuleSprotData.moreSportsTarget.isSportTimeTargetHasNotify == false)
            {
                uteModuleSprotData.moreSportsTarget.isSportIntegerKmNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportTimeTargetNotify = true;
                uteModuleSprotData.moreSportsTarget.isSportIntegerHourNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportKcalTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportDistanceTargetNotify = false;
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSprotData.moreSportsTarget.isSportTimeTargetHasNotify = true;
            }
        }
#if UTE_SPORTS_ITTEGER_HOUR_TIME_TARGET
        else if(uteModuleSprotData.moreSportData.totalSportTime >= (UTE_SPORTS_ITTEGER_HOUR_TIME_TARGET*3600))
        {
            if(uteModuleSprotData.moreSportsTarget.isSportIntegerHourHasNotify == false)
            {
                uteModuleSprotData.moreSportsTarget.isSportIntegerKmNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportTimeTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportIntegerHourNotify = true;
                uteModuleSprotData.moreSportsTarget.isSportKcalTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportDistanceTargetNotify = false;
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSprotData.moreSportsTarget.isSportIntegerHourHasNotify = true;
            }
        }
#endif
        else if((uteModuleSprotData.moreSportData.saveData.sportCaloire >= uteModuleSprotData.moreSportsTarget.sportKcalTarget) && (uteModuleSprotData.moreSportsTarget.sportKcalTarget > 0))
        {
            if(uteModuleSprotData.moreSportsTarget.isSportKcalTargetHasNotify == false)
            {
                uteModuleSprotData.moreSportsTarget.isSportIntegerKmNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportTimeTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportIntegerHourNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportKcalTargetNotify = true;
                uteModuleSprotData.moreSportsTarget.isSportDistanceTargetNotify = false;
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSprotData.moreSportsTarget.isSportKcalTargetHasNotify = true;
            }
        }
        else if((sportDistancemi >= uteModuleSprotData.moreSportsTarget.sportDistanceTargeCnt) && (uteModuleSprotData.moreSportsTarget.sportDistanceTargeCnt >0 ))
        {
            if(uteModuleSprotData.moreSportsTarget.isSportDistanceTargetHasNotify == false)
            {
                uteModuleSprotData.moreSportsTarget.isSportIntegerKmNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportTimeTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportIntegerHourNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportKcalTargetNotify = false;
                uteModuleSprotData.moreSportsTarget.isSportDistanceTargetNotify = true;
                // uteTaskGuiStartScreen(UTE_MOUDLE_SCREENS_SPORT_TARGET_NOTIFY_ID, 0, __func__);
                // uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,3);

                sys_cb.cover_index = REMIND_SPORT_TARGET;
                sys_cb.remind_tag = true;

                uteModuleSprotData.moreSportsTarget.isSportDistanceTargetHasNotify = true;
            }
        }
    }
#endif
}
#endif
/**
*@brief        处理运动心率值警告数据
*@details
*@author      denglilu
*@date       2022-03-16
*/
#if UTE_SPORTS_HEART_MAX_MIN_WARNING_NOTIFY_SUPPORT
void uteModuleSportMoreSportsHeartWarningProcess(void)
{
    uint8_t heart = (uint8_t)uteModuleHeartGetHeartValue();
    uint32_t warningSecond = uteModuleHeartGetSportHeartWaringSecond();
#if (UTE_MODULE_SPORT_HEART_MIN_MAX_WARNING_FRIST_SECOND_CNT == 0)
    if(uteModuleHeartGetSportHeartWaringMinIsOpen() || uteModuleHeartGetSportHeartWaringMaxIsOpen())
    {
        if(uteModuleHeartIsWear() && (heart!=0xff) && (heart!=0))
        {
            if((heart < uteModuleHeartGetSportHeartWaringMinValue())||(heart > uteModuleHeartGetSportHeartWaringMaxValue()))
            {
                if(uteModuleHeartGetSportHeartWaringIsFristHasNotify() == false)
                {
                    sys_cb.cover_index = REMIND_HEART_WARING;
                    sys_cb.remind_tag = true;
                    uteModuleHeartSetSportHeartWaringIsFristHasNotify(true);
                    warningSecond = 0;
                }
                else
                {
                    if(warningSecond >= UTE_MODULE_SPORT_HEART_MIN_MAX_WARNING_RELOAD_SECOND_CNT)
                    {
                        sys_cb.cover_index = REMIND_HEART_WARING;
                        sys_cb.remind_tag = true;
                        uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
                        warningSecond = 0;
                    }
                }
            }
        }
        if(uteModuleHeartGetSportHeartWaringIsFristHasNotify())
        {
            warningSecond++;
            uteModuleHeartSetSportHeartWaringSecond(warningSecond);
        }
    }
#else
    if(uteModuleHeartIsWear() && (heart!=0xff) && (heart!=0))
    {
        if(uteModuleHeartGetSportHeartWaringMinIsOpen() || uteModuleHeartGetSportHeartWaringMaxIsOpen())
        {
            if((heart < uteModuleHeartGetSportHeartWaringMinValue())||(heart > uteModuleHeartGetSportHeartWaringMaxValue()))
            {
                warningSecond++;
                if(warningSecond >= UTE_MODULE_SPORT_HEART_MIN_MAX_WARNING_FRIST_SECOND_CNT)
                {
                    if((((warningSecond - UTE_MODULE_SPORT_HEART_MIN_MAX_WARNING_FRIST_SECOND_CNT) % UTE_MODULE_SPORT_HEART_MIN_MAX_WARNING_RELOAD_SECOND_CNT) == 0))
                    {
                        sys_cb.cover_index = REMIND_HEART_WARING;
                        sys_cb.remind_tag = true;
                        uteDrvMotorStart(UTE_MOTOR_DURATION_TIME,UTE_MOTOR_INTERVAL_TIME,2);
                    }
                }
            }
            else
            {
                warningSecond = 0;
            }
        }
        else
        {
            warningSecond = 0;
        }
    }
    else
    {
        warningSecond = 0;
    }
    uteModuleHeartSetSportHeartWaringSecond(warningSecond);
#endif
}
#endif

/**
*@brief       获取多运动的运动断开连接超时计数
*@details
*@author     casen
*@date       2022-09-04
*/
uint16_t uteModuleSportMoreSportGetDisconnectTimeoutCnt(void)
{
    return uteModuleSprotData.moreSportData.appStartSportDisconnectTimeOutCnt;
}

#if UTE_MODULE_SPORT_CLASSIFICATION_SUPPORT
/**
*@brief       获取多运动的运动分类界面
*@details
*@author     xjc
*@date       2022-11-28
*/
TRAIN_LIST_PAGE_T uteModuleSportMoreSportGetTrainListPage(void)
{
    return uteModuleSprotData.trainListPage;
}
/**
*@brief      设置多运动的运动分类界面
*@details
*@author     xjc
*@date       2022-11-28
*/
void uteModuleSportMoreSportSetTrainListPage(TRAIN_LIST_PAGE_T trainListPage)
{
    uteModuleSprotData.trainListPage = trainListPage;
}
#endif

#if UTE_MODULE_SPORTS_HISTORY_HEART_ZONE_SUPPORT

ute_module_sport_heart_zone_data_t sportHeartZoneData;
void uteModuleSportGetHeartZoneArray(ute_module_sport_heart_zone_data_t *zoneData)
{
    memcpy(zoneData,&sportHeartZoneData,sizeof(ute_module_sport_heart_zone_data_t));
}
uint8_t  uteModuleSportGetHeartZoneRange(uint8_t *heartHistory,uint8_t heartCnt,uint8_t *reduceStatus,uint8_t *burnFatStatus,uint8_t *heartLungStatus,uint8_t *noOxygenStatus,uint8_t *limitStatus)
{
    uint8_t zoneRange = 0;
    uint8_t reduceStatusCounter =0; // 减压
    uint8_t burnFatStatusCounter =0;    //燃脂
    uint8_t heartLungStatusCounter =0;  // 心肺
    uint8_t noOxygenStatusCounter =0;   // 无氧
    uint8_t limitStatusCounter =0;  // 极限
    uint8_t heartHistoryCounter = 0;
    for(uint8_t index =0; index<heartCnt; index++)
    {
        if((heartHistory[index]!=0) &&(heartHistory[index]!=0xff))
        {
            zoneRange = uteModuleHeartGetHeartValueRange(heartHistory[index]);
            UTE_MODULE_LOG(1,"%s,HEART [%d] = %d ,zoneRange = %d",__func__,index,heartHistory[index],zoneRange);
            if(zoneRange!=1)  //过滤静息
            {
                heartHistoryCounter++;
            }
            if(zoneRange == 2)
            {
                reduceStatusCounter++;
            }
            else if(zoneRange == 3)
            {
                burnFatStatusCounter++;
            }
            else if(zoneRange == 4)
            {
                heartLungStatusCounter++;
            }
            else if(zoneRange == 5)
            {
                noOxygenStatusCounter++;
            }
            else if(zoneRange == 0)
            {
                limitStatusCounter++;
            }
        }
    }
    (*reduceStatus) = reduceStatusCounter;
    (*burnFatStatus) = burnFatStatusCounter;
    (*heartLungStatus) = heartLungStatusCounter;
    (*noOxygenStatus) = noOxygenStatusCounter;
    (*limitStatus) = limitStatusCounter;
    return heartHistoryCounter;
}

void  uteModuleSportGetHeartZoneRangePercent(uint8_t heartHistoryCounter,uint8_t reduceStatusCounter,uint8_t burnFatStatusCounter,uint8_t heartLungStatusCounter,uint8_t noOxygenStatusCounter,uint8_t limitStatusCounter)
{
    uint8_t reduceStatusPencent = 0;
    uint8_t burnFatStatusPencent = 0;
    uint8_t heartLungStatusPencent = 0;
    uint8_t noOxygenStatusPencent = 0;
    uint8_t limitStatusPencent = 0;
    if(heartHistoryCounter!=0)
    {
        int8_t zoneTotalPercent = 0,zoneMaxPercent = 0,devPercent = 0;
        reduceStatusPencent = (uint8_t) (reduceStatusCounter*100.0f/heartHistoryCounter+0.5f);
        if(zoneMaxPercent<reduceStatusPencent)
        {
            zoneMaxPercent = reduceStatusPencent;
        }
        zoneTotalPercent += reduceStatusPencent;

        burnFatStatusPencent = (uint8_t) (burnFatStatusCounter*100.0f/heartHistoryCounter+0.5f);
        if(zoneMaxPercent<burnFatStatusPencent)
        {
            zoneMaxPercent = burnFatStatusPencent;
        }
        zoneTotalPercent += burnFatStatusPencent;

        heartLungStatusPencent = (uint8_t) (heartLungStatusCounter*100.0f/heartHistoryCounter+0.5f);
        if(zoneMaxPercent<heartLungStatusPencent)
        {
            zoneMaxPercent = heartLungStatusPencent;
        }
        zoneTotalPercent += heartLungStatusPencent;

        noOxygenStatusPencent = (uint8_t) (noOxygenStatusCounter*100.0f/heartHistoryCounter+0.5f);
        if(zoneMaxPercent<noOxygenStatusPencent)
        {
            zoneMaxPercent = noOxygenStatusPencent;
        }
        zoneTotalPercent += noOxygenStatusPencent;

        limitStatusPencent= (uint8_t) (limitStatusCounter*100.0f/heartHistoryCounter+0.5f);
        if(zoneMaxPercent<limitStatusPencent)
        {
            zoneMaxPercent = limitStatusPencent;
        }
        zoneTotalPercent += limitStatusPencent;
        //Casen add 21-02-25
        if(zoneTotalPercent!=100 && zoneTotalPercent != 0)
        {
            devPercent = 100 - zoneTotalPercent;
            if(0)
            {}
            else if(reduceStatusPencent == zoneMaxPercent)
            {
                reduceStatusPencent += devPercent;
            }
            else if(burnFatStatusPencent == zoneMaxPercent)
            {
                burnFatStatusPencent += devPercent;
            }
            else if(heartLungStatusPencent == zoneMaxPercent)
            {
                heartLungStatusPencent += devPercent;
            }
            else if(noOxygenStatusPencent == zoneMaxPercent)
            {
                noOxygenStatusPencent += devPercent;
            }
            else if(limitStatusPencent == zoneMaxPercent)
            {
                limitStatusPencent += devPercent;
            }
        }
    }
    else
    {
        reduceStatusPencent = 0;
        burnFatStatusPencent = 0;
        heartLungStatusPencent = 0;
        noOxygenStatusPencent = 0;
        limitStatusPencent = 0;
    }
    sportHeartZoneData.reducePer =reduceStatusPencent;
    sportHeartZoneData.burnFatPer =burnFatStatusPencent;
    sportHeartZoneData.heartLungPer =heartLungStatusPencent;
    sportHeartZoneData.noOxygenPer =noOxygenStatusPencent;
    sportHeartZoneData.limitPer =limitStatusPencent;

}

/**
*@brief  读取运动历史心率区间数据
*@details  queryTime 查询的时间
*@author   casen
*@date     2023-02-18
*/
void uteModuleSportReadHistoryHeartZoneData(ute_module_systemtime_time_t *queryTime)
{
    void *file=NULL;
    uint8_t readbuff[33];
    memset(&readbuff[0],0,sizeof(readbuff));
    uint8_t path[30];
    memset(&path[0],0,sizeof(path));
    uint8_t datePath[20];
    memset(&datePath[0],0,sizeof(datePath));
    sprintf((char *)&datePath[0],"%04d%02d%02d%02d%02d",queryTime->year,queryTime->month,queryTime->day,queryTime->hour,queryTime->min);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,datePath = %s", __func__, datePath);
    uint8_t reduceStatusCounter =0; // 减压
    uint8_t burnFatStatusCounter =0;    //燃脂
    uint8_t heartLungStatusCounter =0;  // 心肺
    uint8_t noOxygenStatusCounter =0;   // 无氧
    uint8_t limitStatusCounter =0;  // 极限
    uint8_t heartHistoryCounter =0;
    uint8_t zoneRange = 0;
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, dirInfo, NULL);
    uteModulePlatformTakeMutex(uteModuleSprotMute);

    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt = %d,", __func__,dirInfo->filesCnt);
    for(uint8_t i = dirInfo->filesCnt; i > 0; i--)
    {
        if(memcmp(&datePath[0],&dirInfo->filesName[i-1][0],12)==0)
        {
            sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR,&dirInfo->filesName[i-1][0]);
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,path = %s", __func__, path);
            if(uteModuleFilesystemOpenFile((char *)&path[0],&file,FS_O_RDONLY))
            {
                uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
                uteModuleFilesystemReadData(file,&readbuff[0],33);
                uint16_t heartTotalLen = (uint16_t)(readbuff[31]<<8|readbuff[32]);
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,heartTotalLen = %d,readbuff[31] =%d , readbuff[32] = %d", __func__,heartTotalLen,readbuff[31],readbuff[32]);
                /*读取心率数据*/
                uint8_t tempHeartBuff[24];
                uint16_t heartBuffLength = sizeof(tempHeartBuff)/sizeof(&tempHeartBuff[0]);
                memset(tempHeartBuff,0x00,heartBuffLength);
                uint8_t tempReduce,tempBurnFat,tempHeartLung,tempNoOxygen,tempLimit;
                for(uint16_t i = 0; i<(heartTotalLen/heartBuffLength); i++)
                {
                    tempReduce = tempBurnFat = tempHeartLung = tempNoOxygen = tempLimit = 0;
                    uteModuleFilesystemSeek(file,33+i*heartBuffLength,FS_SEEK_SET);
                    uteModuleFilesystemReadData(file,&tempHeartBuff[0],heartBuffLength);
                    heartHistoryCounter += uteModuleSportGetHeartZoneRange(tempHeartBuff,heartBuffLength,&tempReduce,&tempBurnFat,&tempHeartLung,&tempNoOxygen,&tempLimit);
                    //累计
                    reduceStatusCounter += tempReduce;
                    burnFatStatusCounter += tempBurnFat;
                    heartLungStatusCounter += tempHeartLung;
                    noOxygenStatusCounter += tempNoOxygen;
                    limitStatusCounter += tempLimit;
                }
                memset(tempHeartBuff,0x00,heartBuffLength);
                if(heartTotalLen%heartBuffLength)
                {
                    tempReduce = tempBurnFat = tempHeartLung = tempNoOxygen = tempLimit = 0;
                    uteModuleFilesystemSeek(file,33+(heartTotalLen/heartBuffLength)*heartBuffLength,FS_SEEK_SET);
                    uteModuleFilesystemReadData(file,&tempHeartBuff[0],heartTotalLen%heartBuffLength);
                    heartHistoryCounter += uteModuleSportGetHeartZoneRange(tempHeartBuff,heartTotalLen%heartBuffLength,&tempReduce,&tempBurnFat,&tempHeartLung,&tempNoOxygen,&tempLimit);
                    //累计
                    reduceStatusCounter += tempReduce;
                    burnFatStatusCounter += tempBurnFat;
                    heartLungStatusCounter += tempHeartLung;
                    noOxygenStatusCounter += tempNoOxygen;
                    limitStatusCounter += tempLimit;
                }
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s ,status,%d,%d,%d,%d,%d ,heartHistoryCounter = %d",__func__,reduceStatusCounter,burnFatStatusCounter,heartLungStatusCounter,noOxygenStatusCounter,limitStatusCounter,heartHistoryCounter);
                uteModuleSportGetHeartZoneRangePercent(heartHistoryCounter,reduceStatusCounter,burnFatStatusCounter,heartLungStatusCounter,noOxygenStatusCounter,limitStatusCounter);
                UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s ,StatusPencent %d,%d,%d,%d,%d ",__func__,sportHeartZoneData.reducePer,sportHeartZoneData.burnFatPer,sportHeartZoneData.heartLungPer,sportHeartZoneData.noOxygenPer,sportHeartZoneData.limitPer);
                /*读取心率数据*/

                uteModuleFilesystemCloseFile(file);
                break;
            }
        }
    }
    uteModulePlatformGiveMutex(uteModuleSprotMute);
    uteModulePlatformMemoryFree(dirInfo);
}

/**
*@brief     加载心率区间柱状图
*@details   这里加载的是每行独立的区间图，一般在LONGPAGEVIEW 界面中还要重新设置对应的y.
            也可以通过设置x实现区间比例在同一行.
*@param[in] zoneGramGraph 数组指针，需要传递一个类型是UT_GraphsParam 长度是5的数组地址，对应减压、燃脂、心肺、无氧、极限
*@param[in] color 颜色
*@param[in] x开始坐标
*@param[in] y开始坐标
*@param[in] drawWidth 总的宽度用于计算比例
*@param[in] drawHight 高度
*@return
*@author    casen
*@date      2023-02-21
*/
#ifndef SPORT_HEART_RESUCE_24RGB
#define SPORT_HEART_RESUCE_24RGB 0x97e2fa
#endif
#ifndef SPORT_HEART_BURNFAT_24RGB
#define SPORT_HEART_BURNFAT_24RGB 0xcff979
#endif
#ifndef SPORT_HEART_HEARTLUNG_24RGB
#define SPORT_HEART_HEARTLUNG_24RGB 0xf9de60
#endif
#ifndef SPORT_HEART_NO_OXYGEN_24RGB
#define SPORT_HEART_NO_OXYGEN_24RGB 0xe57352
#endif
#ifndef SPORT_HEART_LIMIT_24RGB
#define SPORT_HEART_LIMIT_24RGB 0xea668c
#endif
void uteModuleSportLoadHeartZoneGrapData(UT_GraphsParam (*zoneGramGraph)[5],int16_t x, int16_t y, uint16_t drawWidth, uint16_t drawHight)
{
    for(uint8_t i = 0; i<5; i++)
    {
        (*zoneGramGraph)[i].x = x;
        (*zoneGramGraph)[i].y = y;
        (*zoneGramGraph)[i].width = drawWidth;
        (*zoneGramGraph)[i].hight = drawHight;
    }
#if 0//UTE_MODULE_LOG_SUPPORT
    sportHeartZoneData.reducePer = 20;
    sportHeartZoneData.burnFatPer = 30;
    sportHeartZoneData.heartLungPer = 10;
    sportHeartZoneData.noOxygenPer = 40;
    sportHeartZoneData.limitPer = 50;
#endif
    (*zoneGramGraph)[0].width = sportHeartZoneData.reducePer*drawWidth/100;
    (*zoneGramGraph)[1].width = sportHeartZoneData.burnFatPer*drawWidth/100;
    (*zoneGramGraph)[2].width = sportHeartZoneData.heartLungPer*drawWidth/100;
    (*zoneGramGraph)[3].width = sportHeartZoneData.noOxygenPer*drawWidth/100;
    (*zoneGramGraph)[4].width = sportHeartZoneData.limitPer*drawWidth/100;

    (*zoneGramGraph)[0].colorData = SPORT_HEART_RESUCE_24RGB;
    (*zoneGramGraph)[1].colorData = SPORT_HEART_BURNFAT_24RGB;
    (*zoneGramGraph)[2].colorData = SPORT_HEART_HEARTLUNG_24RGB;
    (*zoneGramGraph)[3].colorData = SPORT_HEART_NO_OXYGEN_24RGB;
    (*zoneGramGraph)[4].colorData = SPORT_HEART_LIMIT_24RGB;

}
#endif

#if APP_DBG_GSENSOR_DATA
uint8_t sendDbgData[160];
uint8_t sendFrameCnt = 0;
uint32_t sendDbgDataCnt = 0;
/**
*@brief        发送gsensor采集原始数据
*@details
*@author       dengli.lu
*@date       2023-09-15
*/
void uteModuleSportSendGsensorDataToPhone(int16_t tempx, int16_t tempy,int16_t tempz)
{
    if(uteModuleSprotData.appDebugGsensorDataSwitch == false)
    {
        sendFrameCnt = 0;
        sendDbgDataCnt = 0;
        return ;
    }
    if(sendFrameCnt==0)
    {
        sendDbgData[0] = 0x48;
        sendDbgData[1] = 0xff;
        sendDbgData[2] = 0xfe;
    }
    if(sendFrameCnt==25)
    {
        sendDbgData[153] = sendDbgDataCnt>>8&0xff;
        sendDbgData[154] = sendDbgDataCnt&0xff;
        sendDbgData[155] = (mStepSleepParam.currentHourStepCnt>>8 & 0xff);
        sendDbgData[156]= (mStepSleepParam.currentHourStepCnt & 0xff);
        uteModuleProfileBle50SendToPhone(&sendDbgData[0],157);
        memset(&sendDbgData[0],0,160);
        sendFrameCnt = 0;
        sendDbgDataCnt++;
    }
    else
    {
        sendDbgData[3+sendFrameCnt*6+0]=tempx>>8&0xff;
        sendDbgData[3+sendFrameCnt*6+1]=tempx&0xff;
        sendDbgData[3+sendFrameCnt*6+2]=tempy>>8&0xff;
        sendDbgData[3+sendFrameCnt*6+3]=tempy&0xff;
        sendDbgData[3+sendFrameCnt*6+4]=tempz>>8&0xff;
        sendDbgData[3+sendFrameCnt*6+5]=tempz&0xff;
        sendFrameCnt++;
    }
    ute_ble_connect_state_t status;
    uteApplicationCommonGetBleConnectionState(&status);
    if (!status.isConnected)
    {
        memset(&sendDbgData[0],0,160);
        sendFrameCnt = 0;
    }
}
/**
*@brief        设置gsensor采集原始数据开关
*@details
*@author       dengli.lu
*@date       2023-09-15
*/
void uteModuleSportSetAppDebugGsensorDataSwitch(bool appDebugGsensorDataSwitch)
{
    uteModuleSprotData.appDebugGsensorDataSwitch = appDebugGsensorDataSwitch;
}
/**
*@brief        获取gsensor采集原始数据开关
*@details
*@author       dengli.lu
*@date       2023-09-15
*/
bool uteModuleSportGetAppDebugGsensorDataSwitch(void)
{
    return uteModuleSprotData.appDebugGsensorDataSwitch;
}
#endif
/**
*@brief         根据运动类型判断显示数据内容
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint8_t uteModuleSportGetCurrSportShowDataType(uint8_t type)
{
    uint8_t retType = 0;
    uint8_t sportType = 0;

    sportType = type;//uteModuleSportMoreSportGetType();
    if (sportType == SPORT_TYPE_RUNNING
        || sportType == SPORT_TYPE_WALKING
        || sportType == SPORT_TYPE_CLIMBING
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
        || sportType == SPORT_TYPE_OUTDOOR_WALK
        || sportType == SPORT_TYPE_TRAIL_RUNNING
        || sportType == SPORT_TYPE_MARATHON
#endif
       )
    {
        retType = 0x01;//支持实时配速、步频、心率、实时速度、步数、消耗、平均配速、时长、距离
    }
    else if (sportType == SPORT_TYPE_TREADMILL
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_INDOOR_WALK
             || sportType == SPORT_TYPE_INDOOR_RUN
             //|| sportType == SPORT_TYPE_STEP_TRAINING
             //|| sportType == SPORT_TYPE_PARKOUR
#endif
            )
    {
        retType = 0x02;//支持实时配速、步频、心率、步数、消耗、平均配速、时长、距离
    }
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
    else if (sportType == SPORT_TYPE_RIDE_BIKE
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_ROLLER_SKATING
             || sportType == SPORT_TYPE_SKATEBOARDING
             || sportType == SPORT_TYPE_HUNTING
             || sportType == SPORT_TYPE_SKATING
#endif
            )
    {
        retType = 0x03;//实时速度、距离、心率、实时配速、时长
    }
#endif
    else
    {
        retType = 0x00;//心率、消耗、时长
    }
    return retType;
}
#if APP_MODULE_SPORT_HEARTRATE_RANGE_SUPPORT
/**
*@brief         计算实时配速
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportCalcRealTimePace(uint16_t increaseDistance, uint32_t totalDistance, uint8_t time)
{
    uint16_t oneKM = 1000;
    uint16_t totalTime = 0;

    if (increaseDistance > 0)
    {
        totalTime = (oneKM / increaseDistance) * time;
        uteModuleSprotData.moreSportData.realTimeMinute = totalTime / 60;
        uteModuleSprotData.moreSportData.realTimeSecond = totalTime % 60;
    }
    else
    {
        //if (totalDistance > 0)
        //{
        //    totalTime = (oneKM * uteModuleSprotData.moreSportData.totalSportTime) / totalDistance;
        //    uteModuleSprotData.moreSportData.realTimeMinute = totalTime / 60;
        //    uteModuleSprotData.moreSportData.realTimeSecond = totalTime % 60;
        //}
        uteModuleSprotData.moreSportData.realTimeMinute = 0;
        uteModuleSprotData.moreSportData.realTimeSecond = 0;
    }
    if (uteModuleSprotData.moreSportData.realTimeMinute > 0 || uteModuleSprotData.moreSportData.realTimeSecond > 0)
    {
        if (uteModuleSprotData.moreSportData.saveData.maxTimeMinute == 0 && uteModuleSprotData.moreSportData.saveData.maxTimeSecond == 0)
        {
            uteModuleSprotData.moreSportData.saveData.maxTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.maxTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
        if (uteModuleSprotData.moreSportData.saveData.minTimeMinute == 0 && uteModuleSprotData.moreSportData.saveData.minTimeSecond == 0)
        {
            uteModuleSprotData.moreSportData.saveData.minTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.minTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
        if ((uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond) < (uteModuleSprotData.moreSportData.saveData.maxTimeMinute * 60 + uteModuleSprotData.moreSportData.saveData.maxTimeSecond))
        {
            uteModuleSprotData.moreSportData.saveData.maxTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.maxTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
        if ((uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond) > (uteModuleSprotData.moreSportData.saveData.minTimeMinute * 60 + uteModuleSprotData.moreSportData.saveData.minTimeSecond))
        {
            uteModuleSprotData.moreSportData.saveData.minTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.minTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
    }
}

/**
*@brief         根据运动类型判断存储的数据内容
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint8_t uteModuleSportGetCurrSportDataSaveType(void)
{
    uint8_t retType = 0;
    uint8_t sportType = 0;

    sportType = uteModuleSportMoreSportGetType();
    if (sportType == SPORT_TYPE_RUNNING
        || sportType == SPORT_TYPE_WALKING
        || sportType == SPORT_TYPE_CLIMBING
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
        || sportType == SPORT_TYPE_OUTDOOR_WALK
        || sportType == SPORT_TYPE_TRAIL_RUNNING
        || sportType == SPORT_TYPE_MARATHON
#endif
       )
    {
#if APP_MODULE_SPORT_GPS_SAVE_SUPPORT
        retType = 0x01;//支持轨迹、实时配速、步频、心率
#else
        retType = 0x02;//支持实时配速、步频、心率
#endif
    }
    else if (sportType == SPORT_TYPE_TREADMILL
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_INDOOR_WALK
//             || sportType == SPORT_TYPE_INDOOR_RUN
//             || sportType == SPORT_TYPE_STEP_TRAINING
//             || sportType == SPORT_TYPE_PARKOUR
#endif
            )
    {
        retType = 0x02;//支持实时配速、步频、心率
    }
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
    else if (sportType == SPORT_TYPE_RIDE_BIKE
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_ROLLER_SKATING
             || sportType == SPORT_TYPE_SKATEBOARDING
             || sportType == SPORT_TYPE_HUNTING
             || sportType == SPORT_TYPE_SKATING
#endif
            )
    {
#if APP_MODULE_SPORT_GPS_SAVE_SUPPORT
        retType = 0x03;//支持轨迹、实时速度、步频、心率
#else
        retType = 0x04;//实时速度、步频、心率
#endif
    }
#endif
    else
    {
        retType = 0x00;//只有心率
    }
    return retType;
}

/**
*@brief         计算实时速度
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportCalcRealTimeSpeed(void)
{
    uint16_t tmpSpeed = 0;
    uint16_t tmpPace = 0;

    if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02)
    {
        if (uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond > 0)
            tmpSpeed = (uint16_t)(360000 / (uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond));
    }
    else
    {
//#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
//        tmpSpeed = uteModuleSprotData.gpsData.gpsSpeed;
//#else
        if (uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond > 0)
            tmpSpeed = (uint16_t)(360000 / (uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond));
//#endif
    }
    uteModuleSprotData.moreSportData.realTimeSpeedInteger = tmpSpeed / 100;
    uteModuleSprotData.moreSportData.realTimeSpeedDecimals = tmpSpeed % 100;
    if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01
        || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03
        || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x04)
    {
        if (((uteModuleSprotData.moreSportData.saveData.sportDistanceInteger * 1000) + (uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals * 10)) > 0)
        {
            tmpPace = (uint16_t)((1000 * uteModuleSprotData.moreSportData.totalSportTime) / ((uteModuleSprotData.moreSportData.saveData.sportDistanceInteger * 1000) + (uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals * 10)));
            uteModuleSprotData.moreSportData.saveData.avgTimeMinute = tmpPace / 60;
            uteModuleSprotData.moreSportData.saveData.avgTimeSecond = tmpPace % 60;
        }
    }
    if (uteModuleSprotData.moreSportData.saveData.avgTimeMinute > 0 || uteModuleSprotData.moreSportData.saveData.avgTimeSecond > 0)
    {
        uteModuleSprotData.moreSportData.avgSpeed = (uint16_t)(360000 / (uteModuleSprotData.moreSportData.saveData.avgTimeMinute * 60 + uteModuleSprotData.moreSportData.saveData.avgTimeSecond));
    }
    //uteModuleSprotData.moreSportData.speedTotalCnt ++;
    //uteModuleSprotData.moreSportData.speedTotalSum += uteModuleSprotData.moreSportData.realTimeSpeedInteger * 100 + uteModuleSprotData.moreSportData.realTimeSpeedDecimals;
    //uteModuleSprotData.moreSportData.avgSpeed = uteModuleSprotData.moreSportData.speedTotalSum / uteModuleSprotData.moreSportData.speedTotalCnt;
    /*if (uteModuleSprotData.moreSportData.saveData.saveInfoType != 0x02)
    {
        if (uteModuleSprotData.moreSportData.realTimeSpeedInteger * 100 + uteModuleSprotData.moreSportData.realTimeSpeedDecimals > 0)
            tmpPace = 1000 * 360 / (uteModuleSprotData.moreSportData.realTimeSpeedInteger * 100 + uteModuleSprotData.moreSportData.realTimeSpeedDecimals);
        uteModuleSprotData.moreSportData.realTimeMinute = tmpPace / 60;
        uteModuleSprotData.moreSportData.realTimeSecond = tmpPace % 60;
        if (uteModuleSprotData.moreSportData.saveData.maxTimeMinute == 0 && uteModuleSprotData.moreSportData.saveData.maxTimeSecond == 0)
        {
            uteModuleSprotData.moreSportData.saveData.maxTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.maxTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
        if (uteModuleSprotData.moreSportData.saveData.minTimeMinute == 0 && uteModuleSprotData.moreSportData.saveData.minTimeSecond == 0)
        {
            uteModuleSprotData.moreSportData.saveData.minTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.minTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
        if ((uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond) > (uteModuleSprotData.moreSportData.saveData.maxTimeMinute * 60 + uteModuleSprotData.moreSportData.saveData.maxTimeSecond))
        {
            uteModuleSprotData.moreSportData.saveData.maxTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.maxTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
        if ((uteModuleSprotData.moreSportData.realTimeMinute * 60 + uteModuleSprotData.moreSportData.realTimeSecond) < (uteModuleSprotData.moreSportData.saveData.minTimeMinute * 60 + uteModuleSprotData.moreSportData.saveData.minTimeSecond))
        {
            uteModuleSprotData.moreSportData.saveData.minTimeMinute = uteModuleSprotData.moreSportData.realTimeMinute;
            uteModuleSprotData.moreSportData.saveData.minTimeSecond = uteModuleSprotData.moreSportData.realTimeSecond;
        }
    }*/
}

/**
*@brief         基于距离计算配速
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportCalcRealTimeInfoBaseOnGPS(uint8_t sec)
{
    uint16_t increaseDistance = 0;
    uint32_t totalDistance = 0;

    if (uteModuleSprotData.gpsData.gpsTotalDistance > uteModuleSprotData.gpsData.gpsIncreaseDistance)
        increaseDistance = uteModuleSprotData.gpsData.gpsTotalDistance - uteModuleSprotData.gpsData.gpsIncreaseDistance;
    totalDistance = uteModuleSprotData.gpsData.gpsTotalDistance / 10;
    uteModuleSprotData.gpsData.gpsIncreaseDistance = uteModuleSprotData.gpsData.gpsTotalDistance;
    uteModuleSportCalcRealTimePace(increaseDistance / 10, totalDistance, sec);//单位米
    uteModuleSportCalcRealTimeSpeed();
}

/**
*@brief     多运动每秒处理其他数据
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportMoreSportsOtherDataHandler(void)
{
    uint16_t tempStep = 0;
    uint16_t increaseDistance = 0;
    uint32_t totalDistance = 0;

    if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE)
    {
        if ((uteModuleSprotData.moreSportData.totalSportTime % APP_SPORT_SAVE_DATA_INTERVAL == 0 && uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01)
            || (uteModuleSprotData.moreSportData.totalSportTime % 10 == 0 && uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02))
        {
            if (uteModuleSprotData.moreSportData.saveData.sportStep > uteModuleSprotData.moreSportsCalc.lastSportStepCnt)
            {
                if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01)
                    tempStep = (uteModuleSprotData.moreSportData.saveData.sportStep - uteModuleSprotData.moreSportsCalc.lastSportStepCnt) * (60 / APP_SPORT_SAVE_DATA_INTERVAL);
                else
                    tempStep = (uteModuleSprotData.moreSportData.saveData.sportStep - uteModuleSprotData.moreSportsCalc.lastSportStepCnt) * 6;
                if (tempStep > 0xFF)
                    tempStep = 0xFF;
            }
            uteModuleSprotData.moreSportData.realTimeStepfrequency = tempStep & 0xFF;
            if (uteModuleSprotData.moreSportData.saveData.minStepfrequency == 0)
            {
                uteModuleSprotData.moreSportData.saveData.minStepfrequency = uteModuleSprotData.moreSportData.realTimeStepfrequency;
            }
            else if (uteModuleSprotData.moreSportData.realTimeStepfrequency > 0
                     && uteModuleSprotData.moreSportData.realTimeStepfrequency < uteModuleSprotData.moreSportData.saveData.minStepfrequency)
            {
                uteModuleSprotData.moreSportData.saveData.minStepfrequency = uteModuleSprotData.moreSportData.realTimeStepfrequency;
            }
            if (uteModuleSprotData.moreSportData.realTimeStepfrequency > uteModuleSprotData.moreSportData.saveData.maxStepfrequency)
                uteModuleSprotData.moreSportData.saveData.maxStepfrequency = uteModuleSprotData.moreSportData.realTimeStepfrequency;
            if (uteModuleSprotData.moreSportData.realTimeStepfrequency > 0)
            {
                uteModuleSprotData.moreSportData.stepfrequencyTotalCnt ++;
                uteModuleSprotData.moreSportData.stepfrequencyTotalSum += uteModuleSprotData.moreSportData.realTimeStepfrequency;
                //uteModuleSprotData.moreSportData.saveData.avgStepfrequency = uteModuleSprotData.moreSportData.stepfrequencyTotalSum / uteModuleSprotData.moreSportData.stepfrequencyTotalCnt;
            }
            uteModuleSprotData.moreSportsCalc.lastSportStepCnt = uteModuleSprotData.moreSportData.saveData.sportStep;
        }
        if (uteModuleSprotData.moreSportData.saveData.sportStep > 0 && uteModuleSprotData.moreSportData.totalSportTime > 0
            && (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01 || uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02))
        {
            uteModuleSprotData.moreSportData.saveData.avgStepfrequency = uteModuleSprotData.moreSportData.saveData.sportStep * 60 / uteModuleSprotData.moreSportData.totalSportTime;
        }
        if (uteModuleSprotData.moreSportData.totalSportTime % 10 == 0)
        {
            if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x01)
            {
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
                //原来定位成功开启运动，无GPS信号用算法计算距离
                if (uteModuleSportGetGPSStatus() != GPS_LACATION_OK)
                {
                    uint8_t sportDistanceInteger, sportDistanceDecimals;
                    sportDistanceInteger  = (uint8_t)(mUTESportDatas.sportDistance);
                    sportDistanceDecimals = (uint8_t)((mUTESportDatas.sportDistance - (float)sportDistanceInteger) * 100);
                    increaseDistance = (sportDistanceInteger * 100 + sportDistanceDecimals) - (uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger * 100 + uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals);
                    uteModuleSprotData.gpsData.gpsTotalDistance += (increaseDistance * 100);//单位由10米切为分米 * 100
                    uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger = sportDistanceInteger;
                    uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals = sportDistanceDecimals;
                    totalDistance = uteModuleSprotData.gpsData.gpsTotalDistance / 10;
                    uteModuleSportCalcRealTimePace(increaseDistance * 10, totalDistance, 10);//单位米
                    uteModuleSportCalcRealTimeSpeed();
                }
                else
                {
                    if (uteModuleSprotData.gpsData.gpsUsesecond >= 10)
                    {
                        uteModuleSportCalcRealTimeInfoBaseOnGPS(uteModuleSprotData.gpsData.gpsUsesecond);
                        uteModuleSprotData.gpsData.gpsUsesecond = 0;
                    }
                }
#endif
            }
            else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x02)
            {
                UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s, %d %d %d %d", __func__, uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger,
                               uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals, uteModuleSprotData.moreSportData.saveData.sportDistanceInteger, uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals);
                increaseDistance = (uteModuleSprotData.moreSportData.saveData.sportDistanceInteger * 100 + uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals) - (uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger * 100 + uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals);
                totalDistance = uteModuleSprotData.moreSportData.saveData.sportDistanceInteger * 100 + uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals;
                uteModuleSportCalcRealTimePace(increaseDistance * 10, totalDistance * 10, 10);//单位由10米切为米 * 10
                uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger = uteModuleSprotData.moreSportData.saveData.sportDistanceInteger;
                uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals = uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals;
                uteModuleSportCalcRealTimeSpeed();
            }
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
            else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x03)
            {
                if (uteModuleSprotData.gpsData.gpsUsesecond >= 10)
                {
                    uteModuleSportCalcRealTimeInfoBaseOnGPS(uteModuleSprotData.gpsData.gpsUsesecond);
                    uteModuleSprotData.gpsData.gpsUsesecond = 0;
                }
            }
            else if (uteModuleSprotData.moreSportData.saveData.saveInfoType == 0x04)
            {
                if (uteModuleSprotData.gpsData.gpsUsesecond >= 10)
                {
                    uteModuleSportCalcRealTimeInfoBaseOnGPS(uteModuleSprotData.gpsData.gpsUsesecond);
                    uteModuleSprotData.gpsData.gpsUsesecond = 0;
                }
            }
#endif
        }
    }
}

/**
*@brief         初始化心率区间相关参数
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportInitSportsHRRangeData(void)
{
    uint8_t hrValue = 0;

#if APP_MODULE_HEART_MAX_HEARTRATE_SET_SUPPORT
    hrValue = uteModuleHeartGetSaveMaxHeartValue();
#else
    hrValue = 220 - DEFAULT_PERSONALINFO_AGE;
#endif
    uteModuleSprotData.moreSportsCalc.saveIndex = 0;
    uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger = 0;
    uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals = 0;
    uteModuleSprotData.moreSportsCalc.lastSportStepCnt = 0;
    uteModuleSprotData.moreSportsCalc.hrWarmup = (hrValue * 5) / 10;
    uteModuleSprotData.moreSportsCalc.hrWeightReduction = (hrValue * 6) / 10;
    uteModuleSprotData.moreSportsCalc.hrEndurance = (hrValue * 7) / 10;
    uteModuleSprotData.moreSportsCalc.hrAnaerobic = (hrValue * 8) / 10;
    uteModuleSprotData.moreSportsCalc.hrExtreme = (hrValue * 9) / 10;
    uteModuleSprotData.moreSportData.saveData.maxTimeMinute = 0;
    uteModuleSprotData.moreSportData.saveData.maxTimeSecond = 0;
    uteModuleSprotData.moreSportData.saveData.minTimeMinute = 0;//0xFF;
    uteModuleSprotData.moreSportData.saveData.minTimeSecond = 0;//0xFF;
    uteModuleSprotData.moreSportData.saveData.maxStepfrequency = 0;
    uteModuleSprotData.moreSportData.saveData.minStepfrequency = 0;
    uteModuleSprotData.moreSportData.saveData.avgStepfrequency = 0;
    uteModuleSprotData.moreSportData.saveData.hrWarmupCnt = 0;
    uteModuleSprotData.moreSportData.saveData.hrWeightReductionCnt = 0;
    uteModuleSprotData.moreSportData.saveData.hrEnduranceCnt = 0;
    uteModuleSprotData.moreSportData.saveData.hrAnaerobicCnt = 0;
    uteModuleSprotData.moreSportData.saveData.hrExtremeCnt = 0;
#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
    if (uteModuleSportGetGPSStatus() != GPS_LACATION_OK)
        uteModuleSportGPSDataInit();
#endif
}
/**
*@brief         设置存储的数据内容
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportSetCurrSportDataSaveType(uint8_t type)
{
    uteModuleSprotData.moreSportData.saveData.saveInfoType = type;
}
/**
*@brief 获取心率等级范围
*@details 判断心率区间的范围，一共6个等级
*@return 返回值  0表示静息状态
                1表示减压状态
                2表示燃脂状态
                3表示心肺状态
                4表示无氧状态
                5表示极限状态
*@author       wuhuowang
*@date       2022-11-18
*/
uint8_t uteModuleSportGetHeartValueRange(uint8_t heart)
{
    uint8_t retValue = 0;

    if (heart >= uteModuleSprotData.moreSportsCalc.hrWarmup
        && heart < uteModuleSprotData.moreSportsCalc.hrWeightReduction)
        retValue = 1;
    else if (heart >= uteModuleSprotData.moreSportsCalc.hrWeightReduction
             && heart < uteModuleSprotData.moreSportsCalc.hrEndurance)
        retValue = 2;
    else if (heart >= uteModuleSprotData.moreSportsCalc.hrEndurance
             && heart < uteModuleSprotData.moreSportsCalc.hrAnaerobic)
        retValue = 3;
    else if (heart >= uteModuleSprotData.moreSportsCalc.hrAnaerobic
             && heart < uteModuleSprotData.moreSportsCalc.hrExtreme)
        retValue = 4;
    else if (heart >= uteModuleSprotData.moreSportsCalc.hrExtreme)
        retValue = 5;

    return retValue;
}

/**
*@brief     删除不符合保存运动数据的运动
*@details
*@param[in] startTime
*@author       wuhuowang
*@date       2022-12-19
*/
void uteModuleSportMoreSportsDeleteInvalidData(ute_module_systemtime_time_t startTime)
{
    uint8_t path[30];

    memset(&path[0], 0, 30);
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, dirInfo, NULL);
    if(dirInfo->filesCnt> 0)
    {
        sprintf((char *)&path[0], "%s/%04d%02d%02d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, startTime.year, startTime.month, startTime.day, startTime.hour, startTime.min);
        UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,del file=%s", __func__, &path[0]);
        uteModuleFilesystemDelFile(&path[0]);
    }
    uteModulePlatformMemoryFree(dirInfo);
}
#endif
/**
*@brief         获取当天距离，返回公里
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint16_t uteModuleSportGetCurrDayDistanceDataWithKM(void)
{
    float distance;
    float distance_Step, distance_Run;
    ute_personal_info_t personal;
    uteApplicationCommonGetPersonalInfo(&personal);
    uint16_t tempDistance = 0;
    uteModulePlatformTakeMutex(uteModuleSprotMute);

    if (personal.isMan)
    {
        distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.currDayWalkStep)) * 0.00001f * 0.4102670f);
        distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.currDayRunStep))*0.00001f * 0.5461055f);
    }
    else
    {
        distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.currDayWalkStep))*0.00001f * 0.4151582f);
        distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.currDayRunStep))*0.00001f * 0.5047813f);
    }
    distance_Step = ExactDecimalPoint(distance_Step, 2);
    distance_Run = ExactDecimalPoint(distance_Run, 2);
    distance = ExactDecimalPoint((distance_Step + distance_Run), 2);

    distance = ExactDecimalPoint(distance, 2);
    tempDistance = (uint16_t)(distance * 100.f) ; //放大浮点取小数点后两位
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
    uint16_t moreSportDistance = uteModuleSprotData.todaySportWithStepsData.distance;
    tempDistance = tempDistance + moreSportDistance;
#endif
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
    tempDistance += uteModuleSprotData.todaySportOtherData.distance;
#endif
    uteModulePlatformGiveMutex(uteModuleSprotMute);
    if (tempDistance > 9999)
    {
        tempDistance = 9999;
    }
    return tempDistance;
}
/**
*@brief         获取当天总步数
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint32_t uteModuleSportGetCurrDayTotalStepCnt(void)
{
    uint32_t totalStep = 0;
#if UTE_MODULE_SPORT_TODAY_ADD_ALL_SPORT_DATA_SUPPORT
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
    totalStep = uteModuleSprotData.currDayTotalStep + uteModuleSprotData.todaySportWithStepsData.step + uteModuleSprotData.todaySportOtherData.step;
#else
    totalStep = uteModuleSprotData.currDayTotalStep + uteModuleSprotData.todaySportWithStepsData.step;
#endif
#else
    totalStep = uteModuleSprotData.currDayTotalStep;
#endif
    return totalStep;
}
/**
*@brief         获取当前小时与计步相关的卡路里
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint16_t uteModuleSportGetCurrHourKcalDataWithStep(void)
{
    uint16_t kcal = 0;
    float distance_Step, distance_Run;
    float kcli_Step, kcli_Run, kcli;
    ute_personal_info_t personal;
    uteApplicationCommonGetPersonalInfo(&personal);
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    if (personal.isMan)
    {
        distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt)) * 0.00001f * 0.4102670f);
        distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.stepSleepData.current_hour_run_stepCnt))*0.00001f * 0.5461055f);

        kcli_Step = (float)(distance_Step * personal.weight / 1000.0f * 0.5907296f);
        kcli_Run =  (float)(distance_Run*personal.weight / 1000.0f * 0.9288487f);
    }
    else
    {
        distance_Step = (float)((float)((personal.height) * (uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt)) * 0.00001f * 0.4151582f);
        distance_Run = (float)((float)((personal.height) * (uteModuleSprotData.stepSleepData.current_hour_run_stepCnt)) * 0.00001f * 0.5047813f);

        kcli_Step = (float)(distance_Step * personal.weight / 1000.0f * 0.7918928f);
        kcli_Run = (float)(distance_Run * personal.weight / 1000.0f * 1.234930f);
    }
    kcli_Step = ExactDecimalPoint(kcli_Step, 1);
    kcli_Run = ExactDecimalPoint(kcli_Run, 1);
    kcli = ExactDecimalPoint((kcli_Step + kcli_Run), 2);
    uteModulePlatformGiveMutex(uteModuleSprotMute);
    kcal = (uint16_t)(kcli * 1.0f);
    if (kcal > 9999)
    {
        kcal = 9999;
    }
    return kcal;
}

/**
*@brief         获取当前小时距离
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint16_t uteModuleSportGetCurrHourDistanceData(void)
{
    uint16_t tempDistance = 0;
    uint16_t totalDistance = 0;

    totalDistance = uteModuleSportGetCurrDayDistanceDataWithKM();
    if (totalDistance > uteModuleSprotData.lastHourRecordDistance)
        tempDistance = totalDistance - uteModuleSprotData.lastHourRecordDistance;
    return tempDistance;
}

/**
*@brief         获取当前小时卡路里
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint16_t uteModuleSportGetCurrHourKcalData(void)
{
    uint16_t kcal = 0;
    uint16_t totalkcal = 0;

    totalkcal = uteModuleSportGetCurrDayKcalData();
    if (totalkcal > uteModuleSprotData.lastHourRecordKcal)
        kcal = totalkcal - uteModuleSprotData.lastHourRecordKcal;
    return kcal;
}

/**
*@brief         获取当前小时步数
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint16_t uteModuleSportGetCurrHourStepData(void)
{
    uint16_t step = 0;
    uint32_t totalStep = 0;

    totalStep = uteModuleSportGetCurrDayTotalStepCnt();
    if (totalStep > uteModuleSprotData.lastHourRecordStep)
        step = totalStep - uteModuleSprotData.lastHourRecordStep;
    return step;
}

#if APP_MODULE_SPORT_EXERCISE_TIME_SUPPORT
/**
*@brief     读取某一天的所有消耗、步数、活动时长
*@details
*@param[in] ute_module_systemtime_time_t time, 读取的时间
*@return
*@author        wuhuowang
*@date        2022-11-19
*/
void uteModuleSportReadOneDayDataWithTime(ute_module_systemtime_time_t time, uint32_t *step, uint16_t *kcal, uint16_t *exercisetime)
{
    uint32_t tmpTotalStep = 0;
    uint32_t tmpTotalTime = 0;
    uint16_t tmpTotalKcal = 0;
    uint8_t i = 0;
    void *file;
    uint8_t path[30];
    uint16_t buffSize = 32 * 24 + 4;
    uint8_t *readBuff = uteModulePlatformMemoryAlloc(buffSize);
    memset(&path[0], 0, 30);
    sprintf((char *)&path[0], "%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, time.year, time.month, time.day);
    // read
    if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &readBuff[0], buffSize);
        uteModuleFilesystemCloseFile(file);
        for (i = 0; i < 24; i ++)
        {
            tmpTotalTime += (readBuff[4 + i * 32] << 8) | readBuff[4 + i * 32 + 1];
            tmpTotalTime += (readBuff[4 + i * 32 + 2] << 8) | readBuff[4 + i * 32 + 3];
            tmpTotalTime += (readBuff[4 + i * 32 + 4] << 8) | readBuff[4 + i * 32 + 5];
            tmpTotalTime += (readBuff[4 + i * 32 + 12] << 8) | readBuff[4 + i * 32 + 13];
            tmpTotalTime += (readBuff[4 + i * 32 + 14] << 8) | readBuff[4 + i * 32 + 15];
            tmpTotalTime += (readBuff[4 + i * 32 + 16] << 8) | readBuff[4 + i * 32 + 17];
            tmpTotalTime += (readBuff[4 + i * 32 + 18] << 8) | readBuff[4 + i * 32 + 19];
            tmpTotalTime += (readBuff[4 + i * 32 + 20] << 8) | readBuff[4 + i * 32 + 21];
            tmpTotalTime += (readBuff[4 + i * 32 + 22] << 8) | readBuff[4 + i * 32 + 23];
            tmpTotalTime += (readBuff[4 + i * 32 + 24] << 8) | readBuff[4 + i * 32 + 25];
            tmpTotalTime += (readBuff[4 + i * 32 + 26] << 8) | readBuff[4 + i * 32 + 27];
            tmpTotalTime += (readBuff[4 + i * 32 + 28] << 8) | readBuff[4 + i * 32 + 29];
            tmpTotalTime += (readBuff[4 + i * 32 + 30] << 8) | readBuff[4 + i * 32 + 31];
            tmpTotalKcal += (readBuff[4 + i * 32 + 6] << 8) | readBuff[4 + i * 32 + 7];
            tmpTotalStep += (readBuff[4 + i * 32 + 10] << 8) | readBuff[4 + i * 32 + 11];
        }
    }
    uteModulePlatformMemoryFree(readBuff);
    *step = tmpTotalStep;
    *kcal = tmpTotalKcal;
    *exercisetime = tmpTotalTime / 60;  //minute
}

/**
*@brief     读取一周内每天的总消耗数据、步数、活动时长
*@details
*@author        wuhuowang
*@date        2022-11-19
*/
void uteModuleSportReadWeekDayData(void)
{
    uint8_t i = 0;
    ute_module_systemtime_time_t time;
    ute_module_systemtime_time_t readTime;
    uint32_t onedayTotalStep = 0;
    uint16_t onedayTotalTime = 0;
    uint16_t onedayTotalKcal = 0;

    uteModuleSystemtimeGetTime(&time);
    memset(&uteModuleSprotData.dailyActivity.weekDayTotalKcal[0], 0, 14);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,%04d%02d%02d,week=%d",__func__,time.year,time.month,time.day,time.week);
    for (i = 0; i <= time.week; i ++)
    {
        memcpy(&readTime, &time, sizeof(ute_module_systemtime_time_t));
        uteModuleSystemtimeInputDateIncreaseDecreaseDay(&readTime, i - time.week);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,readTime,%04d%02d%02d,week=%d",__func__,readTime.year,readTime.month,readTime.day,readTime.week);
        onedayTotalKcal = 0;
        onedayTotalTime = 0;
        onedayTotalStep = 0;
        uteModuleSportReadOneDayDataWithTime(readTime, &onedayTotalStep, &onedayTotalKcal, &onedayTotalTime);
        uteModuleSprotData.dailyActivity.weekDayTotalStep[i] = onedayTotalStep;
        uteModuleSprotData.dailyActivity.weekDayTotalKcal[i] = onedayTotalKcal;
        uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[i] = onedayTotalTime;
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,WeekDayData[%d]=%d %d %d",__func__,i,uteModuleSprotData.dailyActivity.weekDayTotalStep[i],uteModuleSprotData.dailyActivity.weekDayTotalKcal[i],uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[i]);
    }
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL,"%s,finish",__func__);
}
/**
*@brief  读取当天每小时的活动时长
*@details
*@author   wuhuowang
*@date     2022-11-18
*/
void uteModuleSportGetCurrDayEveryHourExerciseTime(void)
{
    uint32_t tmpTotal = 0;
    uint16_t curHourKcal = 0;
    ute_module_systemtime_time_t time;

    curHourKcal = uteModuleSportGetCurrHourKcalData();
    uteModuleSystemtimeGetTime(&time);
    uteModulePlatformTakeMutex(uteModuleSprotMute);
    if (time.hour != uteModuleSprotData.lastReadHour)
    {
        void *file;
        uint8_t path[30];
        uint16_t buffSize = 32 * 24 + 4;
        uint8_t readBuff[buffSize];
        //uint8_t *readBuff = uteModulePlatformMemoryAlloc(buffSize);
        memset(&path[0], 0, 30);
        memset(&readBuff[0], 0, buffSize);
        sprintf((char *)&path[0], "%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, time.year, time.month, time.day);
        // read
        if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY))
        {
            uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
            uteModuleFilesystemReadData(file, &readBuff[0], buffSize);
            uteModuleFilesystemCloseFile(file);
            memset(uteModuleSprotData.dailyActivity.everyHourAllSportStep, 0x00, 24 * 4);
            memset(uteModuleSprotData.dailyActivity.everyHourAllSportKcal, 0x00, 24 * 2);
            memset(&uteModuleSprotData.dailyActivity.everyHourExerciseTime[0], 0, 24);
            for (uint8_t i = 0; i < 24; i ++)
            {
                tmpTotal = 0;
                if (time.hour == i)
                {
                    for (uint8_t j = 0; j < 13; j ++)
                    {
                        uteModuleSprotData.dailyActivity.everyHourExerciseTime[i] += (uteModuleSprotData.exerciseTime[j] / 60);
                    }
                    uteModuleSprotData.dailyActivity.everyHourAllSportStep[i] = uteModuleSportGetCurrHourStepData();//uteModuleSprotData.stepSleepData.currentHourStepCnt;
                    uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i] = curHourKcal;
                    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,i=%d,everyHourExerciseTime[hour]=%d", __func__,time.hour,uteModuleSprotData.dailyActivity.everyHourExerciseTime[i]);
                    break;
                }
                tmpTotal += (readBuff[4 + i * 32] << 8) | readBuff[4 + i * 32 + 1];
                tmpTotal += (readBuff[4 + i * 32 + 2] << 8) | readBuff[4 + i * 32 + 3];
                tmpTotal += (readBuff[4 + i * 32 + 4] << 8) | readBuff[4 + i * 32 + 5];
                tmpTotal += (readBuff[4 + i * 32 + 12] << 8) | readBuff[4 + i * 32 + 13];
                tmpTotal += (readBuff[4 + i * 32 + 14] << 8) | readBuff[4 + i * 32 + 15];
                tmpTotal += (readBuff[4 + i * 32 + 16] << 8) | readBuff[4 + i * 32 + 17];
                tmpTotal += (readBuff[4 + i * 32 + 18] << 8) | readBuff[4 + i * 32 + 19];
                tmpTotal += (readBuff[4 + i * 32 + 20] << 8) | readBuff[4 + i * 32 + 21];
                tmpTotal += (readBuff[4 + i * 32 + 22] << 8) | readBuff[4 + i * 32 + 23];
                tmpTotal += (readBuff[4 + i * 32 + 24] << 8) | readBuff[4 + i * 32 + 25];
                tmpTotal += (readBuff[4 + i * 32 + 26] << 8) | readBuff[4 + i * 32 + 27];
                tmpTotal += (readBuff[4 + i * 32 + 28] << 8) | readBuff[4 + i * 32 + 29];
                tmpTotal += (readBuff[4 + i * 32 + 30] << 8) | readBuff[4 + i * 32 + 31];
                uteModuleSprotData.dailyActivity.everyHourExerciseTime[i] = tmpTotal / 60;
                uteModuleSprotData.dailyActivity.everyHourAllSportStep[i] = (readBuff[4 + i * 32 + 10] << 8) | readBuff[4 + i * 32 + 11];
                uteModuleSprotData.dailyActivity.everyHourAllSportKcal[i] = (readBuff[4 + i * 32 + 6] << 8) | readBuff[4 + i * 32 + 7];
                UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s,i=%d,tmpTotal=%d,everyHourExerciseTime[]=%d", __func__,i,tmpTotal,uteModuleSprotData.dailyActivity.everyHourExerciseTime[i]);
            }
        }
        //uteModulePlatformMemoryFree(readBuff);
        uteModuleSprotData.lastReadHour = time.hour;
        //  UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,readTotal=%d,readRun=%d,readWalk=%d", __func__,readTotal,readRun,readWalk);
    }
    else
    {
        uteModuleSprotData.dailyActivity.everyHourExerciseTime[time.hour] = 0;
        for (uint8_t j = 0; j < 13; j ++)
        {
            uteModuleSprotData.dailyActivity.everyHourExerciseTime[time.hour] += (uteModuleSprotData.exerciseTime[j] / 60);
        }
        uteModuleSprotData.dailyActivity.everyHourAllSportStep[time.hour] = uteModuleSportGetCurrHourStepData();//uteModuleSprotData.stepSleepData.currentHourStepCnt;
        uteModuleSprotData.dailyActivity.everyHourAllSportKcal[time.hour] = curHourKcal;
    }
    uteModulePlatformGiveMutex(uteModuleSprotMute);
    //UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currentHourStepCnt=%d,current_hour_run_stepCnt=%d,current_hour_walk_stepCnt=%d", __func__,uteModuleSprotData.stepSleepData.currentHourStepCnt,uteModuleSprotData.stepSleepData.current_hour_run_stepCnt,uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt);
}

/**
*@brief       获取当天活动时长的总时间
*@details
*@author     wuhuowang
*@date       2022-10-22
*/
uint16_t uteModuleSportGetCurrDayExerciseData(void)
{
    uint16_t totalTime = 0;
    uint8_t i = 0;

    uteModuleSportGetCurrDayEveryHourExerciseTime();
    for (i = 0; i < 24; i ++)
    {
        totalTime += uteModuleSprotData.dailyActivity.everyHourExerciseTime[i];
    }
    return totalTime * 60;
}

/**
*@brief     加载活动时长每个小时的活动时长柱状图数据
*@details
*@param[out] uint8_t *everyHourSportTime[24]
*@return    当天最大活动时长
*@author      wuhuowang
*@date       2022-10-22
*/
uint8_t uteModuleSportLoadTodayEveryHourExerciseTimeHistoryData(uint8_t *everyHourSportTime)
{
    uint8_t maxSportTime = 0;
    uint8_t sportTime = 0;
    uint8_t i = 0;
    ute_module_systemtime_time_t time;

    uteModuleSystemtimeGetTime(&time);
    uteModuleSportGetCurrDayEveryHourExerciseTime();
    memset(everyHourSportTime, 0, 24);
    //for (i = 0; i < 24; i ++)
    //    uteModuleSprotData.dailyActivity.everyHourExerciseTime[i] = i * 2;
    for (i = 0; i < 24; i ++)
    {
        if(i > time.hour)
        {
            break;
        }
        if (uteModuleSprotData.dailyActivity.everyHourExerciseTime[i] > sportTime)
        {
            sportTime = uteModuleSprotData.dailyActivity.everyHourExerciseTime[i];
        }
        if (sportTime > 60)
        {
            sportTime = 60;
        }
    }
    if (sportTime > 30)
    {
        u8 temp = (sportTime % 10) ? 1 : 0;
        maxSportTime = (sportTime / 10 + temp) * 10;//
    }
    else
    {
        maxSportTime = 30;
    }
    for (i = 0; i < 24; i ++)
    {
        if (i > time.hour)
        {
            break;
        }
        sportTime = uteModuleSprotData.dailyActivity.everyHourExerciseTime[i];
        if(sportTime > 60)
        {
            sportTime = 60;
        }
        everyHourSportTime[i] = sportTime;
    }
    return maxSportTime;
}

/**
*@brief     加载今日活动周每天的卡路里柱状图
*@details
*@param[out] uint16_t weekDayTotalKcal[7] 每日卡路里
*@param[out] *totalKcal 周卡路里总数
*@return  uint32_t  当周最大数据的整1000倍数据，如2300，返回3000，最小返回1000
*@author      wuhuowang
*@date       2022-10-22
*/
uint32_t uteModuleSportLoadWeekDayKcalHistoryData(uint16_t *weekDayTotalKcal, uint32_t *totalKcal)
{
    //kcal graph
    uint8_t i = 0;
    uint32_t maxKcal = 0;
    uint32_t inKcal1000 = 0;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uteModuleSprotData.dailyActivity.weekDayTotalKcal[time.week] = uteModuleSportGetCurrDayKcalData();
    memset(weekDayTotalKcal, 0, sizeof(uint16_t) * 7);
    *totalKcal = 0;
    //for (i = 0; i < 7; i ++)
    //    uteModuleSprotData.dailyActivity.weekDayTotalKcal[i] = 1000 * i;
    for (i = 0; i < 7; i ++)
    {
        *totalKcal = *totalKcal + uteModuleSprotData.dailyActivity.weekDayTotalKcal[i];
        if (uteModuleSprotData.dailyActivity.weekDayTotalKcal[i] > maxKcal)
        {
            maxKcal = uteModuleSprotData.dailyActivity.weekDayTotalKcal[i];
        }
        if (maxKcal > 99999)
        {
            maxKcal = 99999;
        }
    }
    if (maxKcal % 1000)
    {
        inKcal1000 = (maxKcal / 1000 + 1) * 1000;
    }
    else
    {
        inKcal1000 = maxKcal;
        if (inKcal1000 == 0)
        {
            inKcal1000 = 1000;
        }
    }
    if (maxKcal != 0)
    {
        for (i = 0; i < 7; i ++)
        {
            uint32_t kcal = uteModuleSprotData.dailyActivity.weekDayTotalKcal[i];
            if (kcal > 99999)
            {
                kcal = 99999;
            }
            weekDayTotalKcal[i] = kcal;
        }
    }
    return inKcal1000;
}

/**
*@brief     加载今日活动周每天的活动时长柱状图
*@details
*@param[in] uint16_t weekDayTotalExerciseTime[7] 每天的活动时长
*@param[out] *totalTime 周活动时长总数
*@return  uint16_t  当周最大数据的整100倍数据，如230，返回300，最小返回100
*@author      wuhuowang
*@date       2022-10-22
*/
uint16_t uteModuleSportLoadWeekDayExerciseTimeHistoryData(uint16_t *weekDayTotalExerciseTime, uint16_t *totalTime)
{
    //exercise graph
    uint8_t i = 0;
    uint16_t maxTime = 0;
    uint16_t inTime100 = 0;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[time.week] = uteModuleSportGetCurrDayExerciseData();
    memset(weekDayTotalExerciseTime, 0, sizeof(uint16_t) * 7);
    *totalTime = 0;
    //for (i = 0; i < 7; i ++)
    //    uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[i] = 2 * i;
    for (i = 0; i < 7; i ++)
    {
        *totalTime = *totalTime + uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[i];
        if (uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[i] > maxTime)
        {
            maxTime = uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[i];
        }
        if (maxTime > 1440)
        {
            maxTime = 1440;
        }
    }
    if (maxTime % 100)
    {
        inTime100 = (maxTime / 100 + 1) * 100;
    }
    else
    {
        inTime100 = maxTime;
        if (inTime100 == 0)
        {
            inTime100 = 100;
        }
    }
    if (maxTime != 0)
    {
        for (i = 0; i < 7; i ++)
        {
            uint16_t exerciseTime = uteModuleSprotData.dailyActivity.weekDayTotalExerciseTime[i];
            if (exerciseTime > 1440)
            {
                exerciseTime = 1440;
            }
            weekDayTotalExerciseTime[i] = exerciseTime;
        }
    }
    return inTime100;
}
/**
*@brief        保存当前活动时长数据
*@details      每天保存一个文件，前面4个byte为年月日，后面每32个byte为一个小时的数据（参考协议的数据格式）
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportSaveExerciseTimeData(void)
{
    /*! 没有连接过APP不保存数据*/
    if (!uteApplicationCommonIsHasConnectOurApp())
    {
        return;
    }
    uint16_t curHourkcal = 0;
    uint16_t curHourdis = 0;
    uint32_t curHourstep = 0;
    uint16_t buffSize = 32 * 24 + 4;
    uint8_t *readBuff = uteModulePlatformMemoryAlloc(buffSize);
    uint8_t path[40];
    memset(&readBuff[0], 0, buffSize);
    memset(&path[0], 0, 40);
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    sprintf((char *)&path[0], "%04d%02d%02d", time.year, time.month, time.day);
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, dirInfo, NULL);
    if ((dirInfo->filesCnt >= UTE_MODULE_SPORT_SAVE_STEP_DATA_MAX_DAYS) && (memcmp(&path[0], &dirInfo->filesName[0][0], 8) != 0))
    {
        /*! 删除最旧一天的数据    */
        memset(&path[0],0,40);
        sprintf((char *)&path[0],"%s/%s",UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, &dirInfo->filesName[0][0]);
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__, &path[0]);
        uteModuleFilesystemDelFile((char *)&path[0]);
    }
    memset(&path[0], 0, 40);
    sprintf((char *)&path[0], "%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, time.year, time.month, time.day);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,dirInfo->filesCnt=%d", __func__, dirInfo->filesCnt);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,save file=%s", __func__, &path[0]);
    /*! 保存当前数据   */
    void *file;
    // read
    if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &readBuff[0], buffSize);
        uteModuleFilesystemCloseFile(file);
    }
    else
    {
        readBuff[0] = time.year >> 8 & 0xff;
        readBuff[1] = time.year & 0xff;
        readBuff[2] = time.month;
        readBuff[3] = time.day;
    }
    if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_WRONLY | FS_O_CREAT))
    {
        uint16_t cacheOffset = 0;
        uint8_t i = 0;

        curHourkcal = uteModuleSportGetCurrHourKcalData();
        curHourdis = uteModuleSportGetCurrHourDistanceData();
        curHourstep = uteModuleSportGetCurrHourStepData();
        for (i = 0; i < 13; i ++)
        {
            uteModuleSprotData.exerciseTime[i] = (uteModuleSprotData.exerciseTime[i] / 60) * 60;
        }
        cacheOffset = 4 + 32 * time.hour;
        UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,cacheOffset=%d", __func__, cacheOffset);
        readBuff[cacheOffset] = (uteModuleSprotData.exerciseTime[0] >> 8) & 0xff;
        readBuff[cacheOffset + 1] = uteModuleSprotData.exerciseTime[0] & 0xff;
        readBuff[cacheOffset + 2] = (uteModuleSprotData.exerciseTime[1] >> 8) & 0xff;
        readBuff[cacheOffset + 3] = uteModuleSprotData.exerciseTime[1] & 0xff;
        readBuff[cacheOffset + 4] = (uteModuleSprotData.exerciseTime[2] >> 8) & 0xff;
        readBuff[cacheOffset + 5] = uteModuleSprotData.exerciseTime[2] & 0xff;
        readBuff[cacheOffset + 6] = (curHourkcal >> 8) & 0xff;//current hour calorie
        readBuff[cacheOffset + 7] = curHourkcal & 0xff;//current hour calorie
        readBuff[cacheOffset + 8] = (curHourdis / 100) & 0xff;//current hour distance inter
        readBuff[cacheOffset + 9] = (curHourdis % 100) & 0xff;//current hour distance decm
        readBuff[cacheOffset + 10] = (curHourstep >> 8) & 0xff;//current hour step
        readBuff[cacheOffset + 11] = (curHourstep) & 0xff;//current hour step
        readBuff[cacheOffset + 12] = (uteModuleSprotData.exerciseTime[3] >> 8) & 0xff;
        readBuff[cacheOffset + 13] = uteModuleSprotData.exerciseTime[3] & 0xff;
        readBuff[cacheOffset + 14] = (uteModuleSprotData.exerciseTime[4] >> 8) & 0xff;
        readBuff[cacheOffset + 15] = uteModuleSprotData.exerciseTime[4] & 0xff;
        readBuff[cacheOffset + 16] = (uteModuleSprotData.exerciseTime[5] >> 8) & 0xff;
        readBuff[cacheOffset + 17] = uteModuleSprotData.exerciseTime[5] & 0xff;
        readBuff[cacheOffset + 18] = (uteModuleSprotData.exerciseTime[6] >> 8) & 0xff;
        readBuff[cacheOffset + 19] = uteModuleSprotData.exerciseTime[6] & 0xff;
        readBuff[cacheOffset + 20] = (uteModuleSprotData.exerciseTime[7] >> 8) & 0xff;
        readBuff[cacheOffset + 21] = uteModuleSprotData.exerciseTime[7] & 0xff;
        readBuff[cacheOffset + 22] = (uteModuleSprotData.exerciseTime[8] >> 8) & 0xff;
        readBuff[cacheOffset + 23] = uteModuleSprotData.exerciseTime[8] & 0xff;
        readBuff[cacheOffset + 24] = (uteModuleSprotData.exerciseTime[9] >> 8) & 0xff;
        readBuff[cacheOffset + 25] = uteModuleSprotData.exerciseTime[9] & 0xff;
        readBuff[cacheOffset + 26] = (uteModuleSprotData.exerciseTime[10] >> 8) & 0xff;
        readBuff[cacheOffset + 27] = uteModuleSprotData.exerciseTime[10] & 0xff;
        readBuff[cacheOffset + 28] = (uteModuleSprotData.exerciseTime[11] >> 8) & 0xff;
        readBuff[cacheOffset + 29] = uteModuleSprotData.exerciseTime[11] & 0xff;
        readBuff[cacheOffset + 30] = (uteModuleSprotData.exerciseTime[12] >> 8) & 0xff;
        readBuff[cacheOffset + 31] = uteModuleSprotData.exerciseTime[12] & 0xff;
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemWriteData(file, &readBuff[0], buffSize);
        uteModuleFilesystemCloseFile(file);
    }
    uteModulePlatformMemoryFree(readBuff);
    uteModulePlatformMemoryFree(dirInfo);
//#if UTE_MODULE_CYWEE_MOTION_SUPPORT
//    uteModuleCwmSaveStepData();     //保存当天运动数据
//#endif
}

/**
*@brief        恢复当前小时活动时长数据
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportRestoreCurrHourExerciseTimeData(void)
{
    uint16_t buffSize = 32 * 24 + 4;
    uint8_t *readBuffOneDay = uteModulePlatformMemoryAlloc(buffSize);
    uint8_t path[40];
    uint8_t i = 0;
    void *file;
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    memset(&path[0], 0, 40);
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,%04d-%02d-%02d,%02d:%02d:%02d", __func__,time.year,time.month,time.day,time.hour,time.min,time.sec);
    sprintf((char *)&path[0], "%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, time.year, time.month, time.day);
    memset(&readBuffOneDay[0], 0, buffSize);
    if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &readBuffOneDay[0], buffSize);
        uteModuleFilesystemCloseFile(file);
    }
    memset(&uteModuleSprotData.exerciseTime[0], 0, 13 * 2);
    uteModuleSprotData.exerciseTime[0] = (readBuffOneDay[4 + time.hour * 32] << 8) | readBuffOneDay[4 + time.hour * 32 + 1];
    uteModuleSprotData.exerciseTime[1] = (readBuffOneDay[4 + time.hour * 32 + 2] << 8) | readBuffOneDay[4 + time.hour * 32 + 3];
    uteModuleSprotData.exerciseTime[2] = (readBuffOneDay[4 + time.hour * 32 + 4] << 8) | readBuffOneDay[4 + time.hour * 32 + 5];
    uteModuleSprotData.exerciseTime[3] = (readBuffOneDay[4 + time.hour * 32 + 12] << 8) | readBuffOneDay[4 + time.hour * 32 + 13];
    uteModuleSprotData.exerciseTime[4] = (readBuffOneDay[4 + time.hour * 32 + 14] << 8) | readBuffOneDay[4 + time.hour * 32 + 15];
    uteModuleSprotData.exerciseTime[5] = (readBuffOneDay[4 + time.hour * 32 + 16] << 8) | readBuffOneDay[4 + time.hour * 32 + 17];
    uteModuleSprotData.exerciseTime[6] = (readBuffOneDay[4 + time.hour * 32 + 18] << 8) | readBuffOneDay[4 + time.hour * 32 + 19];
    uteModuleSprotData.exerciseTime[7] = (readBuffOneDay[4 + time.hour * 32 + 20] << 8) | readBuffOneDay[4 + time.hour * 32 + 21];
    uteModuleSprotData.exerciseTime[8] = (readBuffOneDay[4 + time.hour * 32 + 22] << 8) | readBuffOneDay[4 + time.hour * 32 + 23];
    uteModuleSprotData.exerciseTime[9] = (readBuffOneDay[4 + time.hour * 32 + 24] << 8) | readBuffOneDay[4 + time.hour * 32 + 25];
    uteModuleSprotData.exerciseTime[10] = (readBuffOneDay[4 + time.hour * 32 + 26] << 8) | readBuffOneDay[4 + time.hour * 32 + 27];
    uteModuleSprotData.exerciseTime[11] = (readBuffOneDay[4 + time.hour * 32 + 28] << 8) | readBuffOneDay[4 + time.hour * 32 + 29];
    uteModuleSprotData.exerciseTime[12] = (readBuffOneDay[4 + time.hour * 32 + 30] << 8) | readBuffOneDay[4 + time.hour * 32 + 31];
    uteModuleSprotData.lastHourRecordKcal = 0;
    uteModuleSprotData.lastHourRecordDistance = 0;
    uteModuleSprotData.lastHourRecordStep = 0;
    for (i = 0; i < time.hour; i ++)
    {
        uteModuleSprotData.lastHourRecordKcal += ((readBuffOneDay[4 + i * 32 + 6] << 8) | readBuffOneDay[4 + i * 32 + 7]);
        uteModuleSprotData.lastHourRecordDistance += ((readBuffOneDay[4 + i * 32 + 8] << 8) | readBuffOneDay[4 + i * 32 + 9]);
        uteModuleSprotData.lastHourRecordStep += ((readBuffOneDay[4 + i * 32 + 10] << 8) | readBuffOneDay[4 + i * 32 + 11]);
    }
    uteModulePlatformMemoryFree(readBuffOneDay);
}

/**
*@brief         从flash读取当天活动时长信息
*@details
*@author       wuhuowang
*@date       2022-12-19
*/
void uteModuleSportReadCurrDayExerciseTimeData(ute_module_systemtime_time_t time)
{
    uint32_t tmpTotal = 0;
    uteModulePlatformTakeMutex(uteModuleSprotMute);

    if (time.hour != uteModuleSprotData.lastReadHour)
    {
        void *file;
        uint8_t path[40];
        uint16_t buffSize = 32 * 24 + 4;
        uint8_t *readBuff = uteModulePlatformMemoryAlloc(buffSize);
        memset(&path[0], 0, 40);
        sprintf((char *)&path[0],"%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, time.year, time.month, time.day);
        uteModuleSprotData.lastHourRecordKcal = 0;
        uteModuleSprotData.lastHourRecordDistance = 0;
        uteModuleSprotData.lastHourRecordStep = 0;
        // read
        if (uteModuleFilesystemOpenFile((char *)(char *)&path[0], &file, FS_O_RDONLY))
        {
            uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
            uteModuleFilesystemReadData(file, &readBuff[0], buffSize);
            uteModuleFilesystemCloseFile(file);
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
            memset(&uteModuleSprotData.dailyActivity.everyHourExerciseTime[0], 0, 24);
#endif
            for (uint8_t i = 0; i < time.hour; i ++)
            {
                tmpTotal = 0;
                tmpTotal += (readBuff[4 + i * 32] << 8) | readBuff[4 + i * 32 + 1];
                tmpTotal += (readBuff[4 + i * 32 + 2] << 8) | readBuff[4 + i * 32 + 3];
                tmpTotal += (readBuff[4 + i * 32 + 4] << 8) | readBuff[4 + i * 32 + 5];
                tmpTotal += (readBuff[4 + i * 32 + 12] << 8) | readBuff[4 + i * 32 + 13];
                tmpTotal += (readBuff[4 + i * 32 + 14] << 8) | readBuff[4 + i * 32 + 15];
                tmpTotal += (readBuff[4 + i * 32 + 16] << 8) | readBuff[4 + i * 32 + 17];
                tmpTotal += (readBuff[4 + i * 32 + 18] << 8) | readBuff[4 + i * 32 + 19];
                tmpTotal += (readBuff[4 + i * 32 + 20] << 8) | readBuff[4 + i * 32 + 21];
                tmpTotal += (readBuff[4 + i * 32 + 22] << 8) | readBuff[4 + i * 32 + 23];
                tmpTotal += (readBuff[4 + i * 32 + 24] << 8) | readBuff[4 + i * 32 + 25];
                tmpTotal += (readBuff[4 + i * 32 + 26] << 8) | readBuff[4 + i * 32 + 27];
                tmpTotal += (readBuff[4 + i * 32 + 28] << 8) | readBuff[4 + i * 32 + 29];
                tmpTotal += (readBuff[4 + i * 32 + 30] << 8) | readBuff[4 + i * 32 + 31];
                uteModuleSprotData.lastHourRecordKcal += ((readBuff[4 + i * 32 + 6] << 8) | readBuff[4 + i * 32 + 7]);
                uteModuleSprotData.lastHourRecordDistance += ((readBuff[4 + i * 32 + 8] << 8) | readBuff[4 + i * 32 + 9]);
                uteModuleSprotData.lastHourRecordStep += ((readBuff[4 + i * 32 + 10] << 8) | readBuff[4 + i * 32 + 11]);
#if UTE_GUI_SCREEN_ACTIVITY_LIST_SUPPORT
                uteModuleSprotData.dailyActivity.everyHourExerciseTime[i] = tmpTotal / 60;
#endif
                //if (time.hour == i)
                //{
                //    break;
                //}
            }
        }
        uteModulePlatformMemoryFree(readBuff);
        uteModuleSprotData.lastReadHour = time.hour;
    }
    //UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,currentHourStepCnt=%d,current_hour_run_stepCnt=%d,current_hour_walk_stepCnt=%d", __func__,uteModuleSprotData.stepSleepData.currentHourStepCnt,uteModuleSprotData.stepSleepData.current_hour_run_stepCnt,uteModuleSprotData.stepSleepData.current_hour_walk_stepCnt);
    uteModulePlatformGiveMutex(uteModuleSprotMute);
}

/**
*@brief         从flash删除未来日期活动时长信息
*@details
*@author       wuhuowang
*@date       2022-12-19
*/
void uteModuleSportDeleteExerciseTimeDataByDay(ute_module_systemtime_time_t time)
{
    /*! 时间往回设置,删除大于新设置日期的数据*/
    uint32_t newSetDay = 0;
    uint32_t fileDay = 0;
    uint8_t path[40];
    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,before del file", __func__);
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, dirInfo, NULL);
    for (int i = (dirInfo->filesCnt - 1); i >= 0; i --)
    {
        memset(&path[0], 0, 40);
        sprintf((char *)&path[0], "%04d%02d%02d", time.year, time.month, time.day);
        newSetDay = atoi((const char *)&path[0]);
        fileDay = atoi((const char *)&dirInfo->filesName[i][0]);
        if (fileDay > newSetDay)
        {
            memset(&path[0], 0, 40);
            sprintf((char *)&path[0], "%s/%s", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, &dirInfo->filesName[i][0]);
            uteModuleFilesystemDelFile((char *)&path[0]);
            UTE_MODULE_LOG(UTE_LOG_STEP_LVL, "%s,del file=%s", __func__,&path[0]);
        }
        else
        {
            break;
        }
    }
    uteModulePlatformMemoryFree(dirInfo);
}

/**
*@brief         从flash删除未来小时活动时长信息
*@details
*@author       wuhuowang
*@date       2022-12-19
*/
void uteModuleSportDeleteExerciseTimeDataByHour(ute_module_systemtime_time_t time)
{
    uint8_t path[40];
    void *file;
    uint16_t buffSize = 32 * 24 + 4;
    uint8_t *readBuffOneDay = uteModulePlatformMemoryAlloc(buffSize);
    memset(&path[0], 0, 40);
    sprintf((char *)&path[0], "%s/%04d%02d%02d", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, time.year, time.month, time.day);
    memset(&readBuffOneDay[0], 0, buffSize);
    if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY | FS_O_WRONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &readBuffOneDay[0], buffSize);
        /*! 清除当前时间下一个小时之后的数据*/
        memset(&readBuffOneDay[4 + (time.hour + 1) * 32], 0, buffSize - (4 + (time.hour + 1) * 32));
        uteModuleFilesystemWriteData(file, &readBuffOneDay[0], buffSize);
        uteModuleFilesystemCloseFile(file);
    }
    //恢复当前小时活动时长数据
    memset(&uteModuleSprotData.exerciseTime[0], 0, 13 * 2);
    uteModuleSprotData.exerciseTime[0] = (readBuffOneDay[4 + time.hour * 32] << 8) | readBuffOneDay[4 + time.hour * 32 + 1];
    uteModuleSprotData.exerciseTime[1] = (readBuffOneDay[4 + time.hour * 32 + 2] << 8) | readBuffOneDay[4 + time.hour * 32 + 3];
    uteModuleSprotData.exerciseTime[2] = (readBuffOneDay[4 + time.hour * 32 + 4] << 8) | readBuffOneDay[4 + time.hour * 32 + 5];
    uteModuleSprotData.exerciseTime[3] = (readBuffOneDay[4 + time.hour * 32 + 12] << 8) | readBuffOneDay[4 + time.hour * 32 + 13];
    uteModuleSprotData.exerciseTime[4] = (readBuffOneDay[4 + time.hour * 32 + 14] << 8) | readBuffOneDay[4 + time.hour * 32 + 15];
    uteModuleSprotData.exerciseTime[5] = (readBuffOneDay[4 + time.hour * 32 + 16] << 8) | readBuffOneDay[4 + time.hour * 32 + 17];
    uteModuleSprotData.exerciseTime[6] = (readBuffOneDay[4 + time.hour * 32 + 18] << 8) | readBuffOneDay[4 + time.hour * 32 + 19];
    uteModuleSprotData.exerciseTime[7] = (readBuffOneDay[4 + time.hour * 32 + 20] << 8) | readBuffOneDay[4 + time.hour * 32 + 21];
    uteModuleSprotData.exerciseTime[8] = (readBuffOneDay[4 + time.hour * 32 + 22] << 8) | readBuffOneDay[4 + time.hour * 32 + 23];
    uteModuleSprotData.exerciseTime[9] = (readBuffOneDay[4 + time.hour * 32 + 24] << 8) | readBuffOneDay[4 + time.hour * 32 + 25];
    uteModuleSprotData.exerciseTime[10] = (readBuffOneDay[4 + time.hour * 32 + 26] << 8) | readBuffOneDay[4 + time.hour * 32 + 27];
    uteModuleSprotData.exerciseTime[11] = (readBuffOneDay[4 + time.hour * 32 + 28] << 8) | readBuffOneDay[4 + time.hour * 32 + 29];
    uteModuleSprotData.exerciseTime[12] = (readBuffOneDay[4 + time.hour * 32 + 30] << 8) | readBuffOneDay[4 + time.hour * 32 + 31];
    uteModulePlatformMemoryFree(readBuffOneDay);
}

/**
*@brief        开始发送活动时长数据
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportSendExerciseTimeHistoryData(void)
{
    ute_application_sync_data_param_t *sendParam;
    uteApplicationCommonGetSyncDataParam(&sendParam);
    uint8_t path[40];
    uint8_t response[40];
    uint8_t sendSize = 0;
    uint8_t i = 0;
    response[0] = CMD_GET_EXERCISE_DATA;
    response[1] = 0xFB;
    uint8_t *dataBuff = (uint8_t *)uteModulePlatformMemoryAlloc(sendParam->dataBuffSize);
    memset(&dataBuff[0], 0, sendParam->dataBuffSize);
    memset(&path[0], 0, 40);
    if (sendParam->dirInfo.filesCnt > 0)
    {
    SEND_NEXT_DATA:
        sendSize = 39;
        bool isHasData = false;
        void *file;
        sprintf((char *)&path[0],"%s/%s", UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, &sendParam->dirInfo.filesName[sendParam->currSendFileIndex][0]);
        UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,read file=%s", __func__,&path[0]);
        UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,currSendFileIndex=%d,currSendHourIndex=%d %d", __func__,sendParam->currSendFileIndex,sendParam->currSendHourIndex,sendParam->dataBuffSize);
        if (uteModuleFilesystemOpenFile((char *)&path[0], &file, FS_O_RDONLY))
        {
            uteModuleFilesystemReadData(file, &dataBuff[0], sendParam->dataBuffSize);
            uteModuleFilesystemCloseFile(file);
        }
        uint8_t invalidHour = 0;
        for (i = sendParam->currSendHourIndex; i < 24; i ++)
        {
            if ((memcmp(&dataBuff[4 + 32 * i],"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00", 32) == 0)
                || (memcmp(&dataBuff[4 + 32 * i],"\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff\xff", 32) == 0))
            {
                invalidHour ++;
            }
            else
            {
                memcpy(&response[2], &dataBuff[0], 4);//year month day
                response[6] = i;
                memcpy(&response[7], &dataBuff[4 + 32 * i], 32);
                invalidHour ++;
                isHasData = true;
                break;
            }
        }
        UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,invalidHour=%d", __func__,invalidHour);
        sendParam->currSendHourIndex += invalidHour;
        if (sendParam->currSendHourIndex >= 24)
        {
            sendParam->currSendFileIndex ++;
            if (sendParam->currSendFileIndex < sendParam->dirInfo.filesCnt)
            {
                sendParam->currSendHourIndex = 0;
            }
            else
            {
                sendParam->currSendHourIndex = 24;
            }
        }
        if ((!isHasData) && (sendParam->currSendFileIndex < sendParam->dirInfo.filesCnt))
        {
            goto SEND_NEXT_DATA;
        }
    }
    else
    {
        sendParam->currSendHourIndex = 24;
    }
    UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,currSendFileIndex=%d,currSendHourIndex=%d,dirInfo.filesCnt=%d", __func__,sendParam->currSendFileIndex,sendParam->currSendHourIndex,sendParam->dirInfo.filesCnt);
    if ((sendParam->currSendFileIndex == sendParam->dirInfo.filesCnt)
        && (sendParam->currSendHourIndex == 24))
    {
        sendSize = 3;
        response[1] = 0xfd;
        response[2] = sendParam->crc;
        uteApplicationCommonSyncDataTimerStop();
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
        ute_module_systemtime_time_t time;
        uteModuleSystemtimeGetTime(&time);
        ute_module_systemtime_measure_time_t setTime;
        memset(&setTime,0,sizeof(ute_module_systemtime_measure_time_t));
        setTime.year = time.year;
        setTime.month = time.month;
        setTime.day = time.day;
        setTime.hour = time.hour;
        setTime.min = time.min;
        setTime.sec = time.sec;
        uteModuleSportSetExerciseTimeSyncTime(setTime);
        UTE_MODULE_LOG(1, "%s,syncSime=%d/%d/%d %d:%d:%d", __func__, setTime.year, setTime.month,setTime.day,setTime.hour,setTime.min,setTime.sec);
#endif
    }
    if (sendSize == 39)
    {
        uteModuleCrc8Bit(&sendParam->crc, &response[2], 37);
    }
    uteModuleProfileBle50SendToPhone(&response[0], sendSize);
    uteModulePlatformMemoryFree(dataBuff);
}

/**
*@brief        准备开始发送活动时长数据
*@details
*@param[in]  需要同步的数据时间戳
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportStartSendExerciseTimeHistoryData(ute_module_systemtime_time_t time)
{
    uteModuleSportSaveExerciseTimeData();
    ute_application_sync_data_param_t *param;
    uteApplicationCommonGetSyncDataParam(&param);
    param->crc = 0;
    param->time = time;
    if (param->time.year == 0)
    {
        param->isAllData = true;
    }
    param->currSendFileIndex = 0;
    param->currSendHourIndex = 0;
    param->dataBuffSize = 32 * 24 + 4;
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_EXERCISE_TIME_DIR, &param->dirInfo, NULL);
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
    int diffday = 0;
    ute_module_systemtime_time_t curryTime;
    uteModuleSystemtimeGetTime(&curryTime);
    if(uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.year == 0)
    {
        diffday = 0;
    }
    else
    {
        diffday = uteModuleSystemtimeGetDiffDay(uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.year,uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.month,uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.day,curryTime.year,curryTime.month,curryTime.day);
    }
    if((diffday >= 0)&&(diffday <= UTE_MODULE_SPORT_SAVE_STEP_DATA_MAX_DAYS))
    {
        if((param->dirInfo.filesCnt - diffday) > 0)
        {
            param->currSendFileIndex = param->dirInfo.filesCnt - diffday - 1;
        }
    }
#endif
    uteApplicationCommonRegisterSyncDataTimerFunction(uteModuleSportSendExerciseTimeHistoryData);
    uteApplicationCommonSyncDataTimerStart();
    UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,", __func__);
}
/**
*@brief         根据运动类型确认活动时长的判断依据以及活动时长类型
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint8_t uteModuleSportGetCurrSportDataExerciseType(void)
{
    uint8_t retType = 0;
    uint8_t sportType = 0;

    sportType = uteModuleSportMoreSportGetType();
    if (sportType == SPORT_TYPE_RUNNING     //户外跑步、跑步机、室内跑步
        || sportType == SPORT_TYPE_TREADMILL
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
        //|| sportType == SPORT_TYPE_INDOOR_RUN
        || sportType == SPORT_TYPE_MARATHON
#endif
       )
    {
        retType = 0x01;//以步数为计算依据
    }
    else if (sportType == SPORT_TYPE_RIDE_BIKE
             || sportType == SPORT_TYPE_SPINNING) //户外骑行、室内骑行、小轮车、山地自行车
    {
        retType = 0x02;//以最大心率的60%为依据
    }
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
    else if (sportType == SPORT_TYPE_OUTDOOR_WALK
             || sportType == SPORT_TYPE_INDOOR_WALK)  //户外健走
    {
        retType = 0x03;//以步数为计算依据
    }
#endif
    else if (sportType == SPORT_TYPE_SWIMMING)  //泳池游泳、公开水域游泳
    {
        retType = 0x04;//以最大心率的60%为依据
    }
    else if (sportType == SPORT_TYPE_CLIMBING
             || sportType == SPORT_TYPE_WALKING
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_TRAIL_RUNNING
             || sportType == SPORT_TYPE_ROCK_CLIMBING
             || sportType == SPORT_TYPE_SKATEBOARDING
             || sportType == SPORT_TYPE_ROLLER_SKATING
             || sportType == SPORT_TYPE_PARKOUR
#endif
            ) //户外运动：户外徒步、户外滑冰、登山、攀岩、越野、滑板、轮滑、沙滩车、滑翔伞、跑酷
    {
        retType = 0x05;//以最大心率的60%为依据
    }
    else if (sportType == SPORT_TYPE_JUMP_ROPE
             || sportType == SPORT_TYPE_SIT_UP
             || sportType == SPORT_TYPE_FREE_TRAINING
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_ELLIPTICAL_TRAINER
             || sportType == SPORT_TYPE_ROWING_MACHING
             || sportType == SPORT_TYPE_CROSS_FIT
             || sportType == SPORT_TYPE_WAIST_TRAINING
             || sportType == SPORT_TYPE_STAIRS
             || sportType == SPORT_TYPE_STRENGTH_TRAINING
             || sportType == SPORT_TYPE_FITNESS_GAMING
             || sportType == SPORT_TYPE_AEROBICS
             || sportType == SPORT_TYPE_STEP_TRAINING
             || sportType == SPORT_TYPE_FLEXIBILITY
             || sportType == SPORT_TYPE_FUNCTIONAL_TRAINING
             || sportType == SPORT_TYPE_PHYSICAL_TRAINING
             || sportType == SPORT_TYPE_CORE_TRAINING
             || sportType == SPORT_TYPE_MIXED_CARDIO
#endif
            ) //健身运动
    {
        /*划船机-L、爬楼梯、室内健身、踏步机、椭圆机、爬楼机、
        自由训练、核心训练、混合有氧、力量训练、拉伸、自由体操、
        柔韧训练、踏步训练、 体操、高强度间歇训练、交叉训练CrossFit、
        体能训练、哑铃训练、杠铃训练、举重、硬拉、波比跳、仰卧起坐、
        跳绳、功能性训练、上肢训练、下肢训练、腰腹训练、背部训练 */
        retType = 0x06;//以最大心率的60%为依据
    }
    else if (sportType == SPORT_TYPE_BADMINTON
             || sportType == SPORT_TYPE_TABLE_TENNIS
             || sportType == SPORT_TYPE_TENNIS
             || sportType == SPORT_TYPE_BASKETBALL
             || sportType == SPORT_TYPE_BASEBALL
             || sportType == SPORT_TYPE_VOLLEYBALL
             || sportType == SPORT_TYPE_CRICKET
             || sportType == SPORT_TYPE_RUGBY
             || sportType == SPORT_TYPE_HOCKEY
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_SHUTTLECOCK
             || sportType == SPORT_TYPE_AUSTRALIAN_FOOTBALL
             || sportType == SPORT_TYPE_HANDBALL
             || sportType == SPORT_TYPE_BOWLING
             || sportType == SPORT_TYPE_RACQUETBALL
             || sportType == SPORT_TYPE_AMERICAN_FOOTBALL
             || sportType == SPORT_TYPE_RUGGER
             || sportType == SPORT_TYPE_PICKLEBALL
             || sportType == SPORT_TYPE_LACROSSE
#endif
            )   //球类运动
    {
        retType = 0x07;//以最大心率的60%为依据
    }
    else if (sportType == SPORT_TYPE_YOGA
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_PILATES
#endif
            )   //瑜伽运动：瑜伽、普拉提
    {
        retType = 0x08;//以最大心率的60%为依据
    }
    else if (sportType == SPORT_TYPE_BOATING
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_DIVING
             || sportType == SPORT_TYPE_SURFING
             || sportType == SPORT_TYPE_SNORKELING
#endif
            )//水上运动
    {
        retType = 0x09;//以最大心率的60%为依据
    }
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
    else if (sportType == SPORT_TYPE_SKIING
             || sportType == SPORT_TYPE_ICE_HOCKEY
             || sportType == SPORT_TYPE_SNOWBOARDING
             || sportType == SPORT_TYPE_DOWNHILL_SKIING
             || sportType == SPORT_TYPE_SNOW_SPORTS
             || sportType == SPORT_TYPE_SKATING
            )//冰雪运动
    {
        retType = 0x0A;//以最大心率的60%为依据
    }
    else if (sportType == SPORT_TYPE_ARCHERY
             || sportType == SPORT_TYPE_PLAY
             || sportType == SPORT_TYPE_HULA_HOOP
             || sportType == SPORT_TYPE_DARTS
             || sportType == SPORT_TYPE_FISHING
             || sportType == SPORT_TYPE_DISC_SPORTS
             || sportType == SPORT_TYPE_HUNTING)//休闲运动：剑术、射箭、飞镖、拔河、呼啦圈、放风筝、钓鱼、飞盘、打猎、卡巴迪
    {
        retType = 0x0B;//以最大心率的60%为依据
    }
#endif
    else
    {
        retType = 0x0C;//以最大心率的60%为依据
    }
    return retType;
}

/**
*@brief     日常每秒处理
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportDailyExerciseEverySecond(ute_module_systemtime_time_t *time)
{
    if (uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_CLOSE)
    {
        //uteModuleSportGetCurrDayStepCnt(&uteModuleSprotData.lastMinuteStepCnt, NULL, NULL);
        if (time->sec == 59)
        {
            if (uteModuleSprotData.currDayTotalStep > uteModuleSprotData.lastMinuteStepCnt)
            {
                if (uteModuleSprotData.currDayTotalStep - uteModuleSprotData.lastMinuteStepCnt > 100)
                {
                    uteModuleSprotData.exerciseTime[0] += 60;//以秒为单位保存
                }
            }
            UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s, %d %d %d", __func__, uteModuleSprotData.lastMinuteStepCnt, uteModuleSprotData.currDayTotalStep, uteModuleSprotData.todaySportWithStepsData.step);
            uteModuleSprotData.lastMinuteStepCnt = uteModuleSprotData.currDayTotalStep;
        }
    }
}

/**
*@brief     多运动每秒处理活动时长
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportMoreSportsExerciseDataHandler(void)
{
    uint16_t tempStep = 0;

    if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE)
    {
        if (uteModuleSprotData.moreSportData.totalSportTime % 60 == 0 && uteModuleSprotData.moreSportData.totalSportTime > 0)
        {
            if (uteModuleSprotData.moreSportData.saveData.sportStep > uteModuleSprotData.lastMinuteSportStepCnt)
            {
                tempStep = uteModuleSprotData.moreSportData.saveData.sportStep - uteModuleSprotData.lastMinuteSportStepCnt;
                if (tempStep > 100
                    && (uteModuleSprotData.exerciseType == 0x01 || uteModuleSprotData.exerciseType == 0x03))
                {
                    uteModuleSprotData.exerciseTime[uteModuleSprotData.exerciseType] += 60;//以秒为单位保存
                }
            }
            uteModuleSprotData.lastMinuteSportStepCnt = uteModuleSprotData.moreSportData.saveData.sportStep;
        }
    }
}
#endif

#if UTE_MODULE_WATCH_ROTATE_SUPPORT
/**         获取旋转正在测试中
*@brief
*@details
*@author     dengli.lu
*@date       2023-09-12
*/
bool uteModuleSportGetGsensorRotateTesting(void)
{
    return uteModuleSprotData.isGsensorRotateTesting;
}
/**
* @brief        设置旋转正在测试中
* @details
* @param[in]
*@author     dengli.lu
*@date       2023-09-12
 */
void uteModuleSportSetGsensorRotateTesting(bool isGsensorRotateTesting)
{
    uteModuleSprotData.isGsensorRotateTesting = isGsensorRotateTesting;
}
/**
*@brief        获取算法中gsensor旋转次数,每500ms或者每秒获取一次
*@details
*@author       dengli.lu
*@date       2023-09-15
*/
uint16_t uteModuleSportGetGsensorRotateCnt(void)
{
    return getRotateResult();
}
/**
*@brief        清除算法中gsensor旋转次数
*@details
*@author       dengli.lu
*@date       2023-09-15
*/
void uteModuleSportClearGsensorRotateData(void)
{
    clearRotateData();
}
#endif

#if !UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_ELLIPSIS_TIMER_SUPPORT
void uteModuleSprotInputDataBeforeAlgoTimerCallback(void *pxTimer)
{
    uteModulePlatformSendMsgToUteApplicationTask(MSG_TYPE_DRV_SPORT_ALGO_INPUT_DATA_TIMER,0);
}
#endif

AT(.com_text.ute_sport)
void uteModuleSprotInputDataBeforeAlgoTimerHandler(void)
{
    if (bsp_sensor_hr_work_status())
    {
        return;
    }
#if UTE_MODULE_SPROT_ALGO_AUTO_SWITCH_SYSCLK_SUPPORT
    uint8_t cur_sys_clk = sys_clk_get();
    if (bsp_system_is_sleep())
    {
        if (cur_sys_clk == SYS_24M && uteModuleSprotData.switchSysclkCountdown)
        {
            sleep_set_sysclk(SYS_176M);
        }
    }
#endif
#if UTE_MODULE_CYWEE_MOTION_SUPPORT
    uteModuleCwmtWearStatusSwitch(uteModuleHeartIsWear()); //
#else
    uteModuleSportInputDataBeforeAlgo();
#if UTE_HEART_VCXX_NO_WEAR_NO_RUN_STEP_ALGO_SUPPORT
    if (uteModuleHeartIsWear())
    {
        uteModuleSportUnWearToWearSwitch();
    }
    else
    {
        uteModuleSportStepTypeSetNone();
    }

#endif
#endif
#if UTE_MODULE_SPROT_ALGO_AUTO_SWITCH_SYSCLK_SUPPORT
    if (bsp_system_is_sleep() && cur_sys_clk > SYS_24M)
    {
        if (uteModuleSprotData.switchSysclkCountdown == 0)
        {
            sleep_set_sysclk(SYS_24M);
        }
    }
#endif
}

/**
 * @brief        开启记步算法定时器
 * @details
 * @param[in]    ms 定时间时长
 * @author       Wang.Luo
 * @date         2023-05-05
 */
void uteModuleSportAlgoTimerStart(uint16_t ms)
{
    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL,"%s,ms=%d",__func__,ms);
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_ELLIPSIS_TIMER_SUPPORT
    enableSportAlgorithmsTimer = true;
#else
    if(uteModuleSportInputDataBeforeAlgoTimer == NULL)
    {
        uteModulePlatformCreateTimer(&uteModuleSportInputDataBeforeAlgoTimer, "sports input data before algo timer", 1, 400, true, uteModuleSprotInputDataBeforeAlgoTimerCallback);
    }
    uteModulePlatformRestartTimer(&uteModuleSportInputDataBeforeAlgoTimer, ms);
#endif
}
/**
 * @brief        停止记步算法定时器
 * @details
 * @author       Wang.Luo
 * @date         2023-05-05
 */
void uteModuleSprotAlgoTimerStop(void)
{
    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL,"%s",__func__);
#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_ELLIPSIS_TIMER_SUPPORT
    enableSportAlgorithmsTimer = false;
#else
    uteModulePlatformStopTimer(&uteModuleSportInputDataBeforeAlgoTimer);
    uteModulePlatformDeleteTimer(&uteModuleSportInputDataBeforeAlgoTimer);
    uteModuleSportInputDataBeforeAlgoTimer = NULL;
#endif
}

#if UTE_MODULE_ALL_SPORT_STEP_ALGORITHMS_ELLIPSIS_TIMER_SUPPORT
/**
 * @brief        是否使用定时器运行运动算法
 * @details
 * @return       void*
 * @author       Wang.Luo
 * @date         2025-02-21
 */
AT(.com_text.ute_sport)
bool uteModuleSportAlgoTimerIsRunning(void)
{
    if(!uteApplicationCommonIsPowerOn())
    {
        return false;
    }
    return enableSportAlgorithmsTimer;
}
#endif

ute_module_more_sports_data_t uteModuleSportGetMoreData(void)
{
    return uteModuleSprotData.moreSportData;
}

#if APP_MODULE_SPORT_GPS_TRANSLATE_SUPPORT
const double R_OF_EARTH = 63710000.0;//地球半径6371KM

double ToRadians(double angle)
{
    return angle * 3.141593 / 180;
}

uint32_t EarthDistance(double lat1,double lon1,double lat2,double lon2)
{
    float temp = 0.0;
    double distance = 0.0;

    if ((ToRadians(lon2) - ToRadians(lon1)) < 0.000001)
        temp = (ToRadians(lon2) - ToRadians(lon1)) * -1;
    else
        temp = (ToRadians(lon2)-ToRadians(lon1));

    distance = R_OF_EARTH * acos(sin(ToRadians(lat1)) *\
                                 sin(ToRadians(lat2)) + cos(ToRadians(lat1)) *\
                                 cos(ToRadians(lat2)) * cos(temp));

    return (uint32_t)(distance);
}
/**
*@brief     根据经纬度计算距离
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint32_t uteModuleSportCalcDistanceFromGPSInfo(uint32_t preLatitude, uint32_t preLongitude, uint32_t newLatitude, uint32_t newLongitude)
{
    double latitude0 = 0.0;
    double latitude1 = 0.0;
    double longitude0 = 0.0;
    double longitude1 = 0.0;
    uint32_t tempValue = 0;
    uint32_t distanceResult = 0;

    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "GPS 0, %x %x %x %x", preLatitude, preLongitude, newLatitude, newLongitude);
    if (preLatitude & 0x80000000)
    {
        tempValue = ~(preLatitude - 1);
        latitude0 = (double)(tempValue / 1000000.0);
    }
    else
    {
        latitude0 = (double)(preLatitude / 1000000.0);
        //UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "GPS 1, %d", (uint32_t)latitude0);
    }
    if (preLongitude & 0x80000000)
    {
        tempValue = ~(preLongitude - 1);
        //UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "GPS, %x", tempValue);
        longitude0 = (double)(tempValue / 1000000.0);
    }
    else
    {
        longitude0 = (double)(preLongitude / 1000000.0);
        //UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s, %d", __func__, longitude0);
    }
    if (newLatitude & 0x80000000)
    {
        tempValue = ~(newLatitude - 1);
        latitude1 = (double)(tempValue / 1000000.0);
    }
    else
    {
        latitude1 = (double)(newLatitude / 1000000.0);
    }
    if (newLongitude & 0x80000000)
    {
        tempValue = ~(newLongitude - 1);
        //UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "GPS 2, %x", tempValue);
        longitude1 = (double)(tempValue / 1000000.0);
    }
    else
    {
        longitude1 = (double)(newLongitude / 1000000.0);
    }
    distanceResult = EarthDistance(latitude0, longitude0, latitude1, longitude1);
    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "GPS 3, %x %x %x %x %d", (uint32_t)(latitude0 * 1000000), (uint32_t)(longitude0 * 1000000), (uint32_t)(latitude1 * 1000000), (uint32_t)(longitude1 * 1000000), distanceResult);
    return distanceResult;
}
/**
*@brief     发送运动状态给app
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportSendMoreSportsGetGPSStatus(uint8_t type)
{
    uint8_t resp[4];

    memset(resp, 0, sizeof(resp));
    resp[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;
    resp[1] = 0x01;//GPS信息头
    if (type == 0x01)
    {
        resp[2] = 0xAA;//请求APP去获取GPS信息
        resp[3] = 0x03;//获取到GPS信息后每隔n秒下发一个经纬度数据
        uteModuleProfileBleSendToPhone(&resp[0], 4);
    }
    else
    {
        resp[2] = 0x55;//不需要获取GPS信息
        uteModuleProfileBleSendToPhone(&resp[0], 3);
    }
}
/**
*@brief     运动状态发生改变时主动发送运动状态给app
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportSendMoreSportsStatusToAPPWhenChange(uint8_t status)
{
    uint8_t resp[4];

    if (uteModuleSprotData.moreSportData.isAppStart != true)
    {
        memset(resp, 0, sizeof(resp));
        resp[0] = CMD_SPORT_MODE_AND_SPORT_HEART_RATE;
        resp[1] = 0x04;//主动上报状态
        resp[2] = uteModuleSprotData.moreSportData.saveData.sportsType;//运动类型
        resp[3] = status;//0x00表示结束运动，0x11表示开始运动，0x22表示暂停运动，0x33表示继续运动
        uteModuleProfileBleSendToPhone(&resp[0], 4);
    }
}

/**
*@brief     多运动GPS消息处理
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportGPSMsgHandler(uint32_t param)
{
    UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s, %d", __func__, param);
    switch (param)
    {
        case 0x00:
            if (uteModuleSportGetGPSStatus() != GPS_LACATION_ING)
                uteModuleSportSetGPSStatus(GPS_LACATION_FAIL);//定位失败
            break;

        case 0x01:
            if (uteModuleSportGetGPSStatus() == GPS_LACATION_ING)
            {
                uteModuleSportGPSDataInit();
                uteModuleSportSetGPSStatus(GPS_LACATION_OK);//定位成功
                // uteModuleHeartStartSingleTesting(TYPE_HEART);
                // uteModuleSportStartMoreSports(uteModuleSportMoreSportGetType(), 0x01, false);
            }
            break;

        case 0x02:
            //下发经纬度、速度、距离
            uteModuleSprotData.gpsData.gpsInvalidCnt = 0;
            //if (uteModuleSportGetGPSStatus() != GPS_LACATION_OK)
            //    uteModuleSportSetGPSStatus(GPS_LACATION_OK);
            break;

        /*case 0x03:
            //下发距离、速度
            uteModuleSprotData.gpsData.gpsInvalidCnt = 0;
            if (uteModuleSportGetGPSStatus() != GPS_LACATION_OK)
                uteModuleSportSetGPSStatus(GPS_LACATION_OK);
            break;*/

        default:
            break;
    }
}
/**
*@brief     多运动处理GPS数据
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportMoreSportsGPSDataHandler(uint8_t type, uint16_t speed, uint32_t value0, uint32_t value1, uint32_t value2, uint32_t value3)
{
    if ((uteModuleSprotData.moreSportData.status == ALL_SPORT_STATUS_OPEN) &&
        (uteModuleSprotData.moreSportData.countZeroIndex == -1))
    {
        if (type == 0)
        {
            //处理经纬度和速度
            if ((uteModuleSprotData.gpsData.latitudeSport == 0 && uteModuleSprotData.gpsData.longitudeSport == 0) || uteModuleSportGetGPSStatus() == GPS_LACATION_DISCONNECT)
            {
                //first time to get GPS info, no need calc distance
                uteModuleSprotData.gpsData.gpsUsesecond = 0;
            }
            else
            {
                //calc distance
                uint32_t gpsDistance = 0;
                gpsDistance = uteModuleSportCalcDistanceFromGPSInfo(uteModuleSprotData.gpsData.latitudeSport, uteModuleSprotData.gpsData.longitudeSport, value0, value1);
                uteModuleSprotData.gpsData.gpsTotalDistance += gpsDistance;
                if (uteModuleSprotData.gpsData.gpsUsesecond >= APP_SPORT_SAVE_DATA_INTERVAL)
                {
                    uteModuleSportCalcRealTimeInfoBaseOnGPS(uteModuleSprotData.gpsData.gpsUsesecond);
                    uteModuleSprotData.gpsData.gpsUsesecond = 0;
                }
                //uteModuleSprotData.gpsData.gpsTotalDistance += uteModuleSprotData.gpsData.gpsIncreaseDistance;
            }
            uteModuleSprotData.gpsData.latitudeSport = value0;
            uteModuleSprotData.gpsData.longitudeSport = value1;
            uteModuleSprotData.gpsData.gpsSpeed = speed;
            if (uteModuleSportGetGPSStatus() != GPS_LACATION_OK)
                uteModuleSportSetGPSStatus(GPS_LACATION_OK);
        }
        //else
        //{
        //    //处理距离和速度
        //    uteModuleSprotData.gpsData.gpsSpeed = speed;
        //}
    }
}

/**
*@brief     GPS每秒处理
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportGPSDataEverySecond(void)
{
    if (uteModuleSprotData.moreSportData.status != ALL_SPORT_STATUS_PAUSE)
    {
        if (uteModuleSportGetGPSStatus() == GPS_LACATION_OK)
        {
            uteModuleSprotData.gpsData.gpsUsesecond ++;
            if (uteModuleSprotData.gpsData.gpsInvalidCnt < 0xFF)
                uteModuleSprotData.gpsData.gpsInvalidCnt ++;
            if (uteModuleSprotData.gpsData.gpsInvalidCnt >= 120) //todo超过120秒认为收不到定位
            {
                uteModuleSportSetGPSStatus(GPS_LACATION_DISCONNECT);
                uteModuleSprotData.gpsData.gpsSpeed = 0;
                //uteModuleSprotData.gpsData.latitudeSport = 0;
                //uteModuleSprotData.gpsData.longitudeSport = 0;
                uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger = (uint8_t)(mUTESportDatas.sportDistance);
                uteModuleSprotData.moreSportsCalc.lastsportDistanceDecimals = (uint8_t)((mUTESportDatas.sportDistance - (float)uteModuleSprotData.moreSportsCalc.lastsportDistanceInteger) * 100);
            }
        }
    }
}
/**
*@brief         根据运动类型判断是否需要APP下发GPS
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
uint8_t uteModuleSportGetAPPSendGPSType(void)
{
    uint8_t retType = 0;
    uint8_t sportType = 0;

    sportType = uteModuleSportMoreSportGetType();
    if (sportType == SPORT_TYPE_RUNNING
        || sportType == SPORT_TYPE_WALKING
        || sportType == SPORT_TYPE_CLIMBING
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
        || sportType == SPORT_TYPE_OUTDOOR_WALK
        || sportType == SPORT_TYPE_TRAIL_RUNNING
        || sportType == SPORT_TYPE_MARATHON
#endif
       )
    {
        retType = 0x01;//可以不需要GPS
    }
    else if (sportType == SPORT_TYPE_RIDE_BIKE
#if UTE_MODULE_SPORT_HUNDRED_SUPPORT
             || sportType == SPORT_TYPE_ROLLER_SKATING
             || sportType == SPORT_TYPE_SKATEBOARDING
             || sportType == SPORT_TYPE_HUNTING
             || sportType == SPORT_TYPE_SKATING
#endif
            )
    {
        retType = 0x02;//必须有GPS才能打开
    }
    else
    {
        retType = 0x00;//不需要GPS就能打开
    }
    return retType;
}
/**
*@brief         获取GPS状态
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
GPS_STATUS_T uteModuleSportGetGPSStatus(void)
{
    return uteModuleSprotData.gpsData.gpsStatus;
}
/**
*@brief         设置GPS状态
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportSetGPSStatus(GPS_STATUS_T status)
{
    uteModuleSprotData.gpsData.gpsStatus = status;
}
/**
*@brief         初始化GPS数据
*@details
*@author       wuhuowang
*@date       2022-11-18
*/
void uteModuleSportGPSDataInit(void)
{
    memset(&uteModuleSprotData.gpsData, 0, sizeof(ute_module_sports_gps_data_t));
}
#endif

/**
*@brief     判断运动量是否过少
*@details
*@return  为运动量过少类型
*@author       wuhuowang
*@date       2022-12-09
*/
uint8_t uteModuleSportMoreSportsIsLessDataType(void)
{
    uint8_t retVaule = 0;
    uint32_t tempDistance = 0;
    float distance = 0;
    uint8_t sportType = 0;

    uteModulePlatformTakeMutex(uteModuleSprotMute);
    sportType = uteModuleSportGetCurrSportShowDataType(uteModuleSportMoreSportGetType());
    if (sportType)
    {
        distance = (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceInteger + (float)(uteModuleSprotData.moreSportData.saveData.sportDistanceDecimals * 0.01));
        distance = distance * 1000.0f; //放大1000倍,m
        tempDistance = (uint32_t)distance;
        // 1 距离等于零
        if (tempDistance == 0)
        {
            retVaule = 0x02;  // distance too short 不需要保存数据
        }
        // 2 距离小于100m
        if ((tempDistance != 0) && (tempDistance < 100))
        {
            retVaule =  0x02;  // distance too short 不需要保存数据
        }
    }
    else
    {
        if (uteModuleSprotData.moreSportData.totalSportTime < UTE_MODULE_SPORT_MORE_SPORT_MIN_SAVE_TIME)
        {
            retVaule = 0x01;// time too short, no need save any data
        }
    }
    uteModulePlatformGiveMutex(uteModuleSprotMute);

    return retVaule;
}

/**
*@brief     设置空间不足类型
*@details
*@return
*@author       wuhuowang
*@date       2022-12-09
*/
void uteModuleSportSetMemoryFullType(MEMORY_FULL_TYPE_T type)
{
    uteModuleSprotData.memoryFullType = type;
}
/**
*@brief     获取设置空间不足类型
*@details
*@return  设置空间不足类型
*@author       wuhuowang
*@date       2022-12-09
*/
MEMORY_FULL_TYPE_T uteModuleSportGetMemoryFullType(void)
{
    return uteModuleSprotData.memoryFullType;
}

/**
*@brief     开始运动时计算存储空间
*@details
*@return
*@author       wuhuowang
*@date       2022-12-09
*/
void uteModuleSportMoreSportsCalcSpaceSize(void)
{
    uint16_t recordCnt = 0;

    ute_module_filesystem_dir_t *dirInfo = (ute_module_filesystem_dir_t *)uteModulePlatformMemoryAlloc(sizeof(ute_module_filesystem_dir_t));
    uteModuleFilesystemLs(UTE_MODULE_FILESYSTEM_SPORT_MORE_SPORTS_DIR, dirInfo, NULL);

    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "%s, filesCnt=%d totalSize = %d", __func__, dirInfo->filesCnt, dirInfo->totalSize);
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
    if (uteModuleSprotData.moreSportsSyncTime.year == 0)
    {
        recordCnt = dirInfo->filesCnt;
        printf("czh line %d,recordCnt = %d\n",__LINE__,recordCnt);
    }
    else
    {
        uint64_t lastSyncTime, fileTime;
        uint8_t i = 0;
        uint8_t lastSyncTimeBuff[15];
        memset(lastSyncTimeBuff, 0, 15);
        sprintf((char *)&lastSyncTimeBuff[0], "%04d%02d%02d%02d%02d", uteModuleSprotData.moreSportsSyncTime.year, uteModuleSprotData.moreSportsSyncTime.month,\
                uteModuleSprotData.moreSportsSyncTime.day, uteModuleSprotData.moreSportsSyncTime.hour, uteModuleSprotData.moreSportsSyncTime.min);
        UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,%s", __func__, lastSyncTimeBuff);
        lastSyncTime = atoll((const char *)&lastSyncTimeBuff[0]);
        for (i = 0; i < dirInfo->filesCnt; i ++)
        {
            fileTime = atoll((const char *)&dirInfo->filesName[i][0]);
            UTE_MODULE_LOG(UTE_LOG_PROTOCOL_LVL, "%s,fileTime=%lld,lastSyncTimeBuff=%lld", __func__, fileTime, lastSyncTime);
            if ((fileTime - lastSyncTime) >= 0)
            {
                recordCnt++;
            }
        }
    }
#else
    recordCnt = uteModuleSprotData.sportsHistoryRecord.sportsHistoryRecordTotalCnt;
#endif
    if (/*dirInfo->filesCnt*/recordCnt >= UTE_MODULE_SPORT_MORE_SPORTS_DATA_MAX_CNT)
    {
        uteModuleSportSetMemoryFullType(FULL_TYPE_MAX_NUM);
    }
    else if (dirInfo->totalSize >= 198 * 1024)//todo
    {
        uteModuleSportSetMemoryFullType(FULL_TYPE_NOT_ENOUGH);
    }
    else
    {
        uteModuleSportSetMemoryFullType(FULL_TYPE_IDLE);
    }
    uteModuleSprotData.leftSpaceSize = 200 * 1024 - dirInfo->totalSize;
    uteModulePlatformMemoryFree(dirInfo);
}
#if APP_SYNC_RECORD_TIME_FLAG_SUPPORT
/**
*@brief     读取步数同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportReadStepSyncTimeInfo(void)
{
    /*! 读取数据*/
    void *file;
    uint8_t readbuff[7];
    memset(&readbuff[0],0,sizeof(readbuff));
    if(uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_SPORT_STEP_SYNC_TIME_INFO,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readbuff[0],7);
        uteModuleFilesystemCloseFile(file);
    }
    uteModuleSprotData.stepSyncTime.year = (readbuff[0] << 8) | readbuff[1];
    uteModuleSprotData.stepSyncTime.month = readbuff[2];
    uteModuleSprotData.stepSyncTime.day = readbuff[3];
    uteModuleSprotData.stepSyncTime.hour = readbuff[4];
    uteModuleSprotData.stepSyncTime.min = readbuff[5];
    uteModuleSprotData.stepSyncTime.sec = readbuff[6];
}
/**
*@brief  保存步数同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportSaveStepSyncTimeInfo(void)
{
    /*! 保存到文件zn.zeng, 2021-08-20*/
    void *file;
    uint8_t writeBuff[7];
    memset(&writeBuff[0],0,sizeof(writeBuff));
    writeBuff[0] = uteModuleSprotData.stepSyncTime.year >> 8 & 0xff;
    writeBuff[1] = uteModuleSprotData.stepSyncTime.year & 0xff;
    writeBuff[2] = uteModuleSprotData.stepSyncTime.month;
    writeBuff[3] = uteModuleSprotData.stepSyncTime.day;
    writeBuff[4] = uteModuleSprotData.stepSyncTime.hour;
    writeBuff[5] = uteModuleSprotData.stepSyncTime.min;
    writeBuff[6] = uteModuleSprotData.stepSyncTime.sec;
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_SPORT_STEP_SYNC_TIME_INFO, &file, FS_O_RDONLY|FS_O_WRONLY|FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&writeBuff[0],7);
        uteModuleFilesystemCloseFile(file);
    }
}
/**
*@brief  设置步数同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportSetStepSyncTime(ute_module_systemtime_measure_time_t setTime)
{
    uteModuleSprotData.stepSyncTime.year = setTime.year;
    uteModuleSprotData.stepSyncTime.month = setTime.month;
    uteModuleSprotData.stepSyncTime.day = setTime.day;
    uteModuleSprotData.stepSyncTime.hour = setTime.hour;
    uteModuleSprotData.stepSyncTime.min = setTime.min;
    uteModuleSprotData.stepSyncTime.sec = setTime.sec;
    uteModuleSportSaveStepSyncTimeInfo();
}
/**
*@brief  获取步数同步时间
*@details
*@param[out] ute_module_systemtime_measure_time_t *time  时间变量指针
*@author        dengli.lu
*@date        2022-10-24
*/
void uteModuleSportGetStepSyncTime(ute_module_systemtime_measure_time_t *time)
{
    memcpy(time, &uteModuleSprotData.stepSyncTime, sizeof(ute_module_systemtime_measure_time_t));
}
/**
*@brief     读取活动时长同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportReadExerciseTimeSyncTimeInfo(void)
{
    /*! 读取数据*/
    void *file;
    uint8_t readbuff[7];
    memset(&readbuff[0],0,sizeof(readbuff));
    if(uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_EXERCISE_TIME_SYNC_TIME_INFO,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readbuff[0],7);
        uteModuleFilesystemCloseFile(file);
    }
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.year = (readbuff[0] << 8) | readbuff[1];
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.month = readbuff[2];
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.day = readbuff[3];
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.hour = readbuff[4];
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.min = readbuff[5];
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.sec = readbuff[6];
}
/**
*@brief  保存活动时长同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportSaveExerciseTimeSyncTimeInfo(void)
{
    /*! 保存到文件zn.zeng, 2021-08-20*/
    void *file;
    uint8_t writeBuff[7];
    memset(&writeBuff[0],0,sizeof(writeBuff));
    writeBuff[0] = uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.year >> 8 & 0xff;
    writeBuff[1] = uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.year & 0xff;
    writeBuff[2] = uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.month;
    writeBuff[3] = uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.day;
    writeBuff[4] = uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.hour;
    writeBuff[5] = uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.min;
    writeBuff[6] = uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.sec;
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_EXERCISE_TIME_SYNC_TIME_INFO, &file, FS_O_RDONLY|FS_O_WRONLY|FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&writeBuff[0],7);
        uteModuleFilesystemCloseFile(file);
    }
}
/**
*@brief  设置活动时长同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportSetExerciseTimeSyncTime(ute_module_systemtime_measure_time_t setTime)
{
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.year = setTime.year;
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.month = setTime.month;
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.day = setTime.day;
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.hour = setTime.hour;
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.min = setTime.min;
    uteModuleSprotData.dailyActivity.exerciseTimeSyncTime.sec = setTime.sec;
    uteModuleSportSaveExerciseTimeSyncTimeInfo();
}
/**
*@brief  获取活动时长同步时间
*@details
*@param[out] ute_module_systemtime_measure_time_t *time  时间变量指针
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportGetExerciseTimeSyncTime(ute_module_systemtime_measure_time_t *time)
{
    memcpy(time, &uteModuleSprotData.dailyActivity.exerciseTimeSyncTime, sizeof(ute_module_systemtime_measure_time_t));
}
/**
*@brief     读取多运动同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportReadMoreSportsSyncTimeInfo(void)
{
    /*! 读取数据*/
    void *file;
    uint8_t readbuff[7];
    memset(&readbuff[0],0,sizeof(readbuff));
    if(uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_MORESPORTS_SYNC_TIME_INFO,&file,FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemReadData(file,&readbuff[0],7);
        uteModuleFilesystemCloseFile(file);
    }
    uteModuleSprotData.moreSportsSyncTime.year = (readbuff[0] << 8) | readbuff[1];
    uteModuleSprotData.moreSportsSyncTime.month = readbuff[2];
    uteModuleSprotData.moreSportsSyncTime.day = readbuff[3];
    uteModuleSprotData.moreSportsSyncTime.hour = readbuff[4];
    uteModuleSprotData.moreSportsSyncTime.min = readbuff[5];
    uteModuleSprotData.moreSportsSyncTime.sec = readbuff[6];
}
/**
*@brief     读取多运动同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportSaveMoreSportsSyncTimeInfo(void)
{
    /*! 保存到文件zn.zeng, 2021-08-20*/
    void *file;
    uint8_t writeBuff[7];
    memset(&writeBuff[0],0,sizeof(writeBuff));
    writeBuff[0] = uteModuleSprotData.moreSportsSyncTime.year >> 8 & 0xff;
    writeBuff[1] = uteModuleSprotData.moreSportsSyncTime.year & 0xff;
    writeBuff[2] = uteModuleSprotData.moreSportsSyncTime.month;
    writeBuff[3] = uteModuleSprotData.moreSportsSyncTime.day;
    writeBuff[4] = uteModuleSprotData.moreSportsSyncTime.hour;
    writeBuff[5] = uteModuleSprotData.moreSportsSyncTime.min;
    writeBuff[6] = uteModuleSprotData.moreSportsSyncTime.sec;
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_MORESPORTS_SYNC_TIME_INFO, &file, FS_O_RDONLY|FS_O_WRONLY|FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file,0,FS_SEEK_SET);
        uteModuleFilesystemWriteData(file,&writeBuff[0],7);
        uteModuleFilesystemCloseFile(file);
    }
}
/**
*@brief     设置多运动同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportSetMoreSportsSyncTime(ute_module_systemtime_measure_time_t setTime)
{
    uteModuleSprotData.moreSportsSyncTime.year = setTime.year;
    uteModuleSprotData.moreSportsSyncTime.month = setTime.month;
    uteModuleSprotData.moreSportsSyncTime.day = setTime.day;
    uteModuleSprotData.moreSportsSyncTime.hour = setTime.hour;
    uteModuleSprotData.moreSportsSyncTime.min = setTime.min;
    uteModuleSprotData.moreSportsSyncTime.sec = setTime.sec;
    uteModuleSportSaveMoreSportsSyncTimeInfo();
}
/**
*@brief     获取多运动同步时间
*@details
*@author        dengli.lu
*@date        2023-03-15
*/
void uteModuleSportGetMoreSportsSyncTime(ute_module_systemtime_measure_time_t *time)
{
    memcpy(time, &uteModuleSprotData.moreSportsSyncTime, sizeof(ute_module_systemtime_measure_time_t));
}
#endif
#if APP_MODULE_SPORT_TODAY_ADD_ALL_SPORT_OTHER_DATA_SUPPORT
/**
*@brief     读取多运动其他信息
*@details
*@author        wuhuowang
*@date        2023-05-12
*/
void uteModuleSportReadMoreSportsOtherInfo(void)
{
    /*! 读取数据*/
    void *file;
    uint8_t readbuff[12];
    ute_module_systemtime_time_t time;
    uteModuleSystemtimeGetTime(&time);
    memset(&readbuff[0], 0, sizeof(readbuff));
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_MORESPORTS_OTHER_INFO, &file, FS_O_RDONLY))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemReadData(file, &readbuff[0], 12);
        uteModuleFilesystemCloseFile(file);
    }
    uteModuleSprotData.todaySportOtherData.year = (readbuff[0] << 8) | readbuff[1];
    uteModuleSprotData.todaySportOtherData.month = readbuff[2];
    uteModuleSprotData.todaySportOtherData.day = readbuff[3];
    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "SportsOtherInfo:%d-%d-%d", uteModuleSprotData.todaySportOtherData.year, uteModuleSprotData.todaySportOtherData.month, uteModuleSprotData.todaySportOtherData.day);
    if (uteModuleSprotData.todaySportOtherData.year == time.year
        || uteModuleSprotData.todaySportOtherData.month == time.month
        || uteModuleSprotData.todaySportOtherData.day == time.day)
    {
        uteModuleSprotData.todaySportOtherData.step = (readbuff[4] << 24) | (readbuff[5] << 16) | (readbuff[6] << 8) | readbuff[7];
        uteModuleSprotData.todaySportOtherData.distance = (readbuff[8] << 8) | readbuff[9];
        uteModuleSprotData.todaySportOtherData.caloire = (readbuff[10] << 8) | readbuff[11];
    }
    else
    {
        uteModuleSprotData.todaySportOtherData.step = 0;
        uteModuleSprotData.todaySportOtherData.distance = 0;
        uteModuleSprotData.todaySportOtherData.caloire = 0;
    }
    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "SportsOtherInfo:%d:%d:%d", uteModuleSprotData.todaySportOtherData.step, uteModuleSprotData.todaySportOtherData.distance, uteModuleSprotData.todaySportOtherData.caloire);
}
/**
*@brief     保存多运动其他信息
*@details
*@author        wuhuowang
*@date        2023-05-12
*/
void uteModuleSportSaveMoreSportsOtherInfo(ute_module_systemtime_time_t time)
{
    /*! 保存到文件*/
    void *file;
    uint8_t writeBuff[12];
    memset(&writeBuff[0], 0, sizeof(writeBuff));
    writeBuff[0] = (time.year >> 8) & 0xff;
    writeBuff[1] = time.year & 0xff;
    writeBuff[2] = time.month;
    writeBuff[3] = time.day;
    writeBuff[4] = (uteModuleSprotData.todaySportOtherData.step >> 24) & 0xff;
    writeBuff[5] = (uteModuleSprotData.todaySportOtherData.step >> 16) & 0xff;
    writeBuff[6] = (uteModuleSprotData.todaySportOtherData.step >> 8) & 0xff;
    writeBuff[7] = uteModuleSprotData.todaySportOtherData.step & 0xff;
    writeBuff[8] = (uteModuleSprotData.todaySportOtherData.distance >> 8) & 0xff;
    writeBuff[9] = uteModuleSprotData.todaySportOtherData.distance & 0xff;
    writeBuff[10] = (uteModuleSprotData.todaySportOtherData.caloire >> 8) & 0xff;
    writeBuff[11] = uteModuleSprotData.todaySportOtherData.caloire & 0xff;
    if (uteModuleFilesystemOpenFile(UTE_MODULE_FILESYSTEM_SYSTEMPARM_MORESPORTS_OTHER_INFO, &file, FS_O_RDONLY | FS_O_WRONLY | FS_O_CREAT))
    {
        uteModuleFilesystemSeek(file, 0, FS_SEEK_SET);
        uteModuleFilesystemWriteData(file, &writeBuff[0], 12);
        uteModuleFilesystemCloseFile(file);
    }
}
#endif
#if DUG_GSENSOR_DATA_SUPPORT
uint8_t sendDbgData[160];
uint8_t sendFrameCnt = 0;
uint32_t sendDbgDataCnt = 0;

void uteModuleSportsendGsensorDataToPhone(uint8_t frame_index, int16_t tempx, int16_t tempy, int16_t tempz)
{
    if (uteApplicationCommonGetappDebugGsensorDataSwitch == true)
    {
        sendFrameCnt = 0;
        sendDbgDataCnt = 0;
        return;
    }
    ute_ble_connect_state_t connectStatus;
    uteApplicationCommonGetBleConnectionState(&connectStatus);
    UTE_MODULE_LOG(UTE_LOG_SYSTEM_LVL, "sendFrameCnt=%d sendDbgDataCnt = %d %d", sendFrameCnt, sendDbgDataCnt, connectStatus.isConnected);
    if (sendFrameCnt == 0)
    {
        sendDbgData[0] = 0x48;
        sendDbgData[1] = 0xff;
        sendDbgData[2] = 0xfe;
    }
    if (sendFrameCnt == 25)
    {
        sendDbgData[153] = sendDbgDataCnt >> 8 & 0xff;
        sendDbgData[154] = sendDbgDataCnt & 0xff;
        sendDbgData[155] = (mStepSleepParam.currentHourStepCnt >> 8 & 0xff);
        sendDbgData[156]= (mStepSleepParam.currentHourStepCnt & 0xff);
        sendDbgData[157] = uteModuleHeartGetHeartValue();
        uteModuleProfileBle50SendToPhone(&sendDbgData[0], 158);
        memset(&sendDbgData[0], 0, 158);
        sendFrameCnt = 0;
        sendDbgDataCnt ++;
    }
    else
    {
        sendDbgData[3 + sendFrameCnt * 6 + 0] = tempx >> 8 & 0xff;
        sendDbgData[3 + sendFrameCnt * 6 + 1] = tempx & 0xff;
        sendDbgData[3 + sendFrameCnt * 6 + 2] = tempy >> 8 & 0xff;
        sendDbgData[3 + sendFrameCnt * 6 + 3] = tempy & 0xff;
        sendDbgData[3 + sendFrameCnt * 6 + 4] = tempz >> 8 & 0xff;
        sendDbgData[3 + sendFrameCnt * 6 + 5] = tempz & 0xff;
        sendFrameCnt ++;
    }
    if (!connectStatus.isConnected)
    {
        memset(&sendDbgData[0], 0, sizeof(sendDbgData));
        sendFrameCnt = 0;
    }
}
#endif

